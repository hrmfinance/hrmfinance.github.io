import{ax as b,h as a,ay as f,c as A,P as u}from"./index-BatYe0cj.js";const d={async getAccounts(t){t?.trim()||(t=a.getBusinessId());const e={businessId:a.getBusinessId()};return t?.split(" ").forEach((r,i)=>{r&&(e[`:search${i}`]=r.trim())}),(await u({query:"getAccounts",queryString:"!* contain :search0 AND !* contain :search1 AND !* contain :search2",params:e,limit:2e3})).data||[]},async createAccount(t){const s={query:"addAccount",params:{businessId:a.getBusinessId()},form:t},n=await u(s);return n.data||n},async updateAccount(t,e){const n={query:"updateAccount",params:{businessId:a.getBusinessId(),id:t},data2update:e},r=await u(n);return r.data||r},async deleteAccount(t){const s={query:"deleteAccount",params:{businessId:a.getBusinessId(),id:t}};return await u(s)},async getJournalEntries(t){t?.trim()||(t=a.getBusinessId());const e={businessId:a.getBusinessId(),year:a.getSelectedYear()};return t?.split(" ").forEach((r,i)=>{r&&(e[`:search${i}`]=r.trim())}),(await u({query:"getEntryBooks",queryString:"!* contain :search0 AND !* contain :search1 AND !* contain :search2",params:e})).data||[]},async createJournalEntry(t){const s={query:"addEntryBook",params:{businessId:a.getBusinessId()},form:t},n=await u(s);return n.data||n},async updateJournalEntry(t,e){const n={query:"updateEntryBook",params:{businessId:a.getBusinessId(),id:t},form:e},r=await u(n);return r.data||r},async postJournalEntry(t){const s={query:"postEntryBook",params:{businessId:a.getBusinessId(),id:t},form:{status:"posted",postedAt:new Date().toISOString(),postedBy:a.state?.user?.uid||"system"}},n=await u(s);return n.data||n},async voidJournalEntry(t){const s={query:"updateEntryBook",params:{businessId:a.getBusinessId(),id:t},form:{status:"void",voidedAt:new Date().toISOString(),voidedBy:a.state?.user?.uid||"system"}},n=await u(s);return n.data||n},async getDocuments(t){t?.trim()||(t=a.getBusinessId());const e={businessId:a.getBusinessId()};return t?.split(" ").forEach((r,i)=>{r&&(e[`:search${i}`]=r.trim())}),(await u({query:"getDocuments",queryString:"!* contain :search0 AND !* contain :search1 AND !* contain :search2",params:e})).data||[]},async uploadDocument(t,e){const s=await t.arrayBuffer(),n=Array.from(new Uint8Array(s)),i={query:"uploadDocument",params:{businessId:a.getBusinessId(),userId:a.state?.user?.uid,timestamp:new Date().getTime()},form:{fileBuffer:n,fileName:t.name,mimeType:t.type,fileSize:t.size,...e,uploadedAt:new Date().toISOString(),uploadedBy:a.state?.user?.uid||"system"}},l=await u(i);return l.data||l}},{accounts:c,setAccounts:y,transactions:p,setTransactions:I,documents:h,setDocuments:w,isLoading:E,setIsLoading:o}=b(()=>{const[t,e]=A([]),[s,n]=A([]),[r,i]=A([]),[l,g]=A(!1);return{accounts:t,setAccounts:e,transactions:s,setTransactions:n,documents:r,setDocuments:i,isLoading:l,setIsLoading:g}}),D={get accounts(){return c()},get transactions(){return p()},get documents(){return h()},get isLoading(){return E()},async loadAccounts(t){o(!0);try{const e=await d.getAccounts(t||a.getBusinessId());y(e)}catch(e){throw console.error("Error loading accounts:",e),e}finally{o(!1)}},async addAccount(t){o(!0);try{const e={...t,id:f(16),accountId:f(16),createdDate:new Date().toISOString(),lastModified:new Date().toISOString(),isActive:t.isActive??!0},s=await d.createAccount(e);return y([...c(),s]),s}catch(e){throw console.error("Error adding account:",e),e}finally{o(!1)}},async updateAccount(t,e){o(!0);try{const s={...e,lastModified:new Date().toISOString()};await d.updateAccount(t,s),y(c().map(n=>n.id===t?{...n,...s}:n))}catch(s){throw console.error("Error updating account:",s),s}finally{o(!1)}},async deleteAccount(t){o(!0);try{await d.deleteAccount(t),y(c().filter(e=>e.id!==t))}catch(e){throw console.error("Error deleting account:",e),e}finally{o(!1)}},getAccountById(t){return c().find(e=>e.id===t)},getAccountsByType(t){return c().filter(e=>e.accountType===t||e.type===t||e.classification===t)},getAccountHierarchy(){return c().filter(e=>!e.parentAccountId).map(e=>({...e,subAccounts:c().filter(s=>s.parentAccountId===e.id)}))},async loadTransactions(t){o(!0);try{const e=t?.search||a.getBusinessId(),s=await d.getJournalEntries(e);I(s)}catch(e){throw console.error("Error loading transactions:",e),e}finally{o(!1)}},async addTransaction(t){o(!0);try{const e={...t,id:f(16),entryNumber:`JE-${Date.now()}`,status:"draft",createdAt:new Date().toISOString(),createdBy:a.state?.user?.uid||"system",businessId:a.getBusinessId()},s=await d.createJournalEntry(e);return I([...p(),s]),s}catch(e){throw console.error("Error adding transaction:",e),e}finally{o(!1)}},async postTransaction(t){o(!0);try{const e=await d.postJournalEntry(t);I(p().map(s=>s.id===t?e:s))}catch(e){throw console.error("Error posting transaction:",e),e}finally{o(!1)}},async voidTransaction(t){o(!0);try{const e=await d.voidJournalEntry(t);I(p().map(s=>s.id===t?e:s))}catch(e){throw console.error("Error voiding transaction:",e),e}finally{o(!1)}},getTransactionById(t){return p().find(e=>e.id===t)},async loadDocuments(t){o(!0);try{const e=await d.getDocuments(t||a.getBusinessId());w(e)}catch(e){throw console.error("Error loading documents:",e),e}finally{o(!1)}},async uploadDocument(t,e){o(!0);try{const s={...e,id:f(16),businessId:a.getBusinessId()},n=await d.uploadDocument(t,s);return w([...h(),n]),n}catch(s){throw console.error("Error uploading document:",s),s}finally{o(!1)}},getDocumentById(t){return h().find(e=>e.id===t)},get totalAssets(){return c().filter(t=>t.accountType==="Asset"||t.classification==="Asset").reduce((t,e)=>t+(e.balance||0),0)},get totalLiabilities(){return c().filter(t=>t.accountType==="Liability"||t.classification==="Liability").reduce((t,e)=>t+(e.balance||0),0)},get totalEquity(){return c().filter(t=>t.accountType==="Equity"||t.classification==="Equity").reduce((t,e)=>t+(e.balance||0),0)},get totalRevenue(){return c().filter(t=>t.accountType==="Revenue"||t.classification==="Revenue").reduce((t,e)=>t+(e.balance||0),0)},get totalExpenses(){return c().filter(t=>t.accountType==="Expense"||t.classification==="Expense").reduce((t,e)=>t+(e.balance||0),0)},get accountsByType(){const t={};return c().forEach(e=>{const s=e.accountType||e.type||e.classification||"Uncategorized";t[s]||(t[s]=[]),t[s].push(e)}),t},updateBalancesFromJournalEntries(t){const e=c().map(s=>{let n=0,r=0;t.forEach(g=>{g.status==="posted"&&g.lines?.forEach(m=>{(m.accountId===s.id||m.accountNumber===s.accountNumber)&&(n+=m.debitAmount||0,r+=m.creditAmount||0)})});const i=s.accountType||s.type||s.classification||"Asset";let l=0;return i==="Asset"||i==="Expense"?l=n-r:l=r-n,{...s,balance:l}});y(e)}};export{D as a};
