import{h as C,Q as we,e as O,P as G,u as Se,c as E,o as Ce,g as _e,t as P,i as r,a as s,v,I as A,B as z,w as pe,b as ue,S as de,F as Ie,k as B,y as Ee,M as Ne}from"./index-lxO5XhQ-.js";class ke{async createShipper(p){try{const o=C.state.user;if(!o)throw new Error("User not authenticated");const u=Date.now(),y={id:we(),name:p.name,companyName:p.companyName,address:p.address,contact:p.contact,taxId:p.taxId,licenseNumber:p.licenseNumber,insuranceInfo:p.insuranceInfo,notes:p.notes,isActive:p.isActive??!0,createdBy:o.uid,createdAt:u.toString(),updatedAt:u.toString(),businessId:C.getBusinessId()},_={query:"addShipper",params:{businessId:C.getBusinessId()},form:y};return O("Creating shipper:",_),(await G(_))?.shipper||y}catch(o){throw console.error("Error creating shipper:",o),new Error(`Failed to create shipper: ${o instanceof Error?o.message:"Unknown error"}`)}}async getShippers(p){try{if(!C.state.user)throw new Error("User not authenticated");let u={};p&&p.trim()&&p.split(" ").map((_,N)=>{_&&(u[`:search${N}`]=_.trim())});const y={query:"getShipperYabaExpress",params:u,queryString:p?"!* contain :search0 AND !* contain :search1 AND !* contain :search2 AND !* contain :search3 AND user = guia":""};return O("Fetching shippers:",y),(await G(y))?.data||[]}catch(o){throw console.error("Error fetching shippers:",o),new Error(`Failed to fetch shippers: ${o instanceof Error?o.message:"Unknown error"}`)}}async getShipperById(p){try{if(!C.state.user)throw new Error("User not authenticated");const y={query:"getShipperById",params:{businessId:C.getBusinessId(),id:p}};return O("Fetching shipper by id:",y),(await G(y))?.shipper||null}catch(o){throw console.error("Error fetching shipper:",o),new Error(`Failed to fetch shipper: ${o instanceof Error?o.message:"Unknown error"}`)}}async updateShipper(p,o){try{const u=C.state.user;if(!u)throw new Error("User not authenticated");const y=Date.now(),b={...o,updatedAt:y.toString(),updatedBy:u.uid},N={query:"updateShipper",params:{businessId:C.getBusinessId(),id:p},form:b};return O("Updating shipper:",N),(await G(N))?.shipper||{...b,id:p}}catch(u){throw console.error("Error updating shipper:",u),new Error(`Failed to update shipper: ${u instanceof Error?u.message:"Unknown error"}`)}}async deleteShipper(p){try{if(!C.state.user)throw new Error("User not authenticated");const y={query:"deleteShipper",params:{businessId:C.getBusinessId(),id:p}};O("Deleting shipper:",y);const b=await G(y);if(b?.error)throw new Error(b.error)}catch(o){throw console.error("Error deleting shipper:",o),new Error(`Failed to delete shipper: ${o instanceof Error?o.message:"Unknown error"}`)}}async toggleShipperStatus(p,o){return this.updateShipper(p,{isActive:o})}}const Q=new ke;var Ae=P("<div><strong></strong> "),ze=P("<div><p>Cargando..."),Ue=P("<div>"),De=P("<div><h3>Información Básica</h3><div>"),Fe=P("<div><h3>Dirección</h3><div>"),Be=P("<div><h3>Información de Contacto</h3><div>"),Le=P("<div><h3></h3><div>"),Me=P("<div><h3>Información Adicional"),qe=P("<div><h2></h2><div>"),Re=P("<div><div><h1></h1><p></p></div><div><div>"),je=P("<div><table><thead><tr><th></th><th></th><th></th><th></th><th></th><th>Estado</th><th>Acciones</th></tr></thead><tbody>"),Oe=P("<div><p>"),Ge=P("<tr><td></td><td></td><td></td><td></td><td>, </td><td><span></span></td><td><div>");const Qe=()=>{const{t:e}=Se(),[p,o]=E([]),[u,y]=E(!1),[b,_]=E(""),[N,T]=E(!1),[L,V]=E(null),[g,W]=E({name:"",companyName:"",address:{street:"",city:"",state:"",zipCode:"",country:""},contact:{phone:"",email:"",fax:""},taxId:"",licenseNumber:"",insuranceInfo:{provider:"",policyNumber:"",expirationDate:""},notes:"",isActive:!0}),[M,X]=E({}),[U,w]=E(null),me=["Estados Unidos","Cuba","México","Canadá","España","Francia","Alemania","Reino Unido","Italia","China","Japón","Brasil"];Ce(()=>{q()});const ce=_e(()=>b()?p().filter(t=>t.name.toLowerCase().includes(b().toLowerCase())||t.companyName?.toLowerCase().includes(b().toLowerCase())||t.contact.email.toLowerCase().includes(b().toLowerCase())||t.licenseNumber?.toLowerCase().includes(b().toLowerCase())):p()),q=async()=>{try{y(!0),w(null);const t=await Q.getShippers();o(t)}catch(t){console.error("Error loading shippers:",t),w({type:"error",text:e("shipper.messages.loadError")})}finally{y(!1)}},ge=()=>{const t=g(),h={};return t.name.trim()||(h.name=e("shipper.validation.nameRequired")),t.address.street.trim()||(h.street=e("shipper.validation.streetRequired")),t.address.city.trim()||(h.city=e("shipper.validation.cityRequired")),t.address.country.trim()||(h.country=e("shipper.validation.countryRequired")),t.contact.email&&!/\S+@\S+\.\S+/.test(t.contact.email)&&(h.email=e("shipper.validation.emailInvalid")),X(h),Object.keys(h).length===0},he=async()=>{if(ge())try{y(!0),w(null),L()?(await Q.updateShipper(L().id,g()),w({type:"success",text:e("shipper.messages.updateSuccess")})):(await Q.createShipper(g()),w({type:"success",text:e("shipper.messages.createSuccess")})),await q(),Z()}catch(t){console.error("Error saving shipper:",t),w({type:"error",text:L()?e("shipper.messages.updateError"):e("shipper.messages.createError")})}finally{y(!1)}},fe=t=>{V(t),W({name:t.name,companyName:t.companyName||"",address:t.address,contact:t.contact,taxId:t.taxId||"",licenseNumber:t.licenseNumber||"",insuranceInfo:t.insuranceInfo||{provider:"",policyNumber:"",expirationDate:""},notes:t.notes||"",isActive:t.isActive}),T(!0)},ve=async t=>{if(confirm(e("shipper.deleteConfirm")))try{y(!0),await Q.deleteShipper(t.id),w({type:"success",text:e("shipper.messages.deleteSuccess")}),await q()}catch(h){console.error("Error deleting shipper:",h),w({type:"error",text:e("shipper.messages.deleteError")})}finally{y(!1)}},be=async t=>{try{y(!0),await Q.toggleShipperStatus(t.id,!t.isActive),w({type:"success",text:e("shipper.messages.statusChanged")}),await q()}catch(h){console.error("Error changing shipper status:",h),w({type:"error",text:e("shipper.messages.updateError")})}finally{y(!1)}},Pe=()=>{V(null),W({name:"",companyName:"",address:{street:"",city:"",state:"",zipCode:"",country:""},contact:{phone:"",email:"",fax:""},taxId:"",licenseNumber:"",insuranceInfo:{provider:"",policyNumber:"",expirationDate:""},notes:"",isActive:!0}),X({}),T(!0)},Z=()=>{T(!1),V(null),X({})},f=(t,h)=>{W(k=>{const D={...k};let x=D;for(let S=0;S<t.length-1;S++)x=x[t[S]]={...x[t[S]]};return x[t[t.length-1]]=h,D})};return(()=>{var t=Re(),h=t.firstChild,k=h.firstChild,D=k.nextSibling,x=h.nextSibling,S=x.firstChild;return t.style.setProperty("padding","2rem"),t.style.setProperty("max-width","1200px"),t.style.setProperty("margin","0 auto"),h.style.setProperty("margin-bottom","2rem"),h.style.setProperty("text-align","center"),k.style.setProperty("font-size","2rem"),k.style.setProperty("font-weight","700"),k.style.setProperty("color","var(--text-primary)"),r(k,()=>e("shipper.pageTitle")),D.style.setProperty("color","var(--text-muted)"),D.style.setProperty("font-size","1.125rem"),r(D,()=>e("shipper.pageSubtitle")),x.style.setProperty("display","flex"),x.style.setProperty("justify-content","space-between"),x.style.setProperty("align-items","center"),x.style.setProperty("margin-bottom","2rem"),x.style.setProperty("gap","1rem"),x.style.setProperty("flex-wrap","wrap"),S.style.setProperty("display","flex"),S.style.setProperty("gap","1rem"),S.style.setProperty("align-items","center"),r(S,s(v,{placeholder:"Buscar transportistas...",get value(){return b()},onChange:_,style:{"min-width":"300px"}}),null),r(S,s(z,{onClick:q,get disabled(){return u()},get children(){return[s(A,{name:"search",size:"1em",style:{"margin-right":"0.5rem"}}),"Buscar"]}}),null),r(x,s(z,{onClick:Pe,variant:"primary",get disabled(){return u()},get children(){return[s(A,{name:"add",size:"1em",style:{"margin-right":"0.5rem"}}),pe(()=>e("shipper.createNew"))]}}),null),r(t,s(de,{get when(){return U()},get children(){var d=Ae(),c=d.firstChild;return c.nextSibling,d.style.setProperty("padding","1rem"),d.style.setProperty("margin-bottom","1rem"),d.style.setProperty("border-radius","var(--border-radius)"),r(c,()=>U().type==="success"?"✓ Éxito:":"⚠ Error:"),r(d,()=>U().text,null),ue(i=>{var l=U().type==="success"?"var(--success-light)":"var(--error-light)",m=U().type==="success"?"var(--success-dark)":"var(--error-dark)",n=`1px solid ${U().type==="success"?"var(--success-color)":"var(--error-color)"}`;return l!==i.e&&((i.e=l)!=null?d.style.setProperty("background",l):d.style.removeProperty("background")),m!==i.t&&((i.t=m)!=null?d.style.setProperty("color",m):d.style.removeProperty("color")),n!==i.a&&((i.a=n)!=null?d.style.setProperty("border",n):d.style.removeProperty("border")),i},{e:void 0,t:void 0,a:void 0}),d}}),null),r(t,s(B,{get children(){var d=Ue();return d.style.setProperty("padding","1.5rem"),r(d,s(de,{get when(){return u()},get fallback(){return s(de,{get when(){return ce().length>0},get fallback(){return(()=>{var c=Oe(),i=c.firstChild;return c.style.setProperty("text-align","center"),c.style.setProperty("padding","2rem"),c.style.setProperty("color","var(--text-muted)"),r(c,s(A,{name:"shipping",size:"3rem",style:{opacity:"0.3","margin-bottom":"1rem"}}),i),r(i,()=>e("shipper.messages.noRecords")),c})()},get children(){var c=je(),i=c.firstChild,l=i.firstChild,m=l.firstChild,n=m.firstChild,a=n.nextSibling,J=a.nextSibling,Y=J.nextSibling,H=Y.nextSibling,ee=H.nextSibling,ye=ee.nextSibling,xe=l.nextSibling;return c.style.setProperty("overflow-x","auto"),i.style.setProperty("width","100%"),i.style.setProperty("border-collapse","collapse"),m.style.setProperty("border-bottom","2px solid var(--border-color)"),n.style.setProperty("padding","1rem"),n.style.setProperty("text-align","left"),r(n,()=>e("shipper.fields.name")),a.style.setProperty("padding","1rem"),a.style.setProperty("text-align","left"),r(a,()=>e("shipper.fields.companyName")),J.style.setProperty("padding","1rem"),J.style.setProperty("text-align","left"),r(J,()=>e("shipper.fields.licenseNumber")),Y.style.setProperty("padding","1rem"),Y.style.setProperty("text-align","left"),r(Y,()=>e("shipper.fields.email")),H.style.setProperty("padding","1rem"),H.style.setProperty("text-align","left"),r(H,()=>e("shipper.fields.city")),ee.style.setProperty("padding","1rem"),ee.style.setProperty("text-align","center"),ye.style.setProperty("padding","1rem"),ye.style.setProperty("text-align","center"),r(xe,s(Ie,{get each(){return ce()},children:$=>(()=>{var re=Ge(),te=re.firstChild,se=te.nextSibling,ne=se.nextSibling,ae=ne.nextSibling,R=ae.nextSibling,$e=R.firstChild,K=R.nextSibling,I=K.firstChild,le=K.nextSibling,F=le.firstChild;return re.style.setProperty("border-bottom","1px solid var(--border-light)"),te.style.setProperty("padding","1rem"),r(te,()=>$.name),se.style.setProperty("padding","1rem"),r(se,()=>$.companyName||"-"),ne.style.setProperty("padding","1rem"),r(ne,()=>$.licenseNumber||"-"),ae.style.setProperty("padding","1rem"),r(ae,()=>$.contact.email||"-"),R.style.setProperty("padding","1rem"),r(R,()=>$.address.city,$e),r(R,()=>$.address.country,null),K.style.setProperty("padding","1rem"),K.style.setProperty("text-align","center"),I.style.setProperty("padding","0.25rem 0.5rem"),I.style.setProperty("border-radius","4px"),I.style.setProperty("font-size","0.875rem"),r(I,()=>$.isActive?"Activo":"Inactivo"),le.style.setProperty("padding","1rem"),le.style.setProperty("text-align","center"),F.style.setProperty("display","flex"),F.style.setProperty("gap","0.5rem"),F.style.setProperty("justify-content","center"),r(F,s(z,{size:"sm",variant:"secondary",onClick:()=>fe($),get children(){return s(A,{name:"edit",size:"0.875rem"})}}),null),r(F,s(z,{size:"sm",variant:"secondary",onClick:()=>be($),get children(){return s(A,{get name(){return $.isActive?"close":"check"},size:"0.875rem"})}}),null),r(F,s(z,{size:"sm",variant:"secondary",onClick:()=>ve($),style:{color:"var(--error-color)"},get children(){return s(A,{name:"delete",size:"0.875rem"})}}),null),ue(j=>{var oe=$.isActive?"var(--success-light)":"var(--error-light)",ie=$.isActive?"var(--success-dark)":"var(--error-dark)";return oe!==j.e&&((j.e=oe)!=null?I.style.setProperty("background",oe):I.style.removeProperty("background")),ie!==j.t&&((j.t=ie)!=null?I.style.setProperty("color",ie):I.style.removeProperty("color")),j},{e:void 0,t:void 0}),re})()})),c}})},get children(){var c=ze(),i=c.firstChild;return c.style.setProperty("text-align","center"),c.style.setProperty("padding","2rem"),r(c,s(A,{name:"loading",size:"2rem"}),i),c}})),d}}),null),r(t,s(Ne,{get isOpen(){return N()},onClose:Z,size:"large",get children(){var d=qe(),c=d.firstChild,i=c.nextSibling;return d.style.setProperty("padding","2rem"),c.style.setProperty("margin-bottom","1.5rem"),r(c,(()=>{var l=pe(()=>!!L());return()=>l()?e("shipper.editShipper"):e("shipper.createNew")})()),r(d,s(B,{style:{"margin-bottom":"1.5rem"},get children(){var l=De(),m=l.firstChild,n=m.nextSibling;return l.style.setProperty("padding","1.5rem"),m.style.setProperty("margin-bottom","1rem"),n.style.setProperty("display","grid"),n.style.setProperty("grid-template-columns","repeat(auto-fit, minmax(300px, 1fr))"),n.style.setProperty("gap","1rem"),r(n,s(v,{get label(){return`${e("shipper.fields.name")} *`},get value(){return g().name},onChange:a=>f(["name"],a),get placeholder(){return e("shipper.placeholders.name")},get error(){return M().name}}),null),r(n,s(v,{get label(){return e("shipper.fields.companyName")},get value(){return g().companyName||""},onChange:a=>f(["companyName"],a),get placeholder(){return e("shipper.placeholders.companyName")}}),null),r(n,s(v,{get label(){return e("shipper.fields.taxId")},get value(){return g().taxId||""},onChange:a=>f(["taxId"],a),get placeholder(){return e("shipper.placeholders.taxId")}}),null),r(n,s(v,{get label(){return e("shipper.fields.licenseNumber")},get value(){return g().licenseNumber||""},onChange:a=>f(["licenseNumber"],a),get placeholder(){return e("shipper.placeholders.licenseNumber")}}),null),l}}),i),r(d,s(B,{style:{"margin-bottom":"1.5rem"},get children(){var l=Fe(),m=l.firstChild,n=m.nextSibling;return l.style.setProperty("padding","1.5rem"),m.style.setProperty("margin-bottom","1rem"),n.style.setProperty("display","grid"),n.style.setProperty("grid-template-columns","repeat(auto-fit, minmax(300px, 1fr))"),n.style.setProperty("gap","1rem"),r(n,s(v,{get label(){return`${e("shipper.fields.street")} *`},get value(){return g().address.street},onChange:a=>f(["address","street"],a),get placeholder(){return e("shipper.placeholders.street")},get error(){return M().street}}),null),r(n,s(v,{get label(){return`${e("shipper.fields.city")} *`},get value(){return g().address.city},onChange:a=>f(["address","city"],a),get placeholder(){return e("shipper.placeholders.city")},get error(){return M().city}}),null),r(n,s(v,{get label(){return e("shipper.fields.state")},get value(){return g().address.state},onChange:a=>f(["address","state"],a),get placeholder(){return e("shipper.placeholders.state")}}),null),r(n,s(v,{get label(){return e("shipper.fields.zipCode")},get value(){return g().address.zipCode},onChange:a=>f(["address","zipCode"],a),get placeholder(){return e("shipper.placeholders.zipCode")}}),null),r(n,s(Ee,{get label(){return`${e("shipper.fields.country")} *`},get value(){return g().address.country},onChange:a=>f(["address","country"],a),get options(){return me.map(a=>({value:a,label:a}))},get error(){return M().country}}),null),l}}),i),r(d,s(B,{style:{"margin-bottom":"1.5rem"},get children(){var l=Be(),m=l.firstChild,n=m.nextSibling;return l.style.setProperty("padding","1.5rem"),m.style.setProperty("margin-bottom","1rem"),n.style.setProperty("display","grid"),n.style.setProperty("grid-template-columns","repeat(auto-fit, minmax(300px, 1fr))"),n.style.setProperty("gap","1rem"),r(n,s(v,{get label(){return e("shipper.fields.phone")},get value(){return g().contact.phone},onChange:a=>f(["contact","phone"],a),get placeholder(){return e("shipper.placeholders.phone")}}),null),r(n,s(v,{get label(){return e("shipper.fields.email")},type:"email",get value(){return g().contact.email},onChange:a=>f(["contact","email"],a),get placeholder(){return e("shipper.placeholders.email")},get error(){return M().email}}),null),r(n,s(v,{get label(){return e("shipper.fields.fax")},get value(){return g().contact.fax||""},onChange:a=>f(["contact","fax"],a),get placeholder(){return e("shipper.placeholders.fax")}}),null),l}}),i),r(d,s(B,{style:{"margin-bottom":"1.5rem"},get children(){var l=Le(),m=l.firstChild,n=m.nextSibling;return l.style.setProperty("padding","1.5rem"),m.style.setProperty("margin-bottom","1rem"),r(m,()=>e("shipper.fields.insuranceInfo")),n.style.setProperty("display","grid"),n.style.setProperty("grid-template-columns","repeat(auto-fit, minmax(300px, 1fr))"),n.style.setProperty("gap","1rem"),r(n,s(v,{get label(){return e("shipper.fields.insuranceProvider")},get value(){return g().insuranceInfo?.provider||""},onChange:a=>f(["insuranceInfo","provider"],a),get placeholder(){return e("shipper.placeholders.insuranceProvider")}}),null),r(n,s(v,{get label(){return e("shipper.fields.policyNumber")},get value(){return g().insuranceInfo?.policyNumber||""},onChange:a=>f(["insuranceInfo","policyNumber"],a),get placeholder(){return e("shipper.placeholders.policyNumber")}}),null),r(n,s(v,{get label(){return e("shipper.fields.expirationDate")},type:"date",get value(){return g().insuranceInfo?.expirationDate||""},onChange:a=>f(["insuranceInfo","expirationDate"],a)}),null),l}}),i),r(d,s(B,{style:{"margin-bottom":"1.5rem"},get children(){var l=Me(),m=l.firstChild;return l.style.setProperty("padding","1.5rem"),m.style.setProperty("margin-bottom","1rem"),r(l,s(v,{get label(){return e("shipper.fields.notes")},get value(){return g().notes||""},onChange:n=>f(["notes"],n),get placeholder(){return e("shipper.placeholders.notes")},multiline:!0,rows:3}),null),l}}),i),i.style.setProperty("display","flex"),i.style.setProperty("gap","1rem"),i.style.setProperty("justify-content","flex-end"),r(i,s(z,{variant:"outline",onClick:Z,get disabled(){return u()},children:"Cancelar"}),null),r(i,s(z,{variant:"primary",onClick:he,get disabled(){return u()},get children(){return pe(()=>!!u())()?"Guardando...":L()?"Actualizar":"Crear"}}),null),d}}),null),t})()};var Te=P("<div>");const Ye=()=>(()=>{var e=Te();return e.style.setProperty("min-height","100vh"),e.style.setProperty("background","var(--background-secondary)"),e.style.setProperty("padding","1rem 0"),r(e,s(Qe,{})),e})();export{Ye as default};
