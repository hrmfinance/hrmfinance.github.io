import{e as y,aS as ve,aT as Pe,c as w,D as be,o as we,aU as $e,a as d,t as $,i as l,S as W,B as m,b as ne,W as Se,w as Ce,k as _e,d as ze}from"./index-B4xu28zF.js";let Z=null;const ke=async()=>Z||(y("Loading BlazeFace model..."),await ve(),Z=await Pe(),y("BlazeFace model loaded successfully"),Z),xe=async J=>{try{const j=await(await ke()).estimateFaces(J,!1);if(j.length===0)return y("No faces detected in image"),null;const k=j[0],[M,T]=k.topLeft,[O,p]=k.bottomRight,Y=O-M,h=p-T,X=M+Y/2,g=T+h/2,S={topLeft:[M,T],bottomRight:[O,p],landmarks:k.landmarks,confidence:k.probability?.[0]||.9,centerX:X,centerY:g,width:Y,height:h};return y("Face detected:",S),S}catch(A){return y("Error detecting face:",A),null}};var Me=$("<div><div>ğŸ“·</div><p>Selecciona una foto para procesar</p><div><input type=file accept=image/*>"),Te=$("<div><div>ğŸ”</div><p>Detectando rostro y calculando centro..."),Fe=$("<div>Confianza: <!>%"),De=$("<div><div><label>Acciones RÃ¡pidas</label><div></div></div><div><label>Opciones de Vista</label><div><label><input type=checkbox>Mostrar guÃ­as de medida</label><div><div>TamaÃ±o: <!>Ã—<!>px</div><div>Centro: (<!>, <!>)"),Le=$('<img alt="Vista previa 600x600">'),Ie=$("<div><div><h4>Resultado 600Ã—600</h4></div><div><div><label>Padding: <!>px</label><div><input type=range min=10 max=800 step=5></div><div>10px = Muy ajustado | 150px = MÃ¡s cabello</div></div><div><label>Mover Recorte</label><div><div></div><div></div><div></div><div></div></div><div>Mueve 10px por clic"),Re=$("<div><h5>ğŸ“ Opciones de Descarga</h5><div><div><strong>ğŸ“¥ EstÃ¡ndar (600px)</strong><div>2Ã—2 pulgadas @ 300 PPI</div><div>Web y documentos digitales</div></div><div><strong>ğŸ–¨ï¸ HD (1800px)</strong><div>2Ã—2 pulgadas @ 900 PPI</div><div>ImpresiÃ³n profesional</div></div><div><strong>ğŸ’ Original</strong><div>ResoluciÃ³n nativa</div><div>MÃ¡xima calidad posible"),Ee=$("<div>"),Ae=$("<div><h3>ğŸ“¸ Recorte Simple de Pasaporte");const Xe=J=>{const[A,j]=w(null),[k,M]=w(""),[T,O]=w(!1),[p,Y]=w(null),[h,X]=w(null),[g,S]=w({x:0,y:0,size:200}),[F,K]=w(""),[D,ee]=w(600),[se,ye]=w(!0),[le,te]=w(null),B=10,G=()=>{if(!p())return;const e=p(),r=g();y("ğŸ–¼ï¸ CREATING PREVIEW:",{originalImageSize:{width:e.width,height:e.height},cropInOriginal:r,outputSize:"600x600"});const t=document.createElement("canvas"),i=t.getContext("2d");i&&(t.width=600,t.height=600,i.fillStyle="#FFFFFF",i.fillRect(0,0,600,600),i.drawImage(e,r.x,r.y,r.size,r.size,0,0,600,600),se()&&ce(i,600,600),K(t.toDataURL("image/jpeg",.95)))},re=(e=600,r=.95)=>{if(!p())return"";const t=p(),i=g(),o=document.createElement("canvas"),n=o.getContext("2d");return n?(o.width=e,o.height=e,n.fillStyle="#FFFFFF",n.fillRect(0,0,e,e),n.imageSmoothingEnabled=!0,n.imageSmoothingQuality="high",n.drawImage(t,i.x,i.y,i.size,i.size,0,0,e,e),o.toDataURL("image/jpeg",r)):""},pe=()=>{if(!p())return"";const e=p(),r=g(),t=Math.round(r.size),i=document.createElement("canvas"),o=i.getContext("2d");return o?(i.width=t,i.height=t,y("ğŸ¯ Original Quality Export:",{cropArea:r,outputSize:t,originalImageSize:{width:e.width,height:e.height}}),o.fillStyle="#FFFFFF",o.fillRect(0,0,t,t),o.imageSmoothingEnabled=!1,o.drawImage(e,r.x,r.y,r.size,r.size,0,0,t,t),i.toDataURL("image/png")):""},ce=(e,r,t)=>{e.save(),e.strokeStyle="#ff0000",e.lineWidth=2,e.setLineDash([8,4]);const i=t*.5,o=t*.69;e.strokeStyle="rgb(45, 125, 50)",e.lineWidth=2,e.setLineDash([8,4]),e.beginPath(),e.moveTo(0,i),e.lineTo(r,i),e.stroke(),e.beginPath(),e.moveTo(0,o),e.lineTo(r,o),e.stroke();const n=t*.56,a=t*.69;e.strokeStyle="rgb(200, 100, 50)",e.beginPath(),e.moveTo(r-40,n),e.lineTo(r-30,n),e.moveTo(r-40,a),e.lineTo(r-30,a),e.stroke();const c=r/2,u=r*.3,P=r*.7;e.beginPath(),e.moveTo(c,0),e.lineTo(c,t),e.moveTo(u,0),e.lineTo(u,t),e.moveTo(P,0),e.lineTo(P,t),e.stroke(),e.setLineDash([]),e.fillStyle="rgba(255, 0, 0, 0.8)",e.font="bold 12px Arial",e.textAlign="left",e.fillText("Zona de Ojos",5,i-5),e.fillText("300-414px",5,i+15),e.fillText("Altura de Cara",r-120,n+20),e.fillText("336-414px",r-120,n+35),e.strokeStyle="#0000ff",e.fillStyle="#0000ff",e.lineWidth=1,e.setLineDash([]);const s=8;e.beginPath(),e.moveTo(50,20),e.lineTo(r-50,20),e.stroke(),e.beginPath(),e.moveTo(50,20),e.lineTo(50+s,20-s/2),e.lineTo(50+s,20+s/2),e.closePath(),e.fill(),e.beginPath(),e.moveTo(r-50,20),e.lineTo(r-50-s,20-s/2),e.lineTo(r-50-s,20+s/2),e.closePath(),e.fill(),e.textAlign="center",e.fillText("2 pulgadas",r/2,15),e.beginPath(),e.moveTo(20,50),e.lineTo(20,t-50),e.stroke(),e.beginPath(),e.moveTo(20,50),e.lineTo(20-s/2,50+s),e.lineTo(20+s/2,50+s),e.closePath(),e.fill(),e.beginPath(),e.moveTo(20,t-50),e.lineTo(20-s/2,t-50-s),e.lineTo(20+s/2,t-50-s),e.closePath(),e.fill(),e.save(),e.translate(12,t/2),e.rotate(-Math.PI/2),e.textAlign="center",e.fillText("2 pulgadas",0,0),e.restore(),e.restore()},ge=()=>{},me=()=>{const e=k();if(!e)return;const r=new Image;r.onload=()=>{y("Image loaded:",r.width,r.height),Y(r),setTimeout(()=>{ie()},100)},r.onerror=t=>{y("Error loading image:",t)},r.src=e},ie=async()=>{if(p()){O(!0);try{const e=await xe(p());if(e){y("âœ… Face detected:",e),X(e);const r=e.topLeft[0]+e.width/2,t=e.topLeft[1]+e.height/2,i=Math.max(e.width,e.height),o=i+D()*2,n={x:r-o/2,y:t-o/2,size:o},a=p();n.x=Math.max(0,Math.min(a.width-n.size,n.x)),n.y=Math.max(0,Math.min(a.height-n.size,n.y)),y("ğŸ¯ Initial crop calculated:",{faceCenter:{x:r,y:t},faceSize:i,cropSize:o,finalCrop:n}),S(n)}else{y("No face detected, using center crop");const r=p(),t=Math.min(r.width,r.height)*.6;S({x:(r.width-t)/2,y:(r.height-t)/2,size:t})}ge(),G()}catch(e){y("Face detection failed:",e)}finally{O(!1)}}},N=e=>{const r=g(),t=p();let i=r.x,o=r.y;switch(e){case"up":o=Math.max(0,r.y-B);break;case"down":o=Math.min(t.height-r.size,r.y+B);break;case"left":i=Math.max(0,r.x-B);break;case"right":i=Math.min(t.width-r.size,r.x+B);break}const n={x:i,y:o,size:r.size};te({x:i+n.size/2,y:o+n.size/2}),y(`ğŸ”½ Moving ${e}:`,{oldPosition:{x:r.x,y:r.y},newPosition:{x:i,y:o},newCenter:le(),imageSize:{width:t.width,height:t.height}}),S(n),G()},ae=e=>{const r=e==="increase"?Math.min(800,D()+10):Math.max(10,D()-10);if(ee(r),h()){const t=h(),i=t.topLeft[0]+t.width/2,o=t.topLeft[1]+t.height/2,a=Math.max(t.width,t.height)+r*2,c=p(),u={x:Math.max(0,Math.min(c.width-a,i-a/2)),y:Math.max(0,Math.min(c.height-a,o-a/2)),size:a};y("ğŸ“ Padding adjusted:",{direction:e,newPadding:r,newCrop:u}),S(u),G()}},he=e=>{const t=e.target.files?.[0];if(t&&t.type.startsWith("image/")){j(t);const i=new FileReader;i.onload=o=>{y("File read complete"),M(o.target?.result),X(null),K("")},i.readAsDataURL(t)}},fe=()=>{const e=re();if(!e)return;const r={method:"simple_tensorflow_crop",confidence:h()?.confidence||0,cropArea:g(),padding:D(),processingDate:new Date().toISOString()};J.onPhotoReady?.(e,r)};return be(()=>{k()&&(y("Preview changed, loading image..."),me())}),we(()=>{}),$e(()=>{}),d(_e,{get children(){var e=Ae(),r=e.firstChild;return e.style.setProperty("padding","1.5rem"),r.style.setProperty("font-size","1.5rem"),r.style.setProperty("font-weight","600"),r.style.setProperty("margin-bottom","1.5rem"),r.style.setProperty("text-align","center"),l(e,d(W,{get when(){return!A()},get children(){var t=Me(),i=t.firstChild,o=i.nextSibling,n=o.nextSibling,a=n.firstChild;return t.style.setProperty("padding","3rem"),t.style.setProperty("border","3px dashed var(--border-color)"),t.style.setProperty("border-radius","var(--border-radius)"),t.style.setProperty("text-align","center"),t.style.setProperty("margin-bottom","2rem"),t.style.setProperty("background","var(--background-secondary)"),i.style.setProperty("font-size","3rem"),i.style.setProperty("margin-bottom","1rem"),o.style.setProperty("margin-bottom","1rem"),o.style.setProperty("font-size","1.1rem"),n.style.setProperty("position","relative"),n.style.setProperty("display","inline-block"),a.addEventListener("change",he),a.style.setProperty("position","absolute"),a.style.setProperty("opacity","0"),a.style.setProperty("width","100%"),a.style.setProperty("height","100%"),a.style.setProperty("cursor","pointer"),l(n,d(m,{variant:"primary",style:{"pointer-events":"none"},children:"ğŸ“ Elegir Foto"}),null),t}}),null),l(e,d(W,{get when(){return T()},get children(){var t=Te(),i=t.firstChild,o=i.nextSibling;return t.style.setProperty("text-align","center"),t.style.setProperty("padding","2rem"),t.style.setProperty("background","var(--info-light)"),t.style.setProperty("border-radius","var(--border-radius)"),t.style.setProperty("margin-bottom","1.5rem"),i.style.setProperty("font-size","2rem"),i.style.setProperty("margin-bottom","1rem"),o.style.setProperty("font-size","1.1rem"),o.style.setProperty("font-weight","500"),t}}),null),l(e,d(W,{get when(){return Ce(()=>!!(A()&&!T()))()&&p()},get children(){return[(()=>{var t=De(),i=t.firstChild,o=i.firstChild,n=o.nextSibling,a=i.nextSibling,c=a.firstChild,u=c.nextSibling,P=u.firstChild,s=P.firstChild,b=P.nextSibling,C=b.firstChild,oe=C.firstChild,_=oe.nextSibling,f=_.nextSibling,H=f.nextSibling;H.nextSibling;var L=C.nextSibling,I=L.firstChild,Q=I.nextSibling,R=Q.nextSibling,v=R.nextSibling;return v.nextSibling,t.style.setProperty("display","grid"),t.style.setProperty("grid-template-columns","repeat(auto-fit, minmax(250px, 1fr))"),t.style.setProperty("gap","1.5rem"),t.style.setProperty("margin-bottom","1.5rem"),t.style.setProperty("padding","1rem"),t.style.setProperty("background","var(--background-secondary)"),t.style.setProperty("border-radius","var(--border-radius)"),o.style.setProperty("display","block"),o.style.setProperty("margin-bottom","0.5rem"),o.style.setProperty("font-weight","500"),n.style.setProperty("display","flex"),n.style.setProperty("flex-direction","column"),n.style.setProperty("gap","0.5rem"),l(n,d(m,{onClick:()=>{ee(50),te(null),ie()},variant:"secondary",size:"sm",children:"ğŸ”„ Reset Todo"})),c.style.setProperty("display","block"),c.style.setProperty("margin-bottom","0.5rem"),c.style.setProperty("font-weight","500"),u.style.setProperty("display","flex"),u.style.setProperty("flex-direction","column"),u.style.setProperty("gap","0.5rem"),P.style.setProperty("font-size","0.875rem"),P.style.setProperty("display","flex"),P.style.setProperty("align-items","center"),s.addEventListener("change",z=>{ye(z.target.checked),G()}),s.style.setProperty("margin-right","0.5rem"),b.style.setProperty("font-size","0.75rem"),b.style.setProperty("color","var(--text-muted)"),b.style.setProperty("margin-left","1.5rem"),l(C,()=>Math.round(g().size),_),l(C,()=>Math.round(g().size),H),l(L,()=>Math.round(g().x+g().size/2),Q),l(L,()=>Math.round(g().y+g().size/2),v),l(b,d(W,{get when(){return h()},get children(){var z=Fe(),E=z.firstChild,x=E.nextSibling;return x.nextSibling,l(z,()=>((h()?.confidence||0)*100).toFixed(1),x),z}}),null),ne(()=>s.checked=se()),t})(),(()=>{var t=Ie(),i=t.firstChild,o=i.firstChild,n=i.nextSibling,a=n.firstChild,c=a.firstChild,u=c.firstChild,P=u.nextSibling;P.nextSibling;var s=c.nextSibling,b=s.firstChild,C=s.nextSibling,oe=a.nextSibling,_=oe.firstChild,f=_.nextSibling,H=f.firstChild,L=H.nextSibling,I=L.nextSibling,Q=I.nextSibling,R=f.nextSibling;return t.style.setProperty("display","grid"),t.style.setProperty("grid-template-columns","1fr 2fr"),t.style.setProperty("gap","1.5rem"),t.style.setProperty("margin-bottom","1.5rem"),o.style.setProperty("margin-bottom","0.5rem"),l(i,d(W,{get when(){return F()},get children(){var v=Le();return v.style.setProperty("width","100%"),v.style.setProperty("max-width","300px"),v.style.setProperty("border-radius","var(--border-radius)"),v.style.setProperty("border","2px solid var(--success)"),v.style.setProperty("box-shadow","0 2px 8px rgba(0,0,0,0.1)"),ne(()=>Se(v,"src",F())),v}}),null),n.style.setProperty("display","grid"),n.style.setProperty("grid-template-columns","1fr 1fr"),n.style.setProperty("gap","1.5rem"),n.style.setProperty("margin-bottom","1.5rem"),c.style.setProperty("display","block"),c.style.setProperty("margin-bottom","0.5rem"),c.style.setProperty("font-weight","500"),l(c,D,P),s.style.setProperty("display","flex"),s.style.setProperty("gap","0.5rem"),s.style.setProperty("align-items","center"),l(s,d(m,{onClick:()=>ae("decrease"),variant:"secondary",size:"sm",style:{"min-width":"40px"},children:"â–"}),b),b.$$input=v=>{const z=parseInt(v.currentTarget.value);ee(z);const E=le();let x,V;if(E)x=E.x,V=E.y,y("ğŸ“ Using manual center:",E);else if(h()){const q=h();x=q.topLeft[0]+q.width/2,V=q.topLeft[1]+q.height/2,y("ğŸ¤– Using face center:",{x,y:V})}else return;const U=(h()?Math.max(h().width,h().height):200)+z*2,de=p(),ue={x:Math.max(0,Math.min(de.width-U,x-U/2)),y:Math.max(0,Math.min(de.height-U,V-U/2)),size:U};S(ue),G()},b.style.setProperty("flex","1"),l(s,d(m,{onClick:()=>ae("increase"),variant:"secondary",size:"sm",style:{"min-width":"40px"},children:"â•"}),null),C.style.setProperty("font-size","0.75rem"),C.style.setProperty("color","var(--text-muted)"),C.style.setProperty("margin-top","0.25rem"),_.style.setProperty("display","block"),_.style.setProperty("margin-bottom","0.5rem"),_.style.setProperty("margin-left","0.5rem"),_.style.setProperty("font-weight","500"),f.style.setProperty("display","grid"),f.style.setProperty("grid-template-columns","repeat(3, 1fr)"),f.style.setProperty("gap","0.25rem"),f.style.setProperty("max-width","120px"),l(f,d(m,{onClick:()=>N("up"),variant:"secondary",size:"sm",title:"Mover arriba",children:"â¬†ï¸"}),L),l(f,d(m,{onClick:()=>N("left"),variant:"secondary",size:"sm",title:"Mover izquierda",children:"â¬…ï¸"}),I),l(f,d(m,{onClick:()=>{te(null),ie()},variant:"primary",size:"sm",title:"Recentrar en rostro",children:"ğŸ¯"}),I),l(f,d(m,{onClick:()=>N("right"),variant:"secondary",size:"sm",title:"Mover derecha",children:"â¡ï¸"}),I),l(f,d(m,{onClick:()=>N("down"),variant:"secondary",size:"sm",title:"Mover abajo",children:"â¬‡ï¸"}),Q),R.style.setProperty("font-size","0.75rem"),R.style.setProperty("color","var(--text-muted)"),R.style.setProperty("margin-top","0.5rem"),R.style.setProperty("text-align","center"),ne(()=>b.value=D()),t})(),(()=>{var t=Re(),i=t.firstChild,o=i.nextSibling;return t.style.setProperty("padding","1rem"),t.style.setProperty("background","var(--info-light)"),t.style.setProperty("border-radius","var(--border-radius)"),t.style.setProperty("margin-bottom","1rem"),t.style.setProperty("text-align","center"),i.style.setProperty("margin-bottom","0.5rem"),i.style.setProperty("color","var(--info-dark)"),o.style.setProperty("display","grid"),o.style.setProperty("grid-template-columns","repeat(auto-fit, minmax(200px, 1fr))"),o.style.setProperty("gap","1rem"),o.style.setProperty("font-size","0.875rem"),o.style.setProperty("color","var(--info-dark)"),t})(),(()=>{var t=Ee();return t.style.setProperty("display","flex"),t.style.setProperty("gap","1rem"),t.style.setProperty("justify-content","center"),t.style.setProperty("flex-wrap","wrap"),l(t,d(m,{onClick:()=>{j(null),M(""),X(null),K("")},variant:"secondary",children:"ğŸ”„ Nueva Foto"}),null),l(t,d(m,{onClick:()=>{const i=re(600,.95);if(i){const o=document.createElement("a");o.download=`pasaporte-600x600-${Date.now()}.jpg`,o.href=i,o.click()}},variant:"secondary",get disabled(){return!F()},children:"ğŸ“¥ Descargar (600px)"}),null),l(t,d(m,{onClick:()=>{const i=re(1800,1);if(i){const o=document.createElement("a");o.download=`pasaporte-HD-1800x1800-${Date.now()}.jpg`,o.href=i,o.click()}},variant:"secondary",get disabled(){return!F()},title:"Alta resoluciÃ³n para impresiÃ³n profesional",children:"ğŸ–¨ï¸ Descargar HD"}),null),l(t,d(m,{onClick:()=>{const i=pe();if(i){const o=g(),n=document.createElement("a");n.download=`pasaporte-original-${Math.round(o.size)}x${Math.round(o.size)}-${Date.now()}.png`,n.href=i,n.click()}},variant:"secondary",get disabled(){return!F()},title:"Descarga en resoluciÃ³n original sin escalar",children:"ğŸ’ Original (PNG)"}),null),l(t,d(m,{onClick:fe,variant:"primary",get disabled(){return!F()},children:"âœ… Confirmar Foto"}),null),t})()]}}),null),e}})};ze(["input"]);export{Xe as default};
