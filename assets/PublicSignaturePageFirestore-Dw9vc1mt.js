import{aa as fe,c as f,o as he,ab as ve,a as g,S as h,w as J,t as v,j as m,i as d,Z as be,b as T,ac as Pe,d as $e}from"./index-cP5Mwy85.js";var xe=v("<div><div><div>⏳</div><p>Cargando solicitud de firma...</p><p>Conectando (máximo 5 segundos)"),Se=v("<div><div><div><div>❌</div><h2>Error</h2><p>"),_e=v("<div><div><div><div>✅</div><h2>¡Firma Guardada!</h2><p>Su firma ha sido guardada exitosamente en la base de datos.</p><p>Puede cerrar esta ventana."),we=v("<p><strong>Teléfono:</strong> "),Ce=v("<p><strong>Tipo de Documento:</strong> "),ke=v("<p><strong>Notas:</strong> "),Ee=v("<div>"),qe=v("<div><div><div><h1>Solicitud de Firma</h1><p></p></div><div><div><h3>Información del Cliente</h3><div><p><strong>Nombre:</strong> </p><p><strong>Email:</strong> </p></div></div><div><h3>Firme en el Área Indicada</h3><canvas></canvas><p>Use su dedo o mouse para dibujar su firma</p></div><div><button>Limpiar</button><button></button></div><p>Al firmar, usted acepta que esta firma electrónica tiene la misma validez legal que una firma manuscrita.");const ze=()=>{const z=fe(),[l,W]=f(null),[Z,R]=f(!0),[P,y]=f(""),[$,K]=f(null),[O,I]=f(!1),[L,A]=f(!1),[D,N]=f(!1),[U,Q]=f(!1),[ee,te]=f("");he(()=>{const e=z.id,t=z.token;if(console.log("Public signature page - Loading request with token:",t,e),!t){y("Token de acceso inválido"),R(!1);return}te(t);const n=setTimeout(()=>{console.log("Request timed out"),y("La solicitud tardó demasiado tiempo. Por favor intente nuevamente."),R(!1)},1e4);(async()=>{try{console.log("Fetching signature request by token...");const r=await ve(t,e);clearTimeout(n),r?r.status==="expired"?y("Esta solicitud de firma ha expirado"):r.status==="signed"?y("Esta solicitud ya ha sido firmada"):r.status==="cancelled"?y("Esta solicitud ha sido cancelada"):(console.log("Signature request loaded successfully:",r),W(r),setTimeout(re,100)):y("Solicitud de firma no encontrada o enlace inválido")}catch(r){clearTimeout(n),console.error("Error loading signature request:",r),y("Error al cargar la solicitud: "+(r instanceof Error?r.message:"Unknown error"))}finally{console.log("setLoading(false);",l()),R(!1)}})()});const re=()=>{const e=$();if(!e)return;const t=e.getContext("2d");if(!t)return;const n=e.getBoundingClientRect();e.width=n.width,e.height=n.height,t.strokeStyle="#000",t.lineWidth=2,t.lineCap="round",t.lineJoin="round",t.fillStyle="white",t.fillRect(0,0,e.width,e.height)},X=e=>{I(!0);const t=$();if(!t)return;const n=t.getBoundingClientRect(),i=t.getContext("2d");if(!i)return;let r,s;e instanceof MouseEvent?(r=e.clientX-n.left,s=e.clientY-n.top):(r=e.touches[0].clientX-n.left,s=e.touches[0].clientY-n.top),i.beginPath(),i.moveTo(r,s)},Y=e=>{if(!O())return;const t=$();if(!t)return;const n=t.getBoundingClientRect(),i=t.getContext("2d");if(!i)return;let r,s;e instanceof MouseEvent?(r=e.clientX-n.left,s=e.clientY-n.top):(e.preventDefault(),r=e.touches[0].clientX-n.left,s=e.touches[0].clientY-n.top),i.lineTo(r,s),i.stroke(),A(!0)},B=()=>{I(!1)},ne=()=>{const e=$();if(!e)return;const t=e.getContext("2d");t&&(t.fillStyle="white",t.fillRect(0,0,e.width,e.height),A(!1))},oe=async()=>{const e=$(),t=l(),n=ee();if(!(!e||!t||!L()||!n)){N(!0),y("");try{const i=e.toDataURL("image/png");console.log("Saving signature via public endpoint with token...");const r=Pe(z.id,n,i,{userAgent:navigator.userAgent,platform:navigator.platform,language:navigator.language}),s=new Promise((a,c)=>{setTimeout(()=>c(new Error("Save operation timed out")),1e4)});await Promise.race([r,s]),console.log("Signature saved successfully"),Q(!0)}catch(i){console.error("Error saving signature:",i),i.message.includes("timed out")?y("La operación de guardado tardó demasiado tiempo. Intente nuevamente."):y(i.message||"Error al guardar la firma")}finally{N(!1)}}},_={"min-height":"100vh",background:"var(--background-secondary, #f5f5f5)",padding:"1rem",display:"flex","align-items":"center","justify-content":"center"},F={"max-width":"500px",width:"100%",background:"white","border-radius":"8px","box-shadow":"0 4px 6px rgba(0, 0, 0, 0.1)",overflow:"hidden"},ie={background:"#6c5ce7",color:"white",padding:"2rem","text-align":"center"},se={padding:"2rem"},le={width:"100%",height:"300px",border:"2px dashed #ddd","border-radius":"4px",cursor:"crosshair","touch-action":"none",background:"white"},j={width:"100%",padding:"1rem","border-radius":"4px",border:"none","font-weight":"600",cursor:"pointer",transition:"all 0.2s ease"},ae=()=>(()=>{var e=xe(),t=e.firstChild,n=t.firstChild,i=n.nextSibling,r=i.nextSibling;return t.style.setProperty("text-align","center"),n.style.setProperty("font-size","2rem"),n.style.setProperty("margin-bottom","1rem"),r.style.setProperty("font-size","0.875rem"),r.style.setProperty("color","#666"),T(s=>m(e,_,s)),e})();P()&&l();const de=()=>(()=>{var e=Se(),t=e.firstChild,n=t.firstChild,i=n.firstChild,r=i.nextSibling,s=r.nextSibling;return n.style.setProperty("padding","3rem"),n.style.setProperty("text-align","center"),i.style.setProperty("font-size","3rem"),i.style.setProperty("margin-bottom","1rem"),r.style.setProperty("margin-bottom","1rem"),r.style.setProperty("color","#e74c3c"),s.style.setProperty("color","#666"),d(s,P),T(a=>{var c=_,u=F;return a.e=m(e,c,a.e),a.t=m(t,u,a.t),a},{e:void 0,t:void 0}),e})();let ce=()=>(()=>{var e=_e(),t=e.firstChild,n=t.firstChild,i=n.firstChild,r=i.nextSibling,s=r.nextSibling,a=s.nextSibling;return n.style.setProperty("padding","3rem"),n.style.setProperty("text-align","center"),i.style.setProperty("font-size","4rem"),i.style.setProperty("margin-bottom","1rem"),r.style.setProperty("margin-bottom","1rem"),r.style.setProperty("color","#27ae60"),s.style.setProperty("color","#666"),s.style.setProperty("margin-bottom","2rem"),a.style.setProperty("font-size","0.875rem"),a.style.setProperty("color","#666"),T(c=>{var u=_,x=F;return c.e=m(e,u,c.e),c.t=m(t,x,c.t),c},{e:void 0,t:void 0}),e})();return[g(h,{get when(){return U()},get children(){return g(ce,{})}}),g(h,{get when(){return J(()=>!!P())()&&!l()},get children(){return g(de,{})}}),g(h,{get when(){return Z()},get children(){return g(ae,{})}}),g(h,{get when(){return J(()=>!!l())()&&!U()},get children(){var e=qe(),t=e.firstChild,n=t.firstChild,i=n.firstChild,r=i.nextSibling,s=n.nextSibling,a=s.firstChild,c=a.firstChild,u=c.nextSibling,x=u.firstChild,ue=x.firstChild;ue.nextSibling;var G=x.nextSibling,ge=G.firstChild;ge.nextSibling;var w=a.nextSibling,M=w.firstChild,p=M.nextSibling,C=p.nextSibling,S=w.nextSibling,k=S.firstChild,E=k.nextSibling,q=S.nextSibling;return m(n,ie),i.style.setProperty("font-size","1.5rem"),i.style.setProperty("margin-bottom","0.5rem"),r.style.setProperty("opacity","0.9"),r.style.setProperty("font-size","0.875rem"),d(r,()=>l()?.requestedByName),m(s,se),a.style.setProperty("margin-bottom","2rem"),c.style.setProperty("margin-bottom","1rem"),u.style.setProperty("background","#f8f9fa"),u.style.setProperty("padding","1rem"),u.style.setProperty("border-radius","4px"),u.style.setProperty("font-size","0.875rem"),d(x,()=>l()?.clientName,null),d(G,()=>l()?.clientEmail,null),d(u,g(h,{get when(){return l()?.clientPhone},get children(){var o=we(),b=o.firstChild;return b.nextSibling,d(o,()=>l()?.clientPhone,null),o}}),null),d(u,g(h,{get when(){return l()?.documentType},get children(){var o=Ce(),b=o.firstChild;return b.nextSibling,d(o,()=>l()?.documentType,null),o}}),null),d(u,g(h,{get when(){return l()?.notes},get children(){var o=ke(),b=o.firstChild;return b.nextSibling,o.style.setProperty("margin-top","0.5rem"),d(o,()=>l()?.notes,null),o}}),null),d(s,g(h,{get when(){return P()},get children(){var o=Ee();return o.style.setProperty("padding","1rem"),o.style.setProperty("background","#fee"),o.style.setProperty("color","#c33"),o.style.setProperty("border-radius","4px"),o.style.setProperty("margin-bottom","1rem"),d(o,P),o}}),w),w.style.setProperty("margin-bottom","1.5rem"),M.style.setProperty("margin-bottom","1rem"),p.$$touchend=B,p.$$touchmove=Y,p.$$touchstart=X,p.addEventListener("mouseleave",B),p.$$mouseup=B,p.$$mousemove=Y,p.$$mousedown=X,be(K,p),m(p,le),C.style.setProperty("margin-top","0.5rem"),C.style.setProperty("font-size","0.8rem"),C.style.setProperty("color","#666"),C.style.setProperty("text-align","center"),S.style.setProperty("display","flex"),S.style.setProperty("gap","1rem"),S.style.setProperty("margin-bottom","1rem"),k.$$click=ne,E.$$click=oe,d(E,g(h,{get when(){return D()},fallback:"Guardar",children:"Guardando..."})),q.style.setProperty("font-size","0.75rem"),q.style.setProperty("color","#666"),q.style.setProperty("text-align","center"),q.style.setProperty("line-height","1.4"),T(o=>{var b=_,me=F,ye={...j,background:"#f8f9fa",color:"#333"},V=!L()||D(),pe={...j,background:"#6c5ce7",color:"white"},H=!L()||D();return o.e=m(e,b,o.e),o.t=m(t,me,o.t),o.a=m(k,ye,o.a),V!==o.o&&(k.disabled=o.o=V),o.i=m(E,pe,o.i),H!==o.n&&(E.disabled=o.n=H),o},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0}),e}})]};$e(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","click"]);export{ze as default};
