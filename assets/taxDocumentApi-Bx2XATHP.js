import{P as m,h as l,e as c}from"./index-B4xu28zF.js";async function I(a,n,i,t){try{const r=await a.arrayBuffer(),u=Array.from(new Uint8Array(r)),d=await m({query:"uploadTaxDocument",params:{businessId:l.getBusinessId()},form:{fileBuffer:u,fileName:a.name,mimeType:a.type,fileSize:a.size,taxPortalId:n,taxYear:i,documentType:t?.documentType,tags:t?.tags,notes:t?.notes,businessId:l.getBusinessId()}});return d?.success&&d?.documentId?{success:!0,documentId:d.documentId,document:d.document}:{success:!1,error:d?.error||"Failed to upload document"}}catch(r){return c("Error uploading tax document:",r),{success:!1,error:r.message}}}async function P(a){try{const n=await m({query:"processTaxDocument",params:{businessId:l.getBusinessId()},form:{documentId:a,options:{forceReprocess:!0}}});return n?.success&&n?.document?{success:!0,document:n.document}:{success:!1,error:n?.error||"Failed to process document"}}catch(n){return c("Error processing tax document:",n),{success:!1,error:n.message}}}async function A(a){try{const n=await m({query:"batchProcessTaxDocuments",params:{businessId:l.getBusinessId()},form:{documentIds:a}});return{success:n?.success||!1,results:n?.results||[],totalProcessed:n?.totalProcessed||0,totalFailed:n?.totalFailed||0}}catch(n){return c("Error batch processing tax documents:",n),{success:!1,results:[],totalProcessed:0,totalFailed:a.length}}}async function _(a,n){try{const i=await m({query:"getTaxDocuments",params:{businessId:l.getBusinessId()},form:{taxPortalId:a,taxYear:n}}),t=i?.data?.data||i?.data||[];return c(t),t.map(r=>x(r))}catch(i){return c("Error getting client tax documents:",i),[]}}async function S(a){try{const n=await m({query:"deleteTaxDocument",params:{businessId:l.getBusinessId(),id:a},form:{documentId:a,id:a}});return{success:n?.success||!1,error:n?.error}}catch(n){return c("Error deleting tax document:",n),{success:!1,error:n.message}}}async function w(a,n){try{const i=await m({query:"verifyTaxDocument",params:{businessId:l.getBusinessId()},form:{documentId:a,verifiedData:n}});return{success:i?.success||!1,document:i?.document,error:i?.error}}catch(i){return c("Error verifying tax document:",i),{success:!1,error:i.message}}}function x(a){const n={pending:"pending",processing:"analyzing",processed:"analyzed",complete:"analyzed",verified:"verified",error:"error",flagged:"error"},i={"w-2":"w2",w2:"w2",form_w2:"w2","1099-misc":"1099_misc","1099_misc":"1099_misc",form_1099_misc:"1099_misc","1099-nec":"1099_nec","1099_nec":"1099_nec",form_1099_nec:"1099_nec","1099-int":"1099_int","1099_int":"1099_int",form_1099_int:"1099_int","1099-div":"1099_div","1099_div":"1099_div",form_1099_div:"1099_div",1098:"1098",form_1098:"1098","1098-t":"1098_t","1098_t":"1098_t",form_1098_t:"1098_t",schedule_k1:"schedule_k1","schedule k-1":"schedule_k1","k-1":"schedule_k1",k1:"schedule_k1",receipt:"receipt","1095-a":"1095_a","1095_a":"1095_a",form_1095_a:"1095_a",form_1095a:"1095_a"},t={},r=a.extractedData;let u=null,d=null,p=null,y=null;if(c(r),r?.w2Data){const e=r.w2Data;t.wages=e.wagesTipsCompensation,t.federalTaxWithheld=e.federalTaxWithheld,t.socialSecurityWages=e.socialSecurityWages,t.socialSecurityTax=e.socialSecurityTax,t.medicareWages=e.medicareWages,t.medicareTax=e.medicareTax,t.socialSecurityTips=e.socialSecurityTips,t.allocatedTips=e.allocatedTips,t.dependentCareBenefits=e.dependentCareBenefits,t.nonqualifiedPlans=e.nonqualifiedPlans,t.stateWages=e.stateWages,t.stateTaxWithheld=e.stateTax,t.localWages=e.localWages,t.localTaxWithheld=e.localTax,t.employerStateId=e.employerStateId,t.box14Items=e?.box14Items,t.box12Codes=e?.box12Codes}else r?.form1099Data?.nonemployeeCompensation?u=r?.form1099Data:a.documentType==="1099-MISC"?d=r?.form1099Data:a.documentType==="1099-INT"?p=r?.form1099Data:a.documentType==="1099-DIV"&&(y=r?.form1099Data);if(u){const e=u;t.nonEmployeeCompensation=e?.nonEmployeeCompensation||e?.nonemployeeCompensation,t.federalTaxWithheld1099=e.federalTaxWithheld}if(d){const e=d;t.rents=e.rents,t.royalties=e.royalties,t.otherIncome=e.otherIncome,t.fishingBoatProceeds=e.fishingBoatProceeds,t.medicalPayments=e.medicalPayments,t.cropInsurance=e.cropInsurance,t.grossProceeds=e.grossProceeds,t.federalTaxWithheld1099=e.federalTaxWithheld}if(p){const e=p;t.interestIncome=e.interestIncome,t.earlyWithdrawalPenalty=e.earlyWithdrawalPenalty,t.usSavingsBondInterest=e.usSavingsBondInterest,t.taxExemptInterest=e.taxExemptInterest,t.privateBondInterest=e.privateBondInterest,t.foreignTaxPaid=e.foreignTaxPaid,t.federalTaxWithheld1099=e.federalTaxWithheld}if(y){const e=y;t.ordinaryDividends=e.ordinaryDividends,t.qualifiedDividends=e.qualifiedDividends,t.capitalGainDistributions=e.capitalGainDistributions,t.unrecaptured1250Gain=e.unrecaptured1250Gain,t.section1202Gain=e.section1202Gain,t.collectiblesGain=e.collectiblesGain,t.nondividendDistributions=e.nondividendDistributions,t.section199ADividends=e.section199ADividends,t.investmentExpenses=e.investmentExpenses,t.foreignTaxPaid=e.foreignTaxPaid,t.exemptInterestDividends=e.exemptInterestDividends,t.federalTaxWithheld1099=e.federalTaxWithheld}if(r?.form1098Data){const e=r.form1098Data;t.mortgageInterest=e.mortgageInterest,t.outstandingPrincipal=e.outstandingPrincipal,t.mortgageOriginationDate=e.mortgageOriginationDate,t.refundOfOverpaidInterest=e.refundOfOverpaidInterest,t.mortgageInsurancePremiums=e.mortgageInsurancePremiums,t.pointsPaid=e.pointsPaid,t.propertyAddress=e.propertyAddress,t.propertyTaxes=e.propertyTax}if(r?.form1098tData){const e=r.form1098tData;t.paymentsReceived=e.paymentsReceived,t.amountsBilled=e.amountsBilled,t.adjustmentsPriorYear=e.adjustmentsPriorYear,t.scholarshipsGrants=e.scholarshipsGrants,t.adjustmentsScholarships=e.adjustmentsScholarships,t.includesJanMarch=e.includesJanMarch,t.halfTimeStudent=e.halfTimeStudent,t.graduateStudent=e.graduateStudent}if(r?.scheduleK1Data){const e=r.scheduleK1Data;t.ordinaryBusinessIncome=e.ordinaryBusinessIncome,t.rentalRealEstateIncome=e.rentalRealEstateIncome,t.otherRentalIncome=e.otherRentalIncome,t.guaranteedPayments=e.guaranteedPayments,t.interestIncomeK1=e.interestIncome,t.dividendIncomeK1=e.ordinaryDividends,t.qualifiedDividendsK1=e.qualifiedDividends,t.royaltiesK1=e.royalties,t.shortTermCapitalGain=e.shortTermCapitalGain,t.longTermCapitalGain=e.longTermCapitalGain,t.unrecaptured1250GainK1=e.unrecaptured1250Gain,t.section1231Gain=e.section1231Gain,t.section179Deduction=e.section179Deduction,t.selfEmploymentEarnings=e.selfEmploymentEarnings}if(r?.form1095AData){c("[1095-A] Extracting form1095AData:",r.form1095AData);const e=r.form1095AData,h=e.annualTotals||{};t.annualPremiumAmount=e.totalEnrollmentPremiums||h.totalEnrollmentPremiums||0,t.annualSlcspPremium=e.totalSlcsp||h.totalSlcsp||0,t.annualAdvancePtc=e.totalAdvancePremiumTaxCredit||h.totalAdvancePremiumTaxCredit||0,c("[1095-A] Annual totals extracted:",{annualPremiumAmount:t.annualPremiumAmount,annualSlcspPremium:t.annualSlcspPremium,annualAdvancePtc:t.annualAdvancePtc}),e.monthlyData&&Array.isArray(e.monthlyData)?(t.monthlyPremiums=e.monthlyData.map(o=>o.enrollmentPremiums||0),t.monthlySlcsp=e.monthlyData.map(o=>o.slcsp||0),t.monthlyAptc=e.monthlyData.map(o=>o.advancePremiumTaxCredit||0),t.coverageMonths=e.monthlyData.filter(o=>(o.enrollmentPremiums||0)>0).length,c("[1095-A] Monthly data extracted, coverage months:",t.coverageMonths)):(t.monthlyPremiums=e.monthlyPremiums,t.monthlySlcsp=e.monthlySlcsp,t.monthlyAptc=e.monthlyAptc,t.coverageMonths=e.coverageMonths),!t.coverageMonths&&e.coveredMonthFlags&&(t.coverageMonths=e.coveredMonthFlags.filter(Boolean).length),!t.annualPremiumAmount&&e.monthlyPremiums?.length&&(t.annualPremiumAmount=e.monthlyPremiums.reduce((o,f)=>o+(f||0),0)),!t.annualSlcspPremium&&e.monthlySlcsp?.length&&(t.annualSlcspPremium=e.monthlySlcsp.reduce((o,f)=>o+(f||0),0)),!t.annualAdvancePtc&&e.monthlyAptc?.length&&(t.annualAdvancePtc=e.monthlyAptc.reduce((o,f)=>o+(f||0),0))}const s={};if(r?.payerName||r?.payerTIN||r?.payerAddress){s.name=r.payerName,s.ein=r.payerTIN,r.payerAddress&&(s.address=r.payerAddress.street,s.city=r.payerAddress.city,s.state=r.payerAddress.state,s.zip=r.payerAddress.zipCode),s.marketplace={};const e=r.form1095AData;e?.marketplaceIdentifier&&(s.marketplace.marketplaceIdentifier=e?.marketplaceIdentifier,s.marketplace.marketplaceName=e?.marketplaceName,s.marketplace.policyNumber=e?.policyNumber,s.marketplace.policyStartDate=e?.policyStartDate,s.marketplace.policyEndDate=e?.policyEndDate)}const T=a.uploadedAt?new Date(a.uploadedAt).getTime():a.createdAt?new Date(a.createdAt).getTime():Date.now(),g=a.documentType||a.classification?.documentType||"other",v=a.ocrConfidence?a.ocrConfidence<=1?Math.round(a.ocrConfidence*100):a.ocrConfidence:void 0;return{id:a.id,clientNotaryId:a.taxPortalId||a.clientNotaryId||"",documentType:g,drakeFormType:i[g.toLowerCase()]||"other",fileUrl:a.fileUrl||a.filePath||"",originalFileName:a.originalName||a.fileName||"",fileSize:a.fileSize,mimeType:a.mimeType,uploadedAt:T,uploadStatus:n[a.status]||n[a.processingStage||""]||"pending",aiConfidence:v,aiAnalyzedAt:a.updatedAt?new Date(a.updatedAt).getTime():void 0,extractedAmounts:Object.keys(t).length>0?t:void 0,payerInfo:Object.keys(s).length>0?s:void 0,taxYear:a.taxYear||r?.taxYear,verified:a.verified||a.validationStatus==="valid",verifiedBy:a.verifiedBy,verifiedAt:a.verifiedAt,notes:a.notes,errorMessage:a.errorMessage||(a.validationErrors?.length?a.validationErrors.map(e=>e.message).join("; "):void 0)}}export{x as a,A as b,S as d,_ as g,P as p,I as u,w as v};
