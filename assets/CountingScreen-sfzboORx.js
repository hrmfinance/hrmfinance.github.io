import{o as F,aI as m,c as d,f as p,aJ as t,t as R,h as U,i as y,a as o,S,aK as _,aL as $,aM as B,aN as E,g as C}from"./index-spuWHKwZ.js";var J=R("<div>");const O=()=>{F(()=>{const e=m.getActiveLocations(),n=m.stockLevels,s=e.map(r=>{const Z=n.filter(l=>l.locationId===r.id),f=new Set(Z.map(l=>l.productId)).size;return{id:r.id,name:r.name,code:r.code||r.id,productCount:f,shelfCount:Math.ceil(f/20)}});v(s)});const[I,v]=d([]),[N,c]=d(!1),[g,i]=d(null),a=p(()=>t.activeSession),u=p(()=>t.currentItem),x=p(()=>t.isComplete),A=e=>{const n=C.state.user?.email||"unknown";t.startSession("zone",e.id,n,e.id,e.name)},k=()=>{const e=m.getActiveLocations();if(e.length===0){alert("No hay ubicaciones disponibles");return}const n=C.state.user?.email||"unknown";t.startSession("full",e[0].id,n)},h=e=>{const n=u();n&&(t.updateItemCount(n.id,e),e!==n.systemQuantity?(i(n),c(!0)):t.goToNextItem()||t.endSession("completed"))},w=()=>{const e=u();e&&h(e.systemQuantity)},D=()=>{t.goToNextItem()||t.endSession("completed")},b=()=>{t.goToPreviousItem()},j=()=>{c(!1),i(null),t.goToNextItem()||t.endSession("completed")},z=()=>{const e=g();if(!e)return;const n=a();n&&(n.items.map(s=>s.id===e.id?{...s,countedQuantity:void 0,status:"pending",discrepancy:void 0,countedAt:void 0}:s),t.resetSession(),t.startSession(n.type,n.items[0].locationId,n.createdBy,n.zoneId,n.zoneName),c(!1),i(null))},L=async()=>{const e=await t.applyAdjustments();e.success?alert("Ajustes aplicados exitosamente"):alert("Error al aplicar ajustes: "+e.errors.join(", "))},Q=()=>{t.resetSession()},M=()=>a()?t.getDiscrepancyItems():[],P=()=>t.calculateSummary(),T={"min-height":"100vh",background:"#f9fafb"};return(()=>{var e=J();return U(e,T),y(e,o(S,{get when(){return a()},get fallback(){return o(B,{get zones(){return I()},onSelectZone:A,onStartFullCount:k})},get children(){return o(S,{get when(){return!x()},get fallback(){return o($,{get summary(){return P()},get discrepancyItems(){return M()},onApplyAdjustments:L,onClose:Q})},get children(){return o(_,{get session(){return a()},get currentItem(){return u()},onUpdateCount:h,onNext:D,onPrevious:b,onQuickConfirm:w})}})}}),null),y(e,o(E,{get item(){return g()},onConfirm:j,onRecount:z,get isOpen(){return N()}}),null),e})()};export{O as default};
