import{at as ue,au as ve,c as b,A as Pe,o as be,av as we,a as d,t as w,i as s,S as Y,B as g,b as ie,N as $e,v as Se,j as Ce,d as _e}from"./index-nGUKm9jA.js";let q=null;const ze=async()=>q||(console.log("Loading BlazeFace model..."),await ue(),q=await ve(),console.log("BlazeFace model loaded successfully"),q),ke=async Z=>{try{const A=await(await ze()).estimateFaces(Z,!1);if(A.length===0)return console.warn("No faces detected in image"),null;const z=A[0],[x,M]=z.topLeft,[j,c]=z.bottomRight,B=j-x,m=c-M,O=x+B/2,p=M+m/2,$={topLeft:[x,M],bottomRight:[j,c],landmarks:z.landmarks,confidence:z.probability?.[0]||.9,centerX:O,centerY:p,width:B,height:m};return console.log("Face detected:",$),$}catch(E){return console.error("Error detecting face:",E),null}};var xe=w("<div><div>ğŸ“·</div><p>Selecciona una foto para procesar</p><div><input type=file accept=image/*>"),Me=w("<div><div>ğŸ”</div><p>Detectando rostro y calculando centro..."),Te=w("<div>Confianza: <!>%"),Fe=w("<div><div><label>Acciones RÃ¡pidas</label><div></div></div><div><label>Opciones de Vista</label><div><label><input type=checkbox>Mostrar guÃ­as de medida</label><div><div>TamaÃ±o: <!>Ã—<!>px</div><div>Centro: (<!>, <!>)"),De=w('<img alt="Vista previa 600x600">'),Ie=w("<div><div><h4>Resultado 600Ã—600</h4></div><div><div><label>Padding: <!>px</label><div><input type=range min=10 max=800 step=5></div><div>10px = Muy ajustado | 150px = MÃ¡s cabello</div></div><div><label>Mover Recorte</label><div><div></div><div></div><div></div><div></div></div><div>Mueve 10px por clic"),Le=w("<div><h5>ğŸ“ Opciones de Descarga</h5><div><div><strong>ğŸ“¥ EstÃ¡ndar (600px)</strong><div>2Ã—2 pulgadas @ 300 PPI</div><div>Web y documentos digitales</div></div><div><strong>ğŸ–¨ï¸ HD (1800px)</strong><div>2Ã—2 pulgadas @ 900 PPI</div><div>ImpresiÃ³n profesional</div></div><div><strong>ğŸ’ Original</strong><div>ResoluciÃ³n nativa</div><div>MÃ¡xima calidad posible"),Re=w("<div>"),Ee=w("<div><h3>ğŸ“¸ Recorte Simple de Pasaporte");const Oe=Z=>{const[E,A]=b(null),[z,x]=b(""),[M,j]=b(!1),[c,B]=b(null),[m,O]=b(null),[p,$]=b({x:0,y:0,size:200}),[T,J]=b(""),[F,K]=b(600),[ne,de]=b(!0),[le,ee]=b(null),N=10,X=()=>{if(!c())return;const e=c(),r=p();console.log("ğŸ–¼ï¸ CREATING PREVIEW:",{originalImageSize:{width:e.width,height:e.height},cropInOriginal:r,outputSize:"600x600"});const t=document.createElement("canvas"),o=t.getContext("2d");o&&(t.width=600,t.height=600,o.fillStyle="#FFFFFF",o.fillRect(0,0,600,600),o.drawImage(e,r.x,r.y,r.size,r.size,0,0,600,600),ne()&&ye(o,600,600),J(t.toDataURL("image/jpeg",.95)))},te=(e=600,r=.95)=>{if(!c())return"";const t=c(),o=p(),i=document.createElement("canvas"),n=i.getContext("2d");return n?(i.width=e,i.height=e,n.fillStyle="#FFFFFF",n.fillRect(0,0,e,e),n.imageSmoothingEnabled=!0,n.imageSmoothingQuality="high",n.drawImage(t,o.x,o.y,o.size,o.size,0,0,e,e),i.toDataURL("image/jpeg",r)):""},ce=()=>{if(!c())return"";const e=c(),r=p(),t=Math.round(r.size),o=document.createElement("canvas"),i=o.getContext("2d");return i?(o.width=t,o.height=t,console.log("ğŸ¯ Original Quality Export:",{cropArea:r,outputSize:t,originalImageSize:{width:e.width,height:e.height}}),i.fillStyle="#FFFFFF",i.fillRect(0,0,t,t),i.imageSmoothingEnabled=!1,i.drawImage(e,r.x,r.y,r.size,r.size,0,0,t,t),o.toDataURL("image/png")):""},ye=(e,r,t)=>{e.save(),e.strokeStyle="#ff0000",e.lineWidth=2,e.setLineDash([8,4]);const o=t*.5,i=t*.69;e.strokeStyle="rgb(45, 125, 50)",e.lineWidth=2,e.setLineDash([8,4]),e.beginPath(),e.moveTo(0,o),e.lineTo(r,o),e.stroke(),e.beginPath(),e.moveTo(0,i),e.lineTo(r,i),e.stroke();const n=t*.56,a=t*.69;e.strokeStyle="rgb(200, 100, 50)",e.beginPath(),e.moveTo(r-40,n),e.lineTo(r-30,n),e.moveTo(r-40,a),e.lineTo(r-30,a),e.stroke();const y=r/2,f=r*.3,v=r*.7;e.beginPath(),e.moveTo(y,0),e.lineTo(y,t),e.moveTo(f,0),e.lineTo(f,t),e.moveTo(v,0),e.lineTo(v,t),e.stroke(),e.setLineDash([]),e.fillStyle="rgba(255, 0, 0, 0.8)",e.font="bold 12px Arial",e.textAlign="left",e.fillText("Zona de Ojos",5,o-5),e.fillText("300-414px",5,o+15),e.fillText("Altura de Cara",r-120,n+20),e.fillText("336-414px",r-120,n+35),e.strokeStyle="#0000ff",e.fillStyle="#0000ff",e.lineWidth=1,e.setLineDash([]);const l=8;e.beginPath(),e.moveTo(50,20),e.lineTo(r-50,20),e.stroke(),e.beginPath(),e.moveTo(50,20),e.lineTo(50+l,20-l/2),e.lineTo(50+l,20+l/2),e.closePath(),e.fill(),e.beginPath(),e.moveTo(r-50,20),e.lineTo(r-50-l,20-l/2),e.lineTo(r-50-l,20+l/2),e.closePath(),e.fill(),e.textAlign="center",e.fillText("2 pulgadas",r/2,15),e.beginPath(),e.moveTo(20,50),e.lineTo(20,t-50),e.stroke(),e.beginPath(),e.moveTo(20,50),e.lineTo(20-l/2,50+l),e.lineTo(20+l/2,50+l),e.closePath(),e.fill(),e.beginPath(),e.moveTo(20,t-50),e.lineTo(20-l/2,t-50-l),e.lineTo(20+l/2,t-50-l),e.closePath(),e.fill(),e.save(),e.translate(12,t/2),e.rotate(-Math.PI/2),e.textAlign="center",e.fillText("2 pulgadas",0,0),e.restore(),e.restore()},pe=()=>{},ge=()=>{const e=z();if(!e)return;const r=new Image;r.onload=()=>{console.log("Image loaded:",r.width,r.height),B(r),setTimeout(()=>{re()},100)},r.onerror=t=>{console.error("Error loading image:",t)},r.src=e},re=async()=>{if(c()){j(!0);try{const e=await ke(c());if(e){console.log("âœ… Face detected:",e),O(e);const r=e.topLeft[0]+e.width/2,t=e.topLeft[1]+e.height/2,o=Math.max(e.width,e.height),i=o+F()*2,n={x:r-i/2,y:t-i/2,size:i},a=c();n.x=Math.max(0,Math.min(a.width-n.size,n.x)),n.y=Math.max(0,Math.min(a.height-n.size,n.y)),console.log("ğŸ¯ Initial crop calculated:",{faceCenter:{x:r,y:t},faceSize:o,cropSize:i,finalCrop:n}),$(n)}else{console.log("No face detected, using center crop");const r=c(),t=Math.min(r.width,r.height)*.6;$({x:(r.width-t)/2,y:(r.height-t)/2,size:t})}pe(),X()}catch(e){console.error("Face detection failed:",e)}finally{j(!1)}}},U=e=>{const r=p(),t=c();let o=r.x,i=r.y;switch(e){case"up":i=Math.max(0,r.y-N);break;case"down":i=Math.min(t.height-r.size,r.y+N);break;case"left":o=Math.max(0,r.x-N);break;case"right":o=Math.min(t.width-r.size,r.x+N);break}const n={x:o,y:i,size:r.size};ee({x:o+n.size/2,y:i+n.size/2}),console.log(`ğŸ”½ Moving ${e}:`,{oldPosition:{x:r.x,y:r.y},newPosition:{x:o,y:i},newCenter:le(),imageSize:{width:t.width,height:t.height}}),$(n),X()},se=e=>{const r=e==="increase"?Math.min(800,F()+10):Math.max(10,F()-10);if(K(r),m()){const t=m(),o=t.topLeft[0]+t.width/2,i=t.topLeft[1]+t.height/2,a=Math.max(t.width,t.height)+r*2,y=c(),f={x:Math.max(0,Math.min(y.width-a,o-a/2)),y:Math.max(0,Math.min(y.height-a,i-a/2)),size:a};console.log("ğŸ“ Padding adjusted:",{direction:e,newPadding:r,newCrop:f}),$(f),X()}},me=e=>{const t=e.target.files?.[0];if(t&&t.type.startsWith("image/")){A(t);const o=new FileReader;o.onload=i=>{console.log("File read complete"),x(i.target?.result),O(null),J("")},o.readAsDataURL(t)}},he=()=>{const e=te();if(!e)return;const r={method:"simple_tensorflow_crop",confidence:m()?.confidence||0,cropArea:p(),padding:F(),processingDate:new Date().toISOString()};Z.onPhotoReady?.(e,r)};return Pe(()=>{z()&&(console.log("Preview changed, loading image..."),ge())}),be(()=>{}),we(()=>{}),d(Ce,{get children(){var e=Ee(),r=e.firstChild;return e.style.setProperty("padding","1.5rem"),r.style.setProperty("font-size","1.5rem"),r.style.setProperty("font-weight","600"),r.style.setProperty("margin-bottom","1.5rem"),r.style.setProperty("text-align","center"),s(e,d(Y,{get when(){return!E()},get children(){var t=xe(),o=t.firstChild,i=o.nextSibling,n=i.nextSibling,a=n.firstChild;return t.style.setProperty("padding","3rem"),t.style.setProperty("border","3px dashed var(--border-color)"),t.style.setProperty("border-radius","var(--border-radius)"),t.style.setProperty("text-align","center"),t.style.setProperty("margin-bottom","2rem"),t.style.setProperty("background","var(--background-secondary)"),o.style.setProperty("font-size","3rem"),o.style.setProperty("margin-bottom","1rem"),i.style.setProperty("margin-bottom","1rem"),i.style.setProperty("font-size","1.1rem"),n.style.setProperty("position","relative"),n.style.setProperty("display","inline-block"),a.addEventListener("change",me),a.style.setProperty("position","absolute"),a.style.setProperty("opacity","0"),a.style.setProperty("width","100%"),a.style.setProperty("height","100%"),a.style.setProperty("cursor","pointer"),s(n,d(g,{variant:"primary",style:{"pointer-events":"none"},children:"ğŸ“ Elegir Foto"}),null),t}}),null),s(e,d(Y,{get when(){return M()},get children(){var t=Me(),o=t.firstChild,i=o.nextSibling;return t.style.setProperty("text-align","center"),t.style.setProperty("padding","2rem"),t.style.setProperty("background","var(--info-light)"),t.style.setProperty("border-radius","var(--border-radius)"),t.style.setProperty("margin-bottom","1.5rem"),o.style.setProperty("font-size","2rem"),o.style.setProperty("margin-bottom","1rem"),i.style.setProperty("font-size","1.1rem"),i.style.setProperty("font-weight","500"),t}}),null),s(e,d(Y,{get when(){return Se(()=>!!(E()&&!M()))()&&c()},get children(){return[(()=>{var t=Fe(),o=t.firstChild,i=o.firstChild,n=i.nextSibling,a=o.nextSibling,y=a.firstChild,f=y.nextSibling,v=f.firstChild,l=v.firstChild,P=v.nextSibling,S=P.firstChild,oe=S.firstChild,C=oe.nextSibling,h=C.nextSibling,W=h.nextSibling;W.nextSibling;var D=S.nextSibling,I=D.firstChild,H=I.nextSibling,L=H.nextSibling,u=L.nextSibling;return u.nextSibling,t.style.setProperty("display","grid"),t.style.setProperty("grid-template-columns","repeat(auto-fit, minmax(250px, 1fr))"),t.style.setProperty("gap","1.5rem"),t.style.setProperty("margin-bottom","1.5rem"),t.style.setProperty("padding","1rem"),t.style.setProperty("background","var(--background-secondary)"),t.style.setProperty("border-radius","var(--border-radius)"),i.style.setProperty("display","block"),i.style.setProperty("margin-bottom","0.5rem"),i.style.setProperty("font-weight","500"),n.style.setProperty("display","flex"),n.style.setProperty("flex-direction","column"),n.style.setProperty("gap","0.5rem"),s(n,d(g,{onClick:()=>{K(50),ee(null),re()},variant:"secondary",size:"sm",children:"ğŸ”„ Reset Todo"})),y.style.setProperty("display","block"),y.style.setProperty("margin-bottom","0.5rem"),y.style.setProperty("font-weight","500"),f.style.setProperty("display","flex"),f.style.setProperty("flex-direction","column"),f.style.setProperty("gap","0.5rem"),v.style.setProperty("font-size","0.875rem"),v.style.setProperty("display","flex"),v.style.setProperty("align-items","center"),l.addEventListener("change",_=>{de(_.target.checked),X()}),l.style.setProperty("margin-right","0.5rem"),P.style.setProperty("font-size","0.75rem"),P.style.setProperty("color","var(--text-muted)"),P.style.setProperty("margin-left","1.5rem"),s(S,()=>Math.round(p().size),C),s(S,()=>Math.round(p().size),W),s(D,()=>Math.round(p().x+p().size/2),H),s(D,()=>Math.round(p().y+p().size/2),u),s(P,d(Y,{get when(){return m()},get children(){var _=Te(),R=_.firstChild,k=R.nextSibling;return k.nextSibling,s(_,()=>((m()?.confidence||0)*100).toFixed(1),k),_}}),null),ie(()=>l.checked=ne()),t})(),(()=>{var t=Ie(),o=t.firstChild,i=o.firstChild,n=o.nextSibling,a=n.firstChild,y=a.firstChild,f=y.firstChild,v=f.nextSibling;v.nextSibling;var l=y.nextSibling,P=l.firstChild,S=l.nextSibling,oe=a.nextSibling,C=oe.firstChild,h=C.nextSibling,W=h.firstChild,D=W.nextSibling,I=D.nextSibling,H=I.nextSibling,L=h.nextSibling;return t.style.setProperty("display","grid"),t.style.setProperty("grid-template-columns","1fr 2fr"),t.style.setProperty("gap","1.5rem"),t.style.setProperty("margin-bottom","1.5rem"),i.style.setProperty("margin-bottom","0.5rem"),s(o,d(Y,{get when(){return T()},get children(){var u=De();return u.style.setProperty("width","100%"),u.style.setProperty("max-width","300px"),u.style.setProperty("border-radius","var(--border-radius)"),u.style.setProperty("border","2px solid var(--success)"),u.style.setProperty("box-shadow","0 2px 8px rgba(0,0,0,0.1)"),ie(()=>$e(u,"src",T())),u}}),null),n.style.setProperty("display","grid"),n.style.setProperty("grid-template-columns","1fr 1fr"),n.style.setProperty("gap","1.5rem"),n.style.setProperty("margin-bottom","1.5rem"),y.style.setProperty("display","block"),y.style.setProperty("margin-bottom","0.5rem"),y.style.setProperty("font-weight","500"),s(y,F,v),l.style.setProperty("display","flex"),l.style.setProperty("gap","0.5rem"),l.style.setProperty("align-items","center"),s(l,d(g,{onClick:()=>se("decrease"),variant:"secondary",size:"sm",style:{"min-width":"40px"},children:"â–"}),P),P.$$input=u=>{const _=parseInt(u.currentTarget.value);K(_);const R=le();let k,Q;if(R)k=R.x,Q=R.y,console.log("ğŸ“ Using manual center:",R);else if(m()){const V=m();k=V.topLeft[0]+V.width/2,Q=V.topLeft[1]+V.height/2,console.log("ğŸ¤– Using face center:",{x:k,y:Q})}else return;const G=(m()?Math.max(m().width,m().height):200)+_*2,ae=c(),fe={x:Math.max(0,Math.min(ae.width-G,k-G/2)),y:Math.max(0,Math.min(ae.height-G,Q-G/2)),size:G};$(fe),X()},P.style.setProperty("flex","1"),s(l,d(g,{onClick:()=>se("increase"),variant:"secondary",size:"sm",style:{"min-width":"40px"},children:"â•"}),null),S.style.setProperty("font-size","0.75rem"),S.style.setProperty("color","var(--text-muted)"),S.style.setProperty("margin-top","0.25rem"),C.style.setProperty("display","block"),C.style.setProperty("margin-bottom","0.5rem"),C.style.setProperty("margin-left","0.5rem"),C.style.setProperty("font-weight","500"),h.style.setProperty("display","grid"),h.style.setProperty("grid-template-columns","repeat(3, 1fr)"),h.style.setProperty("gap","0.25rem"),h.style.setProperty("max-width","120px"),s(h,d(g,{onClick:()=>U("up"),variant:"secondary",size:"sm",title:"Mover arriba",children:"â¬†ï¸"}),D),s(h,d(g,{onClick:()=>U("left"),variant:"secondary",size:"sm",title:"Mover izquierda",children:"â¬…ï¸"}),I),s(h,d(g,{onClick:()=>{ee(null),re()},variant:"primary",size:"sm",title:"Recentrar en rostro",children:"ğŸ¯"}),I),s(h,d(g,{onClick:()=>U("right"),variant:"secondary",size:"sm",title:"Mover derecha",children:"â¡ï¸"}),I),s(h,d(g,{onClick:()=>U("down"),variant:"secondary",size:"sm",title:"Mover abajo",children:"â¬‡ï¸"}),H),L.style.setProperty("font-size","0.75rem"),L.style.setProperty("color","var(--text-muted)"),L.style.setProperty("margin-top","0.5rem"),L.style.setProperty("text-align","center"),ie(()=>P.value=F()),t})(),(()=>{var t=Le(),o=t.firstChild,i=o.nextSibling;return t.style.setProperty("padding","1rem"),t.style.setProperty("background","var(--info-light)"),t.style.setProperty("border-radius","var(--border-radius)"),t.style.setProperty("margin-bottom","1rem"),t.style.setProperty("text-align","center"),o.style.setProperty("margin-bottom","0.5rem"),o.style.setProperty("color","var(--info-dark)"),i.style.setProperty("display","grid"),i.style.setProperty("grid-template-columns","repeat(auto-fit, minmax(200px, 1fr))"),i.style.setProperty("gap","1rem"),i.style.setProperty("font-size","0.875rem"),i.style.setProperty("color","var(--info-dark)"),t})(),(()=>{var t=Re();return t.style.setProperty("display","flex"),t.style.setProperty("gap","1rem"),t.style.setProperty("justify-content","center"),t.style.setProperty("flex-wrap","wrap"),s(t,d(g,{onClick:()=>{A(null),x(""),O(null),J("")},variant:"secondary",children:"ğŸ”„ Nueva Foto"}),null),s(t,d(g,{onClick:()=>{const o=te(600,.95);if(o){const i=document.createElement("a");i.download=`pasaporte-600x600-${Date.now()}.jpg`,i.href=o,i.click()}},variant:"secondary",get disabled(){return!T()},children:"ğŸ“¥ Descargar (600px)"}),null),s(t,d(g,{onClick:()=>{const o=te(1800,1);if(o){const i=document.createElement("a");i.download=`pasaporte-HD-1800x1800-${Date.now()}.jpg`,i.href=o,i.click()}},variant:"secondary",get disabled(){return!T()},title:"Alta resoluciÃ³n para impresiÃ³n profesional",children:"ğŸ–¨ï¸ Descargar HD"}),null),s(t,d(g,{onClick:()=>{const o=ce();if(o){const i=p(),n=document.createElement("a");n.download=`pasaporte-original-${Math.round(i.size)}x${Math.round(i.size)}-${Date.now()}.png`,n.href=o,n.click()}},variant:"secondary",get disabled(){return!T()},title:"Descarga en resoluciÃ³n original sin escalar",children:"ğŸ’ Original (PNG)"}),null),s(t,d(g,{onClick:he,variant:"primary",get disabled(){return!T()},children:"âœ… Confirmar Foto"}),null),t})()]}}),null),e}})};_e(["input"]);export{Oe as default};
