import{c as u,A as Qe,a as e,t as v,i as r,S as c,b as se,T as ze,I as O,x as Ne,v as Ee,B as z,a8 as Xe,a9 as Ye,d as Re,aa as Ze,E as et,o as tt,ab as rt,g as ne,F as st,j as lt,r as fe,ac as ot,ad as it,ae as ge,af as at,ag as nt,ah as dt,ai as yt,aj as pt,L as ct}from"./index-DEQsfgu8.js";var gt=v("<div><h4>Firma a Exportar:</h4><img alt=Signature>"),mt=v("<div><p>Cargando aplicaciones de pasaporte..."),ut=v("<div><strong>‚ö† Error:</strong> "),Pt=v("<div><strong>‚úì √âxito:</strong> Firma exportada exitosamente a la aplicaci√≥n de pasaporte"),ht=v("<div><div>Se muestran aplicaciones sin firma o que coinciden con el nombre del cliente"),vt=v("<div><p>No se encontraron aplicaciones de pasaporte compatibles.</p><p>Busque aplicaciones sin firma o que coincidan con el nombre del cliente: <strong>"),bt=v("<div><div><div><h2>üìã Exportar Firma a Aplicaci√≥n de Pasaporte</h2><button>‚úï</button></div><div><div><h3>Solicitud de Firma</h3><p><strong>Cliente:</strong> </p><p><strong>ID:</strong> </p><p><strong>Firmado:</strong> </p></div></div><div>");const ft=a=>{const[K,R]=u([]),[L,I]=u(""),[M,le]=u(!1),[ee,te]=u(!1),[j,A]=u(""),[P,Q]=u(!1),C=new Ye,G=async()=>{if(a.isOpen){te(!0),A("");try{console.log("loadPassportApplications");const y=await C.getPassportApplications(a.signatureRequest.clientName);console.log(y);const N=y.filter(w=>{const $=!w.applicationData.firmaBase64&&!w.applicationData.firmaUrl,U=w.applicationData.primerNombre?.toLowerCase().includes(a.signatureRequest.clientName.toLowerCase())||w.applicationData.primerApellido?.toLowerCase().includes(a.signatureRequest.clientName.toLowerCase())||a.signatureRequest.clientName.toLowerCase().includes(w.applicationData.primerNombre?.toLowerCase()||"")||a.signatureRequest.clientName.toLowerCase().includes(w.applicationData.primerApellido?.toLowerCase()||"");return $||U});R(N)}catch(y){console.error("Error loading passport applications:",y),A(y instanceof Error?y.message:"Error loading passport applications")}finally{te(!1)}}},X=async()=>{if(!L()||!a.signatureRequest.signatureUrl){A("Please select a passport application");return}le(!0),A("");try{let y=K().filter(w=>w.id===L())?.[0],N={signatureBase64:a.signatureRequest.signatureUrl,signatureRequestId:a.signatureRequest.id,...y.applicationData};await Xe(L(),N),Q(!0),setTimeout(()=>{Q(!1),a.onClose()},2e3)}catch(y){console.error("Error exporting signature:",y),A(y instanceof Error?y.message:"Error exporting signature")}finally{le(!1)}},J=()=>{a.isOpen&&(G(),I(""),A(""),Q(!1))},T=()=>{I(""),A(""),Q(!1),a.onClose()};return Qe(()=>{a.isOpen&&J()}),e(c,{get when(){return a.isOpen},get children(){var y=bt(),N=y.firstChild,w=N.firstChild,$=w.firstChild,U=$.nextSibling,D=w.nextSibling,W=D.firstChild,k=W.firstChild,B=k.nextSibling,de=B.firstChild;de.nextSibling;var q=B.nextSibling,F=q.firstChild;F.nextSibling;var V=q.nextSibling,oe=V.firstChild;oe.nextSibling;var H=D.nextSibling;return y.style.setProperty("position","fixed"),y.style.setProperty("top","0"),y.style.setProperty("left","0"),y.style.setProperty("right","0"),y.style.setProperty("bottom","0"),y.style.setProperty("background","rgba(0, 0, 0, 0.5)"),y.style.setProperty("display","flex"),y.style.setProperty("align-items","center"),y.style.setProperty("justify-content","center"),y.style.setProperty("z-index","1000"),N.style.setProperty("background","#ffffff"),N.style.setProperty("border-radius","var(--border-radius)"),N.style.setProperty("box-shadow","0 4px 20px rgba(0, 0, 0, 0.2)"),N.style.setProperty("max-width","600px"),N.style.setProperty("width","90%"),N.style.setProperty("max-height","80vh"),N.style.setProperty("overflow","auto"),w.style.setProperty("padding","1.5rem"),w.style.setProperty("border-bottom","1px solid var(--border-color)"),w.style.setProperty("display","flex"),w.style.setProperty("justify-content","space-between"),w.style.setProperty("align-items","center"),$.style.setProperty("margin","0"),$.style.setProperty("font-size","1.25rem"),$.style.setProperty("color","var(--text-primary)"),U.$$click=T,U.style.setProperty("background","none"),U.style.setProperty("border","none"),U.style.setProperty("font-size","1.5rem"),U.style.setProperty("cursor","pointer"),U.style.setProperty("color","var(--text-muted)"),D.style.setProperty("padding","1.5rem"),W.style.setProperty("padding","1rem"),W.style.setProperty("background","var(--info-light)"),W.style.setProperty("border-radius","var(--border-radius-sm)"),W.style.setProperty("margin-bottom","1.5rem"),W.style.setProperty("border","1px solid var(--info-color)"),k.style.setProperty("margin","0 0 0.5rem 0"),k.style.setProperty("font-size","1rem"),k.style.setProperty("color","var(--info-dark)"),B.style.setProperty("margin","0.25rem 0"),B.style.setProperty("font-size","0.875rem"),r(B,()=>a.signatureRequest.clientName,null),q.style.setProperty("margin","0.25rem 0"),q.style.setProperty("font-size","0.875rem"),r(q,()=>a.signatureRequest.id,null),V.style.setProperty("margin","0.25rem 0"),V.style.setProperty("font-size","0.875rem"),r(V,()=>a.signatureRequest.signedAt?.toDate().toLocaleDateString(),null),r(D,e(c,{get when(){return a.signatureRequest.signatureUrl},get children(){var i=gt(),f=i.firstChild,_=f.nextSibling;return i.style.setProperty("text-align","center"),i.style.setProperty("margin-bottom","1.5rem"),f.style.setProperty("margin","0 0 0.5rem 0"),f.style.setProperty("font-size","0.875rem"),f.style.setProperty("color","var(--text-muted)"),_.style.setProperty("max-width","300px"),_.style.setProperty("max-height","100px"),_.style.setProperty("border","1px solid var(--border-color)"),_.style.setProperty("border-radius","var(--border-radius-sm)"),_.style.setProperty("background","white"),_.style.setProperty("padding","0.5rem"),se(()=>ze(_,"src",a.signatureRequest.signatureUrl)),i}}),null),r(D,e(c,{get when(){return ee()},get children(){var i=mt(),f=i.firstChild;return i.style.setProperty("text-align","center"),i.style.setProperty("padding","2rem"),i.style.setProperty("color","var(--text-muted)"),r(i,e(O,{name:"loading",size:"2rem"}),f),i}}),null),r(D,e(c,{get when(){return j()},get children(){var i=ut(),f=i.firstChild;return f.nextSibling,i.style.setProperty("padding","1rem"),i.style.setProperty("background","var(--error-light)"),i.style.setProperty("color","var(--error-dark)"),i.style.setProperty("border-radius","var(--border-radius-sm)"),i.style.setProperty("margin-bottom","1rem"),i.style.setProperty("border","1px solid var(--error-color)"),r(i,j,null),i}}),null),r(D,e(c,{get when(){return P()},get children(){var i=Pt();return i.style.setProperty("padding","1rem"),i.style.setProperty("background","var(--success-light)"),i.style.setProperty("color","var(--success-dark)"),i.style.setProperty("border-radius","var(--border-radius-sm)"),i.style.setProperty("margin-bottom","1rem"),i.style.setProperty("border","1px solid var(--success-color)"),i}}),null),r(D,e(c,{get when(){return Ee(()=>!ee())()&&K().length>0},get children(){var i=ht(),f=i.firstChild;return r(i,e(Ne,{label:"Seleccionar Aplicaci√≥n de Pasaporte",get value(){return L()},onChange:I,get options(){return[{value:"",label:"-- Seleccione una aplicaci√≥n --"},...K().map(_=>({value:_.id,label:`${_.applicationData.primerNombre} ${_.applicationData.primerApellido} (${_.applicationNumber}) - ${_.status}`}))]},required:!0}),f),f.style.setProperty("margin-top","0.5rem"),f.style.setProperty("font-size","0.75rem"),f.style.setProperty("color","var(--text-muted)"),i}}),null),r(D,L,null),r(D,e(c,{get when(){return Ee(()=>!ee())()&&K().length===0},get children(){var i=vt(),f=i.firstChild,_=f.nextSibling,pe=_.firstChild,ue=pe.nextSibling;return i.style.setProperty("padding","2rem"),i.style.setProperty("text-align","center"),i.style.setProperty("color","var(--text-muted)"),r(i,e(O,{name:"search",size:"3rem",style:{"margin-bottom":"1rem"}}),f),_.style.setProperty("font-size","0.875rem"),r(ue,()=>a.signatureRequest.clientName),i}}),null),H.style.setProperty("padding","1rem 1.5rem"),H.style.setProperty("border-top","1px solid var(--border-color)"),H.style.setProperty("display","flex"),H.style.setProperty("gap","0.75rem"),H.style.setProperty("justify-content","flex-end"),r(H,e(z,{variant:"outline",onClick:T,get disabled(){return M()},children:"Cancelar"}),null),r(H,e(z,{variant:"primary",onClick:X,get disabled(){return!L()||M()||P()},get children(){return e(c,{get when(){return M()},fallback:"üìã Exportar Firma",children:"Exportando..."})}}),null),y}})};Re(["click"]);var me=v("<div>"),xt=v('<div><div><div><label>Tienda/Ubicaci√≥n *</label><select required><option value>Seleccionar tienda...</option></select></div><div><label>D√≠as hasta expiraci√≥n *</label><select><option value=1>1 d√≠a</option><option value=3>3 d√≠as</option><option value=7>7 d√≠as</option><option value=14>14 d√≠as</option><option value=30>30 d√≠as</option></select></div><div><label>Notas</label><textarea placeholder="Notas adicionales para el cliente..."rows=3></textarea></div></div><div>'),$t=v("<option>"),_t=v("<div><div><div>üìã</div><p>Comparta este enlace con <strong></strong></p></div><div></div><div></div><p>El enlace expirar√° el "),St=v("<div>sending..."),wt=v("<div><p>Esta solicitud no tiene firma disponible."),Ct=v('<div><div><h3></h3><p>Firmado el: </p><div><span>üìÅ </span><span>üóÉÔ∏è Base64 (PNG)</span><span>üö´ No CORS Issues</span></div></div><div><img alt="Firma del cliente"></div><div>'),kt=v("<span>"),Et=v("<div><div><div><p>Env√≠e solicitudes de firma a sus clientes por email o SMS</p></div><div></div></div><div>"),zt=v("<div><div>‚è≥</div><p>Cargando solicitudes..."),Nt=v("<div><p>No hay solicitudes de firma. Cree una nueva para empezar."),Rt=v("<input type=checkbox>"),Ft=v("<span> ‚Ä¢ "),At=v("<div><strong>Documento:</strong> "),Dt=v("<div><strong>Tienda:</strong> "),Lt=v("<div><strong>Firmado el:</strong> "),It=v("<div><strong>Notas:</strong> "),Mt=v("<div><div><div><div><h4></h4><p></p></div></div></div><div><div><strong>ID:</strong> </div><div><strong>Creado:</strong> </div><div><strong>Expira:</strong> </div></div><div>");const Tt=()=>{const a=Ze(),K=et(),[R,L]=u([]),[I,M]=u(!1),[le,ee]=u(null),[te,j]=u(!1),[A,P]=u(""),[Q,C]=u(""),[G,X]=u(new Set),[J,T]=u(!1),[y,N]=u(!1),[w,$]=u(!1),[U,D]=u(!1),[W,k]=u(null),[B,de]=u("all"),[q,F]=u(""),[V,oe]=u(""),[H,i]=u(""),[f,_]=u(""),[pe,ue]=u(""),[Pe,xe]=u(""),[ce,$e]=u("7"),[he,_e]=u(""),[Fe,Se]=u("");tt(()=>{ie()});const ie=async()=>{M(!0);try{let t=await rt();B()!=="all"&&(t=t.filter(o=>o.storeId===B())),console.log(`Loaded signature requests filtered by store ${B()}:`,t),L(t)}catch{P("Error al cargar las solicitudes")}finally{M(!1)}},Ae=async()=>{if(console.log("handleCreateRequest called"),console.log("Form values:",{clientId:q(),clientName:V(),clientEmail:H(),clientPhone:f(),documentType:pe(),notes:Pe(),expirationDays:ce()}),!q()||!V()||!ce()||!he()){P("Por favor complete todos los campos requeridos (incluyendo la tienda)");return}j(!0),P(""),C("");try{console.log("Creating signature request...");const t=await pt({clientId:q(),clientName:V(),clientEmail:H(),clientPhone:f(),documentType:pe(),notes:Pe(),storeId:he(),businessId:ne.getBusinessId(),storeName:Fe()},parseInt(ce()));console.log("Request created successfully:",t),C("Solicitud creada exitosamente"),a.hideModal(),ve(),await ie(),we(t)}catch(t){console.error("Error creating request:",t),P(t.message||"Error al crear la solicitud")}finally{j(!1)}},De=async t=>{if(confirm("¬øEst√° seguro de cancelar esta solicitud?"))try{await nt(t),await ie(),C("Solicitud cancelada")}catch(o){P(o.message||"Error al cancelar la solicitud")}},Le=async t=>{if(confirm("¬øEst√° seguro de ELIMINAR permanentemente esta solicitud? Esta acci√≥n no se puede deshacer."))try{await yt(t),await ie(),C("Solicitud eliminada permanentemente"),setTimeout(()=>C(""),3e3)}catch(o){P(o.message||"Error al eliminar la solicitud"),setTimeout(()=>P(""),5e3)}},ve=()=>{F(""),oe(""),i(""),_(""),ue(""),xe(""),$e("7"),_e(""),Se("")},Ie=t=>{k(t),D(!0),a.hideModal()},Me=()=>{D(!1),k(null)},Te=()=>{a.showModal({title:"Nueva Solicitud de Firma",children:(()=>{var t=xt(),o=t.firstChild,g=o.firstChild,d=g.firstChild,p=d.nextSibling;p.firstChild;var b=g.nextSibling,s=b.firstChild,l=s.nextSibling,E=b.nextSibling,m=E.firstChild,x=m.nextSibling,S=o.nextSibling;return t.style.setProperty("padding","1.5rem"),r(t,e(c,{get when(){return A()},get children(){var h=me();return h.style.setProperty("padding","1rem"),h.style.setProperty("margin-bottom","1rem"),h.style.setProperty("background","var(--error-light)"),h.style.setProperty("color","var(--error-dark)"),h.style.setProperty("border-radius","var(--border-radius-sm)"),r(h,A),h}}),o),o.style.setProperty("display","grid"),o.style.setProperty("gap","1rem"),d.style.setProperty("display","block"),d.style.setProperty("margin-bottom","0.5rem"),d.style.setProperty("font-weight","500"),d.style.setProperty("color","var(--text-primary)"),p.addEventListener("change",h=>{const Y=h.target.value;_e(Y);const Z=ne.allowedStores.find(ye=>ye.id===Y);Se(Z?.name||"")}),p.style.setProperty("width","100%"),p.style.setProperty("padding","0.75rem"),p.style.setProperty("border","1px solid var(--border-color)"),p.style.setProperty("border-radius","var(--border-radius-sm)"),p.style.setProperty("background","white"),r(p,()=>ne.allowedStores.map(h=>(()=>{var Y=$t();return r(Y,()=>h.name),se(()=>Y.value=h.id),Y})()),null),r(o,e(fe,{label:"Pasaporte",get value(){return q()},onChange:F,placeholder:"CLI-001",required:!0}),b),r(o,e(fe,{label:"Nombre del Cliente",get value(){return V()},onChange:oe,placeholder:"Juan P√©rez",required:!0}),b),r(o,e(fe,{label:"Tel√©fono del Cliente",get value(){return f()},onChange:_,placeholder:"+1 234 567 8900"}),b),s.style.setProperty("display","block"),s.style.setProperty("margin-bottom","0.5rem"),s.style.setProperty("font-weight","500"),s.style.setProperty("color","var(--text-primary)"),l.addEventListener("change",h=>$e(h.target.value)),l.style.setProperty("width","100%"),l.style.setProperty("padding","0.75rem"),l.style.setProperty("border","1px solid var(--border-color)"),l.style.setProperty("border-radius","var(--border-radius-sm)"),l.style.setProperty("background","white"),m.style.setProperty("display","block"),m.style.setProperty("margin-bottom","0.5rem"),m.style.setProperty("font-weight","500"),m.style.setProperty("color","var(--text-primary)"),x.$$input=h=>xe(h.target.value),x.style.setProperty("width","100%"),x.style.setProperty("padding","0.75rem"),x.style.setProperty("border","1px solid var(--border-color)"),x.style.setProperty("border-radius","var(--border-radius-sm)"),x.style.setProperty("resize","vertical"),x.style.setProperty("font-family","inherit"),S.style.setProperty("display","flex"),S.style.setProperty("gap","1rem"),S.style.setProperty("margin-top","2rem"),S.style.setProperty("justify-content","flex-end"),r(S,e(z,{variant:"outline",onClick:()=>{a.hideModal(),ve(),P("")},children:"Cancelar"}),null),r(S,e(z,{variant:"primary",onClick:Ae,get disabled(){return te()},get children(){return e(c,{get when(){return te()},fallback:"Crear Solicitud",children:"Creando..."})}}),null),se(()=>p.value=he()),se(()=>l.value=ce()),se(()=>x.value=Pe()),t})(),onClose:()=>{ve(),P("")}})},we=t=>{a.showModal({title:"Enlace de Firma Generado",children:(()=>{var o=_t(),g=o.firstChild,d=g.firstChild,p=d.nextSibling,b=p.firstChild,s=b.nextSibling,l=g.nextSibling,E=l.nextSibling,m=E.nextSibling;return m.firstChild,o.style.setProperty("padding","1.5rem"),g.style.setProperty("text-align","center"),g.style.setProperty("margin-bottom","2rem"),d.style.setProperty("font-size","4rem"),d.style.setProperty("margin-bottom","1rem"),p.style.setProperty("color","var(--text-muted)"),r(s,()=>t.clientName),l.style.setProperty("padding","1rem"),l.style.setProperty("background","var(--background-secondary)"),l.style.setProperty("border-radius","var(--border-radius-sm)"),l.style.setProperty("word-break","break-all"),l.style.setProperty("font-family","monospace"),l.style.setProperty("font-size","0.875rem"),l.style.setProperty("text-align","center"),l.style.setProperty("margin-bottom","1rem"),r(l,()=>ge(t.id)),E.style.setProperty("display","grid"),E.style.setProperty("gap","0.75rem"),r(E,e(z,{variant:"primary",onClick:()=>{je(t.id)},style:{width:"100%"},get children(){return[e(O,{name:"copy",size:"1rem",style:{"margin-right":"0.5rem"}}),"Copiar Enlace"]}}),null),r(E,e(z,{variant:"secondary",onClick:()=>{const S=`Por favor firme el documento usando este enlace: ${ge(t.id)}`;window.open(`mailto:${t.clientEmail}?subject=Solicitud de Firma&body=${encodeURIComponent(S)}`)},style:{width:"100%"},get children(){return[e(O,{name:"email",size:"1rem",style:{"margin-right":"0.5rem"}}),"Enviar por Email"]}}),null),r(E,e(c,{get when(){return t.clientPhone},get children(){return e(z,{variant:"secondary",onClick:async()=>{$(!0);const S=`Por favor firme el documento: 
${ge(t.id)}`;let h=await at(t.clientPhone,S);console.log(h),$(!1)},style:{width:"100%"},get children(){return e(c,{get when(){return!w()},get fallback(){return St()},get children(){return[e(O,{name:"whatsapp",size:"1rem",style:{"margin-right":"0.5rem"}}),"Enviar por WhatsApp"]}})}})}}),null),m.style.setProperty("margin-top","1rem"),m.style.setProperty("font-size","0.8rem"),m.style.setProperty("color","var(--text-muted)"),m.style.setProperty("text-align","center"),r(m,()=>t.expiresAt.toDate().toLocaleDateString(),null),o})()})},je=t=>{const o=ge(t);navigator.clipboard.writeText(o),C("Enlace copiado al portapapeles"),setTimeout(()=>C(""),3e3)},Ue=t=>{if(!t.signatureUrl)return;const o={imageData:t.signatureUrl,clientName:t.clientName,requestId:t.id,signedAt:t.signedAt?.toDate().toISOString()};sessionStorage.setItem("pendingSignature",JSON.stringify(o)),a.hideModal(),K("/pdf-signature")},Be=t=>{if(!t.signatureUrl){a.showModal({title:"Error",children:(()=>{var g=wt();return g.style.setProperty("padding","1.5rem"),g.style.setProperty("text-align","center"),g})()});return}const o=Math.round(t.signatureUrl.length*3/4);a.showModal({title:"Firma del Cliente",children:(()=>{var g=Ct(),d=g.firstChild,p=d.firstChild,b=p.nextSibling;b.firstChild;var s=b.nextSibling,l=s.firstChild;l.firstChild;var E=l.nextSibling,m=d.nextSibling,x=m.firstChild,S=m.nextSibling;return g.style.setProperty("padding","1.5rem"),g.style.setProperty("text-align","center"),d.style.setProperty("margin-bottom","1.5rem"),p.style.setProperty("margin-bottom","0.5rem"),r(p,()=>t.clientName),b.style.setProperty("color","var(--text-muted)"),b.style.setProperty("font-size","0.875rem"),r(b,()=>t.signedAt?.toDate().toLocaleString(),null),s.style.setProperty("margin-top","0.5rem"),s.style.setProperty("padding","0.5rem"),s.style.setProperty("background","var(--background-secondary)"),s.style.setProperty("border-radius","var(--border-radius-sm)"),s.style.setProperty("font-size","0.75rem"),s.style.setProperty("color","var(--text-muted)"),l.style.setProperty("margin-right","1rem"),r(l,()=>dt(o),null),E.style.setProperty("margin-right","1rem"),m.style.setProperty("border","2px solid var(--border-color)"),m.style.setProperty("border-radius","var(--border-radius)"),m.style.setProperty("padding","1rem"),m.style.setProperty("background","white"),m.style.setProperty("max-width","100%"),m.style.setProperty("overflow","hidden"),x.style.setProperty("max-width","100%"),x.style.setProperty("max-height","400px"),x.style.setProperty("height","auto"),x.style.setProperty("display","block"),x.style.setProperty("margin","0 auto"),S.style.setProperty("margin-top","1.5rem"),S.style.setProperty("display","flex"),S.style.setProperty("gap","1rem"),S.style.setProperty("justify-content","center"),S.style.setProperty("flex-wrap","wrap"),r(S,e(c,{get when(){return ne.state?.profile?.AdminPassportAccess},get children(){return[e(z,{variant:"primary",onClick:()=>Ue(t),get children(){return[e(O,{name:"document",size:"1rem",style:{"margin-right":"0.5rem"}}),"Usar en PDF"]}}),e(z,{variant:"secondary",onClick:()=>Ie(t),get children(){return[e(O,{name:"card",size:"1rem",style:{"margin-right":"0.5rem"}}),"Exportar a Pasaporte"]}})]}}),null),r(S,e(z,{variant:"outline",onClick:()=>{const h=document.createElement("a");h.download=`firma-${t.clientName}-${t.id}.png`,h.href=t.signatureUrl,h.click()},get children(){return[e(O,{name:"download",size:"1rem",style:{"margin-right":"0.5rem"}}),"Descargar"]}}),null),r(S,e(z,{variant:"outline",onClick:()=>a.hideModal(),children:"Cerrar"}),null),se(()=>ze(x,"src",t.signatureUrl)),g})()})},qe=t=>{const o=new Set(G());o.has(t)?o.delete(t):o.add(t),X(o)},Oe=()=>{const t=R().filter(o=>o.status==="signed");X(new Set(t.map(o=>o.id)))},Ce=()=>{X(new Set)},Ge=async()=>{if(G().size===0){P("No hay solicitudes seleccionadas para exportar");return}T(!0),P(""),C("");try{const t=Array.from(G()),o=await ot(t);if(o.success.length>0&&C(`${o.success.length} solicitudes exportadas exitosamente`),o.errors.length>0){const g=o.errors.map(d=>`${d.id}: ${d.error}`).join(", ");P(`Errores en exportaci√≥n: ${g}`)}Ce(),await ie()}catch(t){P(t.message||"Error al exportar solicitudes")}finally{T(!1)}},Je=async()=>{const t=R().filter(o=>o.status==="exported");if(t.length===0){P("No hay solicitudes exportadas para limpiar");return}if(confirm(`¬øEst√° seguro de eliminar ${t.length} solicitudes exportadas de Firestore? Esta acci√≥n no se puede deshacer.`)){T(!0),P(""),C("");try{const o=t.map(d=>d.id),g=await it(o);if(g.success.length>0&&C(`${g.success.length} solicitudes limpiadas exitosamente`),g.errors.length>0){const d=g.errors.map(p=>`${p.id}: ${p.error}`).join(", ");P(`Errores en limpieza: ${d}`)}await ie()}catch(o){P(o.message||"Error al limpiar solicitudes")}finally{T(!1)}}},We=t=>{const o={pending:{color:"var(--warning-color)",bg:"var(--warning-light)",text:"Pendiente"},signed:{color:"var(--success-color)",bg:"var(--success-light)",text:"Firmado"},expired:{color:"var(--error-color)",bg:"var(--error-light)",text:"Expirado"},cancelled:{color:"var(--text-muted)",bg:"var(--background-secondary)",text:"Cancelado"},exported:{color:"var(--info-color)",bg:"var(--info-light)",text:"Exportado"}},g=o[t]||o.pending;return(()=>{var d=kt();return d.style.setProperty("padding","0.25rem 0.75rem"),d.style.setProperty("border-radius","var(--border-radius-sm)"),d.style.setProperty("font-size","0.8rem"),d.style.setProperty("font-weight","500"),r(d,()=>g.text),se(p=>{var b=g.bg,s=g.color;return b!==p.e&&((p.e=b)!=null?d.style.setProperty("background",b):d.style.removeProperty("background")),s!==p.t&&((p.t=s)!=null?d.style.setProperty("color",s):d.style.removeProperty("color")),p},{e:void 0,t:void 0}),d})()};return[e(lt,{title:"Gesti√≥n de Solicitudes de Firma",get children(){var t=Et(),o=t.firstChild,g=o.firstChild,d=g.firstChild,p=g.nextSibling,b=o.nextSibling;return t.style.setProperty("padding","1.5rem"),o.style.setProperty("display","flex"),o.style.setProperty("justify-content","space-between"),o.style.setProperty("align-items","center"),o.style.setProperty("margin-bottom","2rem"),o.style.setProperty("flex-wrap","wrap"),o.style.setProperty("gap","1rem"),d.style.setProperty("color","var(--text-muted)"),d.style.setProperty("font-size","0.875rem"),p.style.setProperty("display","flex"),p.style.setProperty("gap","0.5rem"),p.style.setProperty("flex-wrap","wrap"),r(p,e(z,{variant:"primary",onClick:Te,get children(){return[e(O,{name:"add",size:"1rem",style:{"margin-right":"0.5rem"}}),"Nueva Solicitud"]}}),null),r(p,e(c,{get when(){return R().some(s=>s.status==="signed")},get children(){return[e(z,{variant:"secondary",onClick:Oe,get disabled(){return J()},children:"Seleccionar Firmadas"}),e(c,{get when(){return G().size>0},get children(){return[e(z,{variant:"success",onClick:Ge,get disabled(){return J()},get children(){return e(c,{get when(){return J()},get fallback(){return`Exportar (${G().size})`},children:"Exportando..."})}}),e(z,{variant:"outline",onClick:Ce,get disabled(){return J()},children:"Limpiar Selecci√≥n"})]}})]}}),null),r(p,e(c,{get when(){return R().some(s=>s.status==="exported")},get children(){return e(z,{variant:"warning",onClick:Je,get disabled(){return J()},get children(){return e(c,{get when(){return J()},fallback:"Limpiar Exportadas",children:"Limpiando..."})}})}}),null),b.style.setProperty("margin-bottom","2rem"),b.style.setProperty("padding","1.5rem"),b.style.setProperty("background","var(--bg-secondary)"),b.style.setProperty("border-radius","var(--border-radius)"),b.style.setProperty("border","1px solid var(--border-color)"),r(b,e(Ne,{get value(){return B()},onChange:s=>{de(s),ie()},get options(){return[{value:"all",label:"Todas las Tiendas"},...ne.allowedStores.map(s=>({value:s.id,label:s.name,disabled:!s.isActive}))]},style:{"min-width":"250px"},get disabled(){return I()},label:"Filtrar Solicitudes de Firma por Tienda"})),r(t,e(c,{get when(){return A()},get children(){var s=me();return s.style.setProperty("padding","1rem"),s.style.setProperty("margin-bottom","1rem"),s.style.setProperty("background","var(--error-light)"),s.style.setProperty("color","var(--error-dark)"),s.style.setProperty("border-radius","var(--border-radius-sm)"),r(s,A),s}}),null),r(t,e(c,{get when(){return Q()},get children(){var s=me();return s.style.setProperty("padding","1rem"),s.style.setProperty("margin-bottom","1rem"),s.style.setProperty("background","var(--success-light)"),s.style.setProperty("color","var(--success-dark)"),s.style.setProperty("border-radius","var(--border-radius-sm)"),r(s,Q),s}}),null),r(t,e(c,{get when(){return!I()},get fallback(){return(()=>{var s=zt(),l=s.firstChild;return s.style.setProperty("text-align","center"),s.style.setProperty("padding","2rem"),l.style.setProperty("font-size","1.5rem"),l.style.setProperty("margin-bottom","0.5rem"),s})()},get children(){return e(c,{get when(){return R().length>0},get fallback(){return(()=>{var s=Nt(),l=s.firstChild;return s.style.setProperty("text-align","center"),s.style.setProperty("padding","3rem"),s.style.setProperty("background","var(--background-secondary)"),s.style.setProperty("border-radius","var(--border-radius)"),r(s,e(O,{name:"document",size:"3rem",style:{opacity:"0.3","margin-bottom":"1rem"}}),l),l.style.setProperty("color","var(--text-muted)"),s})()},get children(){var s=me();return s.style.setProperty("display","grid"),s.style.setProperty("gap","1rem"),r(s,e(st,{get each(){return R()},children:l=>(()=>{var E=Mt(),m=E.firstChild,x=m.firstChild,S=x.firstChild,h=S.firstChild,Y=h.nextSibling,Z=m.nextSibling,ye=Z.firstChild,Ve=ye.firstChild;Ve.nextSibling;var be=ye.nextSibling,He=be.firstChild;He.nextSibling;var ke=be.nextSibling,Ke=ke.firstChild;Ke.nextSibling;var re=Z.nextSibling;return E.style.setProperty("padding","1.5rem"),E.style.setProperty("border","1px solid var(--border-color)"),E.style.setProperty("border-radius","var(--border-radius)"),E.style.setProperty("background","var(--surface-color)"),E.style.setProperty("transition","all 0.2s ease"),m.style.setProperty("display","flex"),m.style.setProperty("justify-content","space-between"),m.style.setProperty("align-items","flex-start"),m.style.setProperty("margin-bottom","1rem"),x.style.setProperty("display","flex"),x.style.setProperty("align-items","flex-start"),x.style.setProperty("gap","1rem"),r(x,e(c,{get when(){return l.status==="signed"},get children(){var n=Rt();return n.addEventListener("change",()=>qe(l.id)),n.style.setProperty("margin-top","0.25rem"),n.style.setProperty("width","1.125rem"),n.style.setProperty("height","1.125rem"),se(()=>n.checked=G().has(l.id)),n}}),S),h.style.setProperty("margin-bottom","0.5rem"),r(h,()=>l.clientName),Y.style.setProperty("font-size","0.875rem"),Y.style.setProperty("color","var(--text-muted)"),r(Y,()=>l.clientEmail,null),r(Y,e(c,{get when(){return l.clientPhone},get children(){var n=Ft();return n.firstChild,r(n,()=>l.clientPhone,null),n}}),null),r(m,()=>We(l.status),null),Z.style.setProperty("display","grid"),Z.style.setProperty("grid-template-columns","repeat(auto-fit, minmax(200px, 1fr))"),Z.style.setProperty("gap","0.75rem"),Z.style.setProperty("font-size","0.8rem"),Z.style.setProperty("color","var(--text-muted)"),r(ye,()=>l.id,null),r(be,()=>l.createdAt.toDate().toLocaleDateString(),null),r(ke,()=>l.expiresAt.toDate().toLocaleDateString(),null),r(Z,e(c,{get when(){return l.documentType},get children(){var n=At(),ae=n.firstChild;return ae.nextSibling,r(n,()=>l.documentType,null),n}}),null),r(Z,e(c,{get when(){return l.storeName||l.storeId},get children(){var n=Dt(),ae=n.firstChild;return ae.nextSibling,r(n,()=>l.storeName||l.storeId,null),n}}),null),r(E,e(c,{get when(){return l.signedAt},get children(){var n=Lt(),ae=n.firstChild;return ae.nextSibling,n.style.setProperty("margin-top","0.75rem"),n.style.setProperty("padding","0.75rem"),n.style.setProperty("background","var(--success-light)"),n.style.setProperty("border-radius","var(--border-radius-sm)"),n.style.setProperty("font-size","0.875rem"),r(n,()=>l.signedAt.toDate().toLocaleString(),null),n}}),re),r(E,e(c,{get when(){return l.notes},get children(){var n=It(),ae=n.firstChild;return ae.nextSibling,n.style.setProperty("margin-top","0.75rem"),n.style.setProperty("padding","0.75rem"),n.style.setProperty("background","var(--background-secondary)"),n.style.setProperty("border-radius","var(--border-radius-sm)"),n.style.setProperty("font-size","0.875rem"),r(n,()=>l.notes,null),n}}),re),re.style.setProperty("display","flex"),re.style.setProperty("gap","0.5rem"),re.style.setProperty("margin-top","1rem"),re.style.setProperty("flex-wrap","wrap"),r(re,e(c,{get when(){return l.status==="pending"},get children(){return[e(z,{variant:"secondary",size:"sm",onClick:()=>{we(l)},get children(){return[e(O,{name:"copy",size:"0.875rem",style:{"margin-right":"0.25rem"}}),"Copiar Enlace"]}}),e(z,{variant:"outline",size:"sm",onClick:()=>De(l.id),children:"Cancelar"})]}}),null),r(re,e(c,{get when(){return l.status==="signed"&&l.signatureUrl},get children(){return e(z,{variant:"primary",size:"sm",onClick:()=>Be(l),get children(){return[e(O,{name:"signature",size:"0.875rem",style:{"margin-right":"0.25rem"}}),"Ver Firma"]}})}}),null),r(re,e(c,{get when(){return ne.isAdmin()||l.requestedBy===ne.state.user?.uid},get children(){return e(z,{variant:"error",size:"sm",onClick:()=>Le(l.id),title:"Eliminar solicitud permanentemente",get children(){return[e(O,{name:"delete",size:"0.875rem",style:{"margin-right":"0.25rem"}}),"Eliminar"]}})}}),null),E})()})),s}})}}),null),t}}),e(c,{get when(){return W()},get children(){return e(ft,{get isOpen(){return U()},onClose:Me,get signatureRequest(){return W()}})}})]};Re(["input"]);var jt=v("<div><div><h1>‚úçÔ∏è Firmas Digitales</h1><p>Solicite firmas digitales de sus clientes de forma remota. Env√≠e enlaces por email o SMS para que firmen desde cualquier dispositivo.</p></div><div><div><div>üì±</div><h3>Firma M√≥vil</h3><p>Los clientes pueden firmar desde cualquier dispositivo m√≥vil usando su dedo en la pantalla t√°ctil.</p></div><div><div>üîó</div><h3>Enlaces Seguros</h3><p>Genere enlaces √∫nicos con fecha de expiraci√≥n para asegurar la validez de las solicitudes.</p></div><div><div>‚òÅÔ∏è</div><h3>Almacenamiento Seguro</h3><p>Las firmas se guardan de forma segura en Firebase con acceso controlado y trazabilidad completa.</p></div></div><div><h3>¬øC√≥mo Funciona?</h3><div><div><div>1</div><h4>Crear Solicitud</h4><p>Complete los datos del cliente y cree una nueva solicitud de firma</p></div><div><div>2</div><h4>Enviar Enlace</h4><p>Env√≠e el enlace √∫nico al cliente por email, SMS o cualquier medio</p></div><div><div>3</div><h4>Cliente Firma</h4><p>El cliente abre el enlace y firma usando su dedo o mouse</p></div><div><div>‚úì</div><h4>Firma Guardada</h4><p>La firma se guarda autom√°ticamente y usted recibe notificaci√≥n");const Bt=()=>e(ct,{title:"Gesti√≥n de Firmas Digitales",get children(){var a=jt(),K=a.firstChild,R=K.firstChild,L=R.nextSibling,I=K.nextSibling,M=I.firstChild,le=M.firstChild,ee=le.nextSibling,te=ee.nextSibling,j=M.nextSibling,A=j.firstChild,P=A.nextSibling,Q=P.nextSibling,C=j.nextSibling,G=C.firstChild,X=G.nextSibling,J=X.nextSibling,T=I.nextSibling,y=T.firstChild,N=y.nextSibling,w=N.firstChild,$=w.firstChild,U=$.nextSibling,D=U.nextSibling,W=w.nextSibling,k=W.firstChild,B=k.nextSibling,de=B.nextSibling,q=W.nextSibling,F=q.firstChild,V=F.nextSibling,oe=V.nextSibling,H=q.nextSibling,i=H.firstChild,f=i.nextSibling,_=f.nextSibling;return a.style.setProperty("max-width","1200px"),a.style.setProperty("margin","0 auto"),a.style.setProperty("padding","2rem 1rem"),K.style.setProperty("text-align","center"),K.style.setProperty("margin-bottom","3rem"),R.style.setProperty("font-size","2.5rem"),R.style.setProperty("font-weight","700"),R.style.setProperty("margin-bottom","1rem"),R.style.setProperty("color","var(--text-primary)"),R.style.setProperty("background","linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%)"),R.style.setProperty("-webkit-background-clip","text"),R.style.setProperty("-webkit-text-fill-color","transparent"),R.style.setProperty("background-clip","text"),L.style.setProperty("font-size","1.125rem"),L.style.setProperty("color","var(--text-muted)"),L.style.setProperty("max-width","600px"),L.style.setProperty("margin","0 auto"),L.style.setProperty("line-height","1.6"),r(a,e(Tt,{}),I),I.style.setProperty("margin-top","4rem"),I.style.setProperty("display","grid"),I.style.setProperty("grid-template-columns","repeat(auto-fit, minmax(300px, 1fr))"),I.style.setProperty("gap","2rem"),M.style.setProperty("padding","2rem"),M.style.setProperty("background","white"),M.style.setProperty("border-radius","var(--border-radius)"),M.style.setProperty("box-shadow","var(--shadow-sm)"),M.style.setProperty("text-align","center"),le.style.setProperty("font-size","2.5rem"),le.style.setProperty("margin-bottom","1rem"),ee.style.setProperty("font-size","1.25rem"),ee.style.setProperty("font-weight","600"),ee.style.setProperty("margin-bottom","0.5rem"),ee.style.setProperty("color","var(--text-primary)"),te.style.setProperty("color","var(--text-muted)"),te.style.setProperty("line-height","1.5"),te.style.setProperty("margin","0"),j.style.setProperty("padding","2rem"),j.style.setProperty("background","white"),j.style.setProperty("border-radius","var(--border-radius)"),j.style.setProperty("box-shadow","var(--shadow-sm)"),j.style.setProperty("text-align","center"),A.style.setProperty("font-size","2.5rem"),A.style.setProperty("margin-bottom","1rem"),P.style.setProperty("font-size","1.25rem"),P.style.setProperty("font-weight","600"),P.style.setProperty("margin-bottom","0.5rem"),P.style.setProperty("color","var(--text-primary)"),Q.style.setProperty("color","var(--text-muted)"),Q.style.setProperty("line-height","1.5"),Q.style.setProperty("margin","0"),C.style.setProperty("padding","2rem"),C.style.setProperty("background","white"),C.style.setProperty("border-radius","var(--border-radius)"),C.style.setProperty("box-shadow","var(--shadow-sm)"),C.style.setProperty("text-align","center"),G.style.setProperty("font-size","2.5rem"),G.style.setProperty("margin-bottom","1rem"),X.style.setProperty("font-size","1.25rem"),X.style.setProperty("font-weight","600"),X.style.setProperty("margin-bottom","0.5rem"),X.style.setProperty("color","var(--text-primary)"),J.style.setProperty("color","var(--text-muted)"),J.style.setProperty("line-height","1.5"),J.style.setProperty("margin","0"),T.style.setProperty("margin-top","4rem"),T.style.setProperty("padding","3rem 2rem"),T.style.setProperty("background","linear-gradient(135deg, var(--primary-color)10, var(--secondary-color)10)"),T.style.setProperty("border-radius","var(--border-radius)"),T.style.setProperty("text-align","center"),y.style.setProperty("font-size","2rem"),y.style.setProperty("font-weight","600"),y.style.setProperty("margin-bottom","2rem"),y.style.setProperty("color","var(--text-primary)"),N.style.setProperty("display","grid"),N.style.setProperty("grid-template-columns","repeat(auto-fit, minmax(200px, 1fr))"),N.style.setProperty("gap","2rem"),N.style.setProperty("margin-top","2rem"),$.style.setProperty("width","60px"),$.style.setProperty("height","60px"),$.style.setProperty("border-radius","50%"),$.style.setProperty("background","var(--primary-color)"),$.style.setProperty("color","white"),$.style.setProperty("display","flex"),$.style.setProperty("align-items","center"),$.style.setProperty("justify-content","center"),$.style.setProperty("font-size","1.5rem"),$.style.setProperty("font-weight","600"),$.style.setProperty("margin","0 auto 1rem"),U.style.setProperty("margin-bottom","0.5rem"),D.style.setProperty("color","var(--text-muted)"),D.style.setProperty("font-size","0.875rem"),k.style.setProperty("width","60px"),k.style.setProperty("height","60px"),k.style.setProperty("border-radius","50%"),k.style.setProperty("background","var(--secondary-color)"),k.style.setProperty("color","white"),k.style.setProperty("display","flex"),k.style.setProperty("align-items","center"),k.style.setProperty("justify-content","center"),k.style.setProperty("font-size","1.5rem"),k.style.setProperty("font-weight","600"),k.style.setProperty("margin","0 auto 1rem"),B.style.setProperty("margin-bottom","0.5rem"),de.style.setProperty("color","var(--text-muted)"),de.style.setProperty("font-size","0.875rem"),F.style.setProperty("width","60px"),F.style.setProperty("height","60px"),F.style.setProperty("border-radius","50%"),F.style.setProperty("background","var(--accent-color)"),F.style.setProperty("color","white"),F.style.setProperty("display","flex"),F.style.setProperty("align-items","center"),F.style.setProperty("justify-content","center"),F.style.setProperty("font-size","1.5rem"),F.style.setProperty("font-weight","600"),F.style.setProperty("margin","0 auto 1rem"),V.style.setProperty("margin-bottom","0.5rem"),oe.style.setProperty("color","var(--text-muted)"),oe.style.setProperty("font-size","0.875rem"),i.style.setProperty("width","60px"),i.style.setProperty("height","60px"),i.style.setProperty("border-radius","50%"),i.style.setProperty("background","var(--success-color)"),i.style.setProperty("color","white"),i.style.setProperty("display","flex"),i.style.setProperty("align-items","center"),i.style.setProperty("justify-content","center"),i.style.setProperty("font-size","1.5rem"),i.style.setProperty("font-weight","600"),i.style.setProperty("margin","0 auto 1rem"),f.style.setProperty("margin-bottom","0.5rem"),_.style.setProperty("color","var(--text-muted)"),_.style.setProperty("font-size","0.875rem"),a}});export{Bt as default};
