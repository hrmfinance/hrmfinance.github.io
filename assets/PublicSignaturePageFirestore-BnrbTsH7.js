import{a5 as ye,c as h,o as pe,a6 as fe,a as u,S as f,v as H,t as v,h as g,i as d,R as he,b as q,a7 as ve,d as be}from"./index-kEqkrCc-.js";var Pe=v("<div><div><div>⏳</div><p>Cargando solicitud de firma...</p><p>Conectando a Firestore (máximo 5 segundos)"),$e=v("<div><div><div><div>❌</div><h2>Error</h2><p>"),xe=v("<div><div><div><div>✅</div><h2>¡Firma Guardada en Firestore!</h2><p>Su firma ha sido guardada exitosamente en la base de datos.</p><p>Puede cerrar esta ventana."),Se=v("<p><strong>Teléfono:</strong> "),_e=v("<p><strong>Tipo de Documento:</strong> "),we=v("<p><strong>Notas:</strong> "),Ce=v("<div>"),Ee=v("<div><div><div><h1>Solicitud de Firma (Firestore)</h1><p></p></div><div><div><h3>Información del Cliente</h3><div><p><strong>Nombre:</strong> </p><p><strong>Email:</strong> </p></div></div><div><h3>Firme en el Área Indicada</h3><canvas></canvas><p>Use su dedo o mouse para dibujar su firma</p></div><div><button>Limpiar</button><button></button></div><p>Al firmar, usted acepta que esta firma electrónica tiene la misma validez legal que una firma manuscrita.");const Fe=()=>{const J=ye(),[l,W]=h(null),[K,z]=h(!0),[P,m]=h(""),[$,O]=h(null),[Q,L]=h(!1),[R,A]=h(!1),[T,U]=h(!1),[B,Z]=h(!1);pe(()=>{const e=J.id;if(!e){m("ID de solicitud inválido"),z(!1);return}const t=setTimeout(()=>{console.log("Firestore request timed out - using fallback"),m("La solicitud tardó demasiado tiempo. Usando datos de prueba."),m(""),z(!1)},5e3);(async()=>{try{console.log("Attempting Firestore fetch...");const s=await fe(e);clearTimeout(t),s?s.status==="expired"?m("Esta solicitud de firma ha expirado"):s.status==="signed"?m("Esta solicitud ya ha sido firmada"):s.status==="cancelled"?m("Esta solicitud ha sido cancelada"):(console.log("Firestore data loaded successfully"),W(s),setTimeout(ee,100)):m("Solicitud de firma no encontrada")}catch(s){clearTimeout(t),console.error("Firestore error:",s),m("Error al cargar desde Firestore: "+(s instanceof Error?s.message:"Unknown error"))}finally{console.log("setLoading(false);",l()),z(!1)}})()});const ee=()=>{const e=$();if(!e)return;const t=e.getContext("2d");if(!t)return;const r=e.getBoundingClientRect();e.width=r.width,e.height=r.height,t.strokeStyle="#000",t.lineWidth=2,t.lineCap="round",t.lineJoin="round",t.fillStyle="white",t.fillRect(0,0,e.width,e.height)},N=e=>{L(!0);const t=$();if(!t)return;const r=t.getBoundingClientRect(),s=t.getContext("2d");if(!s)return;let i,o;e instanceof MouseEvent?(i=e.clientX-r.left,o=e.clientY-r.top):(i=e.touches[0].clientX-r.left,o=e.touches[0].clientY-r.top),s.beginPath(),s.moveTo(i,o)},X=e=>{if(!Q())return;const t=$();if(!t)return;const r=t.getBoundingClientRect(),s=t.getContext("2d");if(!s)return;let i,o;e instanceof MouseEvent?(i=e.clientX-r.left,o=e.clientY-r.top):(e.preventDefault(),i=e.touches[0].clientX-r.left,o=e.touches[0].clientY-r.top),s.lineTo(i,o),s.stroke(),A(!0)},D=()=>{L(!1)},te=()=>{const e=$();if(!e)return;const t=e.getContext("2d");t&&(t.fillStyle="white",t.fillRect(0,0,e.width,e.height),A(!1))},re=async()=>{const e=$(),t=l();if(!(!e||!t||!R())){U(!0),m("");try{const r=e.toDataURL("image/png");console.log("Attempting to save signature to Firestore...");const s=ve({requestId:l()?.id,signatureDataUrl:r,signedAt:new Date,deviceInfo:{userAgent:navigator.userAgent,platform:navigator.platform,language:navigator.language}}),i=new Promise((o,a)=>{setTimeout(()=>a(new Error("Save operation timed out")),1e4)});await Promise.race([s,i]),console.log("Signature saved to Firestore successfully"),Z(!0)}catch(r){console.error("Error saving signature:",r),r.message.includes("timed out")?m("La operación de guardado tardó demasiado tiempo. Intente nuevamente."):m(r.message||"Error al guardar la firma")}finally{U(!1)}}},_={"min-height":"100vh",background:"var(--background-secondary, #f5f5f5)",padding:"1rem",display:"flex","align-items":"center","justify-content":"center"},I={"max-width":"500px",width:"100%",background:"white","border-radius":"8px","box-shadow":"0 4px 6px rgba(0, 0, 0, 0.1)",overflow:"hidden"},ne={background:"#6c5ce7",color:"white",padding:"2rem","text-align":"center"},se={padding:"2rem"},ie={width:"100%",height:"300px",border:"2px dashed #ddd","border-radius":"4px",cursor:"crosshair","touch-action":"none",background:"white"},Y={width:"100%",padding:"1rem","border-radius":"4px",border:"none","font-weight":"600",cursor:"pointer",transition:"all 0.2s ease"},oe=()=>(()=>{var e=Pe(),t=e.firstChild,r=t.firstChild,s=r.nextSibling,i=s.nextSibling;return t.style.setProperty("text-align","center"),r.style.setProperty("font-size","2rem"),r.style.setProperty("margin-bottom","1rem"),i.style.setProperty("font-size","0.875rem"),i.style.setProperty("color","#666"),q(o=>g(e,_,o)),e})();P()&&l();const le=()=>(()=>{var e=$e(),t=e.firstChild,r=t.firstChild,s=r.firstChild,i=s.nextSibling,o=i.nextSibling;return r.style.setProperty("padding","3rem"),r.style.setProperty("text-align","center"),s.style.setProperty("font-size","3rem"),s.style.setProperty("margin-bottom","1rem"),i.style.setProperty("margin-bottom","1rem"),i.style.setProperty("color","#e74c3c"),o.style.setProperty("color","#666"),d(o,P),q(a=>{var y=_,c=I;return a.e=g(e,y,a.e),a.t=g(t,c,a.t),a},{e:void 0,t:void 0}),e})();let ae=()=>(()=>{var e=xe(),t=e.firstChild,r=t.firstChild,s=r.firstChild,i=s.nextSibling,o=i.nextSibling,a=o.nextSibling;return r.style.setProperty("padding","3rem"),r.style.setProperty("text-align","center"),s.style.setProperty("font-size","4rem"),s.style.setProperty("margin-bottom","1rem"),i.style.setProperty("margin-bottom","1rem"),i.style.setProperty("color","#27ae60"),o.style.setProperty("color","#666"),o.style.setProperty("margin-bottom","2rem"),a.style.setProperty("font-size","0.875rem"),a.style.setProperty("color","#666"),q(y=>{var c=_,x=I;return y.e=g(e,c,y.e),y.t=g(t,x,y.t),y},{e:void 0,t:void 0}),e})();return[u(f,{get when(){return B()},get children(){return u(ae,{})}}),u(f,{get when(){return H(()=>!!P())()&&!l()},get children(){return u(le,{})}}),u(f,{get when(){return K()},get children(){return u(oe,{})}}),u(f,{get when(){return H(()=>!!l())()&&!B()},get children(){var e=Ee(),t=e.firstChild,r=t.firstChild,s=r.firstChild,i=s.nextSibling,o=r.nextSibling,a=o.firstChild,y=a.firstChild,c=y.nextSibling,x=c.firstChild,de=x.firstChild;de.nextSibling;var G=x.nextSibling,ce=G.firstChild;ce.nextSibling;var w=a.nextSibling,M=w.firstChild,p=M.nextSibling,C=p.nextSibling,S=w.nextSibling,E=S.firstChild,k=E.nextSibling,F=S.nextSibling;return g(r,ne),s.style.setProperty("font-size","1.5rem"),s.style.setProperty("margin-bottom","0.5rem"),i.style.setProperty("opacity","0.9"),i.style.setProperty("font-size","0.875rem"),d(i,()=>l()?.requestedByName),g(o,se),a.style.setProperty("margin-bottom","2rem"),y.style.setProperty("margin-bottom","1rem"),c.style.setProperty("background","#f8f9fa"),c.style.setProperty("padding","1rem"),c.style.setProperty("border-radius","4px"),c.style.setProperty("font-size","0.875rem"),d(x,()=>l()?.clientName,null),d(G,()=>l()?.clientEmail,null),d(c,u(f,{get when(){return l()?.clientPhone},get children(){var n=Se(),b=n.firstChild;return b.nextSibling,d(n,()=>l()?.clientPhone,null),n}}),null),d(c,u(f,{get when(){return l()?.documentType},get children(){var n=_e(),b=n.firstChild;return b.nextSibling,d(n,()=>l()?.documentType,null),n}}),null),d(c,u(f,{get when(){return l()?.notes},get children(){var n=we(),b=n.firstChild;return b.nextSibling,n.style.setProperty("margin-top","0.5rem"),d(n,()=>l()?.notes,null),n}}),null),d(o,u(f,{get when(){return P()},get children(){var n=Ce();return n.style.setProperty("padding","1rem"),n.style.setProperty("background","#fee"),n.style.setProperty("color","#c33"),n.style.setProperty("border-radius","4px"),n.style.setProperty("margin-bottom","1rem"),d(n,P),n}}),w),w.style.setProperty("margin-bottom","1.5rem"),M.style.setProperty("margin-bottom","1rem"),p.$$touchend=D,p.$$touchmove=X,p.$$touchstart=N,p.addEventListener("mouseleave",D),p.$$mouseup=D,p.$$mousemove=X,p.$$mousedown=N,he(O,p),g(p,ie),C.style.setProperty("margin-top","0.5rem"),C.style.setProperty("font-size","0.8rem"),C.style.setProperty("color","#666"),C.style.setProperty("text-align","center"),S.style.setProperty("display","flex"),S.style.setProperty("gap","1rem"),S.style.setProperty("margin-bottom","1rem"),E.$$click=te,k.$$click=re,d(k,u(f,{get when(){return T()},fallback:"Guardar",children:"Guardando..."})),F.style.setProperty("font-size","0.75rem"),F.style.setProperty("color","#666"),F.style.setProperty("text-align","center"),F.style.setProperty("line-height","1.4"),q(n=>{var b=_,ue=I,ge={...Y,background:"#f8f9fa",color:"#333"},V=!R()||T(),me={...Y,background:"#6c5ce7",color:"white"},j=!R()||T();return n.e=g(e,b,n.e),n.t=g(t,ue,n.t),n.a=g(E,ge,n.a),V!==n.o&&(E.disabled=n.o=V),n.i=g(k,me,n.i),j!==n.n&&(k.disabled=n.n=j),n},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0}),e}})]};be(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","click"]);export{Fe as default};
