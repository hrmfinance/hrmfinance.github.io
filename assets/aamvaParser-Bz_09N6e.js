import{e as t}from"./index-W3yYPV3L.js";const x={DCS:"familyName",DCT:"firstName",DAC:"firstName",DAD:"middleName",DBN:"middleName",DCU:"suffix",DDF:"familyNameTrunc",DDG:"firstNameTrunc",DDH:"middleNameTrunc",DAA:"fullName",DAB:"lastName",DAG:"streetAddress",DAH:"streetAddress2",DAI:"city",DAJ:"jurisdiction",DAK:"postalCode",DCG:"country",DAQ:"licenseNumber",DCF:"documentDiscriminator",DCI:"placeOfBirth",DCJ:"auditInfo",DCK:"inventoryControl",DDA:"complianceType",DDB:"cardRevisionDate",DDC:"hazmatEndorsementExpiry",DDD:"limitedDuration",DAW:"weightLbs",DAX:"weightKg",DAZ:"hairColor",DBC:"sex",DBD:"documentIssueDate",DBB:"dateOfBirth",DBA:"expirationDate",DAU:"height",DAY:"eyeColor",DBE:"issueTimestamp",DBF:"numberOfDuplicates",DBG:"medicalIndicator",DBH:"nonResident",DBI:"uniqueCustomerId",DBJ:"socialSecurityNumber",DBK:"socialSecurityNumber",DBL:"dateOfBirthNum",DBM:"socialSecurityNumber",DBN:"fullName",DBO:"lastName",DBP:"firstName",DBQ:"middleName",DBR:"suffix",DBS:"suffixAlias",DCE:"weightRange",DCL:"race",DCM:"standardVehicleClass",DCN:"standardEndorsements",DCO:"standardRestrictions",DCP:"vehicleClassDesc",DCQ:"endorsementDesc",DCR:"restrictionDesc",ZVA:"jurisdictionSpecific",ZVB:"jurisdictionSpecific",ZVC:"jurisdictionSpecific"},B={BLK:"Black",BLU:"Blue",BRO:"Brown",GRY:"Gray",GRN:"Green",HAZ:"Hazel",MAR:"Maroon",PNK:"Pink",DIC:"Dichromatic",UNK:"Unknown"},P={BAL:"Bald",BLK:"Black",BLN:"Blonde",BRO:"Brown",GRY:"Gray",RED:"Red/Auburn",SDY:"Sandy",WHI:"White",UNK:"Unknown"};function R(s){const e=[],i=Object.keys(x),o=[];for(const n of i){let f=0;for(;f<s.length;){const d=s.indexOf(n,f);if(d===-1)break;o.push({pos:d,code:n}),f=d+1}}o.sort((n,f)=>n.pos-f.pos);for(let n=0;n<o.length;n++){const f=o[n].pos,d=n<o.length-1?o[n+1].pos:s.length,r=s.substring(f,d);r.length>3&&e.push(r)}return e}function k(s){if(!s||s.length<10)return t("AAMVA Parser: Invalid or empty barcode data"),null;t("=== AAMVA Parser Start ==="),t("AAMVA Parser: Raw data length:",s.length),t("AAMVA Parser: First 200 chars:",s.substring(0,200)),t("AAMVA Parser: Raw bytes (first 50):",Array.from(s.substring(0,50)).map(e=>e.charCodeAt(0)));try{const e={rawData:s,firstName:"",lastName:"",address:"",city:"",state:"",zipCode:"",idNumber:"",idState:"",dateOfBirth:""};let i=s.replace(/\x00/g,"").replace(/\r\n/g,`
`).replace(/\r/g,`
`);const o=i.indexOf("@");o!==-1&&(i=i.substring(o),t("AAMVA Parser: Found compliance indicator @ at index",o));const n=i.match(/ANSI\s*(\d{6})(\d{2})?/);n&&(e.aamvaVersion=n[2]||"01",t("AAMVA Parser: Version detected:",e.aamvaVersion));const f=["",`
`,"\r","",`
`,"\r"];let d=[];if(i.includes("")&&(d=i.split("").filter(u=>u.length>0),t("AAMVA Parser: Split by RS (0x1E), found",d.length,"segments")),d.length<=3){const u=i.split(/[\n\r]+/).filter(c=>c.length>0);u.length>d.length&&(d=u,t("AAMVA Parser: Split by newlines, found",d.length,"segments"))}if(d.length<=3&&i.includes("")){const u=i.split("").filter(c=>c.length>0);u.length>d.length&&(d=u,t("AAMVA Parser: Split by US (0x1F), found",d.length,"segments"))}d.length<=3&&(t("AAMVA Parser: Few segments found, trying compact format parsing"),d=R(i)),t("AAMVA Parser: Final segment count:",d.length),d.length>0&&t("AAMVA Parser: First segment:",d[0].substring(0,50));for(const u of d){const c=u.trim();if(c.length<3)continue;if(c.startsWith("@")||c.startsWith("ANSI")||c.match(/^[A-Z]{2}\d{6}/)||c.match(/^DL\d/)){t("AAMVA Parser: Skipping header segment:",c.substring(0,30));continue}let h="",a="";const C=c.substring(0,3).toUpperCase();if(x[C])h=C,a=c.substring(3).trim();else for(const g of Object.keys(x)){let m=c.toUpperCase().indexOf(g);if(m!==-1&&m<5){h=g,a=c.substring(m+3).trim();break}}if(!h){/^\d{8}$/.test(c)&&t("AAMVA Parser: Found 8-digit date without field code:",c);continue}if(!a){t("AAMVA Parser: Field",h,"has no value");continue}const b=x[h];switch(t("AAMVA Parser: Field",h,"("+b+") =",a.substring(0,50)),b){case"familyName":case"lastName":e.lastName=l(a);break;case"firstName":const g=a.split(/[,\s]+/);e.firstName=l(g[0]),g.length>1&&!e.middleName&&(e.middleName=l(g.slice(1).join(" ")));break;case"middleName":(!e.middleName||a.length>(e.middleName?.length||0))&&(e.middleName=l(a));break;case"fullName":const m=a.split(",").map(p=>p.trim());if(m.length>=1&&(e.lastName=l(m[0])),m.length>=2){const p=m[1].split(/\s+/);e.firstName=l(p[0]),p.length>1&&(e.middleName=l(p.slice(1).join(" ")))}m.length>=3&&(e.middleName=l(m[2]));break;case"suffix":e.suffix=a.toUpperCase();break;case"streetAddress":e.address=a;break;case"city":e.city=a;break;case"jurisdiction":e.state=a.substring(0,2).toUpperCase(),e.idState=e.state;break;case"postalCode":e.zipCode=a.replace(/[^0-9]/g,"").substring(0,9),e.zipCode.length>5&&(e.zipCode=e.zipCode.substring(0,5)+"-"+e.zipCode.substring(5));break;case"country":e.country=a;break;case"licenseNumber":e.idNumber=a;break;case"dateOfBirth":e.dateOfBirth=N(a);break;case"expirationDate":e.expirationDate=N(a);break;case"documentIssueDate":e.issueDate=N(a);break;case"sex":e.gender=V(a);break;case"height":e.height=S(a);break;case"weightLbs":e.weight=a.replace(/\D/g,"")+" lbs";break;case"eyeColor":e.eyeColor=B[a.toUpperCase()]||a;break;case"hairColor":e.hairColor=P[a.toUpperCase()]||a;break}}t("AAMVA Parser: Segment parsing result:",{firstName:e.firstName,lastName:e.lastName,idNumber:e.idNumber,state:e.state,dob:e.dateOfBirth});const r=I(s);return r&&(!e.firstName&&r.firstName&&(e.firstName=r.firstName),!e.lastName&&r.lastName&&(e.lastName=r.lastName),!e.middleName&&r.middleName&&(e.middleName=r.middleName),!e.idNumber&&r.idNumber&&(e.idNumber=r.idNumber),!e.idState&&r.idState&&(e.idState=r.idState),!e.state&&r.state&&(e.state=r.state),!e.dateOfBirth&&r.dateOfBirth&&(e.dateOfBirth=r.dateOfBirth),!e.expirationDate&&r.expirationDate&&(e.expirationDate=r.expirationDate),!e.issueDate&&r.issueDate&&(e.issueDate=r.issueDate),!e.address&&r.address&&(e.address=r.address),!e.city&&r.city&&(e.city=r.city),!e.zipCode&&r.zipCode&&(e.zipCode=r.zipCode),!e.gender&&r.gender&&(e.gender=r.gender),!e.eyeColor&&r.eyeColor&&(e.eyeColor=r.eyeColor),!e.hairColor&&r.hairColor&&(e.hairColor=r.hairColor),!e.height&&r.height&&(e.height=r.height),!e.weight&&r.weight&&(e.weight=r.weight)),t("=== AAMVA Parser Final Result ==="),t("First Name:",e.firstName||"(not found)"),t("Last Name:",e.lastName||"(not found)"),t("ID Number:",e.idNumber||"(not found)"),t("ID State:",e.idState||e.state||"(not found)"),t("DOB:",e.dateOfBirth||"(not found)"),t("Address:",e.address||"(not found)"),t("City:",e.city||"(not found)"),t("State:",e.state||"(not found)"),t("ZIP:",e.zipCode||"(not found)"),t("Expiration:",e.expirationDate||"(not found)"),t("Issue Date:",e.issueDate||"(not found)"),t("================================"),!e.lastName&&!e.firstName&&!e.idNumber?(t("AAMVA Parser: Could not extract any meaningful data from barcode"),t("AAMVA Parser: Raw data sample:",s.substring(0,300)),null):e}catch(e){return t("AAMVA Parser: Error parsing barcode data",e),t("AAMVA Parser: Raw data that caused error:",s.substring(0,200)),null}}function l(s){return s?s.replace(/[^a-zA-Z\s'-]/g,"").trim().split(/\s+/).map(e=>e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()).join(" "):""}function N(s){if(!s)return"";const e=s.replace(/\D/g,"");if(e.length===8){const i=parseInt(e.substring(0,4),10);if(parseInt(e.substring(4,8),10),i>1900&&i<2100)return`${e.substring(0,4)}-${e.substring(4,6)}-${e.substring(6,8)}`;const o=e.substring(0,2),n=e.substring(2,4);return`${e.substring(4,8)}-${o}-${n}`}if(e.length===6){const i=e.substring(0,2),o=e.substring(2,4),n=e.substring(4,6);return`${parseInt(n,10)>50?"19"+n:"20"+n}-${i}-${o}`}return s}function V(s){const e=s.charAt(0).toUpperCase();return e==="1"||e==="M"?"M":e==="2"||e==="F"?"F":"X"}function S(s){const e=s.replace(/\D/g,"");if(e.length===3){const i=parseInt(e.charAt(0),10),o=parseInt(e.substring(1),10);return`${i}'${o.toString().padStart(2,"0")}"`}else if(e.length===2){const i=parseInt(e,10),o=Math.floor(i/12),n=i%12;return`${o}'${n.toString().padStart(2,"0")}"`}if(s.toLowerCase().includes("in")){const i=parseInt(e,10);if(i>0){const o=Math.floor(i/12),n=i%12;return`${o}'${n.toString().padStart(2,"0")}"`}}if(s.toLowerCase().includes("cm")){const i=parseInt(e,10);if(i>0){const o=Math.round(i/2.54),n=Math.floor(o/12),f=o%12;return`${n}'${f.toString().padStart(2,"0")}"`}}return s}function I(s){const e={};t("AAMVA Parser: Starting regex extraction on data length:",s.length);const i=s.toUpperCase(),o=i.match(/DAQ([A-Z0-9\s\-*]+?)(?=[A-Z]{3}|\x1e|\x0a|\x0d|$)/i)||i.match(/DAQ([A-Z0-9]{4,20})/i);o&&(e.idNumber=o[1].trim(),t("AAMVA Parser: Regex found license:",e.idNumber));const n=i.match(/DCS([A-Z\s'\-]+?)(?=D[A-Z]{2}|\x1e|\x0a|\x0d|$)/i);n&&(e.lastName=l(n[1]),t("AAMVA Parser: Regex found last name:",e.lastName));const f=i.match(/(?:DCT|DAC)([A-Z\s,'\-]+?)(?=D[A-Z]{2}|\x1e|\x0a|\x0d|$)/i);if(f){const A=f[1].split(/[,\s]+/).filter(D=>D.length>0);e.firstName=l(A[0]),A.length>1&&(e.middleName=l(A.slice(1).join(" "))),t("AAMVA Parser: Regex found first name:",e.firstName,"middle:",e.middleName)}if(!e.middleName){const A=i.match(/DAD([A-Z\s'\-]+?)(?=D[A-Z]{2}|\x1e|\x0a|\x0d|$)/i);A&&(e.middleName=l(A[1]),t("AAMVA Parser: Regex found middle name:",e.middleName))}const d=i.match(/DAA([A-Z\s,'\-]+?)(?=D[A-Z]{2}|\x1e|\x0a|\x0d|$)/i);if(d&&(!e.firstName||!e.lastName)){const A=d[1].split(",").map(D=>D.trim());if(A.length>=1&&!e.lastName&&(e.lastName=l(A[0])),A.length>=2&&!e.firstName){const D=A[1].split(/\s+/);e.firstName=l(D[0]),D.length>1&&!e.middleName&&(e.middleName=l(D.slice(1).join(" ")))}A.length>=3&&!e.middleName&&(e.middleName=l(A[2])),t("AAMVA Parser: Regex found full name - last:",e.lastName,"first:",e.firstName)}const r=i.match(/DBB(\d{8})/);r&&(e.dateOfBirth=N(r[1]),t("AAMVA Parser: Regex found DOB:",e.dateOfBirth));const u=i.match(/DBA(\d{8})/);u&&(e.expirationDate=N(u[1]),t("AAMVA Parser: Regex found expiration:",e.expirationDate));const c=i.match(/DBD(\d{8})/);c&&(e.issueDate=N(c[1]),t("AAMVA Parser: Regex found issue date:",e.issueDate));const h=i.match(/DAG([A-Z0-9\s\-\.#]+?)(?=D[A-Z]{2}|\x1e|\x0a|\x0d|$)/i);h&&(e.address=h[1].trim(),t("AAMVA Parser: Regex found address:",e.address));const a=i.match(/DAI([A-Z\s\-\.]+?)(?=D[A-Z]{2}|\x1e|\x0a|\x0d|$)/i);a&&(e.city=a[1].trim(),t("AAMVA Parser: Regex found city:",e.city));const C=i.match(/DAJ([A-Z]{2})/i);C&&(e.state=C[1].toUpperCase(),e.idState=e.state,t("AAMVA Parser: Regex found state:",e.state));const b=i.match(/DAK(\d{5,9}|\d{5}\s*\d{4})/);b&&(e.zipCode=b[1].replace(/\s/g,"").substring(0,9),e.zipCode.length>5&&(e.zipCode=e.zipCode.substring(0,5)+"-"+e.zipCode.substring(5)),t("AAMVA Parser: Regex found ZIP:",e.zipCode));const g=i.match(/DBC([12MF9])/i);g&&(e.gender=V(g[1]),t("AAMVA Parser: Regex found gender:",e.gender));const m=i.match(/DAY([A-Z]{3})/i);m&&(e.eyeColor=B[m[1].toUpperCase()]||m[1],t("AAMVA Parser: Regex found eye color:",e.eyeColor));const p=i.match(/DAZ([A-Z]{3})/i);p&&(e.hairColor=P[p[1].toUpperCase()]||p[1],t("AAMVA Parser: Regex found hair color:",e.hairColor));const M=i.match(/DAU(\d{3}|\d{1}\s*\d{2})/);M&&(e.height=S(M[1].replace(/\s/g,"")),t("AAMVA Parser: Regex found height:",e.height));const y=i.match(/DAW(\d{2,3})/);return y&&(e.weight=y[1]+" lbs",t("AAMVA Parser: Regex found weight:",e.weight)),t("AAMVA Parser: Regex extraction complete, found",Object.keys(e).length,"fields"),Object.keys(e).length>0?e:null}function Z(s){return t("AAMVA to TaxPortal:",s),{idNumber:s.idNumber||"",idState:s.idState||s.state||"",issueDate:s.issueDate,expirationDate:s.expirationDate,idType:"drivers_license",firstName:s.firstName,middleName:s.middleName,lastName:s.lastName,suffix:s.suffix,dateOfBirth:s.dateOfBirth,gender:s.gender,eyeColor:s.eyeColor,hairColor:s.hairColor,height:s.height,weight:s.weight,address:s.address,city:s.city,state:s.state,zipCode:s.zipCode,country:s.country||"USA"}}export{Z as a,k as p};
