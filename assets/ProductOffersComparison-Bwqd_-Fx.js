import{aF as require$$5,c as createSignal,f as createMemo,O as fetchGraphQLSS,t as template,i as insert,a as createComponent,B as Button,S as Show,j as Card,b as createRenderEffect,h as style,F as For,v as memo,d as delegateEvents}from"./index-s7OisT63.js";const normalizeProductName=E=>E.toLowerCase().trim().replace(/\s+/g," ").replace(/[^\w\s]/g,"").replace(/\b(kg|lb|lbs|oz|g|ml|l|unit|units|box|boxes|case|cases)\b/gi,"").trim(),normalizeUnit=E=>{const s={kilogram:"kg",kilograms:"kg",kilo:"kg",kilos:"kg",pound:"lb",pounds:"lb",lbs:"lb",ounce:"oz",ounces:"oz",gram:"g",grams:"g",liter:"l",liters:"l",litre:"l",litres:"l",milliliter:"ml",milliliters:"ml",unit:"ea",units:"ea",each:"ea",piece:"ea",pieces:"ea",pcs:"ea",box:"box",boxes:"box",case:"case",cases:"case",pack:"pack",packs:"pack",package:"pack",packages:"pack"},y=E.toLowerCase().trim();return s[y]||y},generateProductId=()=>`prod_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,generateOfferId=()=>`offer_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,generateComparisonId=()=>`comp_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,defaultCSVConfig={delimiter:",",hasHeader:!0,columnMapping:{productName:0,productCode:1,quantity:2,unitPrice:3,totalPrice:4},defaultCurrency:"USD",defaultUnit:"ea"},defaultPDFConfig={parserType:"auto",defaultCurrency:"USD",defaultUnit:"ea"};async function parseCSVFile(E,s,y){return new Promise((i,d)=>{const C=new FileReader;C.onload=A=>{try{const M=A.target?.result,w=parseCSVString(M,s,y||E.name.replace(/\.csv$/i,""));i(w)}catch(M){d(M)}},C.onerror=()=>{d(new Error("Failed to read file"))},C.readAsText(E)})}function parseCSVString(E,s,y){const i={...defaultCSVConfig,...s,columnMapping:{...defaultCSVConfig.columnMapping,...s?.columnMapping}};s?.delimiter||(i.delimiter=detectDelimiter(E));const d=parseCSVLines(E,i.delimiter);if(d.length===0)throw new Error("CSV file is empty");let C=0;if(i.skipRows&&(C+=i.skipRows),i.hasHeader){if(!s?.columnMapping&&d.length>0){const t=suggestColumnMapping(d[C]);i.columnMapping={...i.columnMapping,...t}}C+=1}const A=[],M=i.defaultCurrency||"USD";for(let t=C;t<d.length;t++){const r=d[t];if(!(r.length===0||r.every(l=>!l.trim())))try{const l=parseProductFromRow(r,i,M);l&&A.push(l)}catch(l){console.warn(`Skipping row ${t+1}: ${l}`)}}const w=A.reduce((t,r)=>t+r.totalPrice,0);return{id:generateOfferId(),supplierName:y||"Unknown Supplier",sourceFile:y||"csv-import",sourceType:"csv",uploadDate:Date.now(),products:A,currency:M,totalProducts:A.length,totalValue:w}}function detectDelimiter(E){const y=E.split(`
`).slice(0,5).join(`
`),i=(y.match(/,/g)||[]).length,d=(y.match(/;/g)||[]).length,C=(y.match(/\t/g)||[]).length;return C>i&&C>d?"	":d>i?";":","}function suggestColumnMapping(E){const s={};return E.forEach((y,i)=>{const d=y.toLowerCase().trim();(d.includes("product")||d.includes("name")||d.includes("item")||d.includes("description")&&!s.productName)&&(s.productName=i),(d.includes("code")||d.includes("product code")||d.includes("item code"))&&!d.includes("sku")&&!s.productCode&&(s.productCode=i),d.includes("sku")&&(s.sku=i),(d.includes("desc")||d==="description")&&s.productName!==i&&(s.description=i),(d.includes("unit")||d.includes("uom")||d.includes("measure"))&&(s.unit=i),(d.includes("qty")||d.includes("quantity")||d.includes("amount")&&!d.includes("price"))&&(s.quantity=i),(d.includes("price")&&d.includes("unit")||d.includes("price")&&!d.includes("total")||d==="price"||d.includes("unit price")||d.includes("price/unit"))&&(s.unitPrice=i),(d.includes("total")||d.includes("amount")&&d.includes("total")||d.includes("subtotal"))&&(s.totalPrice=i),(d.includes("category")||d.includes("type")||d.includes("group"))&&(s.category=i),(d.includes("brand")||d.includes("manufacturer")||d.includes("make"))&&(s.brand=i)}),s}function parseCSVLines(E,s){const y=[],i=E.split(/\r?\n/);for(let d=0;d<i.length;d++){const C=i[d];if(!C.trim())continue;const A=[];let M="",w=!1;for(let n=0;n<C.length;n++){const t=C[n],r=C[n+1];t==='"'?w&&r==='"'?(M+='"',n++):w=!w:t===s&&!w?(A.push(M.trim()),M=""):M+=t}A.push(M.trim()),y.push(A)}return y}function parseProductFromRow(E,s,y){const i=s.columnMapping,d=getColumnValue(E,i.productName);if(!d)return null;const C=getColumnValue(E,i.unitPrice);if(!C)return null;const A=parseNumber$1(C);if(isNaN(A))throw new Error(`Invalid unit price: ${C}`);const M=getColumnValue(E,i.productCode),w=getColumnValue(E,i.sku),n=getColumnValue(E,i.description),t=getColumnValue(E,i.category),r=getColumnValue(E,i.brand);let l=1;const c=getColumnValue(E,i.quantity);c&&(l=parseNumber$1(c),(isNaN(l)||l<=0)&&(l=1));let e=s.defaultUnit||"ea";const h=getColumnValue(E,i.unit);h&&(e=normalizeUnit(h));let f;const a=getColumnValue(E,i.totalPrice);a?(f=parseNumber$1(a),isNaN(f)&&(f=l*A)):f=l*A;const v={id:generateProductId(),productName:d.trim(),normalizedName:normalizeProductName(d),unit:e,quantity:l,unitPrice:A,totalPrice:f,currency:y};return M&&(v.productCode=M),w&&(v.sku=w),n&&(v.description=n),t&&(v.category=t),r&&(v.brand=r),v}function getColumnValue(E,s){return s===void 0||s<0||s>=E.length?"":E[s]?.trim()||""}function parseNumber$1(E){if(!E)return NaN;let s=E.trim().replace(/[$€£¥₹]/g,"");const y=s.lastIndexOf(","),i=s.lastIndexOf(".");return y>i?s=s.replace(/\./g,"").replace(",","."):s=s.replace(/,/g,""),parseFloat(s)}function commonjsRequire(E){throw new Error('Could not dynamically require "'+E+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var pdf={exports:{}},hasRequiredPdf;function requirePdf(){return hasRequiredPdf||(hasRequiredPdf=1,function(module,exports){(function(s,y){module.exports=s.pdfjsLib=y()})(globalThis,()=>(()=>{var __webpack_modules__=[,(E,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.VerbosityLevel=s.Util=s.UnknownErrorException=s.UnexpectedResponseException=s.TextRenderingMode=s.RenderingIntentFlag=s.PromiseCapability=s.PermissionFlag=s.PasswordResponses=s.PasswordException=s.PageActionEventType=s.OPS=s.MissingPDFException=s.MAX_IMAGE_SIZE_TO_CACHE=s.LINE_FACTOR=s.LINE_DESCENT_FACTOR=s.InvalidPDFException=s.ImageKind=s.IDENTITY_MATRIX=s.FormatError=s.FeatureTest=s.FONT_IDENTITY_MATRIX=s.DocumentActionEventType=s.CMapCompressionType=s.BaseException=s.BASELINE_FACTOR=s.AnnotationType=s.AnnotationReplyType=s.AnnotationPrefix=s.AnnotationMode=s.AnnotationFlag=s.AnnotationFieldFlag=s.AnnotationEditorType=s.AnnotationEditorPrefix=s.AnnotationEditorParamsType=s.AnnotationBorderStyleType=s.AnnotationActionEventType=s.AbortException=void 0,s.assert=p,s.bytesToString=$,s.createValidAbsoluteUrl=_,s.getModificationDate=Pe,s.getUuid=Fe,s.getVerbosityLevel=ut,s.info=J,s.isArrayBuffer=Jt,s.isArrayEqual=Se,s.isNodeJS=void 0,s.normalizeUnicode=Re,s.objectFromMap=V,s.objectSize=lt,s.setVerbosityLevel=it,s.shadow=F,s.string32=G,s.stringToBytes=B,s.stringToPDFString=Tt,s.stringToUTF8String=$t,s.unreachable=b,s.utf8StringToString=zt,s.warn=L;const y=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser");s.isNodeJS=y;const i=[1,0,0,1,0,0];s.IDENTITY_MATRIX=i;const d=[.001,0,0,.001,0,0];s.FONT_IDENTITY_MATRIX=d;const C=1e7;s.MAX_IMAGE_SIZE_TO_CACHE=C;const A=1.35;s.LINE_FACTOR=A;const M=.35;s.LINE_DESCENT_FACTOR=M;const w=M/A;s.BASELINE_FACTOR=w;const n={ANY:1,DISPLAY:2,PRINT:4,SAVE:8,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,OPLIST:256};s.RenderingIntentFlag=n;const t={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3};s.AnnotationMode=t;const r="pdfjs_internal_editor_";s.AnnotationEditorPrefix=r;const l={DISABLE:-1,NONE:0,FREETEXT:3,STAMP:13,INK:15};s.AnnotationEditorType=l;const c={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23};s.AnnotationEditorParamsType=c;const e={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048};s.PermissionFlag=e;const h={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4};s.TextRenderingMode=h;const f={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3};s.ImageKind=f;const a={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26};s.AnnotationType=a;const v={GROUP:"Group",REPLY:"R"};s.AnnotationReplyType=v;const R={INVISIBLE:1,HIDDEN:2,PRINT:4,NOZOOM:8,NOROTATE:16,NOVIEW:32,READONLY:64,LOCKED:128,TOGGLENOVIEW:256,LOCKEDCONTENTS:512};s.AnnotationFlag=R;const k={READONLY:1,REQUIRED:2,NOEXPORT:4,MULTILINE:4096,PASSWORD:8192,NOTOGGLETOOFF:16384,RADIO:32768,PUSHBUTTON:65536,COMBO:131072,EDIT:262144,SORT:524288,FILESELECT:1048576,MULTISELECT:2097152,DONOTSPELLCHECK:4194304,DONOTSCROLL:8388608,COMB:16777216,RICHTEXT:33554432,RADIOSINUNISON:33554432,COMMITONSELCHANGE:67108864};s.AnnotationFieldFlag=k;const g={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5};s.AnnotationBorderStyleType=g;const P={E:"Mouse Enter",X:"Mouse Exit",D:"Mouse Down",U:"Mouse Up",Fo:"Focus",Bl:"Blur",PO:"PageOpen",PC:"PageClose",PV:"PageVisible",PI:"PageInvisible",K:"Keystroke",F:"Format",V:"Validate",C:"Calculate"};s.AnnotationActionEventType=P;const U={WC:"WillClose",WS:"WillSave",DS:"DidSave",WP:"WillPrint",DP:"DidPrint"};s.DocumentActionEventType=U;const z={O:"PageOpen",C:"PageClose"};s.PageActionEventType=z;const N={ERRORS:0,WARNINGS:1,INFOS:5};s.VerbosityLevel=N;const j={NONE:0,BINARY:1};s.CMapCompressionType=j;const W={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91};s.OPS=W;const at={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};s.PasswordResponses=at;let tt=N.WARNINGS;function it(rt){Number.isInteger(rt)&&(tt=rt)}function ut(){return tt}function J(rt){tt>=N.INFOS&&console.log(`Info: ${rt}`)}function L(rt){tt>=N.WARNINGS&&console.log(`Warning: ${rt}`)}function b(rt){throw new Error(rt)}function p(rt,q){rt||b(q)}function u(rt){switch(rt?.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function _(rt,q=null,H=null){if(!rt)return null;try{if(H&&typeof rt=="string"&&(H.addDefaultProtocol&&rt.startsWith("www.")&&rt.match(/\./g)?.length>=2&&(rt=`http://${rt}`),H.tryConvertEncoding))try{rt=$t(rt)}catch{}const At=q?new URL(rt,q):new URL(rt);if(u(At))return At}catch{}return null}function F(rt,q,H,At=!1){return Object.defineProperty(rt,q,{value:H,enumerable:!At,configurable:!0,writable:!1}),H}const I=function(){function q(H,At){this.constructor===q&&b("Cannot initialize BaseException."),this.message=H,this.name=At}return q.prototype=new Error,q.constructor=q,q}();s.BaseException=I;class O extends I{constructor(q,H){super(q,"PasswordException"),this.code=H}}s.PasswordException=O;class x extends I{constructor(q,H){super(q,"UnknownErrorException"),this.details=H}}s.UnknownErrorException=x;class o extends I{constructor(q){super(q,"InvalidPDFException")}}s.InvalidPDFException=o;class m extends I{constructor(q){super(q,"MissingPDFException")}}s.MissingPDFException=m;class S extends I{constructor(q,H){super(q,"UnexpectedResponseException"),this.status=H}}s.UnexpectedResponseException=S;class T extends I{constructor(q){super(q,"FormatError")}}s.FormatError=T;class D extends I{constructor(q){super(q,"AbortException")}}s.AbortException=D;function $(rt){(typeof rt!="object"||rt?.length===void 0)&&b("Invalid argument for bytesToString");const q=rt.length,H=8192;if(q<H)return String.fromCharCode.apply(null,rt);const At=[];for(let Vt=0;Vt<q;Vt+=H){const Kt=Math.min(Vt+H,q),be=rt.subarray(Vt,Kt);At.push(String.fromCharCode.apply(null,be))}return At.join("")}function B(rt){typeof rt!="string"&&b("Invalid argument for stringToBytes");const q=rt.length,H=new Uint8Array(q);for(let At=0;At<q;++At)H[At]=rt.charCodeAt(At)&255;return H}function G(rt){return String.fromCharCode(rt>>24&255,rt>>16&255,rt>>8&255,rt&255)}function lt(rt){return Object.keys(rt).length}function V(rt){const q=Object.create(null);for(const[H,At]of rt)q[H]=At;return q}function X(){const rt=new Uint8Array(4);return rt[0]=1,new Uint32Array(rt.buffer,0,1)[0]===1}function K(){try{return new Function(""),!0}catch{return!1}}class Y{static get isLittleEndian(){return F(this,"isLittleEndian",X())}static get isEvalSupported(){return F(this,"isEvalSupported",K())}static get isOffscreenCanvasSupported(){return F(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get platform(){return typeof navigator>"u"?F(this,"platform",{isWin:!1,isMac:!1}):F(this,"platform",{isWin:navigator.platform.includes("Win"),isMac:navigator.platform.includes("Mac")})}static get isCSSRoundSupported(){return F(this,"isCSSRoundSupported",globalThis.CSS?.supports?.("width: round(1.5px, 1px)"))}}s.FeatureTest=Y;const et=[...Array(256).keys()].map(rt=>rt.toString(16).padStart(2,"0"));class gt{static makeHexColor(q,H,At){return`#${et[q]}${et[H]}${et[At]}`}static scaleMinMax(q,H){let At;q[0]?(q[0]<0&&(At=H[0],H[0]=H[1],H[1]=At),H[0]*=q[0],H[1]*=q[0],q[3]<0&&(At=H[2],H[2]=H[3],H[3]=At),H[2]*=q[3],H[3]*=q[3]):(At=H[0],H[0]=H[2],H[2]=At,At=H[1],H[1]=H[3],H[3]=At,q[1]<0&&(At=H[2],H[2]=H[3],H[3]=At),H[2]*=q[1],H[3]*=q[1],q[2]<0&&(At=H[0],H[0]=H[1],H[1]=At),H[0]*=q[2],H[1]*=q[2]),H[0]+=q[4],H[1]+=q[4],H[2]+=q[5],H[3]+=q[5]}static transform(q,H){return[q[0]*H[0]+q[2]*H[1],q[1]*H[0]+q[3]*H[1],q[0]*H[2]+q[2]*H[3],q[1]*H[2]+q[3]*H[3],q[0]*H[4]+q[2]*H[5]+q[4],q[1]*H[4]+q[3]*H[5]+q[5]]}static applyTransform(q,H){const At=q[0]*H[0]+q[1]*H[2]+H[4],Vt=q[0]*H[1]+q[1]*H[3]+H[5];return[At,Vt]}static applyInverseTransform(q,H){const At=H[0]*H[3]-H[1]*H[2],Vt=(q[0]*H[3]-q[1]*H[2]+H[2]*H[5]-H[4]*H[3])/At,Kt=(-q[0]*H[1]+q[1]*H[0]+H[4]*H[1]-H[5]*H[0])/At;return[Vt,Kt]}static getAxialAlignedBoundingBox(q,H){const At=this.applyTransform(q,H),Vt=this.applyTransform(q.slice(2,4),H),Kt=this.applyTransform([q[0],q[3]],H),be=this.applyTransform([q[2],q[1]],H);return[Math.min(At[0],Vt[0],Kt[0],be[0]),Math.min(At[1],Vt[1],Kt[1],be[1]),Math.max(At[0],Vt[0],Kt[0],be[0]),Math.max(At[1],Vt[1],Kt[1],be[1])]}static inverseTransform(q){const H=q[0]*q[3]-q[1]*q[2];return[q[3]/H,-q[1]/H,-q[2]/H,q[0]/H,(q[2]*q[5]-q[4]*q[3])/H,(q[4]*q[1]-q[5]*q[0])/H]}static singularValueDecompose2dScale(q){const H=[q[0],q[2],q[1],q[3]],At=q[0]*H[0]+q[1]*H[2],Vt=q[0]*H[1]+q[1]*H[3],Kt=q[2]*H[0]+q[3]*H[2],be=q[2]*H[1]+q[3]*H[3],xe=(At+be)/2,Te=Math.sqrt((At+be)**2-4*(At*be-Kt*Vt))/2,oe=xe+Te||1,Qt=xe-Te||1;return[Math.sqrt(oe),Math.sqrt(Qt)]}static normalizeRect(q){const H=q.slice(0);return q[0]>q[2]&&(H[0]=q[2],H[2]=q[0]),q[1]>q[3]&&(H[1]=q[3],H[3]=q[1]),H}static intersect(q,H){const At=Math.max(Math.min(q[0],q[2]),Math.min(H[0],H[2])),Vt=Math.min(Math.max(q[0],q[2]),Math.max(H[0],H[2]));if(At>Vt)return null;const Kt=Math.max(Math.min(q[1],q[3]),Math.min(H[1],H[3])),be=Math.min(Math.max(q[1],q[3]),Math.max(H[1],H[3]));return Kt>be?null:[At,Kt,Vt,be]}static bezierBoundingBox(q,H,At,Vt,Kt,be,xe,Te){const oe=[],Qt=[[],[]];let Yt,Xt,Me,vt,he,ve,ue,se;for(let ke=0;ke<2;++ke){if(ke===0?(Xt=6*q-12*At+6*Kt,Yt=-3*q+9*At-9*Kt+3*xe,Me=3*At-3*q):(Xt=6*H-12*Vt+6*be,Yt=-3*H+9*Vt-9*be+3*Te,Me=3*Vt-3*H),Math.abs(Yt)<1e-12){if(Math.abs(Xt)<1e-12)continue;vt=-Me/Xt,0<vt&&vt<1&&oe.push(vt);continue}ue=Xt*Xt-4*Me*Yt,se=Math.sqrt(ue),!(ue<0)&&(he=(-Xt+se)/(2*Yt),0<he&&he<1&&oe.push(he),ve=(-Xt-se)/(2*Yt),0<ve&&ve<1&&oe.push(ve))}let de=oe.length,pe;const Ee=de;for(;de--;)vt=oe[de],pe=1-vt,Qt[0][de]=pe*pe*pe*q+3*pe*pe*vt*At+3*pe*vt*vt*Kt+vt*vt*vt*xe,Qt[1][de]=pe*pe*pe*H+3*pe*pe*vt*Vt+3*pe*vt*vt*be+vt*vt*vt*Te;return Qt[0][Ee]=q,Qt[1][Ee]=H,Qt[0][Ee+1]=xe,Qt[1][Ee+1]=Te,Qt[0].length=Qt[1].length=Ee+2,[Math.min(...Qt[0]),Math.min(...Qt[1]),Math.max(...Qt[0]),Math.max(...Qt[1])]}}s.Util=gt;const wt=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,728,711,710,729,733,731,730,732,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8226,8224,8225,8230,8212,8211,402,8260,8249,8250,8722,8240,8222,8220,8221,8216,8217,8218,8482,64257,64258,321,338,352,376,381,305,322,339,353,382,0,8364];function Tt(rt){if(rt[0]>="ï"){let H;if(rt[0]==="þ"&&rt[1]==="ÿ"?H="utf-16be":rt[0]==="ÿ"&&rt[1]==="þ"?H="utf-16le":rt[0]==="ï"&&rt[1]==="»"&&rt[2]==="¿"&&(H="utf-8"),H)try{const At=new TextDecoder(H,{fatal:!0}),Vt=B(rt);return At.decode(Vt)}catch(At){L(`stringToPDFString: "${At}".`)}}const q=[];for(let H=0,At=rt.length;H<At;H++){const Vt=wt[rt.charCodeAt(H)];q.push(Vt?String.fromCharCode(Vt):rt.charAt(H))}return q.join("")}function $t(rt){return decodeURIComponent(escape(rt))}function zt(rt){return unescape(encodeURIComponent(rt))}function Jt(rt){return typeof rt=="object"&&rt?.byteLength!==void 0}function Se(rt,q){if(rt.length!==q.length)return!1;for(let H=0,At=rt.length;H<At;H++)if(rt[H]!==q[H])return!1;return!0}function Pe(rt=new Date){return[rt.getUTCFullYear().toString(),(rt.getUTCMonth()+1).toString().padStart(2,"0"),rt.getUTCDate().toString().padStart(2,"0"),rt.getUTCHours().toString().padStart(2,"0"),rt.getUTCMinutes().toString().padStart(2,"0"),rt.getUTCSeconds().toString().padStart(2,"0")].join("")}class Ae{#t=!1;constructor(){this.promise=new Promise((q,H)=>{this.resolve=At=>{this.#t=!0,q(At)},this.reject=At=>{this.#t=!0,H(At)}})}get settled(){return this.#t}}s.PromiseCapability=Ae;let me=null,ye=null;function Re(rt){return me||(me=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,ye=new Map([["ﬅ","ſt"]])),rt.replaceAll(me,(q,H,At)=>H?H.normalize("NFKC"):ye.get(At))}function Fe(){if(typeof crypto<"u"&&typeof crypto?.randomUUID=="function")return crypto.randomUUID();const rt=new Uint8Array(32);if(typeof crypto<"u"&&typeof crypto?.getRandomValues=="function")crypto.getRandomValues(rt);else for(let q=0;q<32;q++)rt[q]=Math.floor(Math.random()*255);return $(rt)}const Oe="pdfjs_internal_id_";s.AnnotationPrefix=Oe},(__unused_webpack_module,exports,__w_pdfjs_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.RenderTask=exports.PDFWorkerUtil=exports.PDFWorker=exports.PDFPageProxy=exports.PDFDocumentProxy=exports.PDFDocumentLoadingTask=exports.PDFDataRangeTransport=exports.LoopbackPort=exports.DefaultStandardFontDataFactory=exports.DefaultFilterFactory=exports.DefaultCanvasFactory=exports.DefaultCMapReaderFactory=void 0,Object.defineProperty(exports,"SVGGraphics",{enumerable:!0,get:function(){return _displaySvg.SVGGraphics}}),exports.build=void 0,exports.getDocument=getDocument,exports.version=void 0;var _util=__w_pdfjs_require__(1),_annotation_storage=__w_pdfjs_require__(3),_display_utils=__w_pdfjs_require__(6),_font_loader=__w_pdfjs_require__(9),_displayNode_utils=__w_pdfjs_require__(10),_canvas=__w_pdfjs_require__(11),_worker_options=__w_pdfjs_require__(14),_message_handler=__w_pdfjs_require__(15),_metadata=__w_pdfjs_require__(16),_optional_content_config=__w_pdfjs_require__(17),_transport_stream=__w_pdfjs_require__(18),_displayFetch_stream=__w_pdfjs_require__(19),_displayNetwork=__w_pdfjs_require__(22),_displayNode_stream=__w_pdfjs_require__(23),_displaySvg=__w_pdfjs_require__(24),_xfa_text=__w_pdfjs_require__(25);const DEFAULT_RANGE_CHUNK_SIZE=65536,RENDERING_CANCELLED_TIMEOUT=100,DELAYED_CLEANUP_TIMEOUT=5e3,DefaultCanvasFactory=_util.isNodeJS?_displayNode_utils.NodeCanvasFactory:_display_utils.DOMCanvasFactory;exports.DefaultCanvasFactory=DefaultCanvasFactory;const DefaultCMapReaderFactory=_util.isNodeJS?_displayNode_utils.NodeCMapReaderFactory:_display_utils.DOMCMapReaderFactory;exports.DefaultCMapReaderFactory=DefaultCMapReaderFactory;const DefaultFilterFactory=_util.isNodeJS?_displayNode_utils.NodeFilterFactory:_display_utils.DOMFilterFactory;exports.DefaultFilterFactory=DefaultFilterFactory;const DefaultStandardFontDataFactory=_util.isNodeJS?_displayNode_utils.NodeStandardFontDataFactory:_display_utils.DOMStandardFontDataFactory;exports.DefaultStandardFontDataFactory=DefaultStandardFontDataFactory;function getDocument(E){if(typeof E=="string"||E instanceof URL?E={url:E}:(0,_util.isArrayBuffer)(E)&&(E={data:E}),typeof E!="object")throw new Error("Invalid parameter in getDocument, need parameter object.");if(!E.url&&!E.data&&!E.range)throw new Error("Invalid parameter object: need either .data, .range or .url");const s=new PDFDocumentLoadingTask,{docId:y}=s,i=E.url?getUrlProp(E.url):null,d=E.data?getDataProp(E.data):null,C=E.httpHeaders||null,A=E.withCredentials===!0,M=E.password??null,w=E.range instanceof PDFDataRangeTransport?E.range:null,n=Number.isInteger(E.rangeChunkSize)&&E.rangeChunkSize>0?E.rangeChunkSize:DEFAULT_RANGE_CHUNK_SIZE;let t=E.worker instanceof PDFWorker?E.worker:null;const r=E.verbosity,l=typeof E.docBaseUrl=="string"&&!(0,_display_utils.isDataScheme)(E.docBaseUrl)?E.docBaseUrl:null,c=typeof E.cMapUrl=="string"?E.cMapUrl:null,e=E.cMapPacked!==!1,h=E.CMapReaderFactory||DefaultCMapReaderFactory,f=typeof E.standardFontDataUrl=="string"?E.standardFontDataUrl:null,a=E.StandardFontDataFactory||DefaultStandardFontDataFactory,v=E.stopAtErrors!==!0,R=Number.isInteger(E.maxImageSize)&&E.maxImageSize>-1?E.maxImageSize:-1,k=E.isEvalSupported!==!1,g=typeof E.isOffscreenCanvasSupported=="boolean"?E.isOffscreenCanvasSupported:!_util.isNodeJS,P=Number.isInteger(E.canvasMaxAreaInBytes)?E.canvasMaxAreaInBytes:-1,U=typeof E.disableFontFace=="boolean"?E.disableFontFace:_util.isNodeJS,z=E.fontExtraProperties===!0,N=E.enableXfa===!0,j=E.ownerDocument||globalThis.document,W=E.disableRange===!0,at=E.disableStream===!0,tt=E.disableAutoFetch===!0,it=E.pdfBug===!0,ut=w?w.length:E.length??NaN,J=typeof E.useSystemFonts=="boolean"?E.useSystemFonts:!_util.isNodeJS&&!U,L=typeof E.useWorkerFetch=="boolean"?E.useWorkerFetch:h===_display_utils.DOMCMapReaderFactory&&a===_display_utils.DOMStandardFontDataFactory&&c&&f&&(0,_display_utils.isValidFetchUrl)(c,document.baseURI)&&(0,_display_utils.isValidFetchUrl)(f,document.baseURI),b=E.canvasFactory||new DefaultCanvasFactory({ownerDocument:j}),p=E.filterFactory||new DefaultFilterFactory({docId:y,ownerDocument:j}),u=null;(0,_util.setVerbosityLevel)(r);const _={canvasFactory:b,filterFactory:p};if(L||(_.cMapReaderFactory=new h({baseUrl:c,isCompressed:e}),_.standardFontDataFactory=new a({baseUrl:f})),!t){const O={verbosity:r,port:_worker_options.GlobalWorkerOptions.workerPort};t=O.port?PDFWorker.fromPort(O):new PDFWorker(O),s._worker=t}const F={docId:y,apiVersion:"3.11.174",data:d,password:M,disableAutoFetch:tt,rangeChunkSize:n,length:ut,docBaseUrl:l,enableXfa:N,evaluatorOptions:{maxImageSize:R,disableFontFace:U,ignoreErrors:v,isEvalSupported:k,isOffscreenCanvasSupported:g,canvasMaxAreaInBytes:P,fontExtraProperties:z,useSystemFonts:J,cMapUrl:L?c:null,standardFontDataUrl:L?f:null}},I={ignoreErrors:v,isEvalSupported:k,disableFontFace:U,fontExtraProperties:z,enableXfa:N,ownerDocument:j,disableAutoFetch:tt,pdfBug:it,styleElement:u};return t.promise.then(function(){if(s.destroyed)throw new Error("Loading aborted");const O=_fetchDocument(t,F),x=new Promise(function(o){let m;w?m=new _transport_stream.PDFDataTransportStream({length:ut,initialData:w.initialData,progressiveDone:w.progressiveDone,contentDispositionFilename:w.contentDispositionFilename,disableRange:W,disableStream:at},w):d||(m=(T=>_util.isNodeJS?new _displayNode_stream.PDFNodeStream(T):(0,_display_utils.isValidFetchUrl)(T.url)?new _displayFetch_stream.PDFFetchStream(T):new _displayNetwork.PDFNetworkStream(T))({url:i,length:ut,httpHeaders:C,withCredentials:A,rangeChunkSize:n,disableRange:W,disableStream:at})),o(m)});return Promise.all([O,x]).then(function([o,m]){if(s.destroyed)throw new Error("Loading aborted");const S=new _message_handler.MessageHandler(y,o,t.port),T=new WorkerTransport(S,s,m,I,_);s._transport=T,S.send("Ready",null)})}).catch(s._capability.reject),s}async function _fetchDocument(E,s){if(E.destroyed)throw new Error("Worker was destroyed");const y=await E.messageHandler.sendWithPromise("GetDocRequest",s,s.data?[s.data.buffer]:null);if(E.destroyed)throw new Error("Worker was destroyed");return y}function getUrlProp(E){if(E instanceof URL)return E.href;try{return new URL(E,window.location).href}catch{if(_util.isNodeJS&&typeof E=="string")return E}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function getDataProp(E){if(_util.isNodeJS&&typeof Buffer<"u"&&E instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(E instanceof Uint8Array&&E.byteLength===E.buffer.byteLength)return E;if(typeof E=="string")return(0,_util.stringToBytes)(E);if(typeof E=="object"&&!isNaN(E?.length)||(0,_util.isArrayBuffer)(E))return new Uint8Array(E);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}class PDFDocumentLoadingTask{static#t=0;constructor(){this._capability=new _util.PromiseCapability,this._transport=null,this._worker=null,this.docId=`d${PDFDocumentLoadingTask.#t++}`,this.destroyed=!1,this.onPassword=null,this.onProgress=null}get promise(){return this._capability.promise}async destroy(){this.destroyed=!0;try{this._worker?.port&&(this._worker._pendingDestroy=!0),await this._transport?.destroy()}catch(s){throw this._worker?.port&&delete this._worker._pendingDestroy,s}this._transport=null,this._worker&&(this._worker.destroy(),this._worker=null)}}exports.PDFDocumentLoadingTask=PDFDocumentLoadingTask;class PDFDataRangeTransport{constructor(s,y,i=!1,d=null){this.length=s,this.initialData=y,this.progressiveDone=i,this.contentDispositionFilename=d,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=new _util.PromiseCapability}addRangeListener(s){this._rangeListeners.push(s)}addProgressListener(s){this._progressListeners.push(s)}addProgressiveReadListener(s){this._progressiveReadListeners.push(s)}addProgressiveDoneListener(s){this._progressiveDoneListeners.push(s)}onDataRange(s,y){for(const i of this._rangeListeners)i(s,y)}onDataProgress(s,y){this._readyCapability.promise.then(()=>{for(const i of this._progressListeners)i(s,y)})}onDataProgressiveRead(s){this._readyCapability.promise.then(()=>{for(const y of this._progressiveReadListeners)y(s)})}onDataProgressiveDone(){this._readyCapability.promise.then(()=>{for(const s of this._progressiveDoneListeners)s()})}transportReady(){this._readyCapability.resolve()}requestDataRange(s,y){(0,_util.unreachable)("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}exports.PDFDataRangeTransport=PDFDataRangeTransport;class PDFDocumentProxy{constructor(s,y){this._pdfInfo=s,this._transport=y,Object.defineProperty(this,"getJavaScript",{value:()=>((0,_display_utils.deprecated)("`PDFDocumentProxy.getJavaScript`, please use `PDFDocumentProxy.getJSActions` instead."),this.getJSActions().then(i=>{if(!i)return i;const d=[];for(const C in i)d.push(...i[C]);return d}))})}get annotationStorage(){return this._transport.annotationStorage}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return(0,_util.shadow)(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(s){return this._transport.getPage(s)}getPageIndex(s){return this._transport.getPageIndex(s)}getDestinations(){return this._transport.getDestinations()}getDestination(s){return this._transport.getDestination(s)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig(){return this._transport.getOptionalContentConfig()}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(s=!1){return this._transport.startCleanup(s||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}exports.PDFDocumentProxy=PDFDocumentProxy;class PDFPageProxy{#t=null;#e=!1;constructor(s,y,i,d=!1){this._pageIndex=s,this._pageInfo=y,this._transport=i,this._stats=d?new _display_utils.StatTimer:null,this._pdfBug=d,this.commonObjs=i.commonObjs,this.objs=new PDFObjects,this._maybeCleanupAfterRender=!1,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:s,rotation:y=this.rotate,offsetX:i=0,offsetY:d=0,dontFlip:C=!1}={}){return new _display_utils.PageViewport({viewBox:this.view,scale:s,rotation:y,offsetX:i,offsetY:d,dontFlip:C})}getAnnotations({intent:s="display"}={}){const y=this._transport.getRenderingIntent(s);return this._transport.getAnnotations(this._pageIndex,y.renderingIntent)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return(0,_util.shadow)(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){return this._transport._htmlForXfa?.children[this._pageIndex]||null}render({canvasContext:s,viewport:y,intent:i="display",annotationMode:d=_util.AnnotationMode.ENABLE,transform:C=null,background:A=null,optionalContentConfigPromise:M=null,annotationCanvasMap:w=null,pageColors:n=null,printAnnotationStorage:t=null}){this._stats?.time("Overall");const r=this._transport.getRenderingIntent(i,d,t);this.#e=!1,this.#s(),M||(M=this._transport.getOptionalContentConfig());let l=this._intentStates.get(r.cacheKey);l||(l=Object.create(null),this._intentStates.set(r.cacheKey,l)),l.streamReaderCancelTimeout&&(clearTimeout(l.streamReaderCancelTimeout),l.streamReaderCancelTimeout=null);const c=!!(r.renderingIntent&_util.RenderingIntentFlag.PRINT);l.displayReadyCapability||(l.displayReadyCapability=new _util.PromiseCapability,l.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(r));const e=a=>{l.renderTasks.delete(h),(this._maybeCleanupAfterRender||c)&&(this.#e=!0),this.#r(!c),a?(h.capability.reject(a),this._abortOperatorList({intentState:l,reason:a instanceof Error?a:new Error(a)})):h.capability.resolve(),this._stats?.timeEnd("Rendering"),this._stats?.timeEnd("Overall")},h=new InternalRenderTask({callback:e,params:{canvasContext:s,viewport:y,transform:C,background:A},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:w,operatorList:l.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!c,pdfBug:this._pdfBug,pageColors:n});(l.renderTasks||=new Set).add(h);const f=h.task;return Promise.all([l.displayReadyCapability.promise,M]).then(([a,v])=>{if(this.destroyed){e();return}this._stats?.time("Rendering"),h.initializeGraphics({transparency:a,optionalContentConfig:v}),h.operatorListChanged()}).catch(e),f}getOperatorList({intent:s="display",annotationMode:y=_util.AnnotationMode.ENABLE,printAnnotationStorage:i=null}={}){function d(){A.operatorList.lastChunk&&(A.opListReadCapability.resolve(A.operatorList),A.renderTasks.delete(M))}const C=this._transport.getRenderingIntent(s,y,i,!0);let A=this._intentStates.get(C.cacheKey);A||(A=Object.create(null),this._intentStates.set(C.cacheKey,A));let M;return A.opListReadCapability||(M=Object.create(null),M.operatorListChanged=d,A.opListReadCapability=new _util.PromiseCapability,(A.renderTasks||=new Set).add(M),A.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(C)),A.opListReadCapability.promise}streamTextContent({includeMarkedContent:s=!1,disableNormalization:y=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:s===!0,disableNormalization:y===!0},{highWaterMark:100,size(d){return d.items.length}})}getTextContent(s={}){if(this._transport._htmlForXfa)return this.getXfa().then(i=>_xfa_text.XfaText.textContent(i));const y=this.streamTextContent(s);return new Promise(function(i,d){function C(){A.read().then(function({value:w,done:n}){if(n){i(M);return}Object.assign(M.styles,w.styles),M.items.push(...w.items),C()},d)}const A=y.getReader(),M={items:[],styles:Object.create(null)};C()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const s=[];for(const y of this._intentStates.values())if(this._abortOperatorList({intentState:y,reason:new Error("Page was destroyed."),force:!0}),!y.opListReadCapability)for(const i of y.renderTasks)s.push(i.completed),i.cancel();return this.objs.clear(),this.#e=!1,this.#s(),Promise.all(s)}cleanup(s=!1){this.#e=!0;const y=this.#r(!1);return s&&y&&(this._stats&&=new _display_utils.StatTimer),y}#r(s=!1){if(this.#s(),!this.#e||this.destroyed)return!1;if(s)return this.#t=setTimeout(()=>{this.#t=null,this.#r(!1)},DELAYED_CLEANUP_TIMEOUT),!1;for(const{renderTasks:y,operatorList:i}of this._intentStates.values())if(y.size>0||!i.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),this.#e=!1,!0}#s(){this.#t&&(clearTimeout(this.#t),this.#t=null)}_startRenderPage(s,y){const i=this._intentStates.get(y);i&&(this._stats?.timeEnd("Page Request"),i.displayReadyCapability?.resolve(s))}_renderPageChunk(s,y){for(let i=0,d=s.length;i<d;i++)y.operatorList.fnArray.push(s.fnArray[i]),y.operatorList.argsArray.push(s.argsArray[i]);y.operatorList.lastChunk=s.lastChunk,y.operatorList.separateAnnots=s.separateAnnots;for(const i of y.renderTasks)i.operatorListChanged();s.lastChunk&&this.#r(!0)}_pumpOperatorList({renderingIntent:s,cacheKey:y,annotationStorageSerializable:i}){const{map:d,transfers:C}=i,M=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:s,cacheKey:y,annotationStorage:d},C).getReader(),w=this._intentStates.get(y);w.streamReader=M;const n=()=>{M.read().then(({value:t,done:r})=>{if(r){w.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(t,w),n())},t=>{if(w.streamReader=null,!this._transport.destroyed){if(w.operatorList){w.operatorList.lastChunk=!0;for(const r of w.renderTasks)r.operatorListChanged();this.#r(!0)}if(w.displayReadyCapability)w.displayReadyCapability.reject(t);else if(w.opListReadCapability)w.opListReadCapability.reject(t);else throw t}})};n()}_abortOperatorList({intentState:s,reason:y,force:i=!1}){if(s.streamReader){if(s.streamReaderCancelTimeout&&(clearTimeout(s.streamReaderCancelTimeout),s.streamReaderCancelTimeout=null),!i){if(s.renderTasks.size>0)return;if(y instanceof _display_utils.RenderingCancelledException){let d=RENDERING_CANCELLED_TIMEOUT;y.extraDelay>0&&y.extraDelay<1e3&&(d+=y.extraDelay),s.streamReaderCancelTimeout=setTimeout(()=>{s.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:s,reason:y,force:!0})},d);return}}if(s.streamReader.cancel(new _util.AbortException(y.message)).catch(()=>{}),s.streamReader=null,!this._transport.destroyed){for(const[d,C]of this._intentStates)if(C===s){this._intentStates.delete(d);break}this.cleanup()}}}get stats(){return this._stats}}exports.PDFPageProxy=PDFPageProxy;class LoopbackPort{#t=new Set;#e=Promise.resolve();postMessage(s,y){const i={data:structuredClone(s,y?{transfer:y}:null)};this.#e.then(()=>{for(const d of this.#t)d.call(this,i)})}addEventListener(s,y){this.#t.add(y)}removeEventListener(s,y){this.#t.delete(y)}terminate(){this.#t.clear()}}exports.LoopbackPort=LoopbackPort;const PDFWorkerUtil={isWorkerDisabled:!1,fallbackWorkerSrc:null,fakeWorkerId:0};exports.PDFWorkerUtil=PDFWorkerUtil;{if(_util.isNodeJS&&typeof commonjsRequire=="function")PDFWorkerUtil.isWorkerDisabled=!0,PDFWorkerUtil.fallbackWorkerSrc="./pdf.worker.js";else if(typeof document=="object"){const E=document?.currentScript?.src;E&&(PDFWorkerUtil.fallbackWorkerSrc=E.replace(/(\.(?:min\.)?js)(\?.*)?$/i,".worker$1$2"))}PDFWorkerUtil.isSameOrigin=function(E,s){let y;try{if(y=new URL(E),!y.origin||y.origin==="null")return!1}catch{return!1}const i=new URL(s,y);return y.origin===i.origin},PDFWorkerUtil.createCDNWrapper=function(E){const s=`importScripts("${E}");`;return URL.createObjectURL(new Blob([s]))}}class PDFWorker{static#workerPorts;constructor({name:E=null,port:s=null,verbosity:y=(0,_util.getVerbosityLevel)()}={}){if(this.name=E,this.destroyed=!1,this.verbosity=y,this._readyCapability=new _util.PromiseCapability,this._port=null,this._webWorker=null,this._messageHandler=null,s){if(PDFWorker.#workerPorts?.has(s))throw new Error("Cannot use more than one PDFWorker per port.");(PDFWorker.#workerPorts||=new WeakMap).set(s,this),this._initializeFromPort(s);return}this._initialize()}get promise(){return this._readyCapability.promise}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(E){this._port=E,this._messageHandler=new _message_handler.MessageHandler("main","worker",E),this._messageHandler.on("ready",function(){}),this._readyCapability.resolve(),this._messageHandler.send("configure",{verbosity:this.verbosity})}_initialize(){if(!PDFWorkerUtil.isWorkerDisabled&&!PDFWorker._mainThreadWorkerMessageHandler){let{workerSrc:E}=PDFWorker;try{PDFWorkerUtil.isSameOrigin(window.location.href,E)||(E=PDFWorkerUtil.createCDNWrapper(new URL(E,window.location).href));const s=new Worker(E),y=new _message_handler.MessageHandler("main","worker",s),i=()=>{s.removeEventListener("error",d),y.destroy(),s.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},d=()=>{this._webWorker||i()};s.addEventListener("error",d),y.on("test",A=>{if(s.removeEventListener("error",d),this.destroyed){i();return}A?(this._messageHandler=y,this._port=s,this._webWorker=s,this._readyCapability.resolve(),y.send("configure",{verbosity:this.verbosity})):(this._setupFakeWorker(),y.destroy(),s.terminate())}),y.on("ready",A=>{if(s.removeEventListener("error",d),this.destroyed){i();return}try{C()}catch{this._setupFakeWorker()}});const C=()=>{const A=new Uint8Array;y.send("test",A,[A.buffer])};C();return}catch{(0,_util.info)("The worker has been disabled.")}}this._setupFakeWorker()}_setupFakeWorker(){PDFWorkerUtil.isWorkerDisabled||((0,_util.warn)("Setting up fake worker."),PDFWorkerUtil.isWorkerDisabled=!0),PDFWorker._setupFakeWorkerGlobal.then(E=>{if(this.destroyed){this._readyCapability.reject(new Error("Worker was destroyed"));return}const s=new LoopbackPort;this._port=s;const y=`fake${PDFWorkerUtil.fakeWorkerId++}`,i=new _message_handler.MessageHandler(y+"_worker",y,s);E.setup(i,s);const d=new _message_handler.MessageHandler(y,y+"_worker",s);this._messageHandler=d,this._readyCapability.resolve(),d.send("configure",{verbosity:this.verbosity})}).catch(E=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${E.message}".`))})}destroy(){this.destroyed=!0,this._webWorker&&(this._webWorker.terminate(),this._webWorker=null),PDFWorker.#workerPorts?.delete(this._port),this._port=null,this._messageHandler&&(this._messageHandler.destroy(),this._messageHandler=null)}static fromPort(E){if(!E?.port)throw new Error("PDFWorker.fromPort - invalid method signature.");const s=this.#workerPorts?.get(E.port);if(s){if(s._pendingDestroy)throw new Error("PDFWorker.fromPort - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return s}return new PDFWorker(E)}static get workerSrc(){if(_worker_options.GlobalWorkerOptions.workerSrc)return _worker_options.GlobalWorkerOptions.workerSrc;if(PDFWorkerUtil.fallbackWorkerSrc!==null)return _util.isNodeJS||(0,_display_utils.deprecated)('No "GlobalWorkerOptions.workerSrc" specified.'),PDFWorkerUtil.fallbackWorkerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _mainThreadWorkerMessageHandler(){try{return globalThis.pdfjsWorker?.WorkerMessageHandler||null}catch{return null}}static get _setupFakeWorkerGlobal(){const loader=async()=>{const mainWorkerMessageHandler=this._mainThreadWorkerMessageHandler;if(mainWorkerMessageHandler)return mainWorkerMessageHandler;if(_util.isNodeJS&&typeof commonjsRequire=="function"){const worker=eval("require")(this.workerSrc);return worker.WorkerMessageHandler}return await(0,_display_utils.loadScript)(this.workerSrc),window.pdfjsWorker.WorkerMessageHandler};return(0,_util.shadow)(this,"_setupFakeWorkerGlobal",loader())}}exports.PDFWorker=PDFWorker;class WorkerTransport{#t=new Map;#e=new Map;#r=new Map;#s=null;constructor(s,y,i,d,C){this.messageHandler=s,this.loadingTask=y,this.commonObjs=new PDFObjects,this.fontLoader=new _font_loader.FontLoader({ownerDocument:d.ownerDocument,styleElement:d.styleElement}),this._params=d,this.canvasFactory=C.canvasFactory,this.filterFactory=C.filterFactory,this.cMapReaderFactory=C.cMapReaderFactory,this.standardFontDataFactory=C.standardFontDataFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=i,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=new _util.PromiseCapability,this.setupMessageHandler()}#o(s,y=null){const i=this.#t.get(s);if(i)return i;const d=this.messageHandler.sendWithPromise(s,y);return this.#t.set(s,d),d}get annotationStorage(){return(0,_util.shadow)(this,"annotationStorage",new _annotation_storage.AnnotationStorage)}getRenderingIntent(s,y=_util.AnnotationMode.ENABLE,i=null,d=!1){let C=_util.RenderingIntentFlag.DISPLAY,A=_annotation_storage.SerializableEmpty;switch(s){case"any":C=_util.RenderingIntentFlag.ANY;break;case"display":break;case"print":C=_util.RenderingIntentFlag.PRINT;break;default:(0,_util.warn)(`getRenderingIntent - invalid intent: ${s}`)}switch(y){case _util.AnnotationMode.DISABLE:C+=_util.RenderingIntentFlag.ANNOTATIONS_DISABLE;break;case _util.AnnotationMode.ENABLE:break;case _util.AnnotationMode.ENABLE_FORMS:C+=_util.RenderingIntentFlag.ANNOTATIONS_FORMS;break;case _util.AnnotationMode.ENABLE_STORAGE:C+=_util.RenderingIntentFlag.ANNOTATIONS_STORAGE,A=(C&_util.RenderingIntentFlag.PRINT&&i instanceof _annotation_storage.PrintAnnotationStorage?i:this.annotationStorage).serializable;break;default:(0,_util.warn)(`getRenderingIntent - invalid annotationMode: ${y}`)}return d&&(C+=_util.RenderingIntentFlag.OPLIST),{renderingIntent:C,cacheKey:`${C}_${A.hash}`,annotationStorageSerializable:A}}destroy(){if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=new _util.PromiseCapability,this.#s?.reject(new Error("Worker was destroyed during onPassword callback"));const s=[];for(const i of this.#e.values())s.push(i._destroy());this.#e.clear(),this.#r.clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const y=this.messageHandler.sendWithPromise("Terminate",null);return s.push(y),Promise.all(s).then(()=>{this.commonObjs.clear(),this.fontLoader.clear(),this.#t.clear(),this.filterFactory.destroy(),this._networkStream?.cancelAllRequests(new _util.AbortException("Worker was terminated.")),this.messageHandler&&(this.messageHandler.destroy(),this.messageHandler=null),this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:s,loadingTask:y}=this;s.on("GetReader",(i,d)=>{(0,_util.assert)(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=C=>{this._lastProgress={loaded:C.loaded,total:C.total}},d.onPull=()=>{this._fullReader.read().then(function({value:C,done:A}){if(A){d.close();return}(0,_util.assert)(C instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),d.enqueue(new Uint8Array(C),1,[C])}).catch(C=>{d.error(C)})},d.onCancel=C=>{this._fullReader.cancel(C),d.ready.catch(A=>{if(!this.destroyed)throw A})}}),s.on("ReaderHeadersReady",i=>{const d=new _util.PromiseCapability,C=this._fullReader;return C.headersReady.then(()=>{(!C.isStreamingSupported||!C.isRangeSupported)&&(this._lastProgress&&y.onProgress?.(this._lastProgress),C.onProgress=A=>{y.onProgress?.({loaded:A.loaded,total:A.total})}),d.resolve({isStreamingSupported:C.isStreamingSupported,isRangeSupported:C.isRangeSupported,contentLength:C.contentLength})},d.reject),d.promise}),s.on("GetRangeReader",(i,d)=>{(0,_util.assert)(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const C=this._networkStream.getRangeReader(i.begin,i.end);if(!C){d.close();return}d.onPull=()=>{C.read().then(function({value:A,done:M}){if(M){d.close();return}(0,_util.assert)(A instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),d.enqueue(new Uint8Array(A),1,[A])}).catch(A=>{d.error(A)})},d.onCancel=A=>{C.cancel(A),d.ready.catch(M=>{if(!this.destroyed)throw M})}}),s.on("GetDoc",({pdfInfo:i})=>{this._numPages=i.numPages,this._htmlForXfa=i.htmlForXfa,delete i.htmlForXfa,y._capability.resolve(new PDFDocumentProxy(i,this))}),s.on("DocException",function(i){let d;switch(i.name){case"PasswordException":d=new _util.PasswordException(i.message,i.code);break;case"InvalidPDFException":d=new _util.InvalidPDFException(i.message);break;case"MissingPDFException":d=new _util.MissingPDFException(i.message);break;case"UnexpectedResponseException":d=new _util.UnexpectedResponseException(i.message,i.status);break;case"UnknownErrorException":d=new _util.UnknownErrorException(i.message,i.details);break;default:(0,_util.unreachable)("DocException - expected a valid Error.")}y._capability.reject(d)}),s.on("PasswordRequest",i=>{if(this.#s=new _util.PromiseCapability,y.onPassword){const d=C=>{C instanceof Error?this.#s.reject(C):this.#s.resolve({password:C})};try{y.onPassword(d,i.code)}catch(C){this.#s.reject(C)}}else this.#s.reject(new _util.PasswordException(i.message,i.code));return this.#s.promise}),s.on("DataLoaded",i=>{y.onProgress?.({loaded:i.length,total:i.length}),this.downloadInfoCapability.resolve(i)}),s.on("StartRenderPage",i=>{if(this.destroyed)return;this.#e.get(i.pageIndex)._startRenderPage(i.transparency,i.cacheKey)}),s.on("commonobj",([i,d,C])=>{if(!this.destroyed&&!this.commonObjs.has(i))switch(d){case"Font":const A=this._params;if("error"in C){const n=C.error;(0,_util.warn)(`Error during font loading: ${n}`),this.commonObjs.resolve(i,n);break}const M=A.pdfBug&&globalThis.FontInspector?.enabled?(n,t)=>globalThis.FontInspector.fontAdded(n,t):null,w=new _font_loader.FontFaceObject(C,{isEvalSupported:A.isEvalSupported,disableFontFace:A.disableFontFace,ignoreErrors:A.ignoreErrors,inspectFont:M});this.fontLoader.bind(w).catch(n=>s.sendWithPromise("FontFallback",{id:i})).finally(()=>{!A.fontExtraProperties&&w.data&&(w.data=null),this.commonObjs.resolve(i,w)});break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(i,C);break;default:throw new Error(`Got unknown common object type ${d}`)}}),s.on("obj",([i,d,C,A])=>{if(this.destroyed)return;const M=this.#e.get(d);if(!M.objs.has(i))switch(C){case"Image":if(M.objs.resolve(i,A),A){let w;if(A.bitmap){const{width:n,height:t}=A;w=n*t*4}else w=A.data?.length||0;w>_util.MAX_IMAGE_SIZE_TO_CACHE&&(M._maybeCleanupAfterRender=!0)}break;case"Pattern":M.objs.resolve(i,A);break;default:throw new Error(`Got unknown object type ${C}`)}}),s.on("DocProgress",i=>{this.destroyed||y.onProgress?.({loaded:i.loaded,total:i.total})}),s.on("FetchBuiltInCMap",i=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.cMapReaderFactory?this.cMapReaderFactory.fetch(i):Promise.reject(new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter."))),s.on("FetchStandardFontData",i=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.standardFontDataFactory?this.standardFontDataFactory.fetch(i):Promise.reject(new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter.")))}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){this.annotationStorage.size<=0&&(0,_util.warn)("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:s,transfers:y}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:s,filename:this._fullReader?.filename??null},y).finally(()=>{this.annotationStorage.resetModified()})}getPage(s){if(!Number.isInteger(s)||s<=0||s>this._numPages)return Promise.reject(new Error("Invalid page request."));const y=s-1,i=this.#r.get(y);if(i)return i;const d=this.messageHandler.sendWithPromise("GetPage",{pageIndex:y}).then(C=>{if(this.destroyed)throw new Error("Transport destroyed");const A=new PDFPageProxy(y,C,this,this._params.pdfBug);return this.#e.set(y,A),A});return this.#r.set(y,d),d}getPageIndex(s){return typeof s!="object"||s===null||!Number.isInteger(s.num)||s.num<0||!Number.isInteger(s.gen)||s.gen<0?Promise.reject(new Error("Invalid pageIndex request.")):this.messageHandler.sendWithPromise("GetPageIndex",{num:s.num,gen:s.gen})}getAnnotations(s,y){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:s,intent:y})}getFieldObjects(){return this.#o("GetFieldObjects")}hasJSActions(){return this.#o("HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(s){return typeof s!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:s})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getDocJSActions(){return this.#o("GetDocJSActions")}getPageJSActions(s){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:s})}getStructTree(s){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:s})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(){return this.messageHandler.sendWithPromise("GetOptionalContentConfig",null).then(s=>new _optional_content_config.OptionalContentConfig(s))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const s="GetMetadata",y=this.#t.get(s);if(y)return y;const i=this.messageHandler.sendWithPromise(s,null).then(d=>({info:d[0],metadata:d[1]?new _metadata.Metadata(d[1]):null,contentDispositionFilename:this._fullReader?.filename??null,contentLength:this._fullReader?.contentLength??null}));return this.#t.set(s,i),i}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(s=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const y of this.#e.values())if(!y.cleanup())throw new Error(`startCleanup: Page ${y.pageNumber} is currently rendering.`);this.commonObjs.clear(),s||this.fontLoader.clear(),this.#t.clear(),this.filterFactory.destroy(!0)}}get loadingParams(){const{disableAutoFetch:s,enableXfa:y}=this._params;return(0,_util.shadow)(this,"loadingParams",{disableAutoFetch:s,enableXfa:y})}}class PDFObjects{#t=Object.create(null);#e(s){return this.#t[s]||={capability:new _util.PromiseCapability,data:null}}get(s,y=null){if(y){const d=this.#e(s);return d.capability.promise.then(()=>y(d.data)),null}const i=this.#t[s];if(!i?.capability.settled)throw new Error(`Requesting object that isn't resolved yet ${s}.`);return i.data}has(s){return this.#t[s]?.capability.settled||!1}resolve(s,y=null){const i=this.#e(s);i.data=y,i.capability.resolve()}clear(){for(const s in this.#t){const{data:y}=this.#t[s];y?.bitmap?.close()}this.#t=Object.create(null)}}class RenderTask{#t=null;constructor(s){this.#t=s,this.onContinue=null}get promise(){return this.#t.capability.promise}cancel(s=0){this.#t.cancel(null,s)}get separateAnnots(){const{separateAnnots:s}=this.#t.operatorList;if(!s)return!1;const{annotationCanvasMap:y}=this.#t;return s.form||s.canvas&&y?.size>0}}exports.RenderTask=RenderTask;class InternalRenderTask{static#t=new WeakSet;constructor({callback:s,params:y,objs:i,commonObjs:d,annotationCanvasMap:C,operatorList:A,pageIndex:M,canvasFactory:w,filterFactory:n,useRequestAnimationFrame:t=!1,pdfBug:r=!1,pageColors:l=null}){this.callback=s,this.params=y,this.objs=i,this.commonObjs=d,this.annotationCanvasMap=C,this.operatorListIdx=null,this.operatorList=A,this._pageIndex=M,this.canvasFactory=w,this.filterFactory=n,this._pdfBug=r,this.pageColors=l,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=t===!0&&typeof window<"u",this.cancelled=!1,this.capability=new _util.PromiseCapability,this.task=new RenderTask(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=y.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:s=!1,optionalContentConfig:y}){if(this.cancelled)return;if(this._canvas){if(InternalRenderTask.#t.has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");InternalRenderTask.#t.add(this._canvas)}this._pdfBug&&globalThis.StepperManager?.enabled&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{canvasContext:i,viewport:d,transform:C,background:A}=this.params;this.gfx=new _canvas.CanvasGraphics(i,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:y},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:C,viewport:d,transparency:s,background:A}),this.operatorListIdx=0,this.graphicsReady=!0,this.graphicsReadyCallback?.()}cancel(s=null,y=0){this.running=!1,this.cancelled=!0,this.gfx?.endDrawing(),InternalRenderTask.#t.delete(this._canvas),this.callback(s||new _display_utils.RenderingCancelledException(`Rendering cancelled, page ${this._pageIndex+1}`,y))}operatorListChanged(){if(!this.graphicsReady){this.graphicsReadyCallback||=this._continueBound;return}this.stepper?.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?window.requestAnimationFrame(()=>{this._nextBound().catch(this._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),InternalRenderTask.#t.delete(this._canvas),this.callback())))}}const version="3.11.174";exports.version=version;const build="ce8716743";exports.build=build},(E,s,y)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.SerializableEmpty=s.PrintAnnotationStorage=s.AnnotationStorage=void 0;var i=y(1),d=y(4),C=y(8);const A=Object.freeze({map:null,hash:"",transfers:void 0});s.SerializableEmpty=A;class M{#t=!1;#e=new Map;constructor(){this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(t,r){const l=this.#e.get(t);return l===void 0?r:Object.assign(r,l)}getRawValue(t){return this.#e.get(t)}remove(t){if(this.#e.delete(t),this.#e.size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(const r of this.#e.values())if(r instanceof d.AnnotationEditor)return;this.onAnnotationEditor(null)}}setValue(t,r){const l=this.#e.get(t);let c=!1;if(l!==void 0)for(const[e,h]of Object.entries(r))l[e]!==h&&(c=!0,l[e]=h);else c=!0,this.#e.set(t,r);c&&this.#r(),r instanceof d.AnnotationEditor&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(r.constructor._type)}has(t){return this.#e.has(t)}getAll(){return this.#e.size>0?(0,i.objectFromMap)(this.#e):null}setAll(t){for(const[r,l]of Object.entries(t))this.setValue(r,l)}get size(){return this.#e.size}#r(){this.#t||(this.#t=!0,typeof this.onSetModified=="function"&&this.onSetModified())}resetModified(){this.#t&&(this.#t=!1,typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new w(this)}get serializable(){if(this.#e.size===0)return A;const t=new Map,r=new C.MurmurHash3_64,l=[],c=Object.create(null);let e=!1;for(const[h,f]of this.#e){const a=f instanceof d.AnnotationEditor?f.serialize(!1,c):f;a&&(t.set(h,a),r.update(`${h}:${JSON.stringify(a)}`),e||=!!a.bitmap)}if(e)for(const h of t.values())h.bitmap&&l.push(h.bitmap);return t.size>0?{map:t,hash:r.hexdigest(),transfers:l}:A}}s.AnnotationStorage=M;class w extends M{#t;constructor(t){super();const{map:r,hash:l,transfers:c}=t.serializable,e=structuredClone(r,c?{transfer:c}:null);this.#t={map:e,hash:l,transfers:c}}get print(){(0,i.unreachable)("Should not call PrintAnnotationStorage.print")}get serializable(){return this.#t}}s.PrintAnnotationStorage=w},(E,s,y)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.AnnotationEditor=void 0;var i=y(5),d=y(1),C=y(6);class A{#t="";#e=!1;#r=null;#s=null;#o=null;#a=!1;#n=null;#l=this.focusin.bind(this);#c=this.focusout.bind(this);#i=!1;#p=!1;#h=!1;_initialOptions=Object.create(null);_uiManager=null;_focusEventsAllowed=!0;_l10nPromise=null;#u=!1;#f=A._zIndex++;static _borderLineWidth=-1;static _colorManager=new i.ColorManager;static _zIndex=1;static SMALL_EDITOR_SIZE=0;constructor(n){this.constructor===A&&(0,d.unreachable)("Cannot initialize AnnotationEditor."),this.parent=n.parent,this.id=n.id,this.width=this.height=null,this.pageIndex=n.parent.pageIndex,this.name=n.name,this.div=null,this._uiManager=n.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=n.isCentered,this._structTreeParentId=null;const{rotation:t,rawDims:{pageWidth:r,pageHeight:l,pageX:c,pageY:e}}=this.parent.viewport;this.rotation=t,this.pageRotation=(360+t-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[r,l],this.pageTranslation=[c,e];const[h,f]=this.parentDimensions;this.x=n.x/h,this.y=n.y/f,this.isAttachedToDOM=!1,this.deleted=!1}get editorType(){return Object.getPrototypeOf(this).constructor._type}static get _defaultLineColor(){return(0,d.shadow)(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(n){const t=new M({id:n.parent.getNextId(),parent:n.parent,uiManager:n._uiManager});t.annotationElementId=n.annotationElementId,t.deleted=!0,t._uiManager.addToAnnotationStorage(t)}static initialize(n,t=null){if(A._l10nPromise||=new Map(["editor_alt_text_button_label","editor_alt_text_edit_button_label","editor_alt_text_decorative_tooltip"].map(l=>[l,n.get(l)])),t?.strings)for(const l of t.strings)A._l10nPromise.set(l,n.get(l));if(A._borderLineWidth!==-1)return;const r=getComputedStyle(document.documentElement);A._borderLineWidth=parseFloat(r.getPropertyValue("--outline-width"))||0}static updateDefaultParams(n,t){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(n){return!1}static paste(n,t){(0,d.unreachable)("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return this.#u}set _isDraggable(n){this.#u=n,this.div?.classList.toggle("draggable",n)}center(){const[n,t]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*t/(n*2),this.y+=this.width*n/(t*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*t/(n*2),this.y-=this.width*n/(t*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(n){this._uiManager.addCommands(n)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=this.#f}setParent(n){n!==null&&(this.pageIndex=n.pageIndex,this.pageDimensions=n.pageDimensions),this.parent=n}focusin(n){this._focusEventsAllowed&&(this.#i?this.#i=!1:this.parent.setSelected(this))}focusout(n){!this._focusEventsAllowed||!this.isAttachedToDOM||n.relatedTarget?.closest(`#${this.id}`)||(n.preventDefault(),this.parent?.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(n,t,r,l){const[c,e]=this.parentDimensions;[r,l]=this.screenToPageTranslation(r,l),this.x=(n+r)/c,this.y=(t+l)/e,this.fixAndSetPosition()}#y([n,t],r,l){[r,l]=this.screenToPageTranslation(r,l),this.x+=r/n,this.y+=l/t,this.fixAndSetPosition()}translate(n,t){this.#y(this.parentDimensions,n,t)}translateInPage(n,t){this.#y(this.pageDimensions,n,t),this.div.scrollIntoView({block:"nearest"})}drag(n,t){const[r,l]=this.parentDimensions;if(this.x+=n/r,this.y+=t/l,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:a,y:v}=this.div.getBoundingClientRect();this.parent.findNewParent(this,a,v)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:c,y:e}=this;const[h,f]=this.#m();c+=h,e+=f,this.div.style.left=`${(100*c).toFixed(2)}%`,this.div.style.top=`${(100*e).toFixed(2)}%`,this.div.scrollIntoView({block:"nearest"})}#m(){const[n,t]=this.parentDimensions,{_borderLineWidth:r}=A,l=r/n,c=r/t;switch(this.rotation){case 90:return[-l,c];case 180:return[l,c];case 270:return[l,-c];default:return[-l,-c]}}fixAndSetPosition(){const[n,t]=this.pageDimensions;let{x:r,y:l,width:c,height:e}=this;switch(c*=n,e*=t,r*=n,l*=t,this.rotation){case 0:r=Math.max(0,Math.min(n-c,r)),l=Math.max(0,Math.min(t-e,l));break;case 90:r=Math.max(0,Math.min(n-e,r)),l=Math.min(t,Math.max(c,l));break;case 180:r=Math.min(n,Math.max(c,r)),l=Math.min(t,Math.max(e,l));break;case 270:r=Math.min(n,Math.max(e,r)),l=Math.max(0,Math.min(t-c,l));break}this.x=r/=n,this.y=l/=t;const[h,f]=this.#m();r+=h,l+=f;const{style:a}=this.div;a.left=`${(100*r).toFixed(2)}%`,a.top=`${(100*l).toFixed(2)}%`,this.moveInDOM()}static#g(n,t,r){switch(r){case 90:return[t,-n];case 180:return[-n,-t];case 270:return[-t,n];default:return[n,t]}}screenToPageTranslation(n,t){return A.#g(n,t,this.parentRotation)}pageTranslationToScreen(n,t){return A.#g(n,t,360-this.parentRotation)}#d(n){switch(n){case 90:{const[t,r]=this.pageDimensions;return[0,-t/r,r/t,0]}case 180:return[-1,0,0,-1];case 270:{const[t,r]=this.pageDimensions;return[0,t/r,-r/t,0]}default:return[1,0,0,1]}}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:n,pageDimensions:[t,r]}=this,l=t*n,c=r*n;return d.FeatureTest.isCSSRoundSupported?[Math.round(l),Math.round(c)]:[l,c]}setDims(n,t){const[r,l]=this.parentDimensions;this.div.style.width=`${(100*n/r).toFixed(2)}%`,this.#a||(this.div.style.height=`${(100*t/l).toFixed(2)}%`),this.#r?.classList.toggle("small",n<A.SMALL_EDITOR_SIZE||t<A.SMALL_EDITOR_SIZE)}fixDims(){const{style:n}=this.div,{height:t,width:r}=n,l=r.endsWith("%"),c=!this.#a&&t.endsWith("%");if(l&&c)return;const[e,h]=this.parentDimensions;l||(n.width=`${(100*parseFloat(r)/e).toFixed(2)}%`),!this.#a&&!c&&(n.height=`${(100*parseFloat(t)/h).toFixed(2)}%`)}getInitialTranslation(){return[0,0]}#b(){if(this.#n)return;this.#n=document.createElement("div"),this.#n.classList.add("resizers");const n=["topLeft","topRight","bottomRight","bottomLeft"];this._willKeepAspectRatio||n.push("topMiddle","middleRight","bottomMiddle","middleLeft");for(const t of n){const r=document.createElement("div");this.#n.append(r),r.classList.add("resizer",t),r.addEventListener("pointerdown",this.#P.bind(this,t)),r.addEventListener("contextmenu",C.noContextMenu)}this.div.prepend(this.#n)}#P(n,t){t.preventDefault();const{isMac:r}=d.FeatureTest.platform;if(t.button!==0||t.ctrlKey&&r)return;const l=this.#S.bind(this,n),c=this._isDraggable;this._isDraggable=!1;const e={passive:!0,capture:!0};window.addEventListener("pointermove",l,e);const h=this.x,f=this.y,a=this.width,v=this.height,R=this.parent.div.style.cursor,k=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(t.target).cursor;const g=()=>{this._isDraggable=c,window.removeEventListener("pointerup",g),window.removeEventListener("blur",g),window.removeEventListener("pointermove",l,e),this.parent.div.style.cursor=R,this.div.style.cursor=k;const P=this.x,U=this.y,z=this.width,N=this.height;P===h&&U===f&&z===a&&N===v||this.addCommands({cmd:()=>{this.width=z,this.height=N,this.x=P,this.y=U;const[j,W]=this.parentDimensions;this.setDims(j*z,W*N),this.fixAndSetPosition()},undo:()=>{this.width=a,this.height=v,this.x=h,this.y=f;const[j,W]=this.parentDimensions;this.setDims(j*a,W*v),this.fixAndSetPosition()},mustExec:!0})};window.addEventListener("pointerup",g),window.addEventListener("blur",g)}#S(n,t){const[r,l]=this.parentDimensions,c=this.x,e=this.y,h=this.width,f=this.height,a=A.MIN_SIZE/r,v=A.MIN_SIZE/l,R=x=>Math.round(x*1e4)/1e4,k=this.#d(this.rotation),g=(x,o)=>[k[0]*x+k[2]*o,k[1]*x+k[3]*o],P=this.#d(360-this.rotation),U=(x,o)=>[P[0]*x+P[2]*o,P[1]*x+P[3]*o];let z,N,j=!1,W=!1;switch(n){case"topLeft":j=!0,z=(x,o)=>[0,0],N=(x,o)=>[x,o];break;case"topMiddle":z=(x,o)=>[x/2,0],N=(x,o)=>[x/2,o];break;case"topRight":j=!0,z=(x,o)=>[x,0],N=(x,o)=>[0,o];break;case"middleRight":W=!0,z=(x,o)=>[x,o/2],N=(x,o)=>[0,o/2];break;case"bottomRight":j=!0,z=(x,o)=>[x,o],N=(x,o)=>[0,0];break;case"bottomMiddle":z=(x,o)=>[x/2,o],N=(x,o)=>[x/2,0];break;case"bottomLeft":j=!0,z=(x,o)=>[0,o],N=(x,o)=>[x,0];break;case"middleLeft":W=!0,z=(x,o)=>[0,o/2],N=(x,o)=>[x,o/2];break}const at=z(h,f),tt=N(h,f);let it=g(...tt);const ut=R(c+it[0]),J=R(e+it[1]);let L=1,b=1,[p,u]=this.screenToPageTranslation(t.movementX,t.movementY);if([p,u]=U(p/r,u/l),j){const x=Math.hypot(h,f);L=b=Math.max(Math.min(Math.hypot(tt[0]-at[0]-p,tt[1]-at[1]-u)/x,1/h,1/f),a/h,v/f)}else W?L=Math.max(a,Math.min(1,Math.abs(tt[0]-at[0]-p)))/h:b=Math.max(v,Math.min(1,Math.abs(tt[1]-at[1]-u)))/f;const _=R(h*L),F=R(f*b);it=g(...N(_,F));const I=ut-it[0],O=J-it[1];this.width=_,this.height=F,this.x=I,this.y=O,this.setDims(r*_,l*F),this.fixAndSetPosition()}async addAltTextButton(){if(this.#r)return;const n=this.#r=document.createElement("button");n.className="altText";const t=await A._l10nPromise.get("editor_alt_text_button_label");n.textContent=t,n.setAttribute("aria-label",t),n.tabIndex="0",n.addEventListener("contextmenu",C.noContextMenu),n.addEventListener("pointerdown",r=>r.stopPropagation()),n.addEventListener("click",r=>{r.preventDefault(),this._uiManager.editAltText(this)},{capture:!0}),n.addEventListener("keydown",r=>{r.target===n&&r.key==="Enter"&&(r.preventDefault(),this._uiManager.editAltText(this))}),this.#w(),this.div.append(n),A.SMALL_EDITOR_SIZE||(A.SMALL_EDITOR_SIZE=Math.min(128,Math.round(n.getBoundingClientRect().width*1.4)))}async#w(){const n=this.#r;if(!n)return;if(!this.#t&&!this.#e){n.classList.remove("done"),this.#s?.remove();return}A._l10nPromise.get("editor_alt_text_edit_button_label").then(r=>{n.setAttribute("aria-label",r)});let t=this.#s;if(!t){this.#s=t=document.createElement("span"),t.className="tooltip",t.setAttribute("role","tooltip");const r=t.id=`alt-text-tooltip-${this.id}`;n.setAttribute("aria-describedby",r);const l=100;n.addEventListener("mouseenter",()=>{this.#o=setTimeout(()=>{this.#o=null,this.#s.classList.add("show"),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",subtype:this.editorType,data:{action:"alt_text_tooltip"}}})},l)}),n.addEventListener("mouseleave",()=>{clearTimeout(this.#o),this.#o=null,this.#s?.classList.remove("show")})}n.classList.add("done"),t.innerText=this.#e?await A._l10nPromise.get("editor_alt_text_decorative_tooltip"):this.#t,t.parentNode||n.append(t)}getClientDimensions(){return this.div.getBoundingClientRect()}get altTextData(){return{altText:this.#t,decorative:this.#e}}set altTextData({altText:n,decorative:t}){this.#t===n&&this.#e===t||(this.#t=n,this.#e=t,this.#w())}render(){this.div=document.createElement("div"),this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360),this.div.className=this.name,this.div.setAttribute("id",this.id),this.div.setAttribute("tabIndex",0),this.setInForeground(),this.div.addEventListener("focusin",this.#l),this.div.addEventListener("focusout",this.#c);const[n,t]=this.parentDimensions;this.parentRotation%180!==0&&(this.div.style.maxWidth=`${(100*t/n).toFixed(2)}%`,this.div.style.maxHeight=`${(100*n/t).toFixed(2)}%`);const[r,l]=this.getInitialTranslation();return this.translate(r,l),(0,i.bindEvents)(this,this.div,["pointerdown"]),this.div}pointerdown(n){const{isMac:t}=d.FeatureTest.platform;if(n.button!==0||n.ctrlKey&&t){n.preventDefault();return}this.#i=!0,this.#T(n)}#T(n){if(!this._isDraggable)return;const t=this._uiManager.isSelected(this);this._uiManager.setUpDragSession();let r,l;t&&(r={passive:!0,capture:!0},l=e=>{const[h,f]=this.screenToPageTranslation(e.movementX,e.movementY);this._uiManager.dragSelectedEditors(h,f)},window.addEventListener("pointermove",l,r));const c=()=>{if(window.removeEventListener("pointerup",c),window.removeEventListener("blur",c),t&&window.removeEventListener("pointermove",l,r),this.#i=!1,!this._uiManager.endDragSession()){const{isMac:e}=d.FeatureTest.platform;n.ctrlKey&&!e||n.shiftKey||n.metaKey&&e?this.parent.toggleSelected(this):this.parent.setSelected(this)}};window.addEventListener("pointerup",c),window.addEventListener("blur",c)}moveInDOM(){this.parent?.moveEditorInDOM(this)}_setParentAndPosition(n,t,r){n.changeParent(this),this.x=t,this.y=r,this.fixAndSetPosition()}getRect(n,t){const r=this.parentScale,[l,c]=this.pageDimensions,[e,h]=this.pageTranslation,f=n/r,a=t/r,v=this.x*l,R=this.y*c,k=this.width*l,g=this.height*c;switch(this.rotation){case 0:return[v+f+e,c-R-a-g+h,v+f+k+e,c-R-a+h];case 90:return[v+a+e,c-R+f+h,v+a+g+e,c-R+f+k+h];case 180:return[v-f-k+e,c-R+a+h,v-f+e,c-R+a+g+h];case 270:return[v-a-g+e,c-R-f-k+h,v-a+e,c-R-f+h];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(n,t){const[r,l,c,e]=n,h=c-r,f=e-l;switch(this.rotation){case 0:return[r,t-e,h,f];case 90:return[r,t-l,f,h];case 180:return[c,t-l,h,f];case 270:return[c,t-e,f,h];default:throw new Error("Invalid rotation")}}onceAdded(){}isEmpty(){return!1}enableEditMode(){this.#h=!0}disableEditMode(){this.#h=!1}isInEditMode(){return this.#h}shouldGetKeyboardEvents(){return!1}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}rebuild(){this.div?.addEventListener("focusin",this.#l),this.div?.addEventListener("focusout",this.#c)}serialize(n=!1,t=null){(0,d.unreachable)("An editor must be serializable")}static deserialize(n,t,r){const l=new this.prototype.constructor({parent:t,id:t.getNextId(),uiManager:r});l.rotation=n.rotation;const[c,e]=l.pageDimensions,[h,f,a,v]=l.getRectInCurrentCoords(n.rect,e);return l.x=h/c,l.y=f/e,l.width=a/c,l.height=v/e,l}remove(){this.div.removeEventListener("focusin",this.#l),this.div.removeEventListener("focusout",this.#c),this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),this.#r?.remove(),this.#r=null,this.#s=null}get isResizable(){return!1}makeResizable(){this.isResizable&&(this.#b(),this.#n.classList.remove("hidden"))}select(){this.makeResizable(),this.div?.classList.add("selectedEditor")}unselect(){this.#n?.classList.add("hidden"),this.div?.classList.remove("selectedEditor"),this.div?.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus()}updateParams(n,t){}disableEditing(){this.#r&&(this.#r.hidden=!0)}enableEditing(){this.#r&&(this.#r.hidden=!1)}enterInEditMode(){}get contentDiv(){return this.div}get isEditing(){return this.#p}set isEditing(n){this.#p=n,this.parent&&(n?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio(n,t){this.#a=!0;const r=n/t,{style:l}=this.div;l.aspectRatio=r,l.height="auto"}static get MIN_SIZE(){return 16}}s.AnnotationEditor=A;class M extends A{constructor(n){super(n),this.annotationElementId=n.annotationElementId,this.deleted=!0}serialize(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex}}}},(E,s,y)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.KeyboardManager=s.CommandManager=s.ColorManager=s.AnnotationEditorUIManager=void 0,s.bindEvents=C,s.opacityToHex=A;var i=y(1),d=y(6);function C(c,e,h){for(const f of h)e.addEventListener(f,c[f].bind(c))}function A(c){return Math.round(Math.min(255,Math.max(1,255*c))).toString(16).padStart(2,"0")}class M{#t=0;getId(){return`${i.AnnotationEditorPrefix}${this.#t++}`}}class w{#t=(0,i.getUuid)();#e=0;#r=null;static get _isSVGFittingCanvas(){const e='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',f=new OffscreenCanvas(1,3).getContext("2d"),a=new Image;a.src=e;const v=a.decode().then(()=>(f.drawImage(a,0,0,1,1,0,0,1,3),new Uint32Array(f.getImageData(0,0,1,1).data.buffer)[0]===0));return(0,i.shadow)(this,"_isSVGFittingCanvas",v)}async#s(e,h){this.#r||=new Map;let f=this.#r.get(e);if(f===null)return null;if(f?.bitmap)return f.refCounter+=1,f;try{f||={bitmap:null,id:`image_${this.#t}_${this.#e++}`,refCounter:0,isSvg:!1};let a;if(typeof h=="string"){f.url=h;const v=await fetch(h);if(!v.ok)throw new Error(v.statusText);a=await v.blob()}else a=f.file=h;if(a.type==="image/svg+xml"){const v=w._isSVGFittingCanvas,R=new FileReader,k=new Image,g=new Promise((P,U)=>{k.onload=()=>{f.bitmap=k,f.isSvg=!0,P()},R.onload=async()=>{const z=f.svgUrl=R.result;k.src=await v?`${z}#svgView(preserveAspectRatio(none))`:z},k.onerror=R.onerror=U});R.readAsDataURL(a),await g}else f.bitmap=await createImageBitmap(a);f.refCounter=1}catch(a){console.error(a),f=null}return this.#r.set(e,f),f&&this.#r.set(f.id,f),f}async getFromFile(e){const{lastModified:h,name:f,size:a,type:v}=e;return this.#s(`${h}_${f}_${a}_${v}`,e)}async getFromUrl(e){return this.#s(e,e)}async getFromId(e){this.#r||=new Map;const h=this.#r.get(e);return h?h.bitmap?(h.refCounter+=1,h):h.file?this.getFromFile(h.file):this.getFromUrl(h.url):null}getSvgUrl(e){const h=this.#r.get(e);return h?.isSvg?h.svgUrl:null}deleteId(e){this.#r||=new Map;const h=this.#r.get(e);h&&(h.refCounter-=1,h.refCounter===0&&(h.bitmap=null))}isValidId(e){return e.startsWith(`image_${this.#t}_`)}}class n{#t=[];#e=!1;#r;#s=-1;constructor(e=128){this.#r=e}add({cmd:e,undo:h,mustExec:f,type:a=NaN,overwriteIfSameType:v=!1,keepUndo:R=!1}){if(f&&e(),this.#e)return;const k={cmd:e,undo:h,type:a};if(this.#s===-1){this.#t.length>0&&(this.#t.length=0),this.#s=0,this.#t.push(k);return}if(v&&this.#t[this.#s].type===a){R&&(k.undo=this.#t[this.#s].undo),this.#t[this.#s]=k;return}const g=this.#s+1;g===this.#r?this.#t.splice(0,1):(this.#s=g,g<this.#t.length&&this.#t.splice(g)),this.#t.push(k)}undo(){this.#s!==-1&&(this.#e=!0,this.#t[this.#s].undo(),this.#e=!1,this.#s-=1)}redo(){this.#s<this.#t.length-1&&(this.#s+=1,this.#e=!0,this.#t[this.#s].cmd(),this.#e=!1)}hasSomethingToUndo(){return this.#s!==-1}hasSomethingToRedo(){return this.#s<this.#t.length-1}destroy(){this.#t=null}}s.CommandManager=n;class t{constructor(e){this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:h}=i.FeatureTest.platform;for(const[f,a,v={}]of e)for(const R of f){const k=R.startsWith("mac+");h&&k?(this.callbacks.set(R.slice(4),{callback:a,options:v}),this.allKeys.add(R.split("+").at(-1))):!h&&!k&&(this.callbacks.set(R,{callback:a,options:v}),this.allKeys.add(R.split("+").at(-1)))}}#t(e){e.altKey&&this.buffer.push("alt"),e.ctrlKey&&this.buffer.push("ctrl"),e.metaKey&&this.buffer.push("meta"),e.shiftKey&&this.buffer.push("shift"),this.buffer.push(e.key);const h=this.buffer.join("+");return this.buffer.length=0,h}exec(e,h){if(!this.allKeys.has(h.key))return;const f=this.callbacks.get(this.#t(h));if(!f)return;const{callback:a,options:{bubbles:v=!1,args:R=[],checker:k=null}}=f;k&&!k(e,h)||(a.bind(e,...R)(),v||(h.stopPropagation(),h.preventDefault()))}}s.KeyboardManager=t;class r{static _colorsMapping=new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]);get _colors(){const e=new Map([["CanvasText",null],["Canvas",null]]);return(0,d.getColorValues)(e),(0,i.shadow)(this,"_colors",e)}convert(e){const h=(0,d.getRGB)(e);if(!window.matchMedia("(forced-colors: active)").matches)return h;for(const[f,a]of this._colors)if(a.every((v,R)=>v===h[R]))return r._colorsMapping.get(f);return h}getHexCode(e){const h=this._colors.get(e);return h?i.Util.makeHexColor(...h):e}}s.ColorManager=r;class l{#t=null;#e=new Map;#r=new Map;#s=null;#o=null;#a=new n;#n=0;#l=new Set;#c=null;#i=null;#p=new Set;#h=null;#u=new M;#f=!1;#y=!1;#m=null;#g=i.AnnotationEditorType.NONE;#d=new Set;#b=null;#P=this.blur.bind(this);#S=this.focus.bind(this);#w=this.copy.bind(this);#T=this.cut.bind(this);#I=this.paste.bind(this);#L=this.keydown.bind(this);#O=this.onEditingAction.bind(this);#v=this.onPageChanging.bind(this);#D=this.onScaleChanging.bind(this);#k=this.onRotationChanging.bind(this);#F={isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1};#_=[0,0];#x=null;#C=null;#N=null;static TRANSLATE_SMALL=1;static TRANSLATE_BIG=10;static get _keyboardManager(){const e=l.prototype,h=v=>{const{activeElement:R}=document;return R&&v.#C.contains(R)&&v.hasSomethingToControl()},f=this.TRANSLATE_SMALL,a=this.TRANSLATE_BIG;return(0,i.shadow)(this,"_keyboardManager",new t([[["ctrl+a","mac+meta+a"],e.selectAll],[["ctrl+z","mac+meta+z"],e.undo],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],e.redo],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],e.delete],[["Escape","mac+Escape"],e.unselectAll],[["ArrowLeft","mac+ArrowLeft"],e.translateSelectedEditors,{args:[-f,0],checker:h}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e.translateSelectedEditors,{args:[-a,0],checker:h}],[["ArrowRight","mac+ArrowRight"],e.translateSelectedEditors,{args:[f,0],checker:h}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e.translateSelectedEditors,{args:[a,0],checker:h}],[["ArrowUp","mac+ArrowUp"],e.translateSelectedEditors,{args:[0,-f],checker:h}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e.translateSelectedEditors,{args:[0,-a],checker:h}],[["ArrowDown","mac+ArrowDown"],e.translateSelectedEditors,{args:[0,f],checker:h}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e.translateSelectedEditors,{args:[0,a],checker:h}]]))}constructor(e,h,f,a,v,R){this.#C=e,this.#N=h,this.#s=f,this._eventBus=a,this._eventBus._on("editingaction",this.#O),this._eventBus._on("pagechanging",this.#v),this._eventBus._on("scalechanging",this.#D),this._eventBus._on("rotationchanging",this.#k),this.#o=v.annotationStorage,this.#h=v.filterFactory,this.#b=R,this.viewParameters={realScale:d.PixelsPerInch.PDF_TO_CSS_UNITS,rotation:0}}destroy(){this.#M(),this.#U(),this._eventBus._off("editingaction",this.#O),this._eventBus._off("pagechanging",this.#v),this._eventBus._off("scalechanging",this.#D),this._eventBus._off("rotationchanging",this.#k);for(const e of this.#r.values())e.destroy();this.#r.clear(),this.#e.clear(),this.#p.clear(),this.#t=null,this.#d.clear(),this.#a.destroy(),this.#s.destroy()}get hcmFilter(){return(0,i.shadow)(this,"hcmFilter",this.#b?this.#h.addHCMFilter(this.#b.foreground,this.#b.background):"none")}get direction(){return(0,i.shadow)(this,"direction",getComputedStyle(this.#C).direction)}editAltText(e){this.#s?.editAltText(this,e)}onPageChanging({pageNumber:e}){this.#n=e-1}focusMainContainer(){this.#C.focus()}findParent(e,h){for(const f of this.#r.values()){const{x:a,y:v,width:R,height:k}=f.div.getBoundingClientRect();if(e>=a&&e<=a+R&&h>=v&&h<=v+k)return f}return null}disableUserSelect(e=!1){this.#N.classList.toggle("noUserSelect",e)}addShouldRescale(e){this.#p.add(e)}removeShouldRescale(e){this.#p.delete(e)}onScaleChanging({scale:e}){this.commitOrRemove(),this.viewParameters.realScale=e*d.PixelsPerInch.PDF_TO_CSS_UNITS;for(const h of this.#p)h.onScaleChanging()}onRotationChanging({pagesRotation:e}){this.commitOrRemove(),this.viewParameters.rotation=e}addToAnnotationStorage(e){!e.isEmpty()&&this.#o&&!this.#o.has(e.id)&&this.#o.setValue(e.id,e)}#$(){window.addEventListener("focus",this.#S),window.addEventListener("blur",this.#P)}#U(){window.removeEventListener("focus",this.#S),window.removeEventListener("blur",this.#P)}blur(){if(!this.hasSelection)return;const{activeElement:e}=document;for(const h of this.#d)if(h.div.contains(e)){this.#m=[h,e],h._focusEventsAllowed=!1;break}}focus(){if(!this.#m)return;const[e,h]=this.#m;this.#m=null,h.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0}),h.focus()}#B(){window.addEventListener("keydown",this.#L,{capture:!0})}#M(){window.removeEventListener("keydown",this.#L,{capture:!0})}#R(){document.addEventListener("copy",this.#w),document.addEventListener("cut",this.#T),document.addEventListener("paste",this.#I)}#E(){document.removeEventListener("copy",this.#w),document.removeEventListener("cut",this.#T),document.removeEventListener("paste",this.#I)}addEditListeners(){this.#B(),this.#R()}removeEditListeners(){this.#M(),this.#E()}copy(e){if(e.preventDefault(),this.#t?.commitOrRemove(),!this.hasSelection)return;const h=[];for(const f of this.#d){const a=f.serialize(!0);a&&h.push(a)}h.length!==0&&e.clipboardData.setData("application/pdfjs",JSON.stringify(h))}cut(e){this.copy(e),this.delete()}paste(e){e.preventDefault();const{clipboardData:h}=e;for(const v of h.items)for(const R of this.#i)if(R.isHandlingMimeForPasting(v.type)){R.paste(v,this.currentLayer);return}let f=h.getData("application/pdfjs");if(!f)return;try{f=JSON.parse(f)}catch(v){(0,i.warn)(`paste: "${v.message}".`);return}if(!Array.isArray(f))return;this.unselectAll();const a=this.currentLayer;try{const v=[];for(const g of f){const P=a.deserialize(g);if(!P)return;v.push(P)}const R=()=>{for(const g of v)this.#H(g);this.#W(v)},k=()=>{for(const g of v)g.remove()};this.addCommands({cmd:R,undo:k,mustExec:!0})}catch(v){(0,i.warn)(`paste: "${v.message}".`)}}keydown(e){this.getActive()?.shouldGetKeyboardEvents()||l._keyboardManager.exec(this,e)}onEditingAction(e){["undo","redo","delete","selectAll"].includes(e.name)&&this[e.name]()}#A(e){Object.entries(e).some(([f,a])=>this.#F[f]!==a)&&this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(this.#F,e)})}#z(e){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:e})}setEditingState(e){e?(this.#$(),this.#B(),this.#R(),this.#A({isEditing:this.#g!==i.AnnotationEditorType.NONE,isEmpty:this.#j(),hasSomethingToUndo:this.#a.hasSomethingToUndo(),hasSomethingToRedo:this.#a.hasSomethingToRedo(),hasSelectedEditor:!1})):(this.#U(),this.#M(),this.#E(),this.#A({isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(e){if(!this.#i){this.#i=e;for(const h of this.#i)this.#z(h.defaultPropertiesToUpdate)}}getId(){return this.#u.getId()}get currentLayer(){return this.#r.get(this.#n)}getLayer(e){return this.#r.get(e)}get currentPageIndex(){return this.#n}addLayer(e){this.#r.set(e.pageIndex,e),this.#f?e.enable():e.disable()}removeLayer(e){this.#r.delete(e.pageIndex)}updateMode(e,h=null){if(this.#g!==e){if(this.#g=e,e===i.AnnotationEditorType.NONE){this.setEditingState(!1),this.#G();return}this.setEditingState(!0),this.#q(),this.unselectAll();for(const f of this.#r.values())f.updateMode(e);if(h){for(const f of this.#e.values())if(f.annotationElementId===h){this.setSelected(f),f.enterInEditMode();break}}}}updateToolbar(e){e!==this.#g&&this._eventBus.dispatch("switchannotationeditormode",{source:this,mode:e})}updateParams(e,h){if(this.#i){if(e===i.AnnotationEditorParamsType.CREATE){this.currentLayer.addNewEditor(e);return}for(const f of this.#d)f.updateParams(e,h);for(const f of this.#i)f.updateDefaultParams(e,h)}}enableWaiting(e=!1){if(this.#y!==e){this.#y=e;for(const h of this.#r.values())e?h.disableClick():h.enableClick(),h.div.classList.toggle("waiting",e)}}#q(){if(!this.#f){this.#f=!0;for(const e of this.#r.values())e.enable()}}#G(){if(this.unselectAll(),this.#f){this.#f=!1;for(const e of this.#r.values())e.disable()}}getEditors(e){const h=[];for(const f of this.#e.values())f.pageIndex===e&&h.push(f);return h}getEditor(e){return this.#e.get(e)}addEditor(e){this.#e.set(e.id,e)}removeEditor(e){this.#e.delete(e.id),this.unselect(e),(!e.annotationElementId||!this.#l.has(e.annotationElementId))&&this.#o?.remove(e.id)}addDeletedAnnotationElement(e){this.#l.add(e.annotationElementId),e.deleted=!0}isDeletedAnnotationElement(e){return this.#l.has(e)}removeDeletedAnnotationElement(e){this.#l.delete(e.annotationElementId),e.deleted=!1}#H(e){const h=this.#r.get(e.pageIndex);h?h.addOrRebuild(e):this.addEditor(e)}setActiveEditor(e){this.#t!==e&&(this.#t=e,e&&this.#z(e.propertiesToUpdate))}toggleSelected(e){if(this.#d.has(e)){this.#d.delete(e),e.unselect(),this.#A({hasSelectedEditor:this.hasSelection});return}this.#d.add(e),e.select(),this.#z(e.propertiesToUpdate),this.#A({hasSelectedEditor:!0})}setSelected(e){for(const h of this.#d)h!==e&&h.unselect();this.#d.clear(),this.#d.add(e),e.select(),this.#z(e.propertiesToUpdate),this.#A({hasSelectedEditor:!0})}isSelected(e){return this.#d.has(e)}unselect(e){e.unselect(),this.#d.delete(e),this.#A({hasSelectedEditor:this.hasSelection})}get hasSelection(){return this.#d.size!==0}undo(){this.#a.undo(),this.#A({hasSomethingToUndo:this.#a.hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:this.#j()})}redo(){this.#a.redo(),this.#A({hasSomethingToUndo:!0,hasSomethingToRedo:this.#a.hasSomethingToRedo(),isEmpty:this.#j()})}addCommands(e){this.#a.add(e),this.#A({hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:this.#j()})}#j(){if(this.#e.size===0)return!0;if(this.#e.size===1)for(const e of this.#e.values())return e.isEmpty();return!1}delete(){if(this.commitOrRemove(),!this.hasSelection)return;const e=[...this.#d],h=()=>{for(const a of e)a.remove()},f=()=>{for(const a of e)this.#H(a)};this.addCommands({cmd:h,undo:f,mustExec:!0})}commitOrRemove(){this.#t?.commitOrRemove()}hasSomethingToControl(){return this.#t||this.hasSelection}#W(e){this.#d.clear();for(const h of e)h.isEmpty()||(this.#d.add(h),h.select());this.#A({hasSelectedEditor:!0})}selectAll(){for(const e of this.#d)e.commit();this.#W(this.#e.values())}unselectAll(){if(this.#t){this.#t.commitOrRemove();return}if(this.hasSelection){for(const e of this.#d)e.unselect();this.#d.clear(),this.#A({hasSelectedEditor:!1})}}translateSelectedEditors(e,h,f=!1){if(f||this.commitOrRemove(),!this.hasSelection)return;this.#_[0]+=e,this.#_[1]+=h;const[a,v]=this.#_,R=[...this.#d],k=1e3;this.#x&&clearTimeout(this.#x),this.#x=setTimeout(()=>{this.#x=null,this.#_[0]=this.#_[1]=0,this.addCommands({cmd:()=>{for(const g of R)this.#e.has(g.id)&&g.translateInPage(a,v)},undo:()=>{for(const g of R)this.#e.has(g.id)&&g.translateInPage(-a,-v)},mustExec:!1})},k);for(const g of R)g.translateInPage(e,h)}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),this.#c=new Map;for(const e of this.#d)this.#c.set(e,{savedX:e.x,savedY:e.y,savedPageIndex:e.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!this.#c)return!1;this.disableUserSelect(!1);const e=this.#c;this.#c=null;let h=!1;for(const[{x:a,y:v,pageIndex:R},k]of e)k.newX=a,k.newY=v,k.newPageIndex=R,h||=a!==k.savedX||v!==k.savedY||R!==k.savedPageIndex;if(!h)return!1;const f=(a,v,R,k)=>{if(this.#e.has(a.id)){const g=this.#r.get(k);g?a._setParentAndPosition(g,v,R):(a.pageIndex=k,a.x=v,a.y=R)}};return this.addCommands({cmd:()=>{for(const[a,{newX:v,newY:R,newPageIndex:k}]of e)f(a,v,R,k)},undo:()=>{for(const[a,{savedX:v,savedY:R,savedPageIndex:k}]of e)f(a,v,R,k)},mustExec:!0}),!0}dragSelectedEditors(e,h){if(this.#c)for(const f of this.#c.keys())f.drag(e,h)}rebuild(e){if(e.parent===null){const h=this.getLayer(e.pageIndex);h?(h.changeParent(e),h.addOrRebuild(e)):(this.addEditor(e),this.addToAnnotationStorage(e),e.rebuild())}else e.parent.addOrRebuild(e)}isActive(e){return this.#t===e}getActive(){return this.#t}getMode(){return this.#g}get imageManager(){return(0,i.shadow)(this,"imageManager",new w)}}s.AnnotationEditorUIManager=l},(E,s,y)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.StatTimer=s.RenderingCancelledException=s.PixelsPerInch=s.PageViewport=s.PDFDateString=s.DOMStandardFontDataFactory=s.DOMSVGFactory=s.DOMFilterFactory=s.DOMCanvasFactory=s.DOMCMapReaderFactory=void 0,s.deprecated=U,s.getColorValues=at,s.getCurrentTransform=tt,s.getCurrentTransformInverse=it,s.getFilenameFromUrl=a,s.getPdfFilenameFromUrl=v,s.getRGB=W,s.getXfaPageViewport=j,s.isDataScheme=h,s.isPdfFile=f,s.isValidFetchUrl=k,s.loadScript=P,s.noContextMenu=g,s.setLayerDimensions=ut;var i=y(7),d=y(1);const C="http://www.w3.org/2000/svg";class A{static CSS=96;static PDF=72;static PDF_TO_CSS_UNITS=this.CSS/this.PDF}s.PixelsPerInch=A;class M extends i.BaseFilterFactory{#t;#e;#r;#s;#o;#a;#n;#l;#c;#i;#p=0;constructor({docId:L,ownerDocument:b=globalThis.document}={}){super(),this.#r=L,this.#s=b}get#h(){return this.#t||=new Map}get#u(){if(!this.#e){const L=this.#s.createElement("div"),{style:b}=L;b.visibility="hidden",b.contain="strict",b.width=b.height=0,b.position="absolute",b.top=b.left=0,b.zIndex=-1;const p=this.#s.createElementNS(C,"svg");p.setAttribute("width",0),p.setAttribute("height",0),this.#e=this.#s.createElementNS(C,"defs"),L.append(p),p.append(this.#e),this.#s.body.append(L)}return this.#e}addFilter(L){if(!L)return"none";let b=this.#h.get(L);if(b)return b;let p,u,_,F;if(L.length===1){const o=L[0],m=new Array(256);for(let S=0;S<256;S++)m[S]=o[S]/255;F=p=u=_=m.join(",")}else{const[o,m,S]=L,T=new Array(256),D=new Array(256),$=new Array(256);for(let B=0;B<256;B++)T[B]=o[B]/255,D[B]=m[B]/255,$[B]=S[B]/255;p=T.join(","),u=D.join(","),_=$.join(","),F=`${p}${u}${_}`}if(b=this.#h.get(F),b)return this.#h.set(L,b),b;const I=`g_${this.#r}_transfer_map_${this.#p++}`,O=`url(#${I})`;this.#h.set(L,O),this.#h.set(F,O);const x=this.#y(I);return this.#g(p,u,_,x),O}addHCMFilter(L,b){const p=`${L}-${b}`;if(this.#a===p)return this.#n;if(this.#a=p,this.#n="none",this.#o?.remove(),!L||!b)return this.#n;const u=this.#d(L);L=d.Util.makeHexColor(...u);const _=this.#d(b);if(b=d.Util.makeHexColor(..._),this.#u.style.color="",L==="#000000"&&b==="#ffffff"||L===b)return this.#n;const F=new Array(256);for(let m=0;m<=255;m++){const S=m/255;F[m]=S<=.03928?S/12.92:((S+.055)/1.055)**2.4}const I=F.join(","),O=`g_${this.#r}_hcm_filter`,x=this.#l=this.#y(O);this.#g(I,I,I,x),this.#f(x);const o=(m,S)=>{const T=u[m]/255,D=_[m]/255,$=new Array(S+1);for(let B=0;B<=S;B++)$[B]=T+B/S*(D-T);return $.join(",")};return this.#g(o(0,5),o(1,5),o(2,5),x),this.#n=`url(#${O})`,this.#n}addHighlightHCMFilter(L,b,p,u){const _=`${L}-${b}-${p}-${u}`;if(this.#c===_)return this.#i;if(this.#c=_,this.#i="none",this.#l?.remove(),!L||!b)return this.#i;const[F,I]=[L,b].map(this.#d.bind(this));let O=Math.round(.2126*F[0]+.7152*F[1]+.0722*F[2]),x=Math.round(.2126*I[0]+.7152*I[1]+.0722*I[2]),[o,m]=[p,u].map(this.#d.bind(this));x<O&&([O,x,o,m]=[x,O,m,o]),this.#u.style.color="";const S=($,B,G)=>{const lt=new Array(256),V=(x-O)/G,X=$/255,K=(B-$)/(255*G);let Y=0;for(let et=0;et<=G;et++){const gt=Math.round(O+et*V),wt=X+et*K;for(let Tt=Y;Tt<=gt;Tt++)lt[Tt]=wt;Y=gt+1}for(let et=Y;et<256;et++)lt[et]=lt[Y-1];return lt.join(",")},T=`g_${this.#r}_hcm_highlight_filter`,D=this.#l=this.#y(T);return this.#f(D),this.#g(S(o[0],m[0],5),S(o[1],m[1],5),S(o[2],m[2],5),D),this.#i=`url(#${T})`,this.#i}destroy(L=!1){L&&(this.#n||this.#i)||(this.#e&&(this.#e.parentNode.parentNode.remove(),this.#e=null),this.#t&&(this.#t.clear(),this.#t=null),this.#p=0)}#f(L){const b=this.#s.createElementNS(C,"feColorMatrix");b.setAttribute("type","matrix"),b.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),L.append(b)}#y(L){const b=this.#s.createElementNS(C,"filter");return b.setAttribute("color-interpolation-filters","sRGB"),b.setAttribute("id",L),this.#u.append(b),b}#m(L,b,p){const u=this.#s.createElementNS(C,b);u.setAttribute("type","discrete"),u.setAttribute("tableValues",p),L.append(u)}#g(L,b,p,u){const _=this.#s.createElementNS(C,"feComponentTransfer");u.append(_),this.#m(_,"feFuncR",L),this.#m(_,"feFuncG",b),this.#m(_,"feFuncB",p)}#d(L){return this.#u.style.color=L,W(getComputedStyle(this.#u).getPropertyValue("color"))}}s.DOMFilterFactory=M;class w extends i.BaseCanvasFactory{constructor({ownerDocument:L=globalThis.document}={}){super(),this._document=L}_createCanvas(L,b){const p=this._document.createElement("canvas");return p.width=L,p.height=b,p}}s.DOMCanvasFactory=w;async function n(J,L=!1){if(k(J,document.baseURI)){const b=await fetch(J);if(!b.ok)throw new Error(b.statusText);return L?new Uint8Array(await b.arrayBuffer()):(0,d.stringToBytes)(await b.text())}return new Promise((b,p)=>{const u=new XMLHttpRequest;u.open("GET",J,!0),L&&(u.responseType="arraybuffer"),u.onreadystatechange=()=>{if(u.readyState===XMLHttpRequest.DONE){if(u.status===200||u.status===0){let _;if(L&&u.response?_=new Uint8Array(u.response):!L&&u.responseText&&(_=(0,d.stringToBytes)(u.responseText)),_){b(_);return}}p(new Error(u.statusText))}},u.send(null)})}class t extends i.BaseCMapReaderFactory{_fetchData(L,b){return n(L,this.isCompressed).then(p=>({cMapData:p,compressionType:b}))}}s.DOMCMapReaderFactory=t;class r extends i.BaseStandardFontDataFactory{_fetchData(L){return n(L,!0)}}s.DOMStandardFontDataFactory=r;class l extends i.BaseSVGFactory{_createSVG(L){return document.createElementNS(C,L)}}s.DOMSVGFactory=l;class c{constructor({viewBox:L,scale:b,rotation:p,offsetX:u=0,offsetY:_=0,dontFlip:F=!1}){this.viewBox=L,this.scale=b,this.rotation=p,this.offsetX=u,this.offsetY=_;const I=(L[2]+L[0])/2,O=(L[3]+L[1])/2;let x,o,m,S;switch(p%=360,p<0&&(p+=360),p){case 180:x=-1,o=0,m=0,S=1;break;case 90:x=0,o=1,m=1,S=0;break;case 270:x=0,o=-1,m=-1,S=0;break;case 0:x=1,o=0,m=0,S=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}F&&(m=-m,S=-S);let T,D,$,B;x===0?(T=Math.abs(O-L[1])*b+u,D=Math.abs(I-L[0])*b+_,$=(L[3]-L[1])*b,B=(L[2]-L[0])*b):(T=Math.abs(I-L[0])*b+u,D=Math.abs(O-L[1])*b+_,$=(L[2]-L[0])*b,B=(L[3]-L[1])*b),this.transform=[x*b,o*b,m*b,S*b,T-x*b*I-m*b*O,D-o*b*I-S*b*O],this.width=$,this.height=B}get rawDims(){const{viewBox:L}=this;return(0,d.shadow)(this,"rawDims",{pageWidth:L[2]-L[0],pageHeight:L[3]-L[1],pageX:L[0],pageY:L[1]})}clone({scale:L=this.scale,rotation:b=this.rotation,offsetX:p=this.offsetX,offsetY:u=this.offsetY,dontFlip:_=!1}={}){return new c({viewBox:this.viewBox.slice(),scale:L,rotation:b,offsetX:p,offsetY:u,dontFlip:_})}convertToViewportPoint(L,b){return d.Util.applyTransform([L,b],this.transform)}convertToViewportRectangle(L){const b=d.Util.applyTransform([L[0],L[1]],this.transform),p=d.Util.applyTransform([L[2],L[3]],this.transform);return[b[0],b[1],p[0],p[1]]}convertToPdfPoint(L,b){return d.Util.applyInverseTransform([L,b],this.transform)}}s.PageViewport=c;class e extends d.BaseException{constructor(L,b=0){super(L,"RenderingCancelledException"),this.extraDelay=b}}s.RenderingCancelledException=e;function h(J){const L=J.length;let b=0;for(;b<L&&J[b].trim()==="";)b++;return J.substring(b,b+5).toLowerCase()==="data:"}function f(J){return typeof J=="string"&&/\.pdf$/i.test(J)}function a(J,L=!1){return L||([J]=J.split(/[#?]/,1)),J.substring(J.lastIndexOf("/")+1)}function v(J,L="document.pdf"){if(typeof J!="string")return L;if(h(J))return(0,d.warn)('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),L;const b=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/,p=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,u=b.exec(J);let _=p.exec(u[1])||p.exec(u[2])||p.exec(u[3]);if(_&&(_=_[0],_.includes("%")))try{_=p.exec(decodeURIComponent(_))[0]}catch{}return _||L}class R{started=Object.create(null);times=[];time(L){L in this.started&&(0,d.warn)(`Timer is already running for ${L}`),this.started[L]=Date.now()}timeEnd(L){L in this.started||(0,d.warn)(`Timer has not been started for ${L}`),this.times.push({name:L,start:this.started[L],end:Date.now()}),delete this.started[L]}toString(){const L=[];let b=0;for(const{name:p}of this.times)b=Math.max(p.length,b);for(const{name:p,start:u,end:_}of this.times)L.push(`${p.padEnd(b)} ${_-u}ms
`);return L.join("")}}s.StatTimer=R;function k(J,L){try{const{protocol:b}=L?new URL(J,L):new URL(J);return b==="http:"||b==="https:"}catch{return!1}}function g(J){J.preventDefault()}function P(J,L=!1){return new Promise((b,p)=>{const u=document.createElement("script");u.src=J,u.onload=function(_){L&&u.remove(),b(_)},u.onerror=function(){p(new Error(`Cannot load script at: ${u.src}`))},(document.head||document.documentElement).append(u)})}function U(J){console.log("Deprecated API usage: "+J)}let z;class N{static toDateObject(L){if(!L||typeof L!="string")return null;z||=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?");const b=z.exec(L);if(!b)return null;const p=parseInt(b[1],10);let u=parseInt(b[2],10);u=u>=1&&u<=12?u-1:0;let _=parseInt(b[3],10);_=_>=1&&_<=31?_:1;let F=parseInt(b[4],10);F=F>=0&&F<=23?F:0;let I=parseInt(b[5],10);I=I>=0&&I<=59?I:0;let O=parseInt(b[6],10);O=O>=0&&O<=59?O:0;const x=b[7]||"Z";let o=parseInt(b[8],10);o=o>=0&&o<=23?o:0;let m=parseInt(b[9],10)||0;return m=m>=0&&m<=59?m:0,x==="-"?(F+=o,I+=m):x==="+"&&(F-=o,I-=m),new Date(Date.UTC(p,u,_,F,I,O))}}s.PDFDateString=N;function j(J,{scale:L=1,rotation:b=0}){const{width:p,height:u}=J.attributes.style,_=[0,0,parseInt(p),parseInt(u)];return new c({viewBox:_,scale:L,rotation:b})}function W(J){if(J.startsWith("#")){const L=parseInt(J.slice(1),16);return[(L&16711680)>>16,(L&65280)>>8,L&255]}return J.startsWith("rgb(")?J.slice(4,-1).split(",").map(L=>parseInt(L)):J.startsWith("rgba(")?J.slice(5,-1).split(",").map(L=>parseInt(L)).slice(0,3):((0,d.warn)(`Not a valid color format: "${J}"`),[0,0,0])}function at(J){const L=document.createElement("span");L.style.visibility="hidden",document.body.append(L);for(const b of J.keys()){L.style.color=b;const p=window.getComputedStyle(L).color;J.set(b,W(p))}L.remove()}function tt(J){const{a:L,b,c:p,d:u,e:_,f:F}=J.getTransform();return[L,b,p,u,_,F]}function it(J){const{a:L,b,c:p,d:u,e:_,f:F}=J.getTransform().invertSelf();return[L,b,p,u,_,F]}function ut(J,L,b=!1,p=!0){if(L instanceof c){const{pageWidth:u,pageHeight:_}=L.rawDims,{style:F}=J,I=d.FeatureTest.isCSSRoundSupported,O=`var(--scale-factor) * ${u}px`,x=`var(--scale-factor) * ${_}px`,o=I?`round(${O}, 1px)`:`calc(${O})`,m=I?`round(${x}, 1px)`:`calc(${x})`;!b||L.rotation%180===0?(F.width=o,F.height=m):(F.width=m,F.height=o)}p&&J.setAttribute("data-main-rotation",L.rotation)}},(E,s,y)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.BaseStandardFontDataFactory=s.BaseSVGFactory=s.BaseFilterFactory=s.BaseCanvasFactory=s.BaseCMapReaderFactory=void 0;var i=y(1);class d{constructor(){this.constructor===d&&(0,i.unreachable)("Cannot initialize BaseFilterFactory.")}addFilter(t){return"none"}addHCMFilter(t,r){return"none"}addHighlightHCMFilter(t,r,l,c){return"none"}destroy(t=!1){}}s.BaseFilterFactory=d;class C{constructor(){this.constructor===C&&(0,i.unreachable)("Cannot initialize BaseCanvasFactory.")}create(t,r){if(t<=0||r<=0)throw new Error("Invalid canvas size");const l=this._createCanvas(t,r);return{canvas:l,context:l.getContext("2d")}}reset(t,r,l){if(!t.canvas)throw new Error("Canvas is not specified");if(r<=0||l<=0)throw new Error("Invalid canvas size");t.canvas.width=r,t.canvas.height=l}destroy(t){if(!t.canvas)throw new Error("Canvas is not specified");t.canvas.width=0,t.canvas.height=0,t.canvas=null,t.context=null}_createCanvas(t,r){(0,i.unreachable)("Abstract method `_createCanvas` called.")}}s.BaseCanvasFactory=C;class A{constructor({baseUrl:t=null,isCompressed:r=!0}){this.constructor===A&&(0,i.unreachable)("Cannot initialize BaseCMapReaderFactory."),this.baseUrl=t,this.isCompressed=r}async fetch({name:t}){if(!this.baseUrl)throw new Error('The CMap "baseUrl" parameter must be specified, ensure that the "cMapUrl" and "cMapPacked" API parameters are provided.');if(!t)throw new Error("CMap name must be specified.");const r=this.baseUrl+t+(this.isCompressed?".bcmap":""),l=this.isCompressed?i.CMapCompressionType.BINARY:i.CMapCompressionType.NONE;return this._fetchData(r,l).catch(c=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${r}`)})}_fetchData(t,r){(0,i.unreachable)("Abstract method `_fetchData` called.")}}s.BaseCMapReaderFactory=A;class M{constructor({baseUrl:t=null}){this.constructor===M&&(0,i.unreachable)("Cannot initialize BaseStandardFontDataFactory."),this.baseUrl=t}async fetch({filename:t}){if(!this.baseUrl)throw new Error('The standard font "baseUrl" parameter must be specified, ensure that the "standardFontDataUrl" API parameter is provided.');if(!t)throw new Error("Font filename must be specified.");const r=`${this.baseUrl}${t}`;return this._fetchData(r).catch(l=>{throw new Error(`Unable to load font data at: ${r}`)})}_fetchData(t){(0,i.unreachable)("Abstract method `_fetchData` called.")}}s.BaseStandardFontDataFactory=M;class w{constructor(){this.constructor===w&&(0,i.unreachable)("Cannot initialize BaseSVGFactory.")}create(t,r,l=!1){if(t<=0||r<=0)throw new Error("Invalid SVG dimensions");const c=this._createSVG("svg:svg");return c.setAttribute("version","1.1"),l||(c.setAttribute("width",`${t}px`),c.setAttribute("height",`${r}px`)),c.setAttribute("preserveAspectRatio","none"),c.setAttribute("viewBox",`0 0 ${t} ${r}`),c}createElement(t){if(typeof t!="string")throw new Error("Invalid SVG element type");return this._createSVG(t)}_createSVG(t){(0,i.unreachable)("Abstract method `_createSVG` called.")}}s.BaseSVGFactory=w},(E,s,y)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.MurmurHash3_64=void 0;var i=y(1);const d=3285377520,C=4294901760,A=65535;class M{constructor(n){this.h1=n?n&4294967295:d,this.h2=n?n&4294967295:d}update(n){let t,r;if(typeof n=="string"){t=new Uint8Array(n.length*2),r=0;for(let U=0,z=n.length;U<z;U++){const N=n.charCodeAt(U);N<=255?t[r++]=N:(t[r++]=N>>>8,t[r++]=N&255)}}else if((0,i.isArrayBuffer)(n))t=n.slice(),r=t.byteLength;else throw new Error("Wrong data format in MurmurHash3_64_update. Input must be a string or array.");const l=r>>2,c=r-l*4,e=new Uint32Array(t.buffer,0,l);let h=0,f=0,a=this.h1,v=this.h2;const R=3432918353,k=461845907,g=R&A,P=k&A;for(let U=0;U<l;U++)U&1?(h=e[U],h=h*R&C|h*g&A,h=h<<15|h>>>17,h=h*k&C|h*P&A,a^=h,a=a<<13|a>>>19,a=a*5+3864292196):(f=e[U],f=f*R&C|f*g&A,f=f<<15|f>>>17,f=f*k&C|f*P&A,v^=f,v=v<<13|v>>>19,v=v*5+3864292196);switch(h=0,c){case 3:h^=t[l*4+2]<<16;case 2:h^=t[l*4+1]<<8;case 1:h^=t[l*4],h=h*R&C|h*g&A,h=h<<15|h>>>17,h=h*k&C|h*P&A,l&1?a^=h:v^=h}this.h1=a,this.h2=v}hexdigest(){let n=this.h1,t=this.h2;return n^=t>>>1,n=n*3981806797&C|n*36045&A,t=t*4283543511&C|((t<<16|n>>>16)*2950163797&C)>>>16,n^=t>>>1,n=n*444984403&C|n*60499&A,t=t*3301882366&C|((t<<16|n>>>16)*3120437893&C)>>>16,n^=t>>>1,(n>>>0).toString(16).padStart(8,"0")+(t>>>0).toString(16).padStart(8,"0")}}s.MurmurHash3_64=M},(E,s,y)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.FontLoader=s.FontFaceObject=void 0;var i=y(1);class d{#t=new Set;constructor({ownerDocument:M=globalThis.document,styleElement:w=null}){this._document=M,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(M){this.nativeFontFaces.add(M),this._document.fonts.add(M)}removeNativeFontFace(M){this.nativeFontFaces.delete(M),this._document.fonts.delete(M)}insertRule(M){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const w=this.styleElement.sheet;w.insertRule(M,w.cssRules.length)}clear(){for(const M of this.nativeFontFaces)this._document.fonts.delete(M);this.nativeFontFaces.clear(),this.#t.clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont(M){if(!(!M||this.#t.has(M.loadedName))){if((0,i.assert)(!this.disableFontFace,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:w,src:n,style:t}=M,r=new FontFace(w,n,t);this.addNativeFontFace(r);try{await r.load(),this.#t.add(w)}catch{(0,i.warn)(`Cannot load system font: ${M.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(r)}return}(0,i.unreachable)("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(M){if(M.attached||M.missingFile&&!M.systemFontInfo)return;if(M.attached=!0,M.systemFontInfo){await this.loadSystemFont(M.systemFontInfo);return}if(this.isFontLoadingAPISupported){const n=M.createNativeFontFace();if(n){this.addNativeFontFace(n);try{await n.loaded}catch(t){throw(0,i.warn)(`Failed to load font '${n.family}': '${t}'.`),M.disableFontFace=!0,t}}return}const w=M.createFontFaceRule();if(w){if(this.insertRule(w),this.isSyncFontLoadingSupported)return;await new Promise(n=>{const t=this._queueLoadingCallback(n);this._prepareFontLoadEvent(M,t)})}}get isFontLoadingAPISupported(){const M=!!this._document?.fonts;return(0,i.shadow)(this,"isFontLoadingAPISupported",M)}get isSyncFontLoadingSupported(){let M=!1;return(i.isNodeJS||typeof navigator<"u"&&/Mozilla\/5.0.*?rv:\d+.*? Gecko/.test(navigator.userAgent))&&(M=!0),(0,i.shadow)(this,"isSyncFontLoadingSupported",M)}_queueLoadingCallback(M){function w(){for((0,i.assert)(!t.done,"completeRequest() cannot be called twice."),t.done=!0;n.length>0&&n[0].done;){const r=n.shift();setTimeout(r.callback,0)}}const{loadingRequests:n}=this,t={done:!1,complete:w,callback:M};return n.push(t),t}get _loadTestFont(){const M=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return(0,i.shadow)(this,"_loadTestFont",M)}_prepareFontLoadEvent(M,w){function n(j,W){return j.charCodeAt(W)<<24|j.charCodeAt(W+1)<<16|j.charCodeAt(W+2)<<8|j.charCodeAt(W+3)&255}function t(j,W,at,tt){const it=j.substring(0,W),ut=j.substring(W+at);return it+tt+ut}let r,l;const c=this._document.createElement("canvas");c.width=1,c.height=1;const e=c.getContext("2d");let h=0;function f(j,W){if(++h>30){(0,i.warn)("Load test font never loaded."),W();return}if(e.font="30px "+j,e.fillText(".",0,20),e.getImageData(0,0,1,1).data[3]>0){W();return}setTimeout(f.bind(null,j,W))}const a=`lt${Date.now()}${this.loadTestFontId++}`;let v=this._loadTestFont;v=t(v,976,a.length,a);const k=16,g=1482184792;let P=n(v,k);for(r=0,l=a.length-3;r<l;r+=4)P=P-g+n(a,r)|0;r<a.length&&(P=P-g+n(a+"XXX",r)|0),v=t(v,k,4,(0,i.string32)(P));const U=`url(data:font/opentype;base64,${btoa(v)});`,z=`@font-face {font-family:"${a}";src:${U}}`;this.insertRule(z);const N=this._document.createElement("div");N.style.visibility="hidden",N.style.width=N.style.height="10px",N.style.position="absolute",N.style.top=N.style.left="0px";for(const j of[M.loadedName,a]){const W=this._document.createElement("span");W.textContent="Hi",W.style.fontFamily=j,N.append(W)}this._document.body.append(N),f(a,()=>{N.remove(),w.complete()})}}s.FontLoader=d;class C{constructor(M,{isEvalSupported:w=!0,disableFontFace:n=!1,ignoreErrors:t=!1,inspectFont:r=null}){this.compiledGlyphs=Object.create(null);for(const l in M)this[l]=M[l];this.isEvalSupported=w!==!1,this.disableFontFace=n===!0,this.ignoreErrors=t===!0,this._inspectFont=r}createNativeFontFace(){if(!this.data||this.disableFontFace)return null;let M;if(!this.cssFontInfo)M=new FontFace(this.loadedName,this.data,{});else{const w={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(w.style=`oblique ${this.cssFontInfo.italicAngle}deg`),M=new FontFace(this.cssFontInfo.fontFamily,this.data,w)}return this._inspectFont?.(this),M}createFontFaceRule(){if(!this.data||this.disableFontFace)return null;const M=(0,i.bytesToString)(this.data),w=`url(data:${this.mimetype};base64,${btoa(M)});`;let n;if(!this.cssFontInfo)n=`@font-face {font-family:"${this.loadedName}";src:${w}}`;else{let t=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(t+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),n=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${t}src:${w}}`}return this._inspectFont?.(this,w),n}getPathGenerator(M,w){if(this.compiledGlyphs[w]!==void 0)return this.compiledGlyphs[w];let n;try{n=M.get(this.loadedName+"_path_"+w)}catch(t){if(!this.ignoreErrors)throw t;return(0,i.warn)(`getPathGenerator - ignoring character: "${t}".`),this.compiledGlyphs[w]=function(r,l){}}if(this.isEvalSupported&&i.FeatureTest.isEvalSupported){const t=[];for(const r of n){const l=r.args!==void 0?r.args.join(","):"";t.push("c.",r.cmd,"(",l,`);
`)}return this.compiledGlyphs[w]=new Function("c","size",t.join(""))}return this.compiledGlyphs[w]=function(t,r){for(const l of n)l.cmd==="scale"&&(l.args=[r,-r]),t[l.cmd].apply(t,l.args)}}}s.FontFaceObject=C},(E,s,y)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.NodeStandardFontDataFactory=s.NodeFilterFactory=s.NodeCanvasFactory=s.NodeCMapReaderFactory=void 0;var i=y(7);y(1);const d=function(n){return new Promise((t,r)=>{require$$5.readFile(n,(c,e)=>{if(c||!e){r(new Error(c));return}t(new Uint8Array(e))})})};class C extends i.BaseFilterFactory{}s.NodeFilterFactory=C;class A extends i.BaseCanvasFactory{_createCanvas(t,r){return require$$5.createCanvas(t,r)}}s.NodeCanvasFactory=A;class M extends i.BaseCMapReaderFactory{_fetchData(t,r){return d(t).then(l=>({cMapData:l,compressionType:r}))}}s.NodeCMapReaderFactory=M;class w extends i.BaseStandardFontDataFactory{_fetchData(t){return d(t)}}s.NodeStandardFontDataFactory=w},(E,s,y)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.CanvasGraphics=void 0;var i=y(1),d=y(6),C=y(12),A=y(13);const M=16,w=100,n=4096,t=15,r=10,l=1e3,c=16;function e(b,p){if(b._removeMirroring)throw new Error("Context is already forwarding operations.");b.__originalSave=b.save,b.__originalRestore=b.restore,b.__originalRotate=b.rotate,b.__originalScale=b.scale,b.__originalTranslate=b.translate,b.__originalTransform=b.transform,b.__originalSetTransform=b.setTransform,b.__originalResetTransform=b.resetTransform,b.__originalClip=b.clip,b.__originalMoveTo=b.moveTo,b.__originalLineTo=b.lineTo,b.__originalBezierCurveTo=b.bezierCurveTo,b.__originalRect=b.rect,b.__originalClosePath=b.closePath,b.__originalBeginPath=b.beginPath,b._removeMirroring=()=>{b.save=b.__originalSave,b.restore=b.__originalRestore,b.rotate=b.__originalRotate,b.scale=b.__originalScale,b.translate=b.__originalTranslate,b.transform=b.__originalTransform,b.setTransform=b.__originalSetTransform,b.resetTransform=b.__originalResetTransform,b.clip=b.__originalClip,b.moveTo=b.__originalMoveTo,b.lineTo=b.__originalLineTo,b.bezierCurveTo=b.__originalBezierCurveTo,b.rect=b.__originalRect,b.closePath=b.__originalClosePath,b.beginPath=b.__originalBeginPath,delete b._removeMirroring},b.save=function(){p.save(),this.__originalSave()},b.restore=function(){p.restore(),this.__originalRestore()},b.translate=function(_,F){p.translate(_,F),this.__originalTranslate(_,F)},b.scale=function(_,F){p.scale(_,F),this.__originalScale(_,F)},b.transform=function(_,F,I,O,x,o){p.transform(_,F,I,O,x,o),this.__originalTransform(_,F,I,O,x,o)},b.setTransform=function(_,F,I,O,x,o){p.setTransform(_,F,I,O,x,o),this.__originalSetTransform(_,F,I,O,x,o)},b.resetTransform=function(){p.resetTransform(),this.__originalResetTransform()},b.rotate=function(_){p.rotate(_),this.__originalRotate(_)},b.clip=function(_){p.clip(_),this.__originalClip(_)},b.moveTo=function(u,_){p.moveTo(u,_),this.__originalMoveTo(u,_)},b.lineTo=function(u,_){p.lineTo(u,_),this.__originalLineTo(u,_)},b.bezierCurveTo=function(u,_,F,I,O,x){p.bezierCurveTo(u,_,F,I,O,x),this.__originalBezierCurveTo(u,_,F,I,O,x)},b.rect=function(u,_,F,I){p.rect(u,_,F,I),this.__originalRect(u,_,F,I)},b.closePath=function(){p.closePath(),this.__originalClosePath()},b.beginPath=function(){p.beginPath(),this.__originalBeginPath()}}class h{constructor(p){this.canvasFactory=p,this.cache=Object.create(null)}getCanvas(p,u,_){let F;return this.cache[p]!==void 0?(F=this.cache[p],this.canvasFactory.reset(F,u,_)):(F=this.canvasFactory.create(u,_),this.cache[p]=F),F}delete(p){delete this.cache[p]}clear(){for(const p in this.cache){const u=this.cache[p];this.canvasFactory.destroy(u),delete this.cache[p]}}}function f(b,p,u,_,F,I,O,x,o,m){const[S,T,D,$,B,G]=(0,d.getCurrentTransform)(b);if(T===0&&D===0){const X=O*S+B,K=Math.round(X),Y=x*$+G,et=Math.round(Y),gt=(O+o)*S+B,wt=Math.abs(Math.round(gt)-K)||1,Tt=(x+m)*$+G,$t=Math.abs(Math.round(Tt)-et)||1;return b.setTransform(Math.sign(S),0,0,Math.sign($),K,et),b.drawImage(p,u,_,F,I,0,0,wt,$t),b.setTransform(S,T,D,$,B,G),[wt,$t]}if(S===0&&$===0){const X=x*D+B,K=Math.round(X),Y=O*T+G,et=Math.round(Y),gt=(x+m)*D+B,wt=Math.abs(Math.round(gt)-K)||1,Tt=(O+o)*T+G,$t=Math.abs(Math.round(Tt)-et)||1;return b.setTransform(0,Math.sign(T),Math.sign(D),0,K,et),b.drawImage(p,u,_,F,I,0,0,$t,wt),b.setTransform(S,T,D,$,B,G),[$t,wt]}b.drawImage(p,u,_,F,I,O,x,o,m);const lt=Math.hypot(S,T),V=Math.hypot(D,$);return[lt*o,V*m]}function a(b){const{width:p,height:u}=b;if(p>l||u>l)return null;const _=1e3,F=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),I=p+1;let O=new Uint8Array(I*(u+1)),x,o,m;const S=p+7&-8;let T=new Uint8Array(S*u),D=0;for(const V of b.data){let X=128;for(;X>0;)T[D++]=V&X?0:255,X>>=1}let $=0;for(D=0,T[D]!==0&&(O[0]=1,++$),o=1;o<p;o++)T[D]!==T[D+1]&&(O[o]=T[D]?2:1,++$),D++;for(T[D]!==0&&(O[o]=2,++$),x=1;x<u;x++){D=x*S,m=x*I,T[D-S]!==T[D]&&(O[m]=T[D]?1:8,++$);let V=(T[D]?4:0)+(T[D-S]?8:0);for(o=1;o<p;o++)V=(V>>2)+(T[D+1]?4:0)+(T[D-S+1]?8:0),F[V]&&(O[m+o]=F[V],++$),D++;if(T[D-S]!==T[D]&&(O[m+o]=T[D]?2:4,++$),$>_)return null}for(D=S*(u-1),m=x*I,T[D]!==0&&(O[m]=8,++$),o=1;o<p;o++)T[D]!==T[D+1]&&(O[m+o]=T[D]?4:8,++$),D++;if(T[D]!==0&&(O[m+o]=4,++$),$>_)return null;const B=new Int32Array([0,I,-1,0,-I,0,0,0,1]),G=new Path2D;for(x=0;$&&x<=u;x++){let V=x*I;const X=V+p;for(;V<X&&!O[V];)V++;if(V===X)continue;G.moveTo(V%I,x);const K=V;let Y=O[V];do{const et=B[Y];do V+=et;while(!O[V]);const gt=O[V];gt!==5&&gt!==10?(Y=gt,O[V]=0):(Y=gt&51*Y>>4,O[V]&=Y>>2|Y<<2),G.lineTo(V%I,V/I|0),O[V]||--$}while(K!==V);--x}return T=null,O=null,function(V){V.save(),V.scale(1/p,-1/u),V.translate(0,-u),V.fill(G),V.beginPath(),V.restore()}}class v{constructor(p,u){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=i.IDENTITY_MATRIX,this.textMatrixScale=1,this.fontMatrix=i.FONT_IDENTITY_MATRIX,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=i.TextRenderingMode.FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps="none",this.startNewPathAndClipBox([0,0,p,u])}clone(){const p=Object.create(this);return p.clipBox=this.clipBox.slice(),p}setCurrentPoint(p,u){this.x=p,this.y=u}updatePathMinMax(p,u,_){[u,_]=i.Util.applyTransform([u,_],p),this.minX=Math.min(this.minX,u),this.minY=Math.min(this.minY,_),this.maxX=Math.max(this.maxX,u),this.maxY=Math.max(this.maxY,_)}updateRectMinMax(p,u){const _=i.Util.applyTransform(u,p),F=i.Util.applyTransform(u.slice(2),p);this.minX=Math.min(this.minX,_[0],F[0]),this.minY=Math.min(this.minY,_[1],F[1]),this.maxX=Math.max(this.maxX,_[0],F[0]),this.maxY=Math.max(this.maxY,_[1],F[1])}updateScalingPathMinMax(p,u){i.Util.scaleMinMax(p,u),this.minX=Math.min(this.minX,u[0]),this.maxX=Math.max(this.maxX,u[1]),this.minY=Math.min(this.minY,u[2]),this.maxY=Math.max(this.maxY,u[3])}updateCurvePathMinMax(p,u,_,F,I,O,x,o,m,S){const T=i.Util.bezierBoundingBox(u,_,F,I,O,x,o,m);if(S){S[0]=Math.min(S[0],T[0],T[2]),S[1]=Math.max(S[1],T[0],T[2]),S[2]=Math.min(S[2],T[1],T[3]),S[3]=Math.max(S[3],T[1],T[3]);return}this.updateRectMinMax(p,T)}getPathBoundingBox(p=C.PathType.FILL,u=null){const _=[this.minX,this.minY,this.maxX,this.maxY];if(p===C.PathType.STROKE){u||(0,i.unreachable)("Stroke bounding box must include transform.");const F=i.Util.singularValueDecompose2dScale(u),I=F[0]*this.lineWidth/2,O=F[1]*this.lineWidth/2;_[0]-=I,_[1]-=O,_[2]+=I,_[3]+=O}return _}updateClipFromPath(){const p=i.Util.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(p||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}startNewPathAndClipBox(p){this.clipBox=p,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}getClippedPathBoundingBox(p=C.PathType.FILL,u=null){return i.Util.intersect(this.clipBox,this.getPathBoundingBox(p,u))}}function R(b,p){if(typeof ImageData<"u"&&p instanceof ImageData){b.putImageData(p,0,0);return}const u=p.height,_=p.width,F=u%c,I=(u-F)/c,O=F===0?I:I+1,x=b.createImageData(_,c);let o=0,m;const S=p.data,T=x.data;let D,$,B,G;if(p.kind===i.ImageKind.GRAYSCALE_1BPP){const lt=S.byteLength,V=new Uint32Array(T.buffer,0,T.byteLength>>2),X=V.length,K=_+7>>3,Y=4294967295,et=i.FeatureTest.isLittleEndian?4278190080:255;for(D=0;D<O;D++){for(B=D<I?c:F,m=0,$=0;$<B;$++){const gt=lt-o;let wt=0;const Tt=gt>K?_:gt*8-7,$t=Tt&-8;let zt=0,Jt=0;for(;wt<$t;wt+=8)Jt=S[o++],V[m++]=Jt&128?Y:et,V[m++]=Jt&64?Y:et,V[m++]=Jt&32?Y:et,V[m++]=Jt&16?Y:et,V[m++]=Jt&8?Y:et,V[m++]=Jt&4?Y:et,V[m++]=Jt&2?Y:et,V[m++]=Jt&1?Y:et;for(;wt<Tt;wt++)zt===0&&(Jt=S[o++],zt=128),V[m++]=Jt&zt?Y:et,zt>>=1}for(;m<X;)V[m++]=0;b.putImageData(x,0,D*c)}}else if(p.kind===i.ImageKind.RGBA_32BPP){for($=0,G=_*c*4,D=0;D<I;D++)T.set(S.subarray(o,o+G)),o+=G,b.putImageData(x,0,$),$+=c;D<O&&(G=_*F*4,T.set(S.subarray(o,o+G)),b.putImageData(x,0,$))}else if(p.kind===i.ImageKind.RGB_24BPP)for(B=c,G=_*B,D=0;D<O;D++){for(D>=I&&(B=F,G=_*B),m=0,$=G;$--;)T[m++]=S[o++],T[m++]=S[o++],T[m++]=S[o++],T[m++]=255;b.putImageData(x,0,D*c)}else throw new Error(`bad image kind: ${p.kind}`)}function k(b,p){if(p.bitmap){b.drawImage(p.bitmap,0,0);return}const u=p.height,_=p.width,F=u%c,I=(u-F)/c,O=F===0?I:I+1,x=b.createImageData(_,c);let o=0;const m=p.data,S=x.data;for(let T=0;T<O;T++){const D=T<I?c:F;({srcPos:o}=(0,A.convertBlackAndWhiteToRGBA)({src:m,srcPos:o,dest:S,width:_,height:D,nonBlackColor:0})),b.putImageData(x,0,T*c)}}function g(b,p){const u=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const _ of u)b[_]!==void 0&&(p[_]=b[_]);b.setLineDash!==void 0&&(p.setLineDash(b.getLineDash()),p.lineDashOffset=b.lineDashOffset)}function P(b){if(b.strokeStyle=b.fillStyle="#000000",b.fillRule="nonzero",b.globalAlpha=1,b.lineWidth=1,b.lineCap="butt",b.lineJoin="miter",b.miterLimit=10,b.globalCompositeOperation="source-over",b.font="10px sans-serif",b.setLineDash!==void 0&&(b.setLineDash([]),b.lineDashOffset=0),!i.isNodeJS){const{filter:p}=b;p!=="none"&&p!==""&&(b.filter="none")}}function U(b,p,u,_){const F=b.length;for(let I=3;I<F;I+=4){const O=b[I];if(O===0)b[I-3]=p,b[I-2]=u,b[I-1]=_;else if(O<255){const x=255-O;b[I-3]=b[I-3]*O+p*x>>8,b[I-2]=b[I-2]*O+u*x>>8,b[I-1]=b[I-1]*O+_*x>>8}}}function z(b,p,u){const _=b.length,F=1/255;for(let I=3;I<_;I+=4){const O=u?u[b[I]]:b[I];p[I]=p[I]*O*F|0}}function N(b,p,u){const _=b.length;for(let F=3;F<_;F+=4){const I=b[F-3]*77+b[F-2]*152+b[F-1]*28;p[F]=u?p[F]*u[I>>8]>>8:p[F]*I>>16}}function j(b,p,u,_,F,I,O,x,o,m,S){const T=!!I,D=T?I[0]:0,$=T?I[1]:0,B=T?I[2]:0,G=F==="Luminosity"?N:z,V=Math.min(_,Math.ceil(1048576/u));for(let X=0;X<_;X+=V){const K=Math.min(V,_-X),Y=b.getImageData(x-m,X+(o-S),u,K),et=p.getImageData(x,X+o,u,K);T&&U(Y.data,D,$,B),G(Y.data,et.data,O),p.putImageData(et,x,X+o)}}function W(b,p,u,_){const F=_[0],I=_[1],O=_[2]-F,x=_[3]-I;O===0||x===0||(j(p.context,u,O,x,p.subtype,p.backdrop,p.transferMap,F,I,p.offsetX,p.offsetY),b.save(),b.globalAlpha=1,b.globalCompositeOperation="source-over",b.setTransform(1,0,0,1,0,0),b.drawImage(u.canvas,0,0),b.restore())}function at(b,p){const u=i.Util.singularValueDecompose2dScale(b);u[0]=Math.fround(u[0]),u[1]=Math.fround(u[1]);const _=Math.fround((globalThis.devicePixelRatio||1)*d.PixelsPerInch.PDF_TO_CSS_UNITS);return p!==void 0?p:u[0]<=_||u[1]<=_}const tt=["butt","round","square"],it=["miter","round","bevel"],ut={},J={};class L{constructor(p,u,_,F,I,{optionalContentConfig:O,markedContentStack:x=null},o,m){this.ctx=p,this.current=new v(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=u,this.objs=_,this.canvasFactory=F,this.filterFactory=I,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=x||[],this.optionalContentConfig=O,this.cachedCanvases=new h(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=o,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=m,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(p,u=null){return typeof p=="string"?p.startsWith("g_")?this.commonObjs.get(p):this.objs.get(p):u}beginDrawing({transform:p,viewport:u,transparency:_=!1,background:F=null}){const I=this.ctx.canvas.width,O=this.ctx.canvas.height,x=this.ctx.fillStyle;if(this.ctx.fillStyle=F||"#ffffff",this.ctx.fillRect(0,0,I,O),this.ctx.fillStyle=x,_){const o=this.cachedCanvases.getCanvas("transparent",I,O);this.compositeCtx=this.ctx,this.transparentCanvas=o.canvas,this.ctx=o.context,this.ctx.save(),this.ctx.transform(...(0,d.getCurrentTransform)(this.compositeCtx))}this.ctx.save(),P(this.ctx),p&&(this.ctx.transform(...p),this.outputScaleX=p[0],this.outputScaleY=p[0]),this.ctx.transform(...u.transform),this.viewportScale=u.scale,this.baseTransform=(0,d.getCurrentTransform)(this.ctx)}executeOperatorList(p,u,_,F){const I=p.argsArray,O=p.fnArray;let x=u||0;const o=I.length;if(o===x)return x;const m=o-x>r&&typeof _=="function",S=m?Date.now()+t:0;let T=0;const D=this.commonObjs,$=this.objs;let B;for(;;){if(F!==void 0&&x===F.nextBreakPoint)return F.breakIt(x,_),x;if(B=O[x],B!==i.OPS.dependency)this[B].apply(this,I[x]);else for(const G of I[x]){const lt=G.startsWith("g_")?D:$;if(!lt.has(G))return lt.get(G,_),x}if(x++,x===o)return x;if(m&&++T>r){if(Date.now()>S)return _(),x;T=0}}}#t(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)}endDrawing(){this.#t(),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const p of this._cachedBitmapsMap.values()){for(const u of p.values())typeof HTMLCanvasElement<"u"&&u instanceof HTMLCanvasElement&&(u.width=u.height=0);p.clear()}this._cachedBitmapsMap.clear(),this.#e()}#e(){if(this.pageColors){const p=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(p!=="none"){const u=this.ctx.filter;this.ctx.filter=p,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=u}}}_scaleImage(p,u){const _=p.width,F=p.height;let I=Math.max(Math.hypot(u[0],u[1]),1),O=Math.max(Math.hypot(u[2],u[3]),1),x=_,o=F,m="prescale1",S,T;for(;I>2&&x>1||O>2&&o>1;){let D=x,$=o;I>2&&x>1&&(D=x>=16384?Math.floor(x/2)-1||1:Math.ceil(x/2),I/=x/D),O>2&&o>1&&($=o>=16384?Math.floor(o/2)-1||1:Math.ceil(o)/2,O/=o/$),S=this.cachedCanvases.getCanvas(m,D,$),T=S.context,T.clearRect(0,0,D,$),T.drawImage(p,0,0,x,o,0,0,D,$),p=S.canvas,x=D,o=$,m=m==="prescale1"?"prescale2":"prescale1"}return{img:p,paintWidth:x,paintHeight:o}}_createMaskCanvas(p){const u=this.ctx,{width:_,height:F}=p,I=this.current.fillColor,O=this.current.patternFill,x=(0,d.getCurrentTransform)(u);let o,m,S,T;if((p.bitmap||p.data)&&p.count>1){const wt=p.bitmap||p.data.buffer;m=JSON.stringify(O?x:[x.slice(0,4),I]),o=this._cachedBitmapsMap.get(wt),o||(o=new Map,this._cachedBitmapsMap.set(wt,o));const Tt=o.get(m);if(Tt&&!O){const $t=Math.round(Math.min(x[0],x[2])+x[4]),zt=Math.round(Math.min(x[1],x[3])+x[5]);return{canvas:Tt,offsetX:$t,offsetY:zt}}S=Tt}S||(T=this.cachedCanvases.getCanvas("maskCanvas",_,F),k(T.context,p));let D=i.Util.transform(x,[1/_,0,0,-1/F,0,0]);D=i.Util.transform(D,[1,0,0,1,0,-F]);const $=i.Util.applyTransform([0,0],D),B=i.Util.applyTransform([_,F],D),G=i.Util.normalizeRect([$[0],$[1],B[0],B[1]]),lt=Math.round(G[2]-G[0])||1,V=Math.round(G[3]-G[1])||1,X=this.cachedCanvases.getCanvas("fillCanvas",lt,V),K=X.context,Y=Math.min($[0],B[0]),et=Math.min($[1],B[1]);K.translate(-Y,-et),K.transform(...D),S||(S=this._scaleImage(T.canvas,(0,d.getCurrentTransformInverse)(K)),S=S.img,o&&O&&o.set(m,S)),K.imageSmoothingEnabled=at((0,d.getCurrentTransform)(K),p.interpolate),f(K,S,0,0,S.width,S.height,0,0,_,F),K.globalCompositeOperation="source-in";const gt=i.Util.transform((0,d.getCurrentTransformInverse)(K),[1,0,0,1,-Y,-et]);return K.fillStyle=O?I.getPattern(u,this,gt,C.PathType.FILL):I,K.fillRect(0,0,_,F),o&&!O&&(this.cachedCanvases.delete("fillCanvas"),o.set(m,X.canvas)),{canvas:X.canvas,offsetX:Math.round(Y),offsetY:Math.round(et)}}setLineWidth(p){p!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=p,this.ctx.lineWidth=p}setLineCap(p){this.ctx.lineCap=tt[p]}setLineJoin(p){this.ctx.lineJoin=it[p]}setMiterLimit(p){this.ctx.miterLimit=p}setDash(p,u){const _=this.ctx;_.setLineDash!==void 0&&(_.setLineDash(p),_.lineDashOffset=u)}setRenderingIntent(p){}setFlatness(p){}setGState(p){for(const[u,_]of p)switch(u){case"LW":this.setLineWidth(_);break;case"LC":this.setLineCap(_);break;case"LJ":this.setLineJoin(_);break;case"ML":this.setMiterLimit(_);break;case"D":this.setDash(_[0],_[1]);break;case"RI":this.setRenderingIntent(_);break;case"FL":this.setFlatness(_);break;case"Font":this.setFont(_[0],_[1]);break;case"CA":this.current.strokeAlpha=_;break;case"ca":this.current.fillAlpha=_,this.ctx.globalAlpha=_;break;case"BM":this.ctx.globalCompositeOperation=_;break;case"SMask":this.current.activeSMask=_?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(_);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const p=this.inSMaskMode;this.current.activeSMask&&!p?this.beginSMaskMode():!this.current.activeSMask&&p&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const p=this.ctx.canvas.width,u=this.ctx.canvas.height,_="smaskGroupAt"+this.groupLevel,F=this.cachedCanvases.getCanvas(_,p,u);this.suspendedCtx=this.ctx,this.ctx=F.context;const I=this.ctx;I.setTransform(...(0,d.getCurrentTransform)(this.suspendedCtx)),g(this.suspendedCtx,I),e(I,this.suspendedCtx),this.setGState([["BM","source-over"],["ca",1],["CA",1]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),g(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(p){if(!this.current.activeSMask)return;p?(p[0]=Math.floor(p[0]),p[1]=Math.floor(p[1]),p[2]=Math.ceil(p[2]),p[3]=Math.ceil(p[3])):p=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const u=this.current.activeSMask,_=this.suspendedCtx;W(_,u,this.ctx,p),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}save(){this.inSMaskMode?(g(this.ctx,this.suspendedCtx),this.suspendedCtx.save()):this.ctx.save();const p=this.current;this.stateStack.push(p),this.current=p.clone()}restore(){this.stateStack.length===0&&this.inSMaskMode&&this.endSMaskMode(),this.stateStack.length!==0&&(this.current=this.stateStack.pop(),this.inSMaskMode?(this.suspendedCtx.restore(),g(this.suspendedCtx,this.ctx)):this.ctx.restore(),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null)}transform(p,u,_,F,I,O){this.ctx.transform(p,u,_,F,I,O),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(p,u,_){const F=this.ctx,I=this.current;let O=I.x,x=I.y,o,m;const S=(0,d.getCurrentTransform)(F),T=S[0]===0&&S[3]===0||S[1]===0&&S[2]===0,D=T?_.slice(0):null;for(let $=0,B=0,G=p.length;$<G;$++)switch(p[$]|0){case i.OPS.rectangle:O=u[B++],x=u[B++];const lt=u[B++],V=u[B++],X=O+lt,K=x+V;F.moveTo(O,x),lt===0||V===0?F.lineTo(X,K):(F.lineTo(X,x),F.lineTo(X,K),F.lineTo(O,K)),T||I.updateRectMinMax(S,[O,x,X,K]),F.closePath();break;case i.OPS.moveTo:O=u[B++],x=u[B++],F.moveTo(O,x),T||I.updatePathMinMax(S,O,x);break;case i.OPS.lineTo:O=u[B++],x=u[B++],F.lineTo(O,x),T||I.updatePathMinMax(S,O,x);break;case i.OPS.curveTo:o=O,m=x,O=u[B+4],x=u[B+5],F.bezierCurveTo(u[B],u[B+1],u[B+2],u[B+3],O,x),I.updateCurvePathMinMax(S,o,m,u[B],u[B+1],u[B+2],u[B+3],O,x,D),B+=6;break;case i.OPS.curveTo2:o=O,m=x,F.bezierCurveTo(O,x,u[B],u[B+1],u[B+2],u[B+3]),I.updateCurvePathMinMax(S,o,m,O,x,u[B],u[B+1],u[B+2],u[B+3],D),O=u[B+2],x=u[B+3],B+=4;break;case i.OPS.curveTo3:o=O,m=x,O=u[B+2],x=u[B+3],F.bezierCurveTo(u[B],u[B+1],O,x,O,x),I.updateCurvePathMinMax(S,o,m,u[B],u[B+1],O,x,O,x,D),B+=4;break;case i.OPS.closePath:F.closePath();break}T&&I.updateScalingPathMinMax(S,D),I.setCurrentPoint(O,x)}closePath(){this.ctx.closePath()}stroke(p=!0){const u=this.ctx,_=this.current.strokeColor;u.globalAlpha=this.current.strokeAlpha,this.contentVisible&&(typeof _=="object"&&_?.getPattern?(u.save(),u.strokeStyle=_.getPattern(u,this,(0,d.getCurrentTransformInverse)(u),C.PathType.STROKE),this.rescaleAndStroke(!1),u.restore()):this.rescaleAndStroke(!0)),p&&this.consumePath(this.current.getClippedPathBoundingBox()),u.globalAlpha=this.current.fillAlpha}closeStroke(){this.closePath(),this.stroke()}fill(p=!0){const u=this.ctx,_=this.current.fillColor,F=this.current.patternFill;let I=!1;F&&(u.save(),u.fillStyle=_.getPattern(u,this,(0,d.getCurrentTransformInverse)(u),C.PathType.FILL),I=!0);const O=this.current.getClippedPathBoundingBox();this.contentVisible&&O!==null&&(this.pendingEOFill?(u.fill("evenodd"),this.pendingEOFill=!1):u.fill()),I&&u.restore(),p&&this.consumePath(O)}eoFill(){this.pendingEOFill=!0,this.fill()}fillStroke(){this.fill(!1),this.stroke(!1),this.consumePath()}eoFillStroke(){this.pendingEOFill=!0,this.fillStroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=ut}eoClip(){this.pendingClip=J}beginText(){this.current.textMatrix=i.IDENTITY_MATRIX,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){const p=this.pendingTextPaths,u=this.ctx;if(p===void 0){u.beginPath();return}u.save(),u.beginPath();for(const _ of p)u.setTransform(..._.transform),u.translate(_.x,_.y),_.addToPath(u,_.fontSize);u.restore(),u.clip(),u.beginPath(),delete this.pendingTextPaths}setCharSpacing(p){this.current.charSpacing=p}setWordSpacing(p){this.current.wordSpacing=p}setHScale(p){this.current.textHScale=p/100}setLeading(p){this.current.leading=-p}setFont(p,u){const _=this.commonObjs.get(p),F=this.current;if(!_)throw new Error(`Can't find font for ${p}`);if(F.fontMatrix=_.fontMatrix||i.FONT_IDENTITY_MATRIX,(F.fontMatrix[0]===0||F.fontMatrix[3]===0)&&(0,i.warn)("Invalid font matrix for font "+p),u<0?(u=-u,F.fontDirection=-1):F.fontDirection=1,this.current.font=_,this.current.fontSize=u,_.isType3Font)return;const I=_.loadedName||"sans-serif",O=_.systemFontInfo?.css||`"${I}", ${_.fallbackName}`;let x="normal";_.black?x="900":_.bold&&(x="bold");const o=_.italic?"italic":"normal";let m=u;u<M?m=M:u>w&&(m=w),this.current.fontSizeScale=u/m,this.ctx.font=`${o} ${x} ${m}px ${O}`}setTextRenderingMode(p){this.current.textRenderingMode=p}setTextRise(p){this.current.textRise=p}moveText(p,u){this.current.x=this.current.lineX+=p,this.current.y=this.current.lineY+=u}setLeadingMoveText(p,u){this.setLeading(-u),this.moveText(p,u)}setTextMatrix(p,u,_,F,I,O){this.current.textMatrix=[p,u,_,F,I,O],this.current.textMatrixScale=Math.hypot(p,u),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(p,u,_,F){const I=this.ctx,O=this.current,x=O.font,o=O.textRenderingMode,m=O.fontSize/O.fontSizeScale,S=o&i.TextRenderingMode.FILL_STROKE_MASK,T=!!(o&i.TextRenderingMode.ADD_TO_PATH_FLAG),D=O.patternFill&&!x.missingFile;let $;(x.disableFontFace||T||D)&&($=x.getPathGenerator(this.commonObjs,p)),x.disableFontFace||D?(I.save(),I.translate(u,_),I.beginPath(),$(I,m),F&&I.setTransform(...F),(S===i.TextRenderingMode.FILL||S===i.TextRenderingMode.FILL_STROKE)&&I.fill(),(S===i.TextRenderingMode.STROKE||S===i.TextRenderingMode.FILL_STROKE)&&I.stroke(),I.restore()):((S===i.TextRenderingMode.FILL||S===i.TextRenderingMode.FILL_STROKE)&&I.fillText(p,u,_),(S===i.TextRenderingMode.STROKE||S===i.TextRenderingMode.FILL_STROKE)&&I.strokeText(p,u,_)),T&&(this.pendingTextPaths||=[]).push({transform:(0,d.getCurrentTransform)(I),x:u,y:_,fontSize:m,addToPath:$})}get isFontSubpixelAAEnabled(){const{context:p}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);p.scale(1.5,1),p.fillText("I",0,10);const u=p.getImageData(0,0,10,10).data;let _=!1;for(let F=3;F<u.length;F+=4)if(u[F]>0&&u[F]<255){_=!0;break}return(0,i.shadow)(this,"isFontSubpixelAAEnabled",_)}showText(p){const u=this.current,_=u.font;if(_.isType3Font)return this.showType3Text(p);const F=u.fontSize;if(F===0)return;const I=this.ctx,O=u.fontSizeScale,x=u.charSpacing,o=u.wordSpacing,m=u.fontDirection,S=u.textHScale*m,T=p.length,D=_.vertical,$=D?1:-1,B=_.defaultVMetrics,G=F*u.fontMatrix[0],lt=u.textRenderingMode===i.TextRenderingMode.FILL&&!_.disableFontFace&&!u.patternFill;I.save(),I.transform(...u.textMatrix),I.translate(u.x,u.y+u.textRise),m>0?I.scale(S,-1):I.scale(S,1);let V;if(u.patternFill){I.save();const gt=u.fillColor.getPattern(I,this,(0,d.getCurrentTransformInverse)(I),C.PathType.FILL);V=(0,d.getCurrentTransform)(I),I.restore(),I.fillStyle=gt}let X=u.lineWidth;const K=u.textMatrixScale;if(K===0||X===0){const gt=u.textRenderingMode&i.TextRenderingMode.FILL_STROKE_MASK;(gt===i.TextRenderingMode.STROKE||gt===i.TextRenderingMode.FILL_STROKE)&&(X=this.getSinglePixelWidth())}else X/=K;if(O!==1&&(I.scale(O,O),X/=O),I.lineWidth=X,_.isInvalidPDFjsFont){const gt=[];let wt=0;for(const Tt of p)gt.push(Tt.unicode),wt+=Tt.width;I.fillText(gt.join(""),0,0),u.x+=wt*G*S,I.restore(),this.compose();return}let Y=0,et;for(et=0;et<T;++et){const gt=p[et];if(typeof gt=="number"){Y+=$*gt*F/1e3;continue}let wt=!1;const Tt=(gt.isSpace?o:0)+x,$t=gt.fontChar,zt=gt.accent;let Jt,Se,Pe=gt.width;if(D){const me=gt.vmetric||B,ye=-(gt.vmetric?me[1]:Pe*.5)*G,Re=me[2]*G;Pe=me?-me[0]:Pe,Jt=ye/O,Se=(Y+Re)/O}else Jt=Y/O,Se=0;if(_.remeasure&&Pe>0){const me=I.measureText($t).width*1e3/F*O;if(Pe<me&&this.isFontSubpixelAAEnabled){const ye=Pe/me;wt=!0,I.save(),I.scale(ye,1),Jt/=ye}else Pe!==me&&(Jt+=(Pe-me)/2e3*F/O)}if(this.contentVisible&&(gt.isInFont||_.missingFile)){if(lt&&!zt)I.fillText($t,Jt,Se);else if(this.paintChar($t,Jt,Se,V),zt){const me=Jt+F*zt.offset.x/O,ye=Se-F*zt.offset.y/O;this.paintChar(zt.fontChar,me,ye,V)}}const Ae=D?Pe*G-Tt*m:Pe*G+Tt*m;Y+=Ae,wt&&I.restore()}D?u.y-=Y:u.x+=Y*S,I.restore(),this.compose()}showType3Text(p){const u=this.ctx,_=this.current,F=_.font,I=_.fontSize,O=_.fontDirection,x=F.vertical?1:-1,o=_.charSpacing,m=_.wordSpacing,S=_.textHScale*O,T=_.fontMatrix||i.FONT_IDENTITY_MATRIX,D=p.length,$=_.textRenderingMode===i.TextRenderingMode.INVISIBLE;let B,G,lt,V;if(!($||I===0)){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,u.save(),u.transform(..._.textMatrix),u.translate(_.x,_.y),u.scale(S,O),B=0;B<D;++B){if(G=p[B],typeof G=="number"){V=x*G*I/1e3,this.ctx.translate(V,0),_.x+=V*S;continue}const X=(G.isSpace?m:0)+o,K=F.charProcOperatorList[G.operatorListId];if(!K){(0,i.warn)(`Type3 character "${G.operatorListId}" is not available.`);continue}this.contentVisible&&(this.processingType3=G,this.save(),u.scale(I,I),u.transform(...T),this.executeOperatorList(K),this.restore()),lt=i.Util.applyTransform([G.width,0],T)[0]*I+X,u.translate(lt,0),_.x+=lt*S}u.restore(),this.processingType3=null}}setCharWidth(p,u){}setCharWidthAndBounds(p,u,_,F,I,O){this.ctx.rect(_,F,I-_,O-F),this.ctx.clip(),this.endPath()}getColorN_Pattern(p){let u;if(p[0]==="TilingPattern"){const _=p[1],F=this.baseTransform||(0,d.getCurrentTransform)(this.ctx),I={createCanvasGraphics:O=>new L(O,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};u=new C.TilingPattern(p,_,this.ctx,I,F)}else u=this._getPattern(p[1],p[2]);return u}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments)}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(p,u,_){const F=i.Util.makeHexColor(p,u,_);this.ctx.strokeStyle=F,this.current.strokeColor=F}setFillRGBColor(p,u,_){const F=i.Util.makeHexColor(p,u,_);this.ctx.fillStyle=F,this.current.fillColor=F,this.current.patternFill=!1}_getPattern(p,u=null){let _;return this.cachedPatterns.has(p)?_=this.cachedPatterns.get(p):(_=(0,C.getShadingPattern)(this.getObject(p)),this.cachedPatterns.set(p,_)),u&&(_.matrix=u),_}shadingFill(p){if(!this.contentVisible)return;const u=this.ctx;this.save();const _=this._getPattern(p);u.fillStyle=_.getPattern(u,this,(0,d.getCurrentTransformInverse)(u),C.PathType.SHADING);const F=(0,d.getCurrentTransformInverse)(u);if(F){const{width:I,height:O}=u.canvas,[x,o,m,S]=i.Util.getAxialAlignedBoundingBox([0,0,I,O],F);this.ctx.fillRect(x,o,m-x,S-o)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){(0,i.unreachable)("Should not call beginInlineImage")}beginImageData(){(0,i.unreachable)("Should not call beginImageData")}paintFormXObjectBegin(p,u){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),Array.isArray(p)&&p.length===6&&this.transform(...p),this.baseTransform=(0,d.getCurrentTransform)(this.ctx),u)){const _=u[2]-u[0],F=u[3]-u[1];this.ctx.rect(u[0],u[1],_,F),this.current.updateRectMinMax((0,d.getCurrentTransform)(this.ctx),u),this.clip(),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(p){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const u=this.ctx;p.isolated||(0,i.info)("TODO: Support non-isolated groups."),p.knockout&&(0,i.warn)("Knockout groups not supported.");const _=(0,d.getCurrentTransform)(u);if(p.matrix&&u.transform(...p.matrix),!p.bbox)throw new Error("Bounding box is required.");let F=i.Util.getAxialAlignedBoundingBox(p.bbox,(0,d.getCurrentTransform)(u));const I=[0,0,u.canvas.width,u.canvas.height];F=i.Util.intersect(F,I)||[0,0,0,0];const O=Math.floor(F[0]),x=Math.floor(F[1]);let o=Math.max(Math.ceil(F[2])-O,1),m=Math.max(Math.ceil(F[3])-x,1),S=1,T=1;o>n&&(S=o/n,o=n),m>n&&(T=m/n,m=n),this.current.startNewPathAndClipBox([0,0,o,m]);let D="groupAt"+this.groupLevel;p.smask&&(D+="_smask_"+this.smaskCounter++%2);const $=this.cachedCanvases.getCanvas(D,o,m),B=$.context;B.scale(1/S,1/T),B.translate(-O,-x),B.transform(..._),p.smask?this.smaskStack.push({canvas:$.canvas,context:B,offsetX:O,offsetY:x,scaleX:S,scaleY:T,subtype:p.smask.subtype,backdrop:p.smask.backdrop,transferMap:p.smask.transferMap||null,startTransformInverse:null}):(u.setTransform(1,0,0,1,0,0),u.translate(O,x),u.scale(S,T),u.save()),g(u,B),this.ctx=B,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(u),this.groupLevel++}endGroup(p){if(!this.contentVisible)return;this.groupLevel--;const u=this.ctx,_=this.groupStack.pop();if(this.ctx=_,this.ctx.imageSmoothingEnabled=!1,p.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();const F=(0,d.getCurrentTransform)(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...F);const I=i.Util.getAxialAlignedBoundingBox([0,0,u.canvas.width,u.canvas.height],F);this.ctx.drawImage(u.canvas,0,0),this.ctx.restore(),this.compose(I)}}beginAnnotation(p,u,_,F,I){if(this.#t(),P(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),Array.isArray(u)&&u.length===4){const O=u[2]-u[0],x=u[3]-u[1];if(I&&this.annotationCanvasMap){_=_.slice(),_[4]-=u[0],_[5]-=u[1],u=u.slice(),u[0]=u[1]=0,u[2]=O,u[3]=x;const[o,m]=i.Util.singularValueDecompose2dScale((0,d.getCurrentTransform)(this.ctx)),{viewportScale:S}=this,T=Math.ceil(O*this.outputScaleX*S),D=Math.ceil(x*this.outputScaleY*S);this.annotationCanvas=this.canvasFactory.create(T,D);const{canvas:$,context:B}=this.annotationCanvas;this.annotationCanvasMap.set(p,$),this.annotationCanvas.savedCtx=this.ctx,this.ctx=B,this.ctx.save(),this.ctx.setTransform(o,0,0,-m,0,x*m),P(this.ctx)}else P(this.ctx),this.ctx.rect(u[0],u[1],O,x),this.ctx.clip(),this.endPath()}this.current=new v(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(..._),this.transform(...F)}endAnnotation(){this.annotationCanvas&&(this.ctx.restore(),this.#e(),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(p){if(!this.contentVisible)return;const u=p.count;p=this.getObject(p.data,p),p.count=u;const _=this.ctx,F=this.processingType3;if(F&&(F.compiled===void 0&&(F.compiled=a(p)),F.compiled)){F.compiled(_);return}const I=this._createMaskCanvas(p),O=I.canvas;_.save(),_.setTransform(1,0,0,1,0,0),_.drawImage(O,I.offsetX,I.offsetY),_.restore(),this.compose()}paintImageMaskXObjectRepeat(p,u,_=0,F=0,I,O){if(!this.contentVisible)return;p=this.getObject(p.data,p);const x=this.ctx;x.save();const o=(0,d.getCurrentTransform)(x);x.transform(u,_,F,I,0,0);const m=this._createMaskCanvas(p);x.setTransform(1,0,0,1,m.offsetX-o[4],m.offsetY-o[5]);for(let S=0,T=O.length;S<T;S+=2){const D=i.Util.transform(o,[u,_,F,I,O[S],O[S+1]]),[$,B]=i.Util.applyTransform([0,0],D);x.drawImage(m.canvas,$,B)}x.restore(),this.compose()}paintImageMaskXObjectGroup(p){if(!this.contentVisible)return;const u=this.ctx,_=this.current.fillColor,F=this.current.patternFill;for(const I of p){const{data:O,width:x,height:o,transform:m}=I,S=this.cachedCanvases.getCanvas("maskCanvas",x,o),T=S.context;T.save();const D=this.getObject(O,I);k(T,D),T.globalCompositeOperation="source-in",T.fillStyle=F?_.getPattern(T,this,(0,d.getCurrentTransformInverse)(u),C.PathType.FILL):_,T.fillRect(0,0,x,o),T.restore(),u.save(),u.transform(...m),u.scale(1,-1),f(u,S.canvas,0,0,x,o,0,-1,1,1),u.restore()}this.compose()}paintImageXObject(p){if(!this.contentVisible)return;const u=this.getObject(p);if(!u){(0,i.warn)("Dependent image isn't ready yet");return}this.paintInlineImageXObject(u)}paintImageXObjectRepeat(p,u,_,F){if(!this.contentVisible)return;const I=this.getObject(p);if(!I){(0,i.warn)("Dependent image isn't ready yet");return}const O=I.width,x=I.height,o=[];for(let m=0,S=F.length;m<S;m+=2)o.push({transform:[u,0,0,_,F[m],F[m+1]],x:0,y:0,w:O,h:x});this.paintInlineImageXObjectGroup(I,o)}applyTransferMapsToCanvas(p){return this.current.transferMaps!=="none"&&(p.filter=this.current.transferMaps,p.drawImage(p.canvas,0,0),p.filter="none"),p.canvas}applyTransferMapsToBitmap(p){if(this.current.transferMaps==="none")return p.bitmap;const{bitmap:u,width:_,height:F}=p,I=this.cachedCanvases.getCanvas("inlineImage",_,F),O=I.context;return O.filter=this.current.transferMaps,O.drawImage(u,0,0),O.filter="none",I.canvas}paintInlineImageXObject(p){if(!this.contentVisible)return;const u=p.width,_=p.height,F=this.ctx;if(this.save(),!i.isNodeJS){const{filter:x}=F;x!=="none"&&x!==""&&(F.filter="none")}F.scale(1/u,-1/_);let I;if(p.bitmap)I=this.applyTransferMapsToBitmap(p);else if(typeof HTMLElement=="function"&&p instanceof HTMLElement||!p.data)I=p;else{const o=this.cachedCanvases.getCanvas("inlineImage",u,_).context;R(o,p),I=this.applyTransferMapsToCanvas(o)}const O=this._scaleImage(I,(0,d.getCurrentTransformInverse)(F));F.imageSmoothingEnabled=at((0,d.getCurrentTransform)(F),p.interpolate),f(F,O.img,0,0,O.paintWidth,O.paintHeight,0,-_,u,_),this.compose(),this.restore()}paintInlineImageXObjectGroup(p,u){if(!this.contentVisible)return;const _=this.ctx;let F;if(p.bitmap)F=p.bitmap;else{const I=p.width,O=p.height,o=this.cachedCanvases.getCanvas("inlineImage",I,O).context;R(o,p),F=this.applyTransferMapsToCanvas(o)}for(const I of u)_.save(),_.transform(...I.transform),_.scale(1,-1),f(_,F,I.x,I.y,I.w,I.h,0,-1,1,1),_.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(p){}markPointProps(p,u){}beginMarkedContent(p){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(p,u){p==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(u)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(p){const u=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(p);const _=this.ctx;this.pendingClip&&(u||(this.pendingClip===J?_.clip("evenodd"):_.clip()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),_.beginPath()}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const p=(0,d.getCurrentTransform)(this.ctx);if(p[1]===0&&p[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(p[0]),Math.abs(p[3]));else{const u=Math.abs(p[0]*p[3]-p[2]*p[1]),_=Math.hypot(p[0],p[2]),F=Math.hypot(p[1],p[3]);this._cachedGetSinglePixelWidth=Math.max(_,F)/u}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:p}=this.current,{a:u,b:_,c:F,d:I}=this.ctx.getTransform();let O,x;if(_===0&&F===0){const o=Math.abs(u),m=Math.abs(I);if(o===m)if(p===0)O=x=1/o;else{const S=o*p;O=x=S<1?1/S:1}else if(p===0)O=1/o,x=1/m;else{const S=o*p,T=m*p;O=S<1?1/S:1,x=T<1?1/T:1}}else{const o=Math.abs(u*I-_*F),m=Math.hypot(u,_),S=Math.hypot(F,I);if(p===0)O=S/o,x=m/o;else{const T=p*o;O=S>T?S/T:1,x=m>T?m/T:1}}this._cachedScaleForStroking[0]=O,this._cachedScaleForStroking[1]=x}return this._cachedScaleForStroking}rescaleAndStroke(p){const{ctx:u}=this,{lineWidth:_}=this.current,[F,I]=this.getScaleForStroking();if(u.lineWidth=_||1,F===1&&I===1){u.stroke();return}const O=u.getLineDash();if(p&&u.save(),u.scale(F,I),O.length>0){const x=Math.max(F,I);u.setLineDash(O.map(o=>o/x)),u.lineDashOffset/=x}u.stroke(),p&&u.restore()}isContentVisible(){for(let p=this.markedContentStack.length-1;p>=0;p--)if(!this.markedContentStack[p].visible)return!1;return!0}}s.CanvasGraphics=L;for(const b in i.OPS)L.prototype[b]!==void 0&&(L.prototype[i.OPS[b]]=L.prototype[b])},(E,s,y)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.TilingPattern=s.PathType=void 0,s.getShadingPattern=c;var i=y(1),d=y(6);const C={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};s.PathType=C;function A(f,a){if(!a)return;const v=a[2]-a[0],R=a[3]-a[1],k=new Path2D;k.rect(a[0],a[1],v,R),f.clip(k)}class M{constructor(){this.constructor===M&&(0,i.unreachable)("Cannot initialize BaseShadingPattern.")}getPattern(){(0,i.unreachable)("Abstract method `getPattern` called.")}}class w extends M{constructor(a){super(),this._type=a[1],this._bbox=a[2],this._colorStops=a[3],this._p0=a[4],this._p1=a[5],this._r0=a[6],this._r1=a[7],this.matrix=null}_createGradient(a){let v;this._type==="axial"?v=a.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(v=a.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const R of this._colorStops)v.addColorStop(R[0],R[1]);return v}getPattern(a,v,R,k){let g;if(k===C.STROKE||k===C.FILL){const P=v.current.getClippedPathBoundingBox(k,(0,d.getCurrentTransform)(a))||[0,0,0,0],U=Math.ceil(P[2]-P[0])||1,z=Math.ceil(P[3]-P[1])||1,N=v.cachedCanvases.getCanvas("pattern",U,z,!0),j=N.context;j.clearRect(0,0,j.canvas.width,j.canvas.height),j.beginPath(),j.rect(0,0,j.canvas.width,j.canvas.height),j.translate(-P[0],-P[1]),R=i.Util.transform(R,[1,0,0,1,P[0],P[1]]),j.transform(...v.baseTransform),this.matrix&&j.transform(...this.matrix),A(j,this._bbox),j.fillStyle=this._createGradient(j),j.fill(),g=a.createPattern(N.canvas,"no-repeat");const W=new DOMMatrix(R);g.setTransform(W)}else A(a,this._bbox),g=this._createGradient(a);return g}}function n(f,a,v,R,k,g,P,U){const z=a.coords,N=a.colors,j=f.data,W=f.width*4;let at;z[v+1]>z[R+1]&&(at=v,v=R,R=at,at=g,g=P,P=at),z[R+1]>z[k+1]&&(at=R,R=k,k=at,at=P,P=U,U=at),z[v+1]>z[R+1]&&(at=v,v=R,R=at,at=g,g=P,P=at);const tt=(z[v]+a.offsetX)*a.scaleX,it=(z[v+1]+a.offsetY)*a.scaleY,ut=(z[R]+a.offsetX)*a.scaleX,J=(z[R+1]+a.offsetY)*a.scaleY,L=(z[k]+a.offsetX)*a.scaleX,b=(z[k+1]+a.offsetY)*a.scaleY;if(it>=b)return;const p=N[g],u=N[g+1],_=N[g+2],F=N[P],I=N[P+1],O=N[P+2],x=N[U],o=N[U+1],m=N[U+2],S=Math.round(it),T=Math.round(b);let D,$,B,G,lt,V,X,K;for(let Y=S;Y<=T;Y++){if(Y<J){const $t=Y<it?0:(it-Y)/(it-J);D=tt-(tt-ut)*$t,$=p-(p-F)*$t,B=u-(u-I)*$t,G=_-(_-O)*$t}else{let $t;Y>b?$t=1:J===b?$t=0:$t=(J-Y)/(J-b),D=ut-(ut-L)*$t,$=F-(F-x)*$t,B=I-(I-o)*$t,G=O-(O-m)*$t}let et;Y<it?et=0:Y>b?et=1:et=(it-Y)/(it-b),lt=tt-(tt-L)*et,V=p-(p-x)*et,X=u-(u-o)*et,K=_-(_-m)*et;const gt=Math.round(Math.min(D,lt)),wt=Math.round(Math.max(D,lt));let Tt=W*Y+gt*4;for(let $t=gt;$t<=wt;$t++)et=(D-$t)/(D-lt),et<0?et=0:et>1&&(et=1),j[Tt++]=$-($-V)*et|0,j[Tt++]=B-(B-X)*et|0,j[Tt++]=G-(G-K)*et|0,j[Tt++]=255}}function t(f,a,v){const R=a.coords,k=a.colors;let g,P;switch(a.type){case"lattice":const U=a.verticesPerRow,z=Math.floor(R.length/U)-1,N=U-1;for(g=0;g<z;g++){let j=g*U;for(let W=0;W<N;W++,j++)n(f,v,R[j],R[j+1],R[j+U],k[j],k[j+1],k[j+U]),n(f,v,R[j+U+1],R[j+1],R[j+U],k[j+U+1],k[j+1],k[j+U])}break;case"triangles":for(g=0,P=R.length;g<P;g+=3)n(f,v,R[g],R[g+1],R[g+2],k[g],k[g+1],k[g+2]);break;default:throw new Error("illegal figure")}}class r extends M{constructor(a){super(),this._coords=a[2],this._colors=a[3],this._figures=a[4],this._bounds=a[5],this._bbox=a[7],this._background=a[8],this.matrix=null}_createMeshCanvas(a,v,R){const U=Math.floor(this._bounds[0]),z=Math.floor(this._bounds[1]),N=Math.ceil(this._bounds[2])-U,j=Math.ceil(this._bounds[3])-z,W=Math.min(Math.ceil(Math.abs(N*a[0]*1.1)),3e3),at=Math.min(Math.ceil(Math.abs(j*a[1]*1.1)),3e3),tt=N/W,it=j/at,ut={coords:this._coords,colors:this._colors,offsetX:-U,offsetY:-z,scaleX:1/tt,scaleY:1/it},J=W+2*2,L=at+2*2,b=R.getCanvas("mesh",J,L,!1),p=b.context,u=p.createImageData(W,at);if(v){const F=u.data;for(let I=0,O=F.length;I<O;I+=4)F[I]=v[0],F[I+1]=v[1],F[I+2]=v[2],F[I+3]=255}for(const F of this._figures)t(u,F,ut);return p.putImageData(u,2,2),{canvas:b.canvas,offsetX:U-2*tt,offsetY:z-2*it,scaleX:tt,scaleY:it}}getPattern(a,v,R,k){A(a,this._bbox);let g;if(k===C.SHADING)g=i.Util.singularValueDecompose2dScale((0,d.getCurrentTransform)(a));else if(g=i.Util.singularValueDecompose2dScale(v.baseTransform),this.matrix){const U=i.Util.singularValueDecompose2dScale(this.matrix);g=[g[0]*U[0],g[1]*U[1]]}const P=this._createMeshCanvas(g,k===C.SHADING?null:this._background,v.cachedCanvases);return k!==C.SHADING&&(a.setTransform(...v.baseTransform),this.matrix&&a.transform(...this.matrix)),a.translate(P.offsetX,P.offsetY),a.scale(P.scaleX,P.scaleY),a.createPattern(P.canvas,"no-repeat")}}class l extends M{getPattern(){return"hotpink"}}function c(f){switch(f[0]){case"RadialAxial":return new w(f);case"Mesh":return new r(f);case"Dummy":return new l}throw new Error(`Unknown IR type: ${f[0]}`)}const e={COLORED:1,UNCOLORED:2};class h{static MAX_PATTERN_SIZE=3e3;constructor(a,v,R,k,g){this.operatorList=a[2],this.matrix=a[3]||[1,0,0,1,0,0],this.bbox=a[4],this.xstep=a[5],this.ystep=a[6],this.paintType=a[7],this.tilingType=a[8],this.color=v,this.ctx=R,this.canvasGraphicsFactory=k,this.baseTransform=g}createPatternCanvas(a){const v=this.operatorList,R=this.bbox,k=this.xstep,g=this.ystep,P=this.paintType,U=this.tilingType,z=this.color,N=this.canvasGraphicsFactory;(0,i.info)("TilingType: "+U);const j=R[0],W=R[1],at=R[2],tt=R[3],it=i.Util.singularValueDecompose2dScale(this.matrix),ut=i.Util.singularValueDecompose2dScale(this.baseTransform),J=[it[0]*ut[0],it[1]*ut[1]],L=this.getSizeAndScale(k,this.ctx.canvas.width,J[0]),b=this.getSizeAndScale(g,this.ctx.canvas.height,J[1]),p=a.cachedCanvases.getCanvas("pattern",L.size,b.size,!0),u=p.context,_=N.createCanvasGraphics(u);_.groupLevel=a.groupLevel,this.setFillAndStrokeStyleToContext(_,P,z);let F=j,I=W,O=at,x=tt;return j<0&&(F=0,O+=Math.abs(j)),W<0&&(I=0,x+=Math.abs(W)),u.translate(-(L.scale*F),-(b.scale*I)),_.transform(L.scale,0,0,b.scale,0,0),u.save(),this.clipBbox(_,F,I,O,x),_.baseTransform=(0,d.getCurrentTransform)(_.ctx),_.executeOperatorList(v),_.endDrawing(),{canvas:p.canvas,scaleX:L.scale,scaleY:b.scale,offsetX:F,offsetY:I}}getSizeAndScale(a,v,R){a=Math.abs(a);const k=Math.max(h.MAX_PATTERN_SIZE,v);let g=Math.ceil(a*R);return g>=k?g=k:R=g/a,{scale:R,size:g}}clipBbox(a,v,R,k,g){const P=k-v,U=g-R;a.ctx.rect(v,R,P,U),a.current.updateRectMinMax((0,d.getCurrentTransform)(a.ctx),[v,R,k,g]),a.clip(),a.endPath()}setFillAndStrokeStyleToContext(a,v,R){const k=a.ctx,g=a.current;switch(v){case e.COLORED:const P=this.ctx;k.fillStyle=P.fillStyle,k.strokeStyle=P.strokeStyle,g.fillColor=P.fillStyle,g.strokeColor=P.strokeStyle;break;case e.UNCOLORED:const U=i.Util.makeHexColor(R[0],R[1],R[2]);k.fillStyle=U,k.strokeStyle=U,g.fillColor=U,g.strokeColor=U;break;default:throw new i.FormatError(`Unsupported paint type: ${v}`)}}getPattern(a,v,R,k){let g=R;k!==C.SHADING&&(g=i.Util.transform(g,v.baseTransform),this.matrix&&(g=i.Util.transform(g,this.matrix)));const P=this.createPatternCanvas(v);let U=new DOMMatrix(g);U=U.translate(P.offsetX,P.offsetY),U=U.scale(1/P.scaleX,1/P.scaleY);const z=a.createPattern(P.canvas,"repeat");return z.setTransform(U),z}}s.TilingPattern=h},(E,s,y)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.convertBlackAndWhiteToRGBA=C,s.convertToRGBA=d,s.grayToRGBA=M;var i=y(1);function d(w){switch(w.kind){case i.ImageKind.GRAYSCALE_1BPP:return C(w);case i.ImageKind.RGB_24BPP:return A(w)}return null}function C({src:w,srcPos:n=0,dest:t,width:r,height:l,nonBlackColor:c=4294967295,inverseDecode:e=!1}){const h=i.FeatureTest.isLittleEndian?4278190080:255,[f,a]=e?[c,h]:[h,c],v=r>>3,R=r&7,k=w.length;t=new Uint32Array(t.buffer);let g=0;for(let P=0;P<l;P++){for(const z=n+v;n<z;n++){const N=n<k?w[n]:255;t[g++]=N&128?a:f,t[g++]=N&64?a:f,t[g++]=N&32?a:f,t[g++]=N&16?a:f,t[g++]=N&8?a:f,t[g++]=N&4?a:f,t[g++]=N&2?a:f,t[g++]=N&1?a:f}if(R===0)continue;const U=n<k?w[n++]:255;for(let z=0;z<R;z++)t[g++]=U&1<<7-z?a:f}return{srcPos:n,destPos:g}}function A({src:w,srcPos:n=0,dest:t,destPos:r=0,width:l,height:c}){let e=0;const h=w.length>>2,f=new Uint32Array(w.buffer,n,h);if(i.FeatureTest.isLittleEndian){for(;e<h-2;e+=3,r+=4){const a=f[e],v=f[e+1],R=f[e+2];t[r]=a|4278190080,t[r+1]=a>>>24|v<<8|4278190080,t[r+2]=v>>>16|R<<16|4278190080,t[r+3]=R>>>8|4278190080}for(let a=e*4,v=w.length;a<v;a+=3)t[r++]=w[a]|w[a+1]<<8|w[a+2]<<16|4278190080}else{for(;e<h-2;e+=3,r+=4){const a=f[e],v=f[e+1],R=f[e+2];t[r]=a|255,t[r+1]=a<<24|v>>>8|255,t[r+2]=v<<16|R>>>16|255,t[r+3]=R<<8|255}for(let a=e*4,v=w.length;a<v;a+=3)t[r++]=w[a]<<24|w[a+1]<<16|w[a+2]<<8|255}return{srcPos:n,destPos:r}}function M(w,n){if(i.FeatureTest.isLittleEndian)for(let t=0,r=w.length;t<r;t++)n[t]=w[t]*65793|4278190080;else for(let t=0,r=w.length;t<r;t++)n[t]=w[t]*16843008|255}},(E,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.GlobalWorkerOptions=void 0;const y=Object.create(null);s.GlobalWorkerOptions=y,y.workerPort=null,y.workerSrc=""},(E,s,y)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.MessageHandler=void 0;var i=y(1);const d={DATA:1,ERROR:2},C={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function A(w){switch(w instanceof Error||typeof w=="object"&&w!==null||(0,i.unreachable)('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),w.name){case"AbortException":return new i.AbortException(w.message);case"MissingPDFException":return new i.MissingPDFException(w.message);case"PasswordException":return new i.PasswordException(w.message,w.code);case"UnexpectedResponseException":return new i.UnexpectedResponseException(w.message,w.status);case"UnknownErrorException":return new i.UnknownErrorException(w.message,w.details);default:return new i.UnknownErrorException(w.message,w.toString())}}class M{constructor(n,t,r){this.sourceName=n,this.targetName=t,this.comObj=r,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),this._onComObjOnMessage=l=>{const c=l.data;if(c.targetName!==this.sourceName)return;if(c.stream){this.#e(c);return}if(c.callback){const h=c.callbackId,f=this.callbackCapabilities[h];if(!f)throw new Error(`Cannot resolve callback ${h}`);if(delete this.callbackCapabilities[h],c.callback===d.DATA)f.resolve(c.data);else if(c.callback===d.ERROR)f.reject(A(c.reason));else throw new Error("Unexpected callback case");return}const e=this.actionHandler[c.action];if(!e)throw new Error(`Unknown action from worker: ${c.action}`);if(c.callbackId){const h=this.sourceName,f=c.sourceName;new Promise(function(a){a(e(c.data))}).then(function(a){r.postMessage({sourceName:h,targetName:f,callback:d.DATA,callbackId:c.callbackId,data:a})},function(a){r.postMessage({sourceName:h,targetName:f,callback:d.ERROR,callbackId:c.callbackId,reason:A(a)})});return}if(c.streamId){this.#t(c);return}e(c.data)},r.addEventListener("message",this._onComObjOnMessage)}on(n,t){const r=this.actionHandler;if(r[n])throw new Error(`There is already an actionName called "${n}"`);r[n]=t}send(n,t,r){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:n,data:t},r)}sendWithPromise(n,t,r){const l=this.callbackId++,c=new i.PromiseCapability;this.callbackCapabilities[l]=c;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:n,callbackId:l,data:t},r)}catch(e){c.reject(e)}return c.promise}sendWithStream(n,t,r,l){const c=this.streamId++,e=this.sourceName,h=this.targetName,f=this.comObj;return new ReadableStream({start:a=>{const v=new i.PromiseCapability;return this.streamControllers[c]={controller:a,startCall:v,pullCall:null,cancelCall:null,isClosed:!1},f.postMessage({sourceName:e,targetName:h,action:n,streamId:c,data:t,desiredSize:a.desiredSize},l),v.promise},pull:a=>{const v=new i.PromiseCapability;return this.streamControllers[c].pullCall=v,f.postMessage({sourceName:e,targetName:h,stream:C.PULL,streamId:c,desiredSize:a.desiredSize}),v.promise},cancel:a=>{(0,i.assert)(a instanceof Error,"cancel must have a valid reason");const v=new i.PromiseCapability;return this.streamControllers[c].cancelCall=v,this.streamControllers[c].isClosed=!0,f.postMessage({sourceName:e,targetName:h,stream:C.CANCEL,streamId:c,reason:A(a)}),v.promise}},r)}#t(n){const t=n.streamId,r=this.sourceName,l=n.sourceName,c=this.comObj,e=this,h=this.actionHandler[n.action],f={enqueue(a,v=1,R){if(this.isCancelled)return;const k=this.desiredSize;this.desiredSize-=v,k>0&&this.desiredSize<=0&&(this.sinkCapability=new i.PromiseCapability,this.ready=this.sinkCapability.promise),c.postMessage({sourceName:r,targetName:l,stream:C.ENQUEUE,streamId:t,chunk:a},R)},close(){this.isCancelled||(this.isCancelled=!0,c.postMessage({sourceName:r,targetName:l,stream:C.CLOSE,streamId:t}),delete e.streamSinks[t])},error(a){(0,i.assert)(a instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,c.postMessage({sourceName:r,targetName:l,stream:C.ERROR,streamId:t,reason:A(a)}))},sinkCapability:new i.PromiseCapability,onPull:null,onCancel:null,isCancelled:!1,desiredSize:n.desiredSize,ready:null};f.sinkCapability.resolve(),f.ready=f.sinkCapability.promise,this.streamSinks[t]=f,new Promise(function(a){a(h(n.data,f))}).then(function(){c.postMessage({sourceName:r,targetName:l,stream:C.START_COMPLETE,streamId:t,success:!0})},function(a){c.postMessage({sourceName:r,targetName:l,stream:C.START_COMPLETE,streamId:t,reason:A(a)})})}#e(n){const t=n.streamId,r=this.sourceName,l=n.sourceName,c=this.comObj,e=this.streamControllers[t],h=this.streamSinks[t];switch(n.stream){case C.START_COMPLETE:n.success?e.startCall.resolve():e.startCall.reject(A(n.reason));break;case C.PULL_COMPLETE:n.success?e.pullCall.resolve():e.pullCall.reject(A(n.reason));break;case C.PULL:if(!h){c.postMessage({sourceName:r,targetName:l,stream:C.PULL_COMPLETE,streamId:t,success:!0});break}h.desiredSize<=0&&n.desiredSize>0&&h.sinkCapability.resolve(),h.desiredSize=n.desiredSize,new Promise(function(f){f(h.onPull?.())}).then(function(){c.postMessage({sourceName:r,targetName:l,stream:C.PULL_COMPLETE,streamId:t,success:!0})},function(f){c.postMessage({sourceName:r,targetName:l,stream:C.PULL_COMPLETE,streamId:t,reason:A(f)})});break;case C.ENQUEUE:if((0,i.assert)(e,"enqueue should have stream controller"),e.isClosed)break;e.controller.enqueue(n.chunk);break;case C.CLOSE:if((0,i.assert)(e,"close should have stream controller"),e.isClosed)break;e.isClosed=!0,e.controller.close(),this.#r(e,t);break;case C.ERROR:(0,i.assert)(e,"error should have stream controller"),e.controller.error(A(n.reason)),this.#r(e,t);break;case C.CANCEL_COMPLETE:n.success?e.cancelCall.resolve():e.cancelCall.reject(A(n.reason)),this.#r(e,t);break;case C.CANCEL:if(!h)break;new Promise(function(f){f(h.onCancel?.(A(n.reason)))}).then(function(){c.postMessage({sourceName:r,targetName:l,stream:C.CANCEL_COMPLETE,streamId:t,success:!0})},function(f){c.postMessage({sourceName:r,targetName:l,stream:C.CANCEL_COMPLETE,streamId:t,reason:A(f)})}),h.sinkCapability.reject(A(n.reason)),h.isCancelled=!0,delete this.streamSinks[t];break;default:throw new Error("Unexpected stream case")}}async#r(n,t){await Promise.allSettled([n.startCall?.promise,n.pullCall?.promise,n.cancelCall?.promise]),delete this.streamControllers[t]}destroy(){this.comObj.removeEventListener("message",this._onComObjOnMessage)}}s.MessageHandler=M},(E,s,y)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.Metadata=void 0;var i=y(1);class d{#t;#e;constructor({parsedData:A,rawData:M}){this.#t=A,this.#e=M}getRaw(){return this.#e}get(A){return this.#t.get(A)??null}getAll(){return(0,i.objectFromMap)(this.#t)}has(A){return this.#t.has(A)}}s.Metadata=d},(E,s,y)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.OptionalContentConfig=void 0;var i=y(1),d=y(8);const C=Symbol("INTERNAL");class A{#t=!0;constructor(n,t){this.name=n,this.intent=t}get visible(){return this.#t}_setVisible(n,t){n!==C&&(0,i.unreachable)("Internal method `_setVisible` called."),this.#t=t}}class M{#t=null;#e=new Map;#r=null;#s=null;constructor(n){if(this.name=null,this.creator=null,n!==null){this.name=n.name,this.creator=n.creator,this.#s=n.order;for(const t of n.groups)this.#e.set(t.id,new A(t.name,t.intent));if(n.baseState==="OFF")for(const t of this.#e.values())t._setVisible(C,!1);for(const t of n.on)this.#e.get(t)._setVisible(C,!0);for(const t of n.off)this.#e.get(t)._setVisible(C,!1);this.#r=this.getHash()}}#o(n){const t=n.length;if(t<2)return!0;const r=n[0];for(let l=1;l<t;l++){const c=n[l];let e;if(Array.isArray(c))e=this.#o(c);else if(this.#e.has(c))e=this.#e.get(c).visible;else return(0,i.warn)(`Optional content group not found: ${c}`),!0;switch(r){case"And":if(!e)return!1;break;case"Or":if(e)return!0;break;case"Not":return!e;default:return!0}}return r==="And"}isVisible(n){if(this.#e.size===0)return!0;if(!n)return(0,i.warn)("Optional content group not defined."),!0;if(n.type==="OCG")return this.#e.has(n.id)?this.#e.get(n.id).visible:((0,i.warn)(`Optional content group not found: ${n.id}`),!0);if(n.type==="OCMD"){if(n.expression)return this.#o(n.expression);if(!n.policy||n.policy==="AnyOn"){for(const t of n.ids){if(!this.#e.has(t))return(0,i.warn)(`Optional content group not found: ${t}`),!0;if(this.#e.get(t).visible)return!0}return!1}else if(n.policy==="AllOn"){for(const t of n.ids){if(!this.#e.has(t))return(0,i.warn)(`Optional content group not found: ${t}`),!0;if(!this.#e.get(t).visible)return!1}return!0}else if(n.policy==="AnyOff"){for(const t of n.ids){if(!this.#e.has(t))return(0,i.warn)(`Optional content group not found: ${t}`),!0;if(!this.#e.get(t).visible)return!0}return!1}else if(n.policy==="AllOff"){for(const t of n.ids){if(!this.#e.has(t))return(0,i.warn)(`Optional content group not found: ${t}`),!0;if(this.#e.get(t).visible)return!1}return!0}return(0,i.warn)(`Unknown optional content policy ${n.policy}.`),!0}return(0,i.warn)(`Unknown group type ${n.type}.`),!0}setVisibility(n,t=!0){if(!this.#e.has(n)){(0,i.warn)(`Optional content group not found: ${n}`);return}this.#e.get(n)._setVisible(C,!!t),this.#t=null}get hasInitialVisibility(){return this.#r===null||this.getHash()===this.#r}getOrder(){return this.#e.size?this.#s?this.#s.slice():[...this.#e.keys()]:null}getGroups(){return this.#e.size>0?(0,i.objectFromMap)(this.#e):null}getGroup(n){return this.#e.get(n)||null}getHash(){if(this.#t!==null)return this.#t;const n=new d.MurmurHash3_64;for(const[t,r]of this.#e)n.update(`${t}:${r.visible}`);return this.#t=n.hexdigest()}}s.OptionalContentConfig=M},(E,s,y)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.PDFDataTransportStream=void 0;var i=y(1),d=y(6);class C{constructor({length:n,initialData:t,progressiveDone:r=!1,contentDispositionFilename:l=null,disableRange:c=!1,disableStream:e=!1},h){if((0,i.assert)(h,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.'),this._queuedChunks=[],this._progressiveDone=r,this._contentDispositionFilename=l,t?.length>0){const f=t instanceof Uint8Array&&t.byteLength===t.buffer.byteLength?t.buffer:new Uint8Array(t).buffer;this._queuedChunks.push(f)}this._pdfDataRangeTransport=h,this._isStreamingSupported=!e,this._isRangeSupported=!c,this._contentLength=n,this._fullRequestReader=null,this._rangeReaders=[],this._pdfDataRangeTransport.addRangeListener((f,a)=>{this._onReceiveData({begin:f,chunk:a})}),this._pdfDataRangeTransport.addProgressListener((f,a)=>{this._onProgress({loaded:f,total:a})}),this._pdfDataRangeTransport.addProgressiveReadListener(f=>{this._onReceiveData({chunk:f})}),this._pdfDataRangeTransport.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),this._pdfDataRangeTransport.transportReady()}_onReceiveData({begin:n,chunk:t}){const r=t instanceof Uint8Array&&t.byteLength===t.buffer.byteLength?t.buffer:new Uint8Array(t).buffer;if(n===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(r):this._queuedChunks.push(r);else{const l=this._rangeReaders.some(function(c){return c._begin!==n?!1:(c._enqueue(r),!0)});(0,i.assert)(l,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}_onProgress(n){n.total===void 0?this._rangeReaders[0]?.onProgress?.({loaded:n.loaded}):this._fullRequestReader?.onProgress?.({loaded:n.loaded,total:n.total})}_onProgressiveDone(){this._fullRequestReader?.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(n){const t=this._rangeReaders.indexOf(n);t>=0&&this._rangeReaders.splice(t,1)}getFullReader(){(0,i.assert)(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const n=this._queuedChunks;return this._queuedChunks=null,new A(this,n,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(n,t){if(t<=this._progressiveDataLength)return null;const r=new M(this,n,t);return this._pdfDataRangeTransport.requestDataRange(n,t),this._rangeReaders.push(r),r}cancelAllRequests(n){this._fullRequestReader?.cancel(n);for(const t of this._rangeReaders.slice(0))t.cancel(n);this._pdfDataRangeTransport.abort()}}s.PDFDataTransportStream=C;class A{constructor(n,t,r=!1,l=null){this._stream=n,this._done=r||!1,this._filename=(0,d.isPdfFile)(l)?l:null,this._queuedChunks=t||[],this._loaded=0;for(const c of this._queuedChunks)this._loaded+=c.byteLength;this._requests=[],this._headersReady=Promise.resolve(),n._fullRequestReader=this,this.onProgress=null}_enqueue(n){this._done||(this._requests.length>0?this._requests.shift().resolve({value:n,done:!1}):this._queuedChunks.push(n),this._loaded+=n.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const n=new i.PromiseCapability;return this._requests.push(n),n.promise}cancel(n){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class M{constructor(n,t,r){this._stream=n,this._begin=t,this._end=r,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(n){if(!this._done){if(this._requests.length===0)this._queuedChunk=n;else{this._requests.shift().resolve({value:n,done:!1});for(const r of this._requests)r.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};const n=new i.PromiseCapability;return this._requests.push(n),n.promise}cancel(n){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}},(E,s,y)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.PDFFetchStream=void 0;var i=y(1),d=y(20);function C(r,l,c){return{method:"GET",headers:r,signal:c.signal,mode:"cors",credentials:l?"include":"same-origin",redirect:"follow"}}function A(r){const l=new Headers;for(const c in r){const e=r[c];e!==void 0&&l.append(c,e)}return l}function M(r){return r instanceof Uint8Array?r.buffer:r instanceof ArrayBuffer?r:((0,i.warn)(`getArrayBuffer - unexpected data format: ${r}`),new Uint8Array(r).buffer)}class w{constructor(l){this.source=l,this.isHttp=/^https?:/i.test(l.url),this.httpHeaders=this.isHttp&&l.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return(0,i.assert)(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new n(this),this._fullRequestReader}getRangeReader(l,c){if(c<=this._progressiveDataLength)return null;const e=new t(this,l,c);return this._rangeRequestReaders.push(e),e}cancelAllRequests(l){this._fullRequestReader?.cancel(l);for(const c of this._rangeRequestReaders.slice(0))c.cancel(l)}}s.PDFFetchStream=w;class n{constructor(l){this._stream=l,this._reader=null,this._loaded=0,this._filename=null;const c=l.source;this._withCredentials=c.withCredentials||!1,this._contentLength=c.length,this._headersCapability=new i.PromiseCapability,this._disableRange=c.disableRange||!1,this._rangeChunkSize=c.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!c.disableStream,this._isRangeSupported=!c.disableRange,this._headers=A(this._stream.httpHeaders);const e=c.url;fetch(e,C(this._headers,this._withCredentials,this._abortController)).then(h=>{if(!(0,d.validateResponseStatus)(h.status))throw(0,d.createResponseStatusError)(h.status,e);this._reader=h.body.getReader(),this._headersCapability.resolve();const f=R=>h.headers.get(R),{allowRangeRequests:a,suggestedLength:v}=(0,d.validateRangeRequestCapabilities)({getResponseHeader:f,isHttp:this._stream.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=a,this._contentLength=v||this._contentLength,this._filename=(0,d.extractFilenameFromHeader)(f),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new i.AbortException("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._headersCapability.promise;const{value:l,done:c}=await this._reader.read();return c?{value:l,done:c}:(this._loaded+=l.byteLength,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:M(l),done:!1})}cancel(l){this._reader?.cancel(l),this._abortController.abort()}}class t{constructor(l,c,e){this._stream=l,this._reader=null,this._loaded=0;const h=l.source;this._withCredentials=h.withCredentials||!1,this._readCapability=new i.PromiseCapability,this._isStreamingSupported=!h.disableStream,this._abortController=new AbortController,this._headers=A(this._stream.httpHeaders),this._headers.append("Range",`bytes=${c}-${e-1}`);const f=h.url;fetch(f,C(this._headers,this._withCredentials,this._abortController)).then(a=>{if(!(0,d.validateResponseStatus)(a.status))throw(0,d.createResponseStatusError)(a.status,f);this._readCapability.resolve(),this._reader=a.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._readCapability.promise;const{value:l,done:c}=await this._reader.read();return c?{value:l,done:c}:(this._loaded+=l.byteLength,this.onProgress?.({loaded:this._loaded}),{value:M(l),done:!1})}cancel(l){this._reader?.cancel(l),this._abortController.abort()}}},(E,s,y)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.createResponseStatusError=w,s.extractFilenameFromHeader=M,s.validateRangeRequestCapabilities=A,s.validateResponseStatus=n;var i=y(1),d=y(21),C=y(6);function A({getResponseHeader:t,isHttp:r,rangeChunkSize:l,disableRange:c}){const e={allowRangeRequests:!1,suggestedLength:void 0},h=parseInt(t("Content-Length"),10);return!Number.isInteger(h)||(e.suggestedLength=h,h<=2*l)||c||!r||t("Accept-Ranges")!=="bytes"||(t("Content-Encoding")||"identity")!=="identity"||(e.allowRangeRequests=!0),e}function M(t){const r=t("Content-Disposition");if(r){let l=(0,d.getFilenameFromContentDispositionHeader)(r);if(l.includes("%"))try{l=decodeURIComponent(l)}catch{}if((0,C.isPdfFile)(l))return l}return null}function w(t,r){return t===404||t===0&&r.startsWith("file:")?new i.MissingPDFException('Missing PDF "'+r+'".'):new i.UnexpectedResponseException(`Unexpected server response (${t}) while retrieving PDF "${r}".`,t)}function n(t){return t===200||t===206}},(E,s,y)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.getFilenameFromContentDispositionHeader=d;var i=y(1);function d(C){let A=!0,M=w("filename\\*","i").exec(C);if(M){M=M[1];let h=l(M);return h=unescape(h),h=c(h),h=e(h),t(h)}if(M=r(C),M){const h=e(M);return t(h)}if(M=w("filename","i").exec(C),M){M=M[1];let h=l(M);return h=e(h),t(h)}function w(h,f){return new RegExp("(?:^|;)\\s*"+h+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',f)}function n(h,f){if(h){if(!/^[\x00-\xFF]+$/.test(f))return f;try{const a=new TextDecoder(h,{fatal:!0}),v=(0,i.stringToBytes)(f);f=a.decode(v),A=!1}catch{}}return f}function t(h){return A&&/[\x80-\xff]/.test(h)&&(h=n("utf-8",h),A&&(h=n("iso-8859-1",h))),h}function r(h){const f=[];let a;const v=w("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(a=v.exec(h))!==null;){let[,k,g,P]=a;if(k=parseInt(k,10),k in f){if(k===0)break;continue}f[k]=[g,P]}const R=[];for(let k=0;k<f.length&&k in f;++k){let[g,P]=f[k];P=l(P),g&&(P=unescape(P),k===0&&(P=c(P))),R.push(P)}return R.join("")}function l(h){if(h.startsWith('"')){const f=h.slice(1).split('\\"');for(let a=0;a<f.length;++a){const v=f[a].indexOf('"');v!==-1&&(f[a]=f[a].slice(0,v),f.length=a+1),f[a]=f[a].replaceAll(/\\(.)/g,"$1")}h=f.join('"')}return h}function c(h){const f=h.indexOf("'");if(f===-1)return h;const a=h.slice(0,f),R=h.slice(f+1).replace(/^[^']*'/,"");return n(a,R)}function e(h){return!h.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(h)?h:h.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(f,a,v,R){if(v==="q"||v==="Q")return R=R.replaceAll("_"," "),R=R.replaceAll(/=([0-9a-fA-F]{2})/g,function(k,g){return String.fromCharCode(parseInt(g,16))}),n(a,R);try{R=atob(R)}catch{}return n(a,R)})}return""}},(E,s,y)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.PDFNetworkStream=void 0;var i=y(1),d=y(20);const C=200,A=206;function M(l){const c=l.response;return typeof c!="string"?c:(0,i.stringToBytes)(c).buffer}class w{constructor(c,e={}){this.url=c,this.isHttp=/^https?:/i.test(c),this.httpHeaders=this.isHttp&&e.httpHeaders||Object.create(null),this.withCredentials=e.withCredentials||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}requestRange(c,e,h){const f={begin:c,end:e};for(const a in h)f[a]=h[a];return this.request(f)}requestFull(c){return this.request(c)}request(c){const e=new XMLHttpRequest,h=this.currXhrId++,f=this.pendingRequests[h]={xhr:e};e.open("GET",this.url),e.withCredentials=this.withCredentials;for(const a in this.httpHeaders){const v=this.httpHeaders[a];v!==void 0&&e.setRequestHeader(a,v)}return this.isHttp&&"begin"in c&&"end"in c?(e.setRequestHeader("Range",`bytes=${c.begin}-${c.end-1}`),f.expectedStatus=A):f.expectedStatus=C,e.responseType="arraybuffer",c.onError&&(e.onerror=function(a){c.onError(e.status)}),e.onreadystatechange=this.onStateChange.bind(this,h),e.onprogress=this.onProgress.bind(this,h),f.onHeadersReceived=c.onHeadersReceived,f.onDone=c.onDone,f.onError=c.onError,f.onProgress=c.onProgress,e.send(null),h}onProgress(c,e){const h=this.pendingRequests[c];h&&h.onProgress?.(e)}onStateChange(c,e){const h=this.pendingRequests[c];if(!h)return;const f=h.xhr;if(f.readyState>=2&&h.onHeadersReceived&&(h.onHeadersReceived(),delete h.onHeadersReceived),f.readyState!==4||!(c in this.pendingRequests))return;if(delete this.pendingRequests[c],f.status===0&&this.isHttp){h.onError?.(f.status);return}const a=f.status||C;if(!(a===C&&h.expectedStatus===A)&&a!==h.expectedStatus){h.onError?.(f.status);return}const R=M(f);if(a===A){const k=f.getResponseHeader("Content-Range"),g=/bytes (\d+)-(\d+)\/(\d+)/.exec(k);h.onDone({begin:parseInt(g[1],10),chunk:R})}else R?h.onDone({begin:0,chunk:R}):h.onError?.(f.status)}getRequestXhr(c){return this.pendingRequests[c].xhr}isPendingRequest(c){return c in this.pendingRequests}abortRequest(c){const e=this.pendingRequests[c].xhr;delete this.pendingRequests[c],e.abort()}}class n{constructor(c){this._source=c,this._manager=new w(c.url,{httpHeaders:c.httpHeaders,withCredentials:c.withCredentials}),this._rangeChunkSize=c.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(c){const e=this._rangeRequestReaders.indexOf(c);e>=0&&this._rangeRequestReaders.splice(e,1)}getFullReader(){return(0,i.assert)(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new t(this._manager,this._source),this._fullRequestReader}getRangeReader(c,e){const h=new r(this._manager,c,e);return h.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(h),h}cancelAllRequests(c){this._fullRequestReader?.cancel(c);for(const e of this._rangeRequestReaders.slice(0))e.cancel(c)}}s.PDFNetworkStream=n;class t{constructor(c,e){this._manager=c;const h={onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=e.url,this._fullRequestId=c.requestFull(h),this._headersReceivedCapability=new i.PromiseCapability,this._disableRange=e.disableRange||!1,this._contentLength=e.length,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const c=this._fullRequestId,e=this._manager.getRequestXhr(c),h=v=>e.getResponseHeader(v),{allowRangeRequests:f,suggestedLength:a}=(0,d.validateRangeRequestCapabilities)({getResponseHeader:h,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});f&&(this._isRangeSupported=!0),this._contentLength=a||this._contentLength,this._filename=(0,d.extractFilenameFromHeader)(h),this._isRangeSupported&&this._manager.abortRequest(c),this._headersReceivedCapability.resolve()}_onDone(c){if(c&&(this._requests.length>0?this._requests.shift().resolve({value:c.chunk,done:!1}):this._cachedChunks.push(c.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(c){this._storedError=(0,d.createResponseStatusError)(c,this._url),this._headersReceivedCapability.reject(this._storedError);for(const e of this._requests)e.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(c){this.onProgress?.({loaded:c.loaded,total:c.lengthComputable?c.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersReceivedCapability.promise}async read(){if(this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const c=new i.PromiseCapability;return this._requests.push(c),c.promise}cancel(c){this._done=!0,this._headersReceivedCapability.reject(c);for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class r{constructor(c,e,h){this._manager=c;const f={onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=c.url,this._requestId=c.requestRange(e,h,f),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_close(){this.onClosed?.(this)}_onDone(c){const e=c.chunk;this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunk=e,this._done=!0;for(const h of this._requests)h.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(c){this._storedError=(0,d.createResponseStatusError)(c,this._url);for(const e of this._requests)e.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(c){this.isStreamingSupported||this.onProgress?.({loaded:c.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const e=this._queuedChunk;return this._queuedChunk=null,{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};const c=new i.PromiseCapability;return this._requests.push(c),c.promise}cancel(c){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}},(E,s,y)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.PDFNodeStream=void 0;var i=y(1),d=y(20);const C=/^file:\/\/\/[a-zA-Z]:\//;function A(h){const f=require$$5,a=f.parse(h);return a.protocol==="file:"||a.host?a:/^[a-z]:[/\\]/i.test(h)?f.parse(`file:///${h}`):(a.host||(a.protocol="file:"),a)}class M{constructor(f){this.source=f,this.url=A(f.url),this.isHttp=this.url.protocol==="http:"||this.url.protocol==="https:",this.isFsUrl=this.url.protocol==="file:",this.httpHeaders=this.isHttp&&f.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return(0,i.assert)(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=this.isFsUrl?new c(this):new r(this),this._fullRequestReader}getRangeReader(f,a){if(a<=this._progressiveDataLength)return null;const v=this.isFsUrl?new e(this,f,a):new l(this,f,a);return this._rangeRequestReaders.push(v),v}cancelAllRequests(f){this._fullRequestReader?.cancel(f);for(const a of this._rangeRequestReaders.slice(0))a.cancel(f)}}s.PDFNodeStream=M;class w{constructor(f){this._url=f.url,this._done=!1,this._storedError=null,this.onProgress=null;const a=f.source;this._contentLength=a.length,this._loaded=0,this._filename=null,this._disableRange=a.disableRange||!1,this._rangeChunkSize=a.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!a.disableStream,this._isRangeSupported=!a.disableRange,this._readableStream=null,this._readCapability=new i.PromiseCapability,this._headersCapability=new i.PromiseCapability}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const f=this._readableStream.read();return f===null?(this._readCapability=new i.PromiseCapability,this.read()):(this._loaded+=f.length,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(f).buffer,done:!1})}cancel(f){if(!this._readableStream){this._error(f);return}this._readableStream.destroy(f)}_error(f){this._storedError=f,this._readCapability.resolve()}_setReadableStream(f){this._readableStream=f,f.on("readable",()=>{this._readCapability.resolve()}),f.on("end",()=>{f.destroy(),this._done=!0,this._readCapability.resolve()}),f.on("error",a=>{this._error(a)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new i.AbortException("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class n{constructor(f){this._url=f.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=new i.PromiseCapability;const a=f.source;this._isStreamingSupported=!a.disableStream}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const f=this._readableStream.read();return f===null?(this._readCapability=new i.PromiseCapability,this.read()):(this._loaded+=f.length,this.onProgress?.({loaded:this._loaded}),{value:new Uint8Array(f).buffer,done:!1})}cancel(f){if(!this._readableStream){this._error(f);return}this._readableStream.destroy(f)}_error(f){this._storedError=f,this._readCapability.resolve()}_setReadableStream(f){this._readableStream=f,f.on("readable",()=>{this._readCapability.resolve()}),f.on("end",()=>{f.destroy(),this._done=!0,this._readCapability.resolve()}),f.on("error",a=>{this._error(a)}),this._storedError&&this._readableStream.destroy(this._storedError)}}function t(h,f){return{protocol:h.protocol,auth:h.auth,host:h.hostname,port:h.port,path:h.path,method:"GET",headers:f}}class r extends w{constructor(f){super(f);const a=v=>{if(v.statusCode===404){const P=new i.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=P,this._headersCapability.reject(P);return}this._headersCapability.resolve(),this._setReadableStream(v);const R=P=>this._readableStream.headers[P.toLowerCase()],{allowRangeRequests:k,suggestedLength:g}=(0,d.validateRangeRequestCapabilities)({getResponseHeader:R,isHttp:f.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=k,this._contentLength=g||this._contentLength,this._filename=(0,d.extractFilenameFromHeader)(R)};if(this._request=null,this._url.protocol==="http:"){const v=require$$5;this._request=v.request(t(this._url,f.httpHeaders),a)}else{const v=require$$5;this._request=v.request(t(this._url,f.httpHeaders),a)}this._request.on("error",v=>{this._storedError=v,this._headersCapability.reject(v)}),this._request.end()}}class l extends n{constructor(f,a,v){super(f),this._httpHeaders={};for(const k in f.httpHeaders){const g=f.httpHeaders[k];g!==void 0&&(this._httpHeaders[k]=g)}this._httpHeaders.Range=`bytes=${a}-${v-1}`;const R=k=>{if(k.statusCode===404){const g=new i.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=g;return}this._setReadableStream(k)};if(this._request=null,this._url.protocol==="http:"){const k=require$$5;this._request=k.request(t(this._url,this._httpHeaders),R)}else{const k=require$$5;this._request=k.request(t(this._url,this._httpHeaders),R)}this._request.on("error",k=>{this._storedError=k}),this._request.end()}}class c extends w{constructor(f){super(f);let a=decodeURIComponent(this._url.path);C.test(this._url.href)&&(a=a.replace(/^\//,""));const v=require$$5;v.lstat(a,(R,k)=>{if(R){R.code==="ENOENT"&&(R=new i.MissingPDFException(`Missing PDF "${a}".`)),this._storedError=R,this._headersCapability.reject(R);return}this._contentLength=k.size,this._setReadableStream(v.createReadStream(a)),this._headersCapability.resolve()})}}class e extends n{constructor(f,a,v){super(f);let R=decodeURIComponent(this._url.path);C.test(this._url.href)&&(R=R.replace(/^\//,""));const k=require$$5;this._setReadableStream(k.createReadStream(R,{start:a,end:v-1}))}}},(E,s,y)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.SVGGraphics=void 0;var i=y(6),d=y(1);const C={fontStyle:"normal",fontWeight:"normal",fillColor:"#000000"},A="http://www.w3.org/XML/1998/namespace",M="http://www.w3.org/1999/xlink",w=["butt","round","square"],n=["miter","round","bevel"],t=function(k,g="",P=!1){if(URL.createObjectURL&&typeof Blob<"u"&&!P)return URL.createObjectURL(new Blob([k],{type:g}));const U="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let z=`data:${g};base64,`;for(let N=0,j=k.length;N<j;N+=3){const W=k[N]&255,at=k[N+1]&255,tt=k[N+2]&255,it=W>>2,ut=(W&3)<<4|at>>4,J=N+1<j?(at&15)<<2|tt>>6:64,L=N+2<j?tt&63:64;z+=U[it]+U[ut]+U[J]+U[L]}return z},r=function(){const k=new Uint8Array([137,80,78,71,13,10,26,10]),g=12,P=new Int32Array(256);for(let tt=0;tt<256;tt++){let it=tt;for(let ut=0;ut<8;ut++)it=it&1?3988292384^it>>1&2147483647:it>>1&2147483647;P[tt]=it}function U(tt,it,ut){let J=-1;for(let L=it;L<ut;L++){const b=(J^tt[L])&255,p=P[b];J=J>>>8^p}return J^-1}function z(tt,it,ut,J){let L=J;const b=it.length;ut[L]=b>>24&255,ut[L+1]=b>>16&255,ut[L+2]=b>>8&255,ut[L+3]=b&255,L+=4,ut[L]=tt.charCodeAt(0)&255,ut[L+1]=tt.charCodeAt(1)&255,ut[L+2]=tt.charCodeAt(2)&255,ut[L+3]=tt.charCodeAt(3)&255,L+=4,ut.set(it,L),L+=it.length;const p=U(ut,J+4,L);ut[L]=p>>24&255,ut[L+1]=p>>16&255,ut[L+2]=p>>8&255,ut[L+3]=p&255}function N(tt,it,ut){let J=1,L=0;for(let b=it;b<ut;++b)J=(J+(tt[b]&255))%65521,L=(L+J)%65521;return L<<16|J}function j(tt){if(!d.isNodeJS)return W(tt);try{const it=parseInt(process.versions.node)>=8?tt:Buffer.from(tt),ut=require$$5.deflateSync(it,{level:9});return ut instanceof Uint8Array?ut:new Uint8Array(ut)}catch(it){(0,d.warn)("Not compressing PNG because zlib.deflateSync is unavailable: "+it)}return W(tt)}function W(tt){let it=tt.length;const ut=65535,J=Math.ceil(it/ut),L=new Uint8Array(2+it+J*5+4);let b=0;L[b++]=120,L[b++]=156;let p=0;for(;it>ut;)L[b++]=0,L[b++]=255,L[b++]=255,L[b++]=0,L[b++]=0,L.set(tt.subarray(p,p+ut),b),b+=ut,p+=ut,it-=ut;L[b++]=1,L[b++]=it&255,L[b++]=it>>8&255,L[b++]=~it&65535&255,L[b++]=(~it&65535)>>8&255,L.set(tt.subarray(p),b),b+=tt.length-p;const u=N(tt,0,tt.length);return L[b++]=u>>24&255,L[b++]=u>>16&255,L[b++]=u>>8&255,L[b++]=u&255,L}function at(tt,it,ut,J){const L=tt.width,b=tt.height;let p,u,_;const F=tt.data;switch(it){case d.ImageKind.GRAYSCALE_1BPP:u=0,p=1,_=L+7>>3;break;case d.ImageKind.RGB_24BPP:u=2,p=8,_=L*3;break;case d.ImageKind.RGBA_32BPP:u=6,p=8,_=L*4;break;default:throw new Error("invalid format")}const I=new Uint8Array((1+_)*b);let O=0,x=0;for(let $=0;$<b;++$)I[O++]=0,I.set(F.subarray(x,x+_),O),x+=_,O+=_;if(it===d.ImageKind.GRAYSCALE_1BPP&&J){O=0;for(let $=0;$<b;$++){O++;for(let B=0;B<_;B++)I[O++]^=255}}const o=new Uint8Array([L>>24&255,L>>16&255,L>>8&255,L&255,b>>24&255,b>>16&255,b>>8&255,b&255,p,u,0,0,0]),m=j(I),S=k.length+g*3+o.length+m.length,T=new Uint8Array(S);let D=0;return T.set(k,D),D+=k.length,z("IHDR",o,T,D),D+=g+o.length,z("IDATA",m,T,D),D+=g+m.length,z("IEND",new Uint8Array(0),T,D),t(T,"image/png",ut)}return function(it,ut,J){const L=it.kind===void 0?d.ImageKind.GRAYSCALE_1BPP:it.kind;return at(it,L,ut,J)}}();class l{constructor(){this.fontSizeScale=1,this.fontWeight=C.fontWeight,this.fontSize=0,this.textMatrix=d.IDENTITY_MATRIX,this.fontMatrix=d.FONT_IDENTITY_MATRIX,this.leading=0,this.textRenderingMode=d.TextRenderingMode.FILL,this.textMatrixScale=1,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRise=0,this.fillColor=C.fillColor,this.strokeColor="#000000",this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.lineJoin="",this.lineCap="",this.miterLimit=0,this.dashArray=[],this.dashPhase=0,this.dependencies=[],this.activeClipUrl=null,this.clipGroup=null,this.maskId=""}clone(){return Object.create(this)}setCurrentPoint(g,P){this.x=g,this.y=P}}function c(k){let g=[];const P=[];for(const U of k){if(U.fn==="save"){g.push({fnId:92,fn:"group",items:[]}),P.push(g),g=g.at(-1).items;continue}U.fn==="restore"?g=P.pop():g.push(U)}return g}function e(k){if(Number.isInteger(k))return k.toString();const g=k.toFixed(10);let P=g.length-1;if(g[P]!=="0")return g;do P--;while(g[P]==="0");return g.substring(0,g[P]==="."?P:P+1)}function h(k){if(k[4]===0&&k[5]===0){if(k[1]===0&&k[2]===0)return k[0]===1&&k[3]===1?"":`scale(${e(k[0])} ${e(k[3])})`;if(k[0]===k[3]&&k[1]===-k[2]){const g=Math.acos(k[0])*180/Math.PI;return`rotate(${e(g)})`}}else if(k[0]===1&&k[1]===0&&k[2]===0&&k[3]===1)return`translate(${e(k[4])} ${e(k[5])})`;return`matrix(${e(k[0])} ${e(k[1])} ${e(k[2])} ${e(k[3])} ${e(k[4])} ${e(k[5])})`}let f=0,a=0,v=0;class R{constructor(g,P,U=!1){(0,i.deprecated)("The SVG back-end is no longer maintained and *may* be removed in the future."),this.svgFactory=new i.DOMSVGFactory,this.current=new l,this.transformMatrix=d.IDENTITY_MATRIX,this.transformStack=[],this.extraStack=[],this.commonObjs=g,this.objs=P,this.pendingClip=null,this.pendingEOFill=!1,this.embedFonts=!1,this.embeddedFonts=Object.create(null),this.cssStyle=null,this.forceDataSchema=!!U,this._operatorIdMapping=[];for(const z in d.OPS)this._operatorIdMapping[d.OPS[z]]=z}getObject(g,P=null){return typeof g=="string"?g.startsWith("g_")?this.commonObjs.get(g):this.objs.get(g):P}save(){this.transformStack.push(this.transformMatrix);const g=this.current;this.extraStack.push(g),this.current=g.clone()}restore(){this.transformMatrix=this.transformStack.pop(),this.current=this.extraStack.pop(),this.pendingClip=null,this.tgrp=null}group(g){this.save(),this.executeOpTree(g),this.restore()}loadDependencies(g){const P=g.fnArray,U=g.argsArray;for(let z=0,N=P.length;z<N;z++)if(P[z]===d.OPS.dependency)for(const j of U[z]){const W=j.startsWith("g_")?this.commonObjs:this.objs,at=new Promise(tt=>{W.get(j,tt)});this.current.dependencies.push(at)}return Promise.all(this.current.dependencies)}transform(g,P,U,z,N,j){const W=[g,P,U,z,N,j];this.transformMatrix=d.Util.transform(this.transformMatrix,W),this.tgrp=null}getSVG(g,P){this.viewport=P;const U=this._initialize(P);return this.loadDependencies(g).then(()=>(this.transformMatrix=d.IDENTITY_MATRIX,this.executeOpTree(this.convertOpList(g)),U))}convertOpList(g){const P=this._operatorIdMapping,U=g.argsArray,z=g.fnArray,N=[];for(let j=0,W=z.length;j<W;j++){const at=z[j];N.push({fnId:at,fn:P[at],args:U[j]})}return c(N)}executeOpTree(g){for(const P of g){const U=P.fn,z=P.fnId,N=P.args;switch(z|0){case d.OPS.beginText:this.beginText();break;case d.OPS.dependency:break;case d.OPS.setLeading:this.setLeading(N);break;case d.OPS.setLeadingMoveText:this.setLeadingMoveText(N[0],N[1]);break;case d.OPS.setFont:this.setFont(N);break;case d.OPS.showText:this.showText(N[0]);break;case d.OPS.showSpacedText:this.showText(N[0]);break;case d.OPS.endText:this.endText();break;case d.OPS.moveText:this.moveText(N[0],N[1]);break;case d.OPS.setCharSpacing:this.setCharSpacing(N[0]);break;case d.OPS.setWordSpacing:this.setWordSpacing(N[0]);break;case d.OPS.setHScale:this.setHScale(N[0]);break;case d.OPS.setTextMatrix:this.setTextMatrix(N[0],N[1],N[2],N[3],N[4],N[5]);break;case d.OPS.setTextRise:this.setTextRise(N[0]);break;case d.OPS.setTextRenderingMode:this.setTextRenderingMode(N[0]);break;case d.OPS.setLineWidth:this.setLineWidth(N[0]);break;case d.OPS.setLineJoin:this.setLineJoin(N[0]);break;case d.OPS.setLineCap:this.setLineCap(N[0]);break;case d.OPS.setMiterLimit:this.setMiterLimit(N[0]);break;case d.OPS.setFillRGBColor:this.setFillRGBColor(N[0],N[1],N[2]);break;case d.OPS.setStrokeRGBColor:this.setStrokeRGBColor(N[0],N[1],N[2]);break;case d.OPS.setStrokeColorN:this.setStrokeColorN(N);break;case d.OPS.setFillColorN:this.setFillColorN(N);break;case d.OPS.shadingFill:this.shadingFill(N[0]);break;case d.OPS.setDash:this.setDash(N[0],N[1]);break;case d.OPS.setRenderingIntent:this.setRenderingIntent(N[0]);break;case d.OPS.setFlatness:this.setFlatness(N[0]);break;case d.OPS.setGState:this.setGState(N[0]);break;case d.OPS.fill:this.fill();break;case d.OPS.eoFill:this.eoFill();break;case d.OPS.stroke:this.stroke();break;case d.OPS.fillStroke:this.fillStroke();break;case d.OPS.eoFillStroke:this.eoFillStroke();break;case d.OPS.clip:this.clip("nonzero");break;case d.OPS.eoClip:this.clip("evenodd");break;case d.OPS.paintSolidColorImageMask:this.paintSolidColorImageMask();break;case d.OPS.paintImageXObject:this.paintImageXObject(N[0]);break;case d.OPS.paintInlineImageXObject:this.paintInlineImageXObject(N[0]);break;case d.OPS.paintImageMaskXObject:this.paintImageMaskXObject(N[0]);break;case d.OPS.paintFormXObjectBegin:this.paintFormXObjectBegin(N[0],N[1]);break;case d.OPS.paintFormXObjectEnd:this.paintFormXObjectEnd();break;case d.OPS.closePath:this.closePath();break;case d.OPS.closeStroke:this.closeStroke();break;case d.OPS.closeFillStroke:this.closeFillStroke();break;case d.OPS.closeEOFillStroke:this.closeEOFillStroke();break;case d.OPS.nextLine:this.nextLine();break;case d.OPS.transform:this.transform(N[0],N[1],N[2],N[3],N[4],N[5]);break;case d.OPS.constructPath:this.constructPath(N[0],N[1]);break;case d.OPS.endPath:this.endPath();break;case 92:this.group(P.items);break;default:(0,d.warn)(`Unimplemented operator ${U}`);break}}}setWordSpacing(g){this.current.wordSpacing=g}setCharSpacing(g){this.current.charSpacing=g}nextLine(){this.moveText(0,this.current.leading)}setTextMatrix(g,P,U,z,N,j){const W=this.current;W.textMatrix=W.lineMatrix=[g,P,U,z,N,j],W.textMatrixScale=Math.hypot(g,P),W.x=W.lineX=0,W.y=W.lineY=0,W.xcoords=[],W.ycoords=[],W.tspan=this.svgFactory.createElement("svg:tspan"),W.tspan.setAttributeNS(null,"font-family",W.fontFamily),W.tspan.setAttributeNS(null,"font-size",`${e(W.fontSize)}px`),W.tspan.setAttributeNS(null,"y",e(-W.y)),W.txtElement=this.svgFactory.createElement("svg:text"),W.txtElement.append(W.tspan)}beginText(){const g=this.current;g.x=g.lineX=0,g.y=g.lineY=0,g.textMatrix=d.IDENTITY_MATRIX,g.lineMatrix=d.IDENTITY_MATRIX,g.textMatrixScale=1,g.tspan=this.svgFactory.createElement("svg:tspan"),g.txtElement=this.svgFactory.createElement("svg:text"),g.txtgrp=this.svgFactory.createElement("svg:g"),g.xcoords=[],g.ycoords=[]}moveText(g,P){const U=this.current;U.x=U.lineX+=g,U.y=U.lineY+=P,U.xcoords=[],U.ycoords=[],U.tspan=this.svgFactory.createElement("svg:tspan"),U.tspan.setAttributeNS(null,"font-family",U.fontFamily),U.tspan.setAttributeNS(null,"font-size",`${e(U.fontSize)}px`),U.tspan.setAttributeNS(null,"y",e(-U.y))}showText(g){const P=this.current,U=P.font,z=P.fontSize;if(z===0)return;const N=P.fontSizeScale,j=P.charSpacing,W=P.wordSpacing,at=P.fontDirection,tt=P.textHScale*at,it=U.vertical,ut=it?1:-1,J=U.defaultVMetrics,L=z*P.fontMatrix[0];let b=0;for(const _ of g){if(_===null){b+=at*W;continue}else if(typeof _=="number"){b+=ut*_*z/1e3;continue}const F=(_.isSpace?W:0)+j,I=_.fontChar;let O,x,o=_.width;if(it){let S;const T=_.vmetric||J;S=_.vmetric?T[1]:o*.5,S=-S*L;const D=T[2]*L;o=T?-T[0]:o,O=S/N,x=(b+D)/N}else O=b/N,x=0;(_.isInFont||U.missingFile)&&(P.xcoords.push(P.x+O),it&&P.ycoords.push(-P.y+x),P.tspan.textContent+=I);const m=it?o*L-F*at:o*L+F*at;b+=m}P.tspan.setAttributeNS(null,"x",P.xcoords.map(e).join(" ")),it?P.tspan.setAttributeNS(null,"y",P.ycoords.map(e).join(" ")):P.tspan.setAttributeNS(null,"y",e(-P.y)),it?P.y-=b:P.x+=b*tt,P.tspan.setAttributeNS(null,"font-family",P.fontFamily),P.tspan.setAttributeNS(null,"font-size",`${e(P.fontSize)}px`),P.fontStyle!==C.fontStyle&&P.tspan.setAttributeNS(null,"font-style",P.fontStyle),P.fontWeight!==C.fontWeight&&P.tspan.setAttributeNS(null,"font-weight",P.fontWeight);const p=P.textRenderingMode&d.TextRenderingMode.FILL_STROKE_MASK;if(p===d.TextRenderingMode.FILL||p===d.TextRenderingMode.FILL_STROKE?(P.fillColor!==C.fillColor&&P.tspan.setAttributeNS(null,"fill",P.fillColor),P.fillAlpha<1&&P.tspan.setAttributeNS(null,"fill-opacity",P.fillAlpha)):P.textRenderingMode===d.TextRenderingMode.ADD_TO_PATH?P.tspan.setAttributeNS(null,"fill","transparent"):P.tspan.setAttributeNS(null,"fill","none"),p===d.TextRenderingMode.STROKE||p===d.TextRenderingMode.FILL_STROKE){const _=1/(P.textMatrixScale||1);this._setStrokeAttributes(P.tspan,_)}let u=P.textMatrix;P.textRise!==0&&(u=u.slice(),u[5]+=P.textRise),P.txtElement.setAttributeNS(null,"transform",`${h(u)} scale(${e(tt)}, -1)`),P.txtElement.setAttributeNS(A,"xml:space","preserve"),P.txtElement.append(P.tspan),P.txtgrp.append(P.txtElement),this._ensureTransformGroup().append(P.txtElement)}setLeadingMoveText(g,P){this.setLeading(-P),this.moveText(g,P)}addFontStyle(g){if(!g.data)throw new Error('addFontStyle: No font data available, ensure that the "fontExtraProperties" API parameter is set.');this.cssStyle||(this.cssStyle=this.svgFactory.createElement("svg:style"),this.cssStyle.setAttributeNS(null,"type","text/css"),this.defs.append(this.cssStyle));const P=t(g.data,g.mimetype,this.forceDataSchema);this.cssStyle.textContent+=`@font-face { font-family: "${g.loadedName}"; src: url(${P}); }
`}setFont(g){const P=this.current,U=this.commonObjs.get(g[0]);let z=g[1];P.font=U,this.embedFonts&&!U.missingFile&&!this.embeddedFonts[U.loadedName]&&(this.addFontStyle(U),this.embeddedFonts[U.loadedName]=U),P.fontMatrix=U.fontMatrix||d.FONT_IDENTITY_MATRIX;let N="normal";U.black?N="900":U.bold&&(N="bold");const j=U.italic?"italic":"normal";z<0?(z=-z,P.fontDirection=-1):P.fontDirection=1,P.fontSize=z,P.fontFamily=U.loadedName,P.fontWeight=N,P.fontStyle=j,P.tspan=this.svgFactory.createElement("svg:tspan"),P.tspan.setAttributeNS(null,"y",e(-P.y)),P.xcoords=[],P.ycoords=[]}endText(){const g=this.current;g.textRenderingMode&d.TextRenderingMode.ADD_TO_PATH_FLAG&&g.txtElement?.hasChildNodes()&&(g.element=g.txtElement,this.clip("nonzero"),this.endPath())}setLineWidth(g){g>0&&(this.current.lineWidth=g)}setLineCap(g){this.current.lineCap=w[g]}setLineJoin(g){this.current.lineJoin=n[g]}setMiterLimit(g){this.current.miterLimit=g}setStrokeAlpha(g){this.current.strokeAlpha=g}setStrokeRGBColor(g,P,U){this.current.strokeColor=d.Util.makeHexColor(g,P,U)}setFillAlpha(g){this.current.fillAlpha=g}setFillRGBColor(g,P,U){this.current.fillColor=d.Util.makeHexColor(g,P,U),this.current.tspan=this.svgFactory.createElement("svg:tspan"),this.current.xcoords=[],this.current.ycoords=[]}setStrokeColorN(g){this.current.strokeColor=this._makeColorN_Pattern(g)}setFillColorN(g){this.current.fillColor=this._makeColorN_Pattern(g)}shadingFill(g){const{width:P,height:U}=this.viewport,z=d.Util.inverseTransform(this.transformMatrix),[N,j,W,at]=d.Util.getAxialAlignedBoundingBox([0,0,P,U],z),tt=this.svgFactory.createElement("svg:rect");tt.setAttributeNS(null,"x",N),tt.setAttributeNS(null,"y",j),tt.setAttributeNS(null,"width",W-N),tt.setAttributeNS(null,"height",at-j),tt.setAttributeNS(null,"fill",this._makeShadingPattern(g)),this.current.fillAlpha<1&&tt.setAttributeNS(null,"fill-opacity",this.current.fillAlpha),this._ensureTransformGroup().append(tt)}_makeColorN_Pattern(g){return g[0]==="TilingPattern"?this._makeTilingPattern(g):this._makeShadingPattern(g)}_makeTilingPattern(g){const P=g[1],U=g[2],z=g[3]||d.IDENTITY_MATRIX,[N,j,W,at]=g[4],tt=g[5],it=g[6],ut=g[7],J=`shading${v++}`,[L,b,p,u]=d.Util.normalizeRect([...d.Util.applyTransform([N,j],z),...d.Util.applyTransform([W,at],z)]),[_,F]=d.Util.singularValueDecompose2dScale(z),I=tt*_,O=it*F,x=this.svgFactory.createElement("svg:pattern");x.setAttributeNS(null,"id",J),x.setAttributeNS(null,"patternUnits","userSpaceOnUse"),x.setAttributeNS(null,"width",I),x.setAttributeNS(null,"height",O),x.setAttributeNS(null,"x",`${L}`),x.setAttributeNS(null,"y",`${b}`);const o=this.svg,m=this.transformMatrix,S=this.current.fillColor,T=this.current.strokeColor,D=this.svgFactory.create(p-L,u-b);if(this.svg=D,this.transformMatrix=z,ut===2){const $=d.Util.makeHexColor(...P);this.current.fillColor=$,this.current.strokeColor=$}return this.executeOpTree(this.convertOpList(U)),this.svg=o,this.transformMatrix=m,this.current.fillColor=S,this.current.strokeColor=T,x.append(D.childNodes[0]),this.defs.append(x),`url(#${J})`}_makeShadingPattern(g){switch(typeof g=="string"&&(g=this.objs.get(g)),g[0]){case"RadialAxial":const P=`shading${v++}`,U=g[3];let z;switch(g[1]){case"axial":const N=g[4],j=g[5];z=this.svgFactory.createElement("svg:linearGradient"),z.setAttributeNS(null,"id",P),z.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),z.setAttributeNS(null,"x1",N[0]),z.setAttributeNS(null,"y1",N[1]),z.setAttributeNS(null,"x2",j[0]),z.setAttributeNS(null,"y2",j[1]);break;case"radial":const W=g[4],at=g[5],tt=g[6],it=g[7];z=this.svgFactory.createElement("svg:radialGradient"),z.setAttributeNS(null,"id",P),z.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),z.setAttributeNS(null,"cx",at[0]),z.setAttributeNS(null,"cy",at[1]),z.setAttributeNS(null,"r",it),z.setAttributeNS(null,"fx",W[0]),z.setAttributeNS(null,"fy",W[1]),z.setAttributeNS(null,"fr",tt);break;default:throw new Error(`Unknown RadialAxial type: ${g[1]}`)}for(const N of U){const j=this.svgFactory.createElement("svg:stop");j.setAttributeNS(null,"offset",N[0]),j.setAttributeNS(null,"stop-color",N[1]),z.append(j)}return this.defs.append(z),`url(#${P})`;case"Mesh":return(0,d.warn)("Unimplemented pattern Mesh"),null;case"Dummy":return"hotpink";default:throw new Error(`Unknown IR type: ${g[0]}`)}}setDash(g,P){this.current.dashArray=g,this.current.dashPhase=P}constructPath(g,P){const U=this.current;let z=U.x,N=U.y,j=[],W=0;for(const at of g)switch(at|0){case d.OPS.rectangle:z=P[W++],N=P[W++];const tt=P[W++],it=P[W++],ut=z+tt,J=N+it;j.push("M",e(z),e(N),"L",e(ut),e(N),"L",e(ut),e(J),"L",e(z),e(J),"Z");break;case d.OPS.moveTo:z=P[W++],N=P[W++],j.push("M",e(z),e(N));break;case d.OPS.lineTo:z=P[W++],N=P[W++],j.push("L",e(z),e(N));break;case d.OPS.curveTo:z=P[W+4],N=P[W+5],j.push("C",e(P[W]),e(P[W+1]),e(P[W+2]),e(P[W+3]),e(z),e(N)),W+=6;break;case d.OPS.curveTo2:j.push("C",e(z),e(N),e(P[W]),e(P[W+1]),e(P[W+2]),e(P[W+3])),z=P[W+2],N=P[W+3],W+=4;break;case d.OPS.curveTo3:z=P[W+2],N=P[W+3],j.push("C",e(P[W]),e(P[W+1]),e(z),e(N),e(z),e(N)),W+=4;break;case d.OPS.closePath:j.push("Z");break}j=j.join(" "),U.path&&g.length>0&&g[0]!==d.OPS.rectangle&&g[0]!==d.OPS.moveTo?j=U.path.getAttributeNS(null,"d")+j:(U.path=this.svgFactory.createElement("svg:path"),this._ensureTransformGroup().append(U.path)),U.path.setAttributeNS(null,"d",j),U.path.setAttributeNS(null,"fill","none"),U.element=U.path,U.setCurrentPoint(z,N)}endPath(){const g=this.current;if(g.path=null,!this.pendingClip)return;if(!g.element){this.pendingClip=null;return}const P=`clippath${f++}`,U=this.svgFactory.createElement("svg:clipPath");U.setAttributeNS(null,"id",P),U.setAttributeNS(null,"transform",h(this.transformMatrix));const z=g.element.cloneNode(!0);if(this.pendingClip==="evenodd"?z.setAttributeNS(null,"clip-rule","evenodd"):z.setAttributeNS(null,"clip-rule","nonzero"),this.pendingClip=null,U.append(z),this.defs.append(U),g.activeClipUrl){g.clipGroup=null;for(const N of this.extraStack)N.clipGroup=null;U.setAttributeNS(null,"clip-path",g.activeClipUrl)}g.activeClipUrl=`url(#${P})`,this.tgrp=null}clip(g){this.pendingClip=g}closePath(){const g=this.current;if(g.path){const P=`${g.path.getAttributeNS(null,"d")}Z`;g.path.setAttributeNS(null,"d",P)}}setLeading(g){this.current.leading=-g}setTextRise(g){this.current.textRise=g}setTextRenderingMode(g){this.current.textRenderingMode=g}setHScale(g){this.current.textHScale=g/100}setRenderingIntent(g){}setFlatness(g){}setGState(g){for(const[P,U]of g)switch(P){case"LW":this.setLineWidth(U);break;case"LC":this.setLineCap(U);break;case"LJ":this.setLineJoin(U);break;case"ML":this.setMiterLimit(U);break;case"D":this.setDash(U[0],U[1]);break;case"RI":this.setRenderingIntent(U);break;case"FL":this.setFlatness(U);break;case"Font":this.setFont(U);break;case"CA":this.setStrokeAlpha(U);break;case"ca":this.setFillAlpha(U);break;default:(0,d.warn)(`Unimplemented graphic state operator ${P}`);break}}fill(){const g=this.current;g.element&&(g.element.setAttributeNS(null,"fill",g.fillColor),g.element.setAttributeNS(null,"fill-opacity",g.fillAlpha),this.endPath())}stroke(){const g=this.current;g.element&&(this._setStrokeAttributes(g.element),g.element.setAttributeNS(null,"fill","none"),this.endPath())}_setStrokeAttributes(g,P=1){const U=this.current;let z=U.dashArray;P!==1&&z.length>0&&(z=z.map(function(N){return P*N})),g.setAttributeNS(null,"stroke",U.strokeColor),g.setAttributeNS(null,"stroke-opacity",U.strokeAlpha),g.setAttributeNS(null,"stroke-miterlimit",e(U.miterLimit)),g.setAttributeNS(null,"stroke-linecap",U.lineCap),g.setAttributeNS(null,"stroke-linejoin",U.lineJoin),g.setAttributeNS(null,"stroke-width",e(P*U.lineWidth)+"px"),g.setAttributeNS(null,"stroke-dasharray",z.map(e).join(" ")),g.setAttributeNS(null,"stroke-dashoffset",e(P*U.dashPhase)+"px")}eoFill(){this.current.element?.setAttributeNS(null,"fill-rule","evenodd"),this.fill()}fillStroke(){this.stroke(),this.fill()}eoFillStroke(){this.current.element?.setAttributeNS(null,"fill-rule","evenodd"),this.fillStroke()}closeStroke(){this.closePath(),this.stroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.closePath(),this.eoFillStroke()}paintSolidColorImageMask(){const g=this.svgFactory.createElement("svg:rect");g.setAttributeNS(null,"x","0"),g.setAttributeNS(null,"y","0"),g.setAttributeNS(null,"width","1px"),g.setAttributeNS(null,"height","1px"),g.setAttributeNS(null,"fill",this.current.fillColor),this._ensureTransformGroup().append(g)}paintImageXObject(g){const P=this.getObject(g);if(!P){(0,d.warn)(`Dependent image with object ID ${g} is not ready yet`);return}this.paintInlineImageXObject(P)}paintInlineImageXObject(g,P){const U=g.width,z=g.height,N=r(g,this.forceDataSchema,!!P),j=this.svgFactory.createElement("svg:rect");j.setAttributeNS(null,"x","0"),j.setAttributeNS(null,"y","0"),j.setAttributeNS(null,"width",e(U)),j.setAttributeNS(null,"height",e(z)),this.current.element=j,this.clip("nonzero");const W=this.svgFactory.createElement("svg:image");W.setAttributeNS(M,"xlink:href",N),W.setAttributeNS(null,"x","0"),W.setAttributeNS(null,"y",e(-z)),W.setAttributeNS(null,"width",e(U)+"px"),W.setAttributeNS(null,"height",e(z)+"px"),W.setAttributeNS(null,"transform",`scale(${e(1/U)} ${e(-1/z)})`),P?P.append(W):this._ensureTransformGroup().append(W)}paintImageMaskXObject(g){const P=this.getObject(g.data,g);if(P.bitmap){(0,d.warn)("paintImageMaskXObject: ImageBitmap support is not implemented, ensure that the `isOffscreenCanvasSupported` API parameter is disabled.");return}const U=this.current,z=P.width,N=P.height,j=U.fillColor;U.maskId=`mask${a++}`;const W=this.svgFactory.createElement("svg:mask");W.setAttributeNS(null,"id",U.maskId);const at=this.svgFactory.createElement("svg:rect");at.setAttributeNS(null,"x","0"),at.setAttributeNS(null,"y","0"),at.setAttributeNS(null,"width",e(z)),at.setAttributeNS(null,"height",e(N)),at.setAttributeNS(null,"fill",j),at.setAttributeNS(null,"mask",`url(#${U.maskId})`),this.defs.append(W),this._ensureTransformGroup().append(at),this.paintInlineImageXObject(P,W)}paintFormXObjectBegin(g,P){if(Array.isArray(g)&&g.length===6&&this.transform(g[0],g[1],g[2],g[3],g[4],g[5]),P){const U=P[2]-P[0],z=P[3]-P[1],N=this.svgFactory.createElement("svg:rect");N.setAttributeNS(null,"x",P[0]),N.setAttributeNS(null,"y",P[1]),N.setAttributeNS(null,"width",e(U)),N.setAttributeNS(null,"height",e(z)),this.current.element=N,this.clip("nonzero"),this.endPath()}}paintFormXObjectEnd(){}_initialize(g){const P=this.svgFactory.create(g.width,g.height),U=this.svgFactory.createElement("svg:defs");P.append(U),this.defs=U;const z=this.svgFactory.createElement("svg:g");return z.setAttributeNS(null,"transform",h(g.transform)),P.append(z),this.svg=z,P}_ensureClipGroup(){if(!this.current.clipGroup){const g=this.svgFactory.createElement("svg:g");g.setAttributeNS(null,"clip-path",this.current.activeClipUrl),this.svg.append(g),this.current.clipGroup=g}return this.current.clipGroup}_ensureTransformGroup(){return this.tgrp||(this.tgrp=this.svgFactory.createElement("svg:g"),this.tgrp.setAttributeNS(null,"transform",h(this.transformMatrix)),this.current.activeClipUrl?this._ensureClipGroup().append(this.tgrp):this.svg.append(this.tgrp)),this.tgrp}}s.SVGGraphics=R},(E,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.XfaText=void 0;class y{static textContent(d){const C=[],A={items:C,styles:Object.create(null)};function M(w){if(!w)return;let n=null;const t=w.name;if(t==="#text")n=w.value;else if(y.shouldBuildText(t))w?.attributes?.textContent?n=w.attributes.textContent:w.value&&(n=w.value);else return;if(n!==null&&C.push({str:n}),!!w.children)for(const r of w.children)M(r)}return M(d),A}static shouldBuildText(d){return!(d==="textarea"||d==="input"||d==="option"||d==="select")}}s.XfaText=y},(E,s,y)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.TextLayerRenderTask=void 0,s.renderTextLayer=h,s.updateTextLayer=f;var i=y(1),d=y(6);const C=1e5,A=30,M=.8,w=new Map;function n(a,v){let R;if(v&&i.FeatureTest.isOffscreenCanvasSupported)R=new OffscreenCanvas(a,a).getContext("2d",{alpha:!1});else{const k=document.createElement("canvas");k.width=k.height=a,R=k.getContext("2d",{alpha:!1})}return R}function t(a,v){const R=w.get(a);if(R)return R;const k=n(A,v);k.font=`${A}px ${a}`;const g=k.measureText("");let P=g.fontBoundingBoxAscent,U=Math.abs(g.fontBoundingBoxDescent);if(P){const N=P/(P+U);return w.set(a,N),k.canvas.width=k.canvas.height=0,N}k.strokeStyle="red",k.clearRect(0,0,A,A),k.strokeText("g",0,0);let z=k.getImageData(0,0,A,A).data;U=0;for(let N=z.length-1-3;N>=0;N-=4)if(z[N]>0){U=Math.ceil(N/4/A);break}k.clearRect(0,0,A,A),k.strokeText("A",0,A),z=k.getImageData(0,0,A,A).data,P=0;for(let N=0,j=z.length;N<j;N+=4)if(z[N]>0){P=A-Math.floor(N/4/A);break}if(k.canvas.width=k.canvas.height=0,P){const N=P/(P+U);return w.set(a,N),N}return w.set(a,M),M}function r(a,v,R){const k=document.createElement("span"),g={angle:0,canvasWidth:0,hasText:v.str!=="",hasEOL:v.hasEOL,fontSize:0};a._textDivs.push(k);const P=i.Util.transform(a._transform,v.transform);let U=Math.atan2(P[1],P[0]);const z=R[v.fontName];z.vertical&&(U+=Math.PI/2);const N=Math.hypot(P[2],P[3]),j=N*t(z.fontFamily,a._isOffscreenCanvasSupported);let W,at;U===0?(W=P[4],at=P[5]-j):(W=P[4]+j*Math.sin(U),at=P[5]-j*Math.cos(U));const tt="calc(var(--scale-factor)*",it=k.style;a._container===a._rootContainer?(it.left=`${(100*W/a._pageWidth).toFixed(2)}%`,it.top=`${(100*at/a._pageHeight).toFixed(2)}%`):(it.left=`${tt}${W.toFixed(2)}px)`,it.top=`${tt}${at.toFixed(2)}px)`),it.fontSize=`${tt}${N.toFixed(2)}px)`,it.fontFamily=z.fontFamily,g.fontSize=N,k.setAttribute("role","presentation"),k.textContent=v.str,k.dir=v.dir,a._fontInspectorEnabled&&(k.dataset.fontName=v.fontName),U!==0&&(g.angle=U*(180/Math.PI));let ut=!1;if(v.str.length>1)ut=!0;else if(v.str!==" "&&v.transform[0]!==v.transform[3]){const J=Math.abs(v.transform[0]),L=Math.abs(v.transform[3]);J!==L&&Math.max(J,L)/Math.min(J,L)>1.5&&(ut=!0)}ut&&(g.canvasWidth=z.vertical?v.height:v.width),a._textDivProperties.set(k,g),a._isReadableStream&&a._layoutText(k)}function l(a){const{div:v,scale:R,properties:k,ctx:g,prevFontSize:P,prevFontFamily:U}=a,{style:z}=v;let N="";if(k.canvasWidth!==0&&k.hasText){const{fontFamily:j}=z,{canvasWidth:W,fontSize:at}=k;(P!==at||U!==j)&&(g.font=`${at*R}px ${j}`,a.prevFontSize=at,a.prevFontFamily=j);const{width:tt}=g.measureText(v.textContent);tt>0&&(N=`scaleX(${W*R/tt})`)}k.angle!==0&&(N=`rotate(${k.angle}deg) ${N}`),N.length>0&&(z.transform=N)}function c(a){if(a._canceled)return;const v=a._textDivs,R=a._capability;if(v.length>C){R.resolve();return}if(!a._isReadableStream)for(const g of v)a._layoutText(g);R.resolve()}class e{constructor({textContentSource:v,container:R,viewport:k,textDivs:g,textDivProperties:P,textContentItemsStr:U,isOffscreenCanvasSupported:z}){this._textContentSource=v,this._isReadableStream=v instanceof ReadableStream,this._container=this._rootContainer=R,this._textDivs=g||[],this._textContentItemsStr=U||[],this._isOffscreenCanvasSupported=z,this._fontInspectorEnabled=!!globalThis.FontInspector?.enabled,this._reader=null,this._textDivProperties=P||new WeakMap,this._canceled=!1,this._capability=new i.PromiseCapability,this._layoutTextParams={prevFontSize:null,prevFontFamily:null,div:null,scale:k.scale*(globalThis.devicePixelRatio||1),properties:null,ctx:n(0,z)};const{pageWidth:N,pageHeight:j,pageX:W,pageY:at}=k.rawDims;this._transform=[1,0,0,-1,-W,at+j],this._pageWidth=N,this._pageHeight=j,(0,d.setLayerDimensions)(R,k),this._capability.promise.finally(()=>{this._layoutTextParams=null}).catch(()=>{})}get promise(){return this._capability.promise}cancel(){this._canceled=!0,this._reader&&(this._reader.cancel(new i.AbortException("TextLayer task cancelled.")).catch(()=>{}),this._reader=null),this._capability.reject(new i.AbortException("TextLayer task cancelled."))}_processItems(v,R){for(const k of v){if(k.str===void 0){if(k.type==="beginMarkedContentProps"||k.type==="beginMarkedContent"){const g=this._container;this._container=document.createElement("span"),this._container.classList.add("markedContent"),k.id!==null&&this._container.setAttribute("id",`${k.id}`),g.append(this._container)}else k.type==="endMarkedContent"&&(this._container=this._container.parentNode);continue}this._textContentItemsStr.push(k.str),r(this,k,R)}}_layoutText(v){const R=this._layoutTextParams.properties=this._textDivProperties.get(v);if(this._layoutTextParams.div=v,l(this._layoutTextParams),R.hasText&&this._container.append(v),R.hasEOL){const k=document.createElement("br");k.setAttribute("role","presentation"),this._container.append(k)}}_render(){const v=new i.PromiseCapability;let R=Object.create(null);if(this._isReadableStream){const k=()=>{this._reader.read().then(({value:g,done:P})=>{if(P){v.resolve();return}Object.assign(R,g.styles),this._processItems(g.items,R),k()},v.reject)};this._reader=this._textContentSource.getReader(),k()}else if(this._textContentSource){const{items:k,styles:g}=this._textContentSource;this._processItems(k,g),v.resolve()}else throw new Error('No "textContentSource" parameter specified.');v.promise.then(()=>{R=null,c(this)},this._capability.reject)}}s.TextLayerRenderTask=e;function h(a){!a.textContentSource&&(a.textContent||a.textContentStream)&&((0,d.deprecated)("The TextLayerRender `textContent`/`textContentStream` parameters will be removed in the future, please use `textContentSource` instead."),a.textContentSource=a.textContent||a.textContentStream);const{container:v,viewport:R}=a,k=getComputedStyle(v),g=k.getPropertyValue("visibility"),P=parseFloat(k.getPropertyValue("--scale-factor"));g==="visible"&&(!P||Math.abs(P-R.scale)>1e-5)&&console.error("The `--scale-factor` CSS-variable must be set, to the same value as `viewport.scale`, either on the `container`-element itself or higher up in the DOM.");const U=new e(a);return U._render(),U}function f({container:a,viewport:v,textDivs:R,textDivProperties:k,isOffscreenCanvasSupported:g,mustRotate:P=!0,mustRescale:U=!0}){if(P&&(0,d.setLayerDimensions)(a,{rotation:v.rotation}),U){const z=n(0,g),j={prevFontSize:null,prevFontFamily:null,div:null,scale:v.scale*(globalThis.devicePixelRatio||1),properties:null,ctx:z};for(const W of R)j.properties=k.get(W),j.div=W,l(j)}}},(E,s,y)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.AnnotationEditorLayer=void 0;var i=y(1),d=y(4),C=y(28),A=y(33),M=y(6),w=y(34);class n{#t;#e=!1;#r=null;#s=this.pointerup.bind(this);#o=this.pointerdown.bind(this);#a=new Map;#n=!1;#l=!1;#c=!1;#i;static _initialized=!1;constructor({uiManager:r,pageIndex:l,div:c,accessibilityManager:e,annotationLayer:h,viewport:f,l10n:a}){const v=[C.FreeTextEditor,A.InkEditor,w.StampEditor];if(!n._initialized){n._initialized=!0;for(const R of v)R.initialize(a)}r.registerEditorTypes(v),this.#i=r,this.pageIndex=l,this.div=c,this.#t=e,this.#r=h,this.viewport=f,this.#i.addLayer(this)}get isEmpty(){return this.#a.size===0}updateToolbar(r){this.#i.updateToolbar(r)}updateMode(r=this.#i.getMode()){this.#f(),r===i.AnnotationEditorType.INK?(this.addInkEditorIfNeeded(!1),this.disableClick()):this.enableClick(),r!==i.AnnotationEditorType.NONE&&(this.div.classList.toggle("freeTextEditing",r===i.AnnotationEditorType.FREETEXT),this.div.classList.toggle("inkEditing",r===i.AnnotationEditorType.INK),this.div.classList.toggle("stampEditing",r===i.AnnotationEditorType.STAMP),this.div.hidden=!1)}addInkEditorIfNeeded(r){if(!r&&this.#i.getMode()!==i.AnnotationEditorType.INK)return;if(!r){for(const c of this.#a.values())if(c.isEmpty()){c.setInBackground();return}}this.#h({offsetX:0,offsetY:0},!1).setInBackground()}setEditingState(r){this.#i.setEditingState(r)}addCommands(r){this.#i.addCommands(r)}enable(){this.div.style.pointerEvents="auto";const r=new Set;for(const c of this.#a.values())c.enableEditing(),c.annotationElementId&&r.add(c.annotationElementId);if(!this.#r)return;const l=this.#r.getEditableAnnotations();for(const c of l){if(c.hide(),this.#i.isDeletedAnnotationElement(c.data.id)||r.has(c.data.id))continue;const e=this.deserialize(c);e&&(this.addOrRebuild(e),e.enableEditing())}}disable(){this.#c=!0,this.div.style.pointerEvents="none";const r=new Set;for(const l of this.#a.values()){if(l.disableEditing(),!l.annotationElementId||l.serialize()!==null){r.add(l.annotationElementId);continue}this.getEditableAnnotation(l.annotationElementId)?.show(),l.remove()}if(this.#r){const l=this.#r.getEditableAnnotations();for(const c of l){const{id:e}=c.data;r.has(e)||this.#i.isDeletedAnnotationElement(e)||c.show()}}this.#f(),this.isEmpty&&(this.div.hidden=!0),this.#c=!1}getEditableAnnotation(r){return this.#r?.getEditableAnnotation(r)||null}setActiveEditor(r){this.#i.getActive()!==r&&this.#i.setActiveEditor(r)}enableClick(){this.div.addEventListener("pointerdown",this.#o),this.div.addEventListener("pointerup",this.#s)}disableClick(){this.div.removeEventListener("pointerdown",this.#o),this.div.removeEventListener("pointerup",this.#s)}attach(r){this.#a.set(r.id,r);const{annotationElementId:l}=r;l&&this.#i.isDeletedAnnotationElement(l)&&this.#i.removeDeletedAnnotationElement(r)}detach(r){this.#a.delete(r.id),this.#t?.removePointerInTextLayer(r.contentDiv),!this.#c&&r.annotationElementId&&this.#i.addDeletedAnnotationElement(r)}remove(r){this.detach(r),this.#i.removeEditor(r),r.div.contains(document.activeElement)&&setTimeout(()=>{this.#i.focusMainContainer()},0),r.div.remove(),r.isAttachedToDOM=!1,this.#l||this.addInkEditorIfNeeded(!1)}changeParent(r){r.parent!==this&&(r.annotationElementId&&(this.#i.addDeletedAnnotationElement(r.annotationElementId),d.AnnotationEditor.deleteAnnotationElement(r),r.annotationElementId=null),this.attach(r),r.parent?.detach(r),r.setParent(this),r.div&&r.isAttachedToDOM&&(r.div.remove(),this.div.append(r.div)))}add(r){if(this.changeParent(r),this.#i.addEditor(r),this.attach(r),!r.isAttachedToDOM){const l=r.render();this.div.append(l),r.isAttachedToDOM=!0}r.fixAndSetPosition(),r.onceAdded(),this.#i.addToAnnotationStorage(r)}moveEditorInDOM(r){if(!r.isAttachedToDOM)return;const{activeElement:l}=document;r.div.contains(l)&&(r._focusEventsAllowed=!1,setTimeout(()=>{r.div.contains(document.activeElement)?r._focusEventsAllowed=!0:(r.div.addEventListener("focusin",()=>{r._focusEventsAllowed=!0},{once:!0}),l.focus())},0)),r._structTreeParentId=this.#t?.moveElementInDOM(this.div,r.div,r.contentDiv,!0)}addOrRebuild(r){r.needsToBeRebuilt()?r.rebuild():this.add(r)}addUndoableEditor(r){const l=()=>r._uiManager.rebuild(r),c=()=>{r.remove()};this.addCommands({cmd:l,undo:c,mustExec:!1})}getNextId(){return this.#i.getId()}#p(r){switch(this.#i.getMode()){case i.AnnotationEditorType.FREETEXT:return new C.FreeTextEditor(r);case i.AnnotationEditorType.INK:return new A.InkEditor(r);case i.AnnotationEditorType.STAMP:return new w.StampEditor(r)}return null}pasteEditor(r,l){this.#i.updateToolbar(r),this.#i.updateMode(r);const{offsetX:c,offsetY:e}=this.#u(),h=this.getNextId(),f=this.#p({parent:this,id:h,x:c,y:e,uiManager:this.#i,isCentered:!0,...l});f&&this.add(f)}deserialize(r){switch(r.annotationType??r.annotationEditorType){case i.AnnotationEditorType.FREETEXT:return C.FreeTextEditor.deserialize(r,this,this.#i);case i.AnnotationEditorType.INK:return A.InkEditor.deserialize(r,this,this.#i);case i.AnnotationEditorType.STAMP:return w.StampEditor.deserialize(r,this,this.#i)}return null}#h(r,l){const c=this.getNextId(),e=this.#p({parent:this,id:c,x:r.offsetX,y:r.offsetY,uiManager:this.#i,isCentered:l});return e&&this.add(e),e}#u(){const{x:r,y:l,width:c,height:e}=this.div.getBoundingClientRect(),h=Math.max(0,r),f=Math.max(0,l),a=Math.min(window.innerWidth,r+c),v=Math.min(window.innerHeight,l+e),R=(h+a)/2-r,k=(f+v)/2-l,[g,P]=this.viewport.rotation%180===0?[R,k]:[k,R];return{offsetX:g,offsetY:P}}addNewEditor(){this.#h(this.#u(),!0)}setSelected(r){this.#i.setSelected(r)}toggleSelected(r){this.#i.toggleSelected(r)}isSelected(r){return this.#i.isSelected(r)}unselect(r){this.#i.unselect(r)}pointerup(r){const{isMac:l}=i.FeatureTest.platform;if(!(r.button!==0||r.ctrlKey&&l)&&r.target===this.div&&this.#n){if(this.#n=!1,!this.#e){this.#e=!0;return}if(this.#i.getMode()===i.AnnotationEditorType.STAMP){this.#i.unselectAll();return}this.#h(r,!1)}}pointerdown(r){if(this.#n){this.#n=!1;return}const{isMac:l}=i.FeatureTest.platform;if(r.button!==0||r.ctrlKey&&l||r.target!==this.div)return;this.#n=!0;const c=this.#i.getActive();this.#e=!c||c.isEmpty()}findNewParent(r,l,c){const e=this.#i.findParent(l,c);return e===null||e===this?!1:(e.changeParent(r),!0)}destroy(){this.#i.getActive()?.parent===this&&(this.#i.commitOrRemove(),this.#i.setActiveEditor(null));for(const r of this.#a.values())this.#t?.removePointerInTextLayer(r.contentDiv),r.setParent(null),r.isAttachedToDOM=!1,r.div.remove();this.div=null,this.#a.clear(),this.#i.removeLayer(this)}#f(){this.#l=!0;for(const r of this.#a.values())r.isEmpty()&&r.remove();this.#l=!1}render({viewport:r}){this.viewport=r,(0,M.setLayerDimensions)(this.div,r);for(const l of this.#i.getEditors(this.pageIndex))this.add(l);this.updateMode()}update({viewport:r}){this.#i.commitOrRemove(),this.viewport=r,(0,M.setLayerDimensions)(this.div,{rotation:r.rotation}),this.updateMode()}get pageDimensions(){const{pageWidth:r,pageHeight:l}=this.viewport.rawDims;return[r,l]}}s.AnnotationEditorLayer=n},(E,s,y)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.FreeTextEditor=void 0;var i=y(1),d=y(5),C=y(4),A=y(29);class M extends C.AnnotationEditor{#t=this.editorDivBlur.bind(this);#e=this.editorDivFocus.bind(this);#r=this.editorDivInput.bind(this);#s=this.editorDivKeydown.bind(this);#o;#a="";#n=`${this.id}-editor`;#l;#c=null;static _freeTextDefaultContent="";static _internalPadding=0;static _defaultColor=null;static _defaultFontSize=10;static get _keyboardManager(){const n=M.prototype,t=c=>c.isEmpty(),r=d.AnnotationEditorUIManager.TRANSLATE_SMALL,l=d.AnnotationEditorUIManager.TRANSLATE_BIG;return(0,i.shadow)(this,"_keyboardManager",new d.KeyboardManager([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],n.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],n.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],n._translateEmpty,{args:[-r,0],checker:t}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],n._translateEmpty,{args:[-l,0],checker:t}],[["ArrowRight","mac+ArrowRight"],n._translateEmpty,{args:[r,0],checker:t}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],n._translateEmpty,{args:[l,0],checker:t}],[["ArrowUp","mac+ArrowUp"],n._translateEmpty,{args:[0,-r],checker:t}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],n._translateEmpty,{args:[0,-l],checker:t}],[["ArrowDown","mac+ArrowDown"],n._translateEmpty,{args:[0,r],checker:t}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],n._translateEmpty,{args:[0,l],checker:t}]]))}static _type="freetext";constructor(n){super({...n,name:"freeTextEditor"}),this.#o=n.color||M._defaultColor||C.AnnotationEditor._defaultLineColor,this.#l=n.fontSize||M._defaultFontSize}static initialize(n){C.AnnotationEditor.initialize(n,{strings:["free_text2_default_content","editor_free_text2_aria_label"]});const t=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(t.getPropertyValue("--freetext-padding"))}static updateDefaultParams(n,t){switch(n){case i.AnnotationEditorParamsType.FREETEXT_SIZE:M._defaultFontSize=t;break;case i.AnnotationEditorParamsType.FREETEXT_COLOR:M._defaultColor=t;break}}updateParams(n,t){switch(n){case i.AnnotationEditorParamsType.FREETEXT_SIZE:this.#i(t);break;case i.AnnotationEditorParamsType.FREETEXT_COLOR:this.#p(t);break}}static get defaultPropertiesToUpdate(){return[[i.AnnotationEditorParamsType.FREETEXT_SIZE,M._defaultFontSize],[i.AnnotationEditorParamsType.FREETEXT_COLOR,M._defaultColor||C.AnnotationEditor._defaultLineColor]]}get propertiesToUpdate(){return[[i.AnnotationEditorParamsType.FREETEXT_SIZE,this.#l],[i.AnnotationEditorParamsType.FREETEXT_COLOR,this.#o]]}#i(n){const t=l=>{this.editorDiv.style.fontSize=`calc(${l}px * var(--scale-factor))`,this.translate(0,-(l-this.#l)*this.parentScale),this.#l=l,this.#u()},r=this.#l;this.addCommands({cmd:()=>{t(n)},undo:()=>{t(r)},mustExec:!0,type:i.AnnotationEditorParamsType.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})}#p(n){const t=this.#o;this.addCommands({cmd:()=>{this.#o=this.editorDiv.style.color=n},undo:()=>{this.#o=this.editorDiv.style.color=t},mustExec:!0,type:i.AnnotationEditorParamsType.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})}_translateEmpty(n,t){this._uiManager.translateSelectedEditors(n,t,!0)}getInitialTranslation(){const n=this.parentScale;return[-M._internalPadding*n,-(M._internalPadding+this.#l)*n]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){this.isInEditMode()||(this.parent.setEditingState(!1),this.parent.updateToolbar(i.AnnotationEditorType.FREETEXT),super.enableEditMode(),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),this.editorDiv.addEventListener("keydown",this.#s),this.editorDiv.addEventListener("focus",this.#e),this.editorDiv.addEventListener("blur",this.#t),this.editorDiv.addEventListener("input",this.#r))}disableEditMode(){this.isInEditMode()&&(this.parent.setEditingState(!0),super.disableEditMode(),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",this.#n),this._isDraggable=!0,this.editorDiv.removeEventListener("keydown",this.#s),this.editorDiv.removeEventListener("focus",this.#e),this.editorDiv.removeEventListener("blur",this.#t),this.editorDiv.removeEventListener("input",this.#r),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freeTextEditing"))}focusin(n){this._focusEventsAllowed&&(super.focusin(n),n.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(){if(this.width){this.#m();return}this.enableEditMode(),this.editorDiv.focus(),this._initialOptions?.isCentered&&this.center(),this._initialOptions=null}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freeTextEditing")),super.remove()}#h(){const n=this.editorDiv.getElementsByTagName("div");if(n.length===0)return this.editorDiv.innerText;const t=[];for(const r of n)t.push(r.innerText.replace(/\r\n?|\n/,""));return t.join(`
`)}#u(){const[n,t]=this.parentDimensions;let r;if(this.isAttachedToDOM)r=this.div.getBoundingClientRect();else{const{currentLayer:l,div:c}=this,e=c.style.display;c.style.display="hidden",l.div.append(this.div),r=c.getBoundingClientRect(),c.remove(),c.style.display=e}this.rotation%180===this.parentRotation%180?(this.width=r.width/n,this.height=r.height/t):(this.width=r.height/n,this.height=r.width/t),this.fixAndSetPosition()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const n=this.#a,t=this.#a=this.#h().trimEnd();if(n===t)return;const r=l=>{if(this.#a=l,!l){this.remove();return}this.#f(),this._uiManager.rebuild(this),this.#u()};this.addCommands({cmd:()=>{r(t)},undo:()=>{r(n)},mustExec:!1}),this.#u()}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}dblclick(n){this.enterInEditMode()}keydown(n){n.target===this.div&&n.key==="Enter"&&(this.enterInEditMode(),n.preventDefault())}editorDivKeydown(n){M._keyboardManager.exec(this,n)}editorDivFocus(n){this.isEditing=!0}editorDivBlur(n){this.isEditing=!1}editorDivInput(n){this.parent.div.classList.toggle("freeTextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}render(){if(this.div)return this.div;let n,t;this.width&&(n=this.x,t=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",this.#n),this.enableEditing(),C.AnnotationEditor._l10nPromise.get("editor_free_text2_aria_label").then(l=>this.editorDiv?.setAttribute("aria-label",l)),C.AnnotationEditor._l10nPromise.get("free_text2_default_content").then(l=>this.editorDiv?.setAttribute("default-content",l)),this.editorDiv.contentEditable=!0;const{style:r}=this.editorDiv;if(r.fontSize=`calc(${this.#l}px * var(--scale-factor))`,r.color=this.#o,this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),(0,d.bindEvents)(this,this.div,["dblclick","keydown"]),this.width){const[l,c]=this.parentDimensions;if(this.annotationElementId){const{position:e}=this.#c;let[h,f]=this.getInitialTranslation();[h,f]=this.pageTranslationToScreen(h,f);const[a,v]=this.pageDimensions,[R,k]=this.pageTranslation;let g,P;switch(this.rotation){case 0:g=n+(e[0]-R)/a,P=t+this.height-(e[1]-k)/v;break;case 90:g=n+(e[0]-R)/a,P=t-(e[1]-k)/v,[h,f]=[f,-h];break;case 180:g=n-this.width+(e[0]-R)/a,P=t-(e[1]-k)/v,[h,f]=[-h,-f];break;case 270:g=n+(e[0]-R-this.height*v)/a,P=t+(e[1]-k-this.width*a)/v,[h,f]=[-f,h];break}this.setAt(g*l,P*c,h,f)}else this.setAt(n*l,t*c,this.width*l,this.height*c);this.#f(),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}#f(){if(this.editorDiv.replaceChildren(),!!this.#a)for(const n of this.#a.split(`
`)){const t=document.createElement("div");t.append(n?document.createTextNode(n):document.createElement("br")),this.editorDiv.append(t)}}get contentDiv(){return this.editorDiv}static deserialize(n,t,r){let l=null;if(n instanceof A.FreeTextAnnotationElement){const{data:{defaultAppearanceData:{fontSize:e,fontColor:h},rect:f,rotation:a,id:v},textContent:R,textPosition:k,parent:{page:{pageNumber:g}}}=n;if(!R||R.length===0)return null;l=n={annotationType:i.AnnotationEditorType.FREETEXT,color:Array.from(h),fontSize:e,value:R.join(`
`),position:k,pageIndex:g-1,rect:f,rotation:a,id:v,deleted:!1}}const c=super.deserialize(n,t,r);return c.#l=n.fontSize,c.#o=i.Util.makeHexColor(...n.color),c.#a=n.value,c.annotationElementId=n.id||null,c.#c=l,c}serialize(n=!1){if(this.isEmpty())return null;if(this.deleted)return{pageIndex:this.pageIndex,id:this.annotationElementId,deleted:!0};const t=M._internalPadding*this.parentScale,r=this.getRect(t,t),l=C.AnnotationEditor._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:this.#o),c={annotationType:i.AnnotationEditorType.FREETEXT,color:l,fontSize:this.#l,value:this.#a,pageIndex:this.pageIndex,rect:r,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return n?c:this.annotationElementId&&!this.#y(c)?null:(c.id=this.annotationElementId,c)}#y(n){const{value:t,fontSize:r,color:l,rect:c,pageIndex:e}=this.#c;return n.value!==t||n.fontSize!==r||n.rect.some((h,f)=>Math.abs(h-c[f])>=1)||n.color.some((h,f)=>h!==l[f])||n.pageIndex!==e}#m(n=!1){if(!this.annotationElementId)return;if(this.#u(),!n&&(this.width===0||this.height===0)){setTimeout(()=>this.#m(!0),0);return}const t=M._internalPadding*this.parentScale;this.#c.rect=this.getRect(t,t)}}s.FreeTextEditor=M},(E,s,y)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.StampAnnotationElement=s.InkAnnotationElement=s.FreeTextAnnotationElement=s.AnnotationLayer=void 0;var i=y(1),d=y(6),C=y(3),A=y(30),M=y(31),w=y(32);const n=1e3,t=9,r=new WeakSet;function l(x){return{width:x[2]-x[0],height:x[3]-x[1]}}class c{static create(o){switch(o.data.annotationType){case i.AnnotationType.LINK:return new h(o);case i.AnnotationType.TEXT:return new f(o);case i.AnnotationType.WIDGET:switch(o.data.fieldType){case"Tx":return new v(o);case"Btn":return o.data.radioButton?new g(o):o.data.checkBox?new k(o):new P(o);case"Ch":return new U(o);case"Sig":return new R(o)}return new a(o);case i.AnnotationType.POPUP:return new z(o);case i.AnnotationType.FREETEXT:return new j(o);case i.AnnotationType.LINE:return new W(o);case i.AnnotationType.SQUARE:return new at(o);case i.AnnotationType.CIRCLE:return new tt(o);case i.AnnotationType.POLYLINE:return new it(o);case i.AnnotationType.CARET:return new J(o);case i.AnnotationType.INK:return new L(o);case i.AnnotationType.POLYGON:return new ut(o);case i.AnnotationType.HIGHLIGHT:return new b(o);case i.AnnotationType.UNDERLINE:return new p(o);case i.AnnotationType.SQUIGGLY:return new u(o);case i.AnnotationType.STRIKEOUT:return new _(o);case i.AnnotationType.STAMP:return new F(o);case i.AnnotationType.FILEATTACHMENT:return new I(o);default:return new e(o)}}}class e{#t=!1;constructor(o,{isRenderable:m=!1,ignoreBorder:S=!1,createQuadrilaterals:T=!1}={}){this.isRenderable=m,this.data=o.data,this.layer=o.layer,this.linkService=o.linkService,this.downloadManager=o.downloadManager,this.imageResourcesPath=o.imageResourcesPath,this.renderForms=o.renderForms,this.svgFactory=o.svgFactory,this.annotationStorage=o.annotationStorage,this.enableScripting=o.enableScripting,this.hasJSActions=o.hasJSActions,this._fieldObjects=o.fieldObjects,this.parent=o.parent,m&&(this.container=this._createContainer(S)),T&&this._createQuadrilaterals()}static _hasPopupData({titleObj:o,contentsObj:m,richText:S}){return!!(o?.str||m?.str||S?.str)}get hasPopupData(){return e._hasPopupData(this.data)}_createContainer(o){const{data:m,parent:{page:S,viewport:T}}=this,D=document.createElement("section");D.setAttribute("data-annotation-id",m.id),this instanceof a||(D.tabIndex=n),D.style.zIndex=this.parent.zIndex++,this.data.popupRef&&D.setAttribute("aria-haspopup","dialog"),m.noRotate&&D.classList.add("norotate");const{pageWidth:$,pageHeight:B,pageX:G,pageY:lt}=T.rawDims;if(!m.rect||this instanceof z){const{rotation:et}=m;return!m.hasOwnCanvas&&et!==0&&this.setRotation(et,D),D}const{width:V,height:X}=l(m.rect),K=i.Util.normalizeRect([m.rect[0],S.view[3]-m.rect[1]+S.view[1],m.rect[2],S.view[3]-m.rect[3]+S.view[1]]);if(!o&&m.borderStyle.width>0){D.style.borderWidth=`${m.borderStyle.width}px`;const et=m.borderStyle.horizontalCornerRadius,gt=m.borderStyle.verticalCornerRadius;if(et>0||gt>0){const Tt=`calc(${et}px * var(--scale-factor)) / calc(${gt}px * var(--scale-factor))`;D.style.borderRadius=Tt}else if(this instanceof g){const Tt=`calc(${V}px * var(--scale-factor)) / calc(${X}px * var(--scale-factor))`;D.style.borderRadius=Tt}switch(m.borderStyle.style){case i.AnnotationBorderStyleType.SOLID:D.style.borderStyle="solid";break;case i.AnnotationBorderStyleType.DASHED:D.style.borderStyle="dashed";break;case i.AnnotationBorderStyleType.BEVELED:(0,i.warn)("Unimplemented border style: beveled");break;case i.AnnotationBorderStyleType.INSET:(0,i.warn)("Unimplemented border style: inset");break;case i.AnnotationBorderStyleType.UNDERLINE:D.style.borderBottomStyle="solid";break}const wt=m.borderColor||null;wt?(this.#t=!0,D.style.borderColor=i.Util.makeHexColor(wt[0]|0,wt[1]|0,wt[2]|0)):D.style.borderWidth=0}D.style.left=`${100*(K[0]-G)/$}%`,D.style.top=`${100*(K[1]-lt)/B}%`;const{rotation:Y}=m;return m.hasOwnCanvas||Y===0?(D.style.width=`${100*V/$}%`,D.style.height=`${100*X/B}%`):this.setRotation(Y,D),D}setRotation(o,m=this.container){if(!this.data.rect)return;const{pageWidth:S,pageHeight:T}=this.parent.viewport.rawDims,{width:D,height:$}=l(this.data.rect);let B,G;o%180===0?(B=100*D/S,G=100*$/T):(B=100*$/S,G=100*D/T),m.style.width=`${B}%`,m.style.height=`${G}%`,m.setAttribute("data-main-rotation",(360-o)%360)}get _commonActions(){const o=(m,S,T)=>{const D=T.detail[m],$=D[0],B=D.slice(1);T.target.style[S]=A.ColorConverters[`${$}_HTML`](B),this.annotationStorage.setValue(this.data.id,{[S]:A.ColorConverters[`${$}_rgb`](B)})};return(0,i.shadow)(this,"_commonActions",{display:m=>{const{display:S}=m.detail,T=S%2===1;this.container.style.visibility=T?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:T,noPrint:S===1||S===2})},print:m=>{this.annotationStorage.setValue(this.data.id,{noPrint:!m.detail.print})},hidden:m=>{const{hidden:S}=m.detail;this.container.style.visibility=S?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:S,noView:S})},focus:m=>{setTimeout(()=>m.target.focus({preventScroll:!1}),0)},userName:m=>{m.target.title=m.detail.userName},readonly:m=>{m.target.disabled=m.detail.readonly},required:m=>{this._setRequired(m.target,m.detail.required)},bgColor:m=>{o("bgColor","backgroundColor",m)},fillColor:m=>{o("fillColor","backgroundColor",m)},fgColor:m=>{o("fgColor","color",m)},textColor:m=>{o("textColor","color",m)},borderColor:m=>{o("borderColor","borderColor",m)},strokeColor:m=>{o("strokeColor","borderColor",m)},rotation:m=>{const S=m.detail.rotation;this.setRotation(S),this.annotationStorage.setValue(this.data.id,{rotation:S})}})}_dispatchEventFromSandbox(o,m){const S=this._commonActions;for(const T of Object.keys(m.detail))(o[T]||S[T])?.(m)}_setDefaultPropertiesFromJS(o){if(!this.enableScripting)return;const m=this.annotationStorage.getRawValue(this.data.id);if(!m)return;const S=this._commonActions;for(const[T,D]of Object.entries(m)){const $=S[T];if($){const B={detail:{[T]:D},target:o};$(B),delete m[T]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:o}=this.data;if(!o)return;const[m,S,T,D]=this.data.rect;if(o.length===1){const[,{x:gt,y:wt},{x:Tt,y:$t}]=o[0];if(T===gt&&D===wt&&m===Tt&&S===$t)return}const{style:$}=this.container;let B;if(this.#t){const{borderColor:gt,borderWidth:wt}=$;$.borderWidth=0,B=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${gt}" stroke-width="${wt}">`],this.container.classList.add("hasBorder")}const G=T-m,lt=D-S,{svgFactory:V}=this,X=V.createElement("svg");X.classList.add("quadrilateralsContainer"),X.setAttribute("width",0),X.setAttribute("height",0);const K=V.createElement("defs");X.append(K);const Y=V.createElement("clipPath"),et=`clippath_${this.data.id}`;Y.setAttribute("id",et),Y.setAttribute("clipPathUnits","objectBoundingBox"),K.append(Y);for(const[,{x:gt,y:wt},{x:Tt,y:$t}]of o){const zt=V.createElement("rect"),Jt=(Tt-m)/G,Se=(D-wt)/lt,Pe=(gt-Tt)/G,Ae=(wt-$t)/lt;zt.setAttribute("x",Jt),zt.setAttribute("y",Se),zt.setAttribute("width",Pe),zt.setAttribute("height",Ae),Y.append(zt),B?.push(`<rect vector-effect="non-scaling-stroke" x="${Jt}" y="${Se}" width="${Pe}" height="${Ae}"/>`)}this.#t&&(B.push("</g></svg>')"),$.backgroundImage=B.join("")),this.container.append(X),this.container.style.clipPath=`url(#${et})`}_createPopup(){const{container:o,data:m}=this;o.setAttribute("aria-haspopup","dialog");const S=new z({data:{color:m.color,titleObj:m.titleObj,modificationDate:m.modificationDate,contentsObj:m.contentsObj,richText:m.richText,parentRect:m.rect,borderStyle:0,id:`popup_${m.id}`,rotation:m.rotation},parent:this.parent,elements:[this]});this.parent.div.append(S.render())}render(){(0,i.unreachable)("Abstract method `AnnotationElement.render` called")}_getElementsByName(o,m=null){const S=[];if(this._fieldObjects){const T=this._fieldObjects[o];if(T)for(const{page:D,id:$,exportValues:B}of T){if(D===-1||$===m)continue;const G=typeof B=="string"?B:null,lt=document.querySelector(`[data-element-id="${$}"]`);if(lt&&!r.has(lt)){(0,i.warn)(`_getElementsByName - element not allowed: ${$}`);continue}S.push({id:$,exportValue:G,domElement:lt})}return S}for(const T of document.getElementsByName(o)){const{exportValue:D}=T,$=T.getAttribute("data-element-id");$!==m&&r.has(T)&&S.push({id:$,exportValue:D,domElement:T})}return S}show(){this.container&&(this.container.hidden=!1),this.popup?.maybeShow()}hide(){this.container&&(this.container.hidden=!0),this.popup?.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const o=this.getElementsToTriggerPopup();if(Array.isArray(o))for(const m of o)m.classList.add("highlightArea");else o.classList.add("highlightArea")}_editOnDoubleClick(){const{annotationEditorType:o,data:{id:m}}=this;this.container.addEventListener("dblclick",()=>{this.linkService.eventBus?.dispatch("switchannotationeditormode",{source:this,mode:o,editId:m})})}}class h extends e{constructor(o,m=null){super(o,{isRenderable:!0,ignoreBorder:!!m?.ignoreBorder,createQuadrilaterals:!0}),this.isTooltipOnly=o.data.isTooltipOnly}render(){const{data:o,linkService:m}=this,S=document.createElement("a");S.setAttribute("data-element-id",o.id);let T=!1;return o.url?(m.addLinkAttributes(S,o.url,o.newWindow),T=!0):o.action?(this._bindNamedAction(S,o.action),T=!0):o.attachment?(this._bindAttachment(S,o.attachment),T=!0):o.setOCGState?(this.#e(S,o.setOCGState),T=!0):o.dest?(this._bindLink(S,o.dest),T=!0):(o.actions&&(o.actions.Action||o.actions["Mouse Up"]||o.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(S,o),T=!0),o.resetForm?(this._bindResetFormAction(S,o.resetForm),T=!0):this.isTooltipOnly&&!T&&(this._bindLink(S,""),T=!0)),this.container.classList.add("linkAnnotation"),T&&this.container.append(S),this.container}#t(){this.container.setAttribute("data-internal-link","")}_bindLink(o,m){o.href=this.linkService.getDestinationHash(m),o.onclick=()=>(m&&this.linkService.goToDestination(m),!1),(m||m==="")&&this.#t()}_bindNamedAction(o,m){o.href=this.linkService.getAnchorUrl(""),o.onclick=()=>(this.linkService.executeNamedAction(m),!1),this.#t()}_bindAttachment(o,m){o.href=this.linkService.getAnchorUrl(""),o.onclick=()=>(this.downloadManager?.openOrDownloadData(this.container,m.content,m.filename),!1),this.#t()}#e(o,m){o.href=this.linkService.getAnchorUrl(""),o.onclick=()=>(this.linkService.executeSetOCGState(m),!1),this.#t()}_bindJSAction(o,m){o.href=this.linkService.getAnchorUrl("");const S=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const T of Object.keys(m.actions)){const D=S.get(T);D&&(o[D]=()=>(this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:m.id,name:T}}),!1))}o.onclick||(o.onclick=()=>!1),this.#t()}_bindResetFormAction(o,m){const S=o.onclick;if(S||(o.href=this.linkService.getAnchorUrl("")),this.#t(),!this._fieldObjects){(0,i.warn)('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),S||(o.onclick=()=>!1);return}o.onclick=()=>{S?.();const{fields:T,refs:D,include:$}=m,B=[];if(T.length!==0||D.length!==0){const V=new Set(D);for(const X of T){const K=this._fieldObjects[X]||[];for(const{id:Y}of K)V.add(Y)}for(const X of Object.values(this._fieldObjects))for(const K of X)V.has(K.id)===$&&B.push(K)}else for(const V of Object.values(this._fieldObjects))B.push(...V);const G=this.annotationStorage,lt=[];for(const V of B){const{id:X}=V;switch(lt.push(X),V.type){case"text":{const Y=V.defaultValue||"";G.setValue(X,{value:Y});break}case"checkbox":case"radiobutton":{const Y=V.defaultValue===V.exportValues;G.setValue(X,{value:Y});break}case"combobox":case"listbox":{const Y=V.defaultValue||"";G.setValue(X,{value:Y});break}default:continue}const K=document.querySelector(`[data-element-id="${X}"]`);if(K){if(!r.has(K)){(0,i.warn)(`_bindResetFormAction - element not allowed: ${X}`);continue}}else continue;K.dispatchEvent(new Event("resetform"))}return this.enableScripting&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:lt,name:"ResetForm"}}),!1}}}class f extends e{constructor(o){super(o,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const o=document.createElement("img");return o.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",o.alt="[{{type}} Annotation]",o.dataset.l10nId="text_annotation_type",o.dataset.l10nArgs=JSON.stringify({type:this.data.name}),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(o),this.container}}class a extends e{render(){return this.data.alternativeText&&(this.container.title=this.data.alternativeText),this.container}showElementAndHideCanvas(o){this.data.hasOwnCanvas&&(o.previousSibling?.nodeName==="CANVAS"&&(o.previousSibling.hidden=!0),o.hidden=!1)}_getKeyModifier(o){const{isWin:m,isMac:S}=i.FeatureTest.platform;return m&&o.ctrlKey||S&&o.metaKey}_setEventListener(o,m,S,T,D){S.includes("mouse")?o.addEventListener(S,$=>{this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:T,value:D($),shift:$.shiftKey,modifier:this._getKeyModifier($)}})}):o.addEventListener(S,$=>{if(S==="blur"){if(!m.focused||!$.relatedTarget)return;m.focused=!1}else if(S==="focus"){if(m.focused)return;m.focused=!0}D&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:T,value:D($)}})})}_setEventListeners(o,m,S,T){for(const[D,$]of S)($==="Action"||this.data.actions?.[$])&&(($==="Focus"||$==="Blur")&&(m||={focused:!1}),this._setEventListener(o,m,D,$,T),$==="Focus"&&!this.data.actions?.Blur?this._setEventListener(o,m,"blur","Blur",null):$==="Blur"&&!this.data.actions?.Focus&&this._setEventListener(o,m,"focus","Focus",null))}_setBackgroundColor(o){const m=this.data.backgroundColor||null;o.style.backgroundColor=m===null?"transparent":i.Util.makeHexColor(m[0],m[1],m[2])}_setTextStyle(o){const m=["left","center","right"],{fontColor:S}=this.data.defaultAppearanceData,T=this.data.defaultAppearanceData.fontSize||t,D=o.style;let $;const B=2,G=lt=>Math.round(10*lt)/10;if(this.data.multiLine){const lt=Math.abs(this.data.rect[3]-this.data.rect[1]-B),V=Math.round(lt/(i.LINE_FACTOR*T))||1,X=lt/V;$=Math.min(T,G(X/i.LINE_FACTOR))}else{const lt=Math.abs(this.data.rect[3]-this.data.rect[1]-B);$=Math.min(T,G(lt/i.LINE_FACTOR))}D.fontSize=`calc(${$}px * var(--scale-factor))`,D.color=i.Util.makeHexColor(S[0],S[1],S[2]),this.data.textAlignment!==null&&(D.textAlign=m[this.data.textAlignment])}_setRequired(o,m){m?o.setAttribute("required",!0):o.removeAttribute("required"),o.setAttribute("aria-required",m)}}class v extends a{constructor(o){const m=o.renderForms||!o.data.hasAppearance&&!!o.data.fieldValue;super(o,{isRenderable:m})}setPropertyOnSiblings(o,m,S,T){const D=this.annotationStorage;for(const $ of this._getElementsByName(o.name,o.id))$.domElement&&($.domElement[m]=S),D.setValue($.id,{[T]:S})}render(){const o=this.annotationStorage,m=this.data.id;this.container.classList.add("textWidgetAnnotation");let S=null;if(this.renderForms){const T=o.getValue(m,{value:this.data.fieldValue});let D=T.value||"";const $=o.getValue(m,{charLimit:this.data.maxLen}).charLimit;$&&D.length>$&&(D=D.slice(0,$));let B=T.formattedValue||this.data.textContent?.join(`
`)||null;B&&this.data.comb&&(B=B.replaceAll(/\s+/g,""));const G={userValue:D,formattedValue:B,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(S=document.createElement("textarea"),S.textContent=B??D,this.data.doNotScroll&&(S.style.overflowY="hidden")):(S=document.createElement("input"),S.type="text",S.setAttribute("value",B??D),this.data.doNotScroll&&(S.style.overflowX="hidden")),this.data.hasOwnCanvas&&(S.hidden=!0),r.add(S),S.setAttribute("data-element-id",m),S.disabled=this.data.readOnly,S.name=this.data.fieldName,S.tabIndex=n,this._setRequired(S,this.data.required),$&&(S.maxLength=$),S.addEventListener("input",V=>{o.setValue(m,{value:V.target.value}),this.setPropertyOnSiblings(S,"value",V.target.value,"value"),G.formattedValue=null}),S.addEventListener("resetform",V=>{const X=this.data.defaultFieldValue??"";S.value=G.userValue=X,G.formattedValue=null});let lt=V=>{const{formattedValue:X}=G;X!=null&&(V.target.value=X),V.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){S.addEventListener("focus",X=>{if(G.focused)return;const{target:K}=X;G.userValue&&(K.value=G.userValue),G.lastCommittedValue=K.value,G.commitKey=1,G.focused=!0}),S.addEventListener("updatefromsandbox",X=>{this.showElementAndHideCanvas(X.target);const K={value(Y){G.userValue=Y.detail.value??"",o.setValue(m,{value:G.userValue.toString()}),Y.target.value=G.userValue},formattedValue(Y){const{formattedValue:et}=Y.detail;G.formattedValue=et,et!=null&&Y.target!==document.activeElement&&(Y.target.value=et),o.setValue(m,{formattedValue:et})},selRange(Y){Y.target.setSelectionRange(...Y.detail.selRange)},charLimit:Y=>{const{charLimit:et}=Y.detail,{target:gt}=Y;if(et===0){gt.removeAttribute("maxLength");return}gt.setAttribute("maxLength",et);let wt=G.userValue;!wt||wt.length<=et||(wt=wt.slice(0,et),gt.value=G.userValue=wt,o.setValue(m,{value:wt}),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:m,name:"Keystroke",value:wt,willCommit:!0,commitKey:1,selStart:gt.selectionStart,selEnd:gt.selectionEnd}}))}};this._dispatchEventFromSandbox(K,X)}),S.addEventListener("keydown",X=>{G.commitKey=1;let K=-1;if(X.key==="Escape"?K=0:X.key==="Enter"&&!this.data.multiLine?K=2:X.key==="Tab"&&(G.commitKey=3),K===-1)return;const{value:Y}=X.target;G.lastCommittedValue!==Y&&(G.lastCommittedValue=Y,G.userValue=Y,this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:m,name:"Keystroke",value:Y,willCommit:!0,commitKey:K,selStart:X.target.selectionStart,selEnd:X.target.selectionEnd}}))});const V=lt;lt=null,S.addEventListener("blur",X=>{if(!G.focused||!X.relatedTarget)return;G.focused=!1;const{value:K}=X.target;G.userValue=K,G.lastCommittedValue!==K&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:m,name:"Keystroke",value:K,willCommit:!0,commitKey:G.commitKey,selStart:X.target.selectionStart,selEnd:X.target.selectionEnd}}),V(X)}),this.data.actions?.Keystroke&&S.addEventListener("beforeinput",X=>{G.lastCommittedValue=null;const{data:K,target:Y}=X,{value:et,selectionStart:gt,selectionEnd:wt}=Y;let Tt=gt,$t=wt;switch(X.inputType){case"deleteWordBackward":{const zt=et.substring(0,gt).match(/\w*[^\w]*$/);zt&&(Tt-=zt[0].length);break}case"deleteWordForward":{const zt=et.substring(gt).match(/^[^\w]*\w*/);zt&&($t+=zt[0].length);break}case"deleteContentBackward":gt===wt&&(Tt-=1);break;case"deleteContentForward":gt===wt&&($t+=1);break}X.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:m,name:"Keystroke",value:et,change:K||"",willCommit:!1,selStart:Tt,selEnd:$t}})}),this._setEventListeners(S,G,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],X=>X.target.value)}if(lt&&S.addEventListener("blur",lt),this.data.comb){const X=(this.data.rect[2]-this.data.rect[0])/$;S.classList.add("comb"),S.style.letterSpacing=`calc(${X}px * var(--scale-factor) - 1ch)`}}else S=document.createElement("div"),S.textContent=this.data.fieldValue,S.style.verticalAlign="middle",S.style.display="table-cell";return this._setTextStyle(S),this._setBackgroundColor(S),this._setDefaultPropertiesFromJS(S),this.container.append(S),this.container}}class R extends a{constructor(o){super(o,{isRenderable:!!o.data.hasOwnCanvas})}}class k extends a{constructor(o){super(o,{isRenderable:o.renderForms})}render(){const o=this.annotationStorage,m=this.data,S=m.id;let T=o.getValue(S,{value:m.exportValue===m.fieldValue}).value;typeof T=="string"&&(T=T!=="Off",o.setValue(S,{value:T})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const D=document.createElement("input");return r.add(D),D.setAttribute("data-element-id",S),D.disabled=m.readOnly,this._setRequired(D,this.data.required),D.type="checkbox",D.name=m.fieldName,T&&D.setAttribute("checked",!0),D.setAttribute("exportValue",m.exportValue),D.tabIndex=n,D.addEventListener("change",$=>{const{name:B,checked:G}=$.target;for(const lt of this._getElementsByName(B,S)){const V=G&&lt.exportValue===m.exportValue;lt.domElement&&(lt.domElement.checked=V),o.setValue(lt.id,{value:V})}o.setValue(S,{value:G})}),D.addEventListener("resetform",$=>{const B=m.defaultFieldValue||"Off";$.target.checked=B===m.exportValue}),this.enableScripting&&this.hasJSActions&&(D.addEventListener("updatefromsandbox",$=>{const B={value(G){G.target.checked=G.detail.value!=="Off",o.setValue(S,{value:G.target.checked})}};this._dispatchEventFromSandbox(B,$)}),this._setEventListeners(D,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],$=>$.target.checked)),this._setBackgroundColor(D),this._setDefaultPropertiesFromJS(D),this.container.append(D),this.container}}class g extends a{constructor(o){super(o,{isRenderable:o.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const o=this.annotationStorage,m=this.data,S=m.id;let T=o.getValue(S,{value:m.fieldValue===m.buttonValue}).value;typeof T=="string"&&(T=T!==m.buttonValue,o.setValue(S,{value:T}));const D=document.createElement("input");if(r.add(D),D.setAttribute("data-element-id",S),D.disabled=m.readOnly,this._setRequired(D,this.data.required),D.type="radio",D.name=m.fieldName,T&&D.setAttribute("checked",!0),D.tabIndex=n,D.addEventListener("change",$=>{const{name:B,checked:G}=$.target;for(const lt of this._getElementsByName(B,S))o.setValue(lt.id,{value:!1});o.setValue(S,{value:G})}),D.addEventListener("resetform",$=>{const B=m.defaultFieldValue;$.target.checked=B!=null&&B===m.buttonValue}),this.enableScripting&&this.hasJSActions){const $=m.buttonValue;D.addEventListener("updatefromsandbox",B=>{const G={value:lt=>{const V=$===lt.detail.value;for(const X of this._getElementsByName(lt.target.name)){const K=V&&X.id===S;X.domElement&&(X.domElement.checked=K),o.setValue(X.id,{value:K})}}};this._dispatchEventFromSandbox(G,B)}),this._setEventListeners(D,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],B=>B.target.checked)}return this._setBackgroundColor(D),this._setDefaultPropertiesFromJS(D),this.container.append(D),this.container}}class P extends h{constructor(o){super(o,{ignoreBorder:o.data.hasAppearance})}render(){const o=super.render();o.classList.add("buttonWidgetAnnotation","pushButton"),this.data.alternativeText&&(o.title=this.data.alternativeText);const m=o.lastChild;return this.enableScripting&&this.hasJSActions&&m&&(this._setDefaultPropertiesFromJS(m),m.addEventListener("updatefromsandbox",S=>{this._dispatchEventFromSandbox({},S)})),o}}class U extends a{constructor(o){super(o,{isRenderable:o.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const o=this.annotationStorage,m=this.data.id,S=o.getValue(m,{value:this.data.fieldValue}),T=document.createElement("select");r.add(T),T.setAttribute("data-element-id",m),T.disabled=this.data.readOnly,this._setRequired(T,this.data.required),T.name=this.data.fieldName,T.tabIndex=n;let D=this.data.combo&&this.data.options.length>0;this.data.combo||(T.size=this.data.options.length,this.data.multiSelect&&(T.multiple=!0)),T.addEventListener("resetform",V=>{const X=this.data.defaultFieldValue;for(const K of T.options)K.selected=K.value===X});for(const V of this.data.options){const X=document.createElement("option");X.textContent=V.displayValue,X.value=V.exportValue,S.value.includes(V.exportValue)&&(X.setAttribute("selected",!0),D=!1),T.append(X)}let $=null;if(D){const V=document.createElement("option");V.value=" ",V.setAttribute("hidden",!0),V.setAttribute("selected",!0),T.prepend(V),$=()=>{V.remove(),T.removeEventListener("input",$),$=null},T.addEventListener("input",$)}const B=V=>{const X=V?"value":"textContent",{options:K,multiple:Y}=T;return Y?Array.prototype.filter.call(K,et=>et.selected).map(et=>et[X]):K.selectedIndex===-1?null:K[K.selectedIndex][X]};let G=B(!1);const lt=V=>{const X=V.target.options;return Array.prototype.map.call(X,K=>({displayValue:K.textContent,exportValue:K.value}))};return this.enableScripting&&this.hasJSActions?(T.addEventListener("updatefromsandbox",V=>{const X={value(K){$?.();const Y=K.detail.value,et=new Set(Array.isArray(Y)?Y:[Y]);for(const gt of T.options)gt.selected=et.has(gt.value);o.setValue(m,{value:B(!0)}),G=B(!1)},multipleSelection(K){T.multiple=!0},remove(K){const Y=T.options,et=K.detail.remove;Y[et].selected=!1,T.remove(et),Y.length>0&&Array.prototype.findIndex.call(Y,wt=>wt.selected)===-1&&(Y[0].selected=!0),o.setValue(m,{value:B(!0),items:lt(K)}),G=B(!1)},clear(K){for(;T.length!==0;)T.remove(0);o.setValue(m,{value:null,items:[]}),G=B(!1)},insert(K){const{index:Y,displayValue:et,exportValue:gt}=K.detail.insert,wt=T.children[Y],Tt=document.createElement("option");Tt.textContent=et,Tt.value=gt,wt?wt.before(Tt):T.append(Tt),o.setValue(m,{value:B(!0),items:lt(K)}),G=B(!1)},items(K){const{items:Y}=K.detail;for(;T.length!==0;)T.remove(0);for(const et of Y){const{displayValue:gt,exportValue:wt}=et,Tt=document.createElement("option");Tt.textContent=gt,Tt.value=wt,T.append(Tt)}T.options.length>0&&(T.options[0].selected=!0),o.setValue(m,{value:B(!0),items:lt(K)}),G=B(!1)},indices(K){const Y=new Set(K.detail.indices);for(const et of K.target.options)et.selected=Y.has(et.index);o.setValue(m,{value:B(!0)}),G=B(!1)},editable(K){K.target.disabled=!K.detail.editable}};this._dispatchEventFromSandbox(X,V)}),T.addEventListener("input",V=>{const X=B(!0);o.setValue(m,{value:X}),V.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:m,name:"Keystroke",value:G,changeEx:X,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(T,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],V=>V.target.value)):T.addEventListener("input",function(V){o.setValue(m,{value:B(!0)})}),this.data.combo&&this._setTextStyle(T),this._setBackgroundColor(T),this._setDefaultPropertiesFromJS(T),this.container.append(T),this.container}}class z extends e{constructor(o){const{data:m,elements:S}=o;super(o,{isRenderable:e._hasPopupData(m)}),this.elements=S}render(){this.container.classList.add("popupAnnotation");const o=new N({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),m=[];for(const S of this.elements)S.popup=o,m.push(S.data.id),S.addHighlightArea();return this.container.setAttribute("aria-controls",m.map(S=>`${i.AnnotationPrefix}${S}`).join(",")),this.container}}class N{#t=null;#e=this.#d.bind(this);#r=this.#S.bind(this);#s=this.#P.bind(this);#o=this.#b.bind(this);#a=null;#n=null;#l=null;#c=null;#i=null;#p=null;#h=!1;#u=null;#f=null;#y=null;#m=null;#g=!1;constructor({container:o,color:m,elements:S,titleObj:T,modificationDate:D,contentsObj:$,richText:B,parent:G,rect:lt,parentRect:V,open:X}){this.#n=o,this.#m=T,this.#l=$,this.#y=B,this.#i=G,this.#a=m,this.#f=lt,this.#p=V,this.#c=S;const K=d.PDFDateString.toDateObject(D);K&&(this.#t=G.l10n.get("annotation_date_string",{date:K.toLocaleDateString(),time:K.toLocaleTimeString()})),this.trigger=S.flatMap(Y=>Y.getElementsToTriggerPopup());for(const Y of this.trigger)Y.addEventListener("click",this.#o),Y.addEventListener("mouseenter",this.#s),Y.addEventListener("mouseleave",this.#r),Y.classList.add("popupTriggerArea");for(const Y of S)Y.container?.addEventListener("keydown",this.#e);this.#n.hidden=!0,X&&this.#b()}render(){if(this.#u)return;const{page:{view:o},viewport:{rawDims:{pageWidth:m,pageHeight:S,pageX:T,pageY:D}}}=this.#i,$=this.#u=document.createElement("div");if($.className="popup",this.#a){const zt=$.style.outlineColor=i.Util.makeHexColor(...this.#a);CSS.supports("background-color","color-mix(in srgb, red 30%, white)")?$.style.backgroundColor=`color-mix(in srgb, ${zt} 30%, white)`:$.style.backgroundColor=i.Util.makeHexColor(...this.#a.map(Se=>Math.floor(.7*(255-Se)+Se)))}const B=document.createElement("span");B.className="header";const G=document.createElement("h1");if(B.append(G),{dir:G.dir,str:G.textContent}=this.#m,$.append(B),this.#t){const zt=document.createElement("span");zt.classList.add("popupDate"),this.#t.then(Jt=>{zt.textContent=Jt}),B.append(zt)}const lt=this.#l,V=this.#y;if(V?.str&&(!lt?.str||lt.str===V.str))w.XfaLayer.render({xfaHtml:V.html,intent:"richText",div:$}),$.lastChild.classList.add("richText","popupContent");else{const zt=this._formatContents(lt);$.append(zt)}let X=!!this.#p,K=X?this.#p:this.#f;for(const zt of this.#c)if(!K||i.Util.intersect(zt.data.rect,K)!==null){K=zt.data.rect,X=!0;break}const Y=i.Util.normalizeRect([K[0],o[3]-K[1]+o[1],K[2],o[3]-K[3]+o[1]]),gt=X?K[2]-K[0]+5:0,wt=Y[0]+gt,Tt=Y[1],{style:$t}=this.#n;$t.left=`${100*(wt-T)/m}%`,$t.top=`${100*(Tt-D)/S}%`,this.#n.append($)}_formatContents({str:o,dir:m}){const S=document.createElement("p");S.classList.add("popupContent"),S.dir=m;const T=o.split(/(?:\r\n?|\n)/);for(let D=0,$=T.length;D<$;++D){const B=T[D];S.append(document.createTextNode(B)),D<$-1&&S.append(document.createElement("br"))}return S}#d(o){o.altKey||o.shiftKey||o.ctrlKey||o.metaKey||(o.key==="Enter"||o.key==="Escape"&&this.#h)&&this.#b()}#b(){this.#h=!this.#h,this.#h?(this.#P(),this.#n.addEventListener("click",this.#o),this.#n.addEventListener("keydown",this.#e)):(this.#S(),this.#n.removeEventListener("click",this.#o),this.#n.removeEventListener("keydown",this.#e))}#P(){this.#u||this.render(),this.isVisible?this.#h&&this.#n.classList.add("focused"):(this.#n.hidden=!1,this.#n.style.zIndex=parseInt(this.#n.style.zIndex)+1e3)}#S(){this.#n.classList.remove("focused"),!(this.#h||!this.isVisible)&&(this.#n.hidden=!0,this.#n.style.zIndex=parseInt(this.#n.style.zIndex)-1e3)}forceHide(){this.#g=this.isVisible,this.#g&&(this.#n.hidden=!0)}maybeShow(){this.#g&&(this.#g=!1,this.#n.hidden=!1)}get isVisible(){return this.#n.hidden===!1}}class j extends e{constructor(o){super(o,{isRenderable:!0,ignoreBorder:!0}),this.textContent=o.data.textContent,this.textPosition=o.data.textPosition,this.annotationEditorType=i.AnnotationEditorType.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const o=document.createElement("div");o.classList.add("annotationTextContent"),o.setAttribute("role","comment");for(const m of this.textContent){const S=document.createElement("span");S.textContent=m,o.append(S)}this.container.append(o)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}s.FreeTextAnnotationElement=j;class W extends e{#t=null;constructor(o){super(o,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("lineAnnotation");const o=this.data,{width:m,height:S}=l(o.rect),T=this.svgFactory.create(m,S,!0),D=this.#t=this.svgFactory.createElement("svg:line");return D.setAttribute("x1",o.rect[2]-o.lineCoordinates[0]),D.setAttribute("y1",o.rect[3]-o.lineCoordinates[1]),D.setAttribute("x2",o.rect[2]-o.lineCoordinates[2]),D.setAttribute("y2",o.rect[3]-o.lineCoordinates[3]),D.setAttribute("stroke-width",o.borderStyle.width||1),D.setAttribute("stroke","transparent"),D.setAttribute("fill","transparent"),T.append(D),this.container.append(T),!o.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class at extends e{#t=null;constructor(o){super(o,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("squareAnnotation");const o=this.data,{width:m,height:S}=l(o.rect),T=this.svgFactory.create(m,S,!0),D=o.borderStyle.width,$=this.#t=this.svgFactory.createElement("svg:rect");return $.setAttribute("x",D/2),$.setAttribute("y",D/2),$.setAttribute("width",m-D),$.setAttribute("height",S-D),$.setAttribute("stroke-width",D||1),$.setAttribute("stroke","transparent"),$.setAttribute("fill","transparent"),T.append($),this.container.append(T),!o.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class tt extends e{#t=null;constructor(o){super(o,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("circleAnnotation");const o=this.data,{width:m,height:S}=l(o.rect),T=this.svgFactory.create(m,S,!0),D=o.borderStyle.width,$=this.#t=this.svgFactory.createElement("svg:ellipse");return $.setAttribute("cx",m/2),$.setAttribute("cy",S/2),$.setAttribute("rx",m/2-D/2),$.setAttribute("ry",S/2-D/2),$.setAttribute("stroke-width",D||1),$.setAttribute("stroke","transparent"),$.setAttribute("fill","transparent"),T.append($),this.container.append(T),!o.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class it extends e{#t=null;constructor(o){super(o,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const o=this.data,{width:m,height:S}=l(o.rect),T=this.svgFactory.create(m,S,!0);let D=[];for(const B of o.vertices){const G=B.x-o.rect[0],lt=o.rect[3]-B.y;D.push(G+","+lt)}D=D.join(" ");const $=this.#t=this.svgFactory.createElement(this.svgElementName);return $.setAttribute("points",D),$.setAttribute("stroke-width",o.borderStyle.width||1),$.setAttribute("stroke","transparent"),$.setAttribute("fill","transparent"),T.append($),this.container.append(T),!o.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class ut extends it{constructor(o){super(o),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class J extends e{constructor(o){super(o,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}class L extends e{#t=[];constructor(o){super(o,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=i.AnnotationEditorType.INK}render(){this.container.classList.add(this.containerClassName);const o=this.data,{width:m,height:S}=l(o.rect),T=this.svgFactory.create(m,S,!0);for(const D of o.inkLists){let $=[];for(const G of D){const lt=G.x-o.rect[0],V=o.rect[3]-G.y;$.push(`${lt},${V}`)}$=$.join(" ");const B=this.svgFactory.createElement(this.svgElementName);this.#t.push(B),B.setAttribute("points",$),B.setAttribute("stroke-width",o.borderStyle.width||1),B.setAttribute("stroke","transparent"),B.setAttribute("fill","transparent"),!o.popupRef&&this.hasPopupData&&this._createPopup(),T.append(B)}return this.container.append(T),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}s.InkAnnotationElement=L;class b extends e{constructor(o){super(o,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this.container}}class p extends e{constructor(o){super(o,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),this.container}}class u extends e{constructor(o){super(o,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),this.container}}class _ extends e{constructor(o){super(o,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),this.container}}class F extends e{constructor(o){super(o,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("stampAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}s.StampAnnotationElement=F;class I extends e{#t=null;constructor(o){super(o,{isRenderable:!0});const{filename:m,content:S}=this.data.file;this.filename=(0,d.getFilenameFromUrl)(m,!0),this.content=S,this.linkService.eventBus?.dispatch("fileattachmentannotation",{source:this,filename:m,content:S})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:o,data:m}=this;let S;m.hasAppearance||m.fillAlpha===0?S=document.createElement("div"):(S=document.createElement("img"),S.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(m.name)?"paperclip":"pushpin"}.svg`,m.fillAlpha&&m.fillAlpha<1&&(S.style=`filter: opacity(${Math.round(m.fillAlpha*100)}%);`)),S.addEventListener("dblclick",this.#e.bind(this)),this.#t=S;const{isMac:T}=i.FeatureTest.platform;return o.addEventListener("keydown",D=>{D.key==="Enter"&&(T?D.metaKey:D.ctrlKey)&&this.#e()}),!m.popupRef&&this.hasPopupData?this._createPopup():S.classList.add("popupTriggerArea"),o.append(S),o}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}#e(){this.downloadManager?.openOrDownloadData(this.container,this.content,this.filename)}}class O{#t=null;#e=null;#r=new Map;constructor({div:o,accessibilityManager:m,annotationCanvasMap:S,l10n:T,page:D,viewport:$}){this.div=o,this.#t=m,this.#e=S,this.l10n=T,this.page=D,this.viewport=$,this.zIndex=0,this.l10n||=M.NullL10n}#s(o,m){const S=o.firstChild||o;S.id=`${i.AnnotationPrefix}${m}`,this.div.append(o),this.#t?.moveElementInDOM(this.div,o,S,!1)}async render(o){const{annotations:m}=o,S=this.div;(0,d.setLayerDimensions)(S,this.viewport);const T=new Map,D={data:null,layer:S,linkService:o.linkService,downloadManager:o.downloadManager,imageResourcesPath:o.imageResourcesPath||"",renderForms:o.renderForms!==!1,svgFactory:new d.DOMSVGFactory,annotationStorage:o.annotationStorage||new C.AnnotationStorage,enableScripting:o.enableScripting===!0,hasJSActions:o.hasJSActions,fieldObjects:o.fieldObjects,parent:this,elements:null};for(const $ of m){if($.noHTML)continue;const B=$.annotationType===i.AnnotationType.POPUP;if(B){const V=T.get($.id);if(!V)continue;D.elements=V}else{const{width:V,height:X}=l($.rect);if(V<=0||X<=0)continue}D.data=$;const G=c.create(D);if(!G.isRenderable)continue;if(!B&&$.popupRef){const V=T.get($.popupRef);V?V.push(G):T.set($.popupRef,[G])}G.annotationEditorType>0&&this.#r.set(G.data.id,G);const lt=G.render();$.hidden&&(lt.style.visibility="hidden"),this.#s(lt,$.id)}this.#o(),await this.l10n.translate(S)}update({viewport:o}){const m=this.div;this.viewport=o,(0,d.setLayerDimensions)(m,{rotation:o.rotation}),this.#o(),m.hidden=!1}#o(){if(!this.#e)return;const o=this.div;for(const[m,S]of this.#e){const T=o.querySelector(`[data-annotation-id="${m}"]`);if(!T)continue;const{firstChild:D}=T;D?D.nodeName==="CANVAS"?D.replaceWith(S):D.before(S):T.append(S)}this.#e.clear()}getEditableAnnotations(){return Array.from(this.#r.values())}getEditableAnnotation(o){return this.#r.get(o)}}s.AnnotationLayer=O},(E,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.ColorConverters=void 0;function y(C){return Math.floor(Math.max(0,Math.min(1,C))*255).toString(16).padStart(2,"0")}function i(C){return Math.max(0,Math.min(255,255*C))}class d{static CMYK_G([A,M,w,n]){return["G",1-Math.min(1,.3*A+.59*w+.11*M+n)]}static G_CMYK([A]){return["CMYK",0,0,0,1-A]}static G_RGB([A]){return["RGB",A,A,A]}static G_rgb([A]){return A=i(A),[A,A,A]}static G_HTML([A]){const M=y(A);return`#${M}${M}${M}`}static RGB_G([A,M,w]){return["G",.3*A+.59*M+.11*w]}static RGB_rgb(A){return A.map(i)}static RGB_HTML(A){return`#${A.map(y).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([A,M,w,n]){return["RGB",1-Math.min(1,A+n),1-Math.min(1,w+n),1-Math.min(1,M+n)]}static CMYK_rgb([A,M,w,n]){return[i(1-Math.min(1,A+n)),i(1-Math.min(1,w+n)),i(1-Math.min(1,M+n))]}static CMYK_HTML(A){const M=this.CMYK_RGB(A).slice(1);return this.RGB_HTML(M)}static RGB_CMYK([A,M,w]){const n=1-A,t=1-M,r=1-w,l=Math.min(n,t,r);return["CMYK",n,t,r,l]}}s.ColorConverters=d},(E,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.NullL10n=void 0,s.getL10nFallback=i;const y={of_pages:"of {{pagesCount}}",page_of_pages:"({{pageNumber}} of {{pagesCount}})",document_properties_kb:"{{size_kb}} KB ({{size_b}} bytes)",document_properties_mb:"{{size_mb}} MB ({{size_b}} bytes)",document_properties_date_string:"{{date}}, {{time}}",document_properties_page_size_unit_inches:"in",document_properties_page_size_unit_millimeters:"mm",document_properties_page_size_orientation_portrait:"portrait",document_properties_page_size_orientation_landscape:"landscape",document_properties_page_size_name_a3:"A3",document_properties_page_size_name_a4:"A4",document_properties_page_size_name_letter:"Letter",document_properties_page_size_name_legal:"Legal",document_properties_page_size_dimension_string:"{{width}} × {{height}} {{unit}} ({{orientation}})",document_properties_page_size_dimension_name_string:"{{width}} × {{height}} {{unit}} ({{name}}, {{orientation}})",document_properties_linearized_yes:"Yes",document_properties_linearized_no:"No",additional_layers:"Additional Layers",page_landmark:"Page {{page}}",thumb_page_title:"Page {{page}}",thumb_page_canvas:"Thumbnail of Page {{page}}",find_reached_top:"Reached top of document, continued from bottom",find_reached_bottom:"Reached end of document, continued from top","find_match_count[one]":"{{current}} of {{total}} match","find_match_count[other]":"{{current}} of {{total}} matches","find_match_count_limit[one]":"More than {{limit}} match","find_match_count_limit[other]":"More than {{limit}} matches",find_not_found:"Phrase not found",page_scale_width:"Page Width",page_scale_fit:"Page Fit",page_scale_auto:"Automatic Zoom",page_scale_actual:"Actual Size",page_scale_percent:"{{scale}}%",loading_error:"An error occurred while loading the PDF.",invalid_file_error:"Invalid or corrupted PDF file.",missing_file_error:"Missing PDF file.",unexpected_response_error:"Unexpected server response.",rendering_error:"An error occurred while rendering the page.",annotation_date_string:"{{date}}, {{time}}",printing_not_supported:"Warning: Printing is not fully supported by this browser.",printing_not_ready:"Warning: The PDF is not fully loaded for printing.",web_fonts_disabled:"Web fonts are disabled: unable to use embedded PDF fonts.",free_text2_default_content:"Start typing…",editor_free_text2_aria_label:"Text Editor",editor_ink2_aria_label:"Draw Editor",editor_ink_canvas_aria_label:"User-created image",editor_alt_text_button_label:"Alt text",editor_alt_text_edit_button_label:"Edit alt text",editor_alt_text_decorative_tooltip:"Marked as decorative"};y.print_progress_percent="{{progress}}%";function i(A,M){switch(A){case"find_match_count":A=`find_match_count[${M.total===1?"one":"other"}]`;break;case"find_match_count_limit":A=`find_match_count_limit[${M.limit===1?"one":"other"}]`;break}return y[A]||""}function d(A,M){return M?A.replaceAll(/\{\{\s*(\w+)\s*\}\}/g,(w,n)=>n in M?M[n]:"{{"+n+"}}"):A}const C={async getLanguage(){return"en-us"},async getDirection(){return"ltr"},async get(A,M=null,w=i(A,M)){return d(w,M)},async translate(A){}};s.NullL10n=C},(E,s,y)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.XfaLayer=void 0;var i=y(25);class d{static setupStorage(A,M,w,n,t){const r=n.getValue(M,{value:null});switch(w.name){case"textarea":if(r.value!==null&&(A.textContent=r.value),t==="print")break;A.addEventListener("input",l=>{n.setValue(M,{value:l.target.value})});break;case"input":if(w.attributes.type==="radio"||w.attributes.type==="checkbox"){if(r.value===w.attributes.xfaOn?A.setAttribute("checked",!0):r.value===w.attributes.xfaOff&&A.removeAttribute("checked"),t==="print")break;A.addEventListener("change",l=>{n.setValue(M,{value:l.target.checked?l.target.getAttribute("xfaOn"):l.target.getAttribute("xfaOff")})})}else{if(r.value!==null&&A.setAttribute("value",r.value),t==="print")break;A.addEventListener("input",l=>{n.setValue(M,{value:l.target.value})})}break;case"select":if(r.value!==null){A.setAttribute("value",r.value);for(const l of w.children)l.attributes.value===r.value?l.attributes.selected=!0:l.attributes.hasOwnProperty("selected")&&delete l.attributes.selected}A.addEventListener("input",l=>{const c=l.target.options,e=c.selectedIndex===-1?"":c[c.selectedIndex].value;n.setValue(M,{value:e})});break}}static setAttributes({html:A,element:M,storage:w=null,intent:n,linkService:t}){const{attributes:r}=M,l=A instanceof HTMLAnchorElement;r.type==="radio"&&(r.name=`${r.name}-${n}`);for(const[c,e]of Object.entries(r))if(e!=null)switch(c){case"class":e.length&&A.setAttribute(c,e.join(" "));break;case"dataId":break;case"id":A.setAttribute("data-element-id",e);break;case"style":Object.assign(A.style,e);break;case"textContent":A.textContent=e;break;default:(!l||c!=="href"&&c!=="newWindow")&&A.setAttribute(c,e)}l&&t.addLinkAttributes(A,r.href,r.newWindow),w&&r.dataId&&this.setupStorage(A,r.dataId,M,w)}static render(A){const M=A.annotationStorage,w=A.linkService,n=A.xfaHtml,t=A.intent||"display",r=document.createElement(n.name);n.attributes&&this.setAttributes({html:r,element:n,intent:t,linkService:w});const l=[[n,-1,r]],c=A.div;if(c.append(r),A.viewport){const h=`matrix(${A.viewport.transform.join(",")})`;c.style.transform=h}t!=="richText"&&c.setAttribute("class","xfaLayer xfaFont");const e=[];for(;l.length>0;){const[h,f,a]=l.at(-1);if(f+1===h.children.length){l.pop();continue}const v=h.children[++l.at(-1)[1]];if(v===null)continue;const{name:R}=v;if(R==="#text"){const g=document.createTextNode(v.value);e.push(g),a.append(g);continue}const k=v?.attributes?.xmlns?document.createElementNS(v.attributes.xmlns,R):document.createElement(R);if(a.append(k),v.attributes&&this.setAttributes({html:k,element:v,storage:M,intent:t,linkService:w}),v.children&&v.children.length>0)l.push([v,-1,k]);else if(v.value){const g=document.createTextNode(v.value);i.XfaText.shouldBuildText(R)&&e.push(g),k.append(g)}}for(const h of c.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))h.setAttribute("readOnly",!0);return{textDivs:e}}static update(A){const M=`matrix(${A.viewport.transform.join(",")})`;A.div.style.transform=M,A.div.hidden=!1}}s.XfaLayer=d},(E,s,y)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.InkEditor=void 0;var i=y(1),d=y(4),C=y(29),A=y(6),M=y(5);class w extends d.AnnotationEditor{#t=0;#e=0;#r=this.canvasPointermove.bind(this);#s=this.canvasPointerleave.bind(this);#o=this.canvasPointerup.bind(this);#a=this.canvasPointerdown.bind(this);#n=new Path2D;#l=!1;#c=!1;#i=!1;#p=null;#h=0;#u=0;#f=null;static _defaultColor=null;static _defaultOpacity=1;static _defaultThickness=1;static _type="ink";constructor(t){super({...t,name:"inkEditor"}),this.color=t.color||null,this.thickness=t.thickness||null,this.opacity=t.opacity||null,this.paths=[],this.bezierPath2D=[],this.allRawPaths=[],this.currentPath=[],this.scaleFactor=1,this.translationX=this.translationY=0,this.x=0,this.y=0,this._willKeepAspectRatio=!0}static initialize(t){d.AnnotationEditor.initialize(t,{strings:["editor_ink_canvas_aria_label","editor_ink2_aria_label"]})}static updateDefaultParams(t,r){switch(t){case i.AnnotationEditorParamsType.INK_THICKNESS:w._defaultThickness=r;break;case i.AnnotationEditorParamsType.INK_COLOR:w._defaultColor=r;break;case i.AnnotationEditorParamsType.INK_OPACITY:w._defaultOpacity=r/100;break}}updateParams(t,r){switch(t){case i.AnnotationEditorParamsType.INK_THICKNESS:this.#y(r);break;case i.AnnotationEditorParamsType.INK_COLOR:this.#m(r);break;case i.AnnotationEditorParamsType.INK_OPACITY:this.#g(r);break}}static get defaultPropertiesToUpdate(){return[[i.AnnotationEditorParamsType.INK_THICKNESS,w._defaultThickness],[i.AnnotationEditorParamsType.INK_COLOR,w._defaultColor||d.AnnotationEditor._defaultLineColor],[i.AnnotationEditorParamsType.INK_OPACITY,Math.round(w._defaultOpacity*100)]]}get propertiesToUpdate(){return[[i.AnnotationEditorParamsType.INK_THICKNESS,this.thickness||w._defaultThickness],[i.AnnotationEditorParamsType.INK_COLOR,this.color||w._defaultColor||d.AnnotationEditor._defaultLineColor],[i.AnnotationEditorParamsType.INK_OPACITY,Math.round(100*(this.opacity??w._defaultOpacity))]]}#y(t){const r=this.thickness;this.addCommands({cmd:()=>{this.thickness=t,this.#E()},undo:()=>{this.thickness=r,this.#E()},mustExec:!0,type:i.AnnotationEditorParamsType.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0})}#m(t){const r=this.color;this.addCommands({cmd:()=>{this.color=t,this.#v()},undo:()=>{this.color=r,this.#v()},mustExec:!0,type:i.AnnotationEditorParamsType.INK_COLOR,overwriteIfSameType:!0,keepUndo:!0})}#g(t){t/=100;const r=this.opacity;this.addCommands({cmd:()=>{this.opacity=t,this.#v()},undo:()=>{this.opacity=r,this.#v()},mustExec:!0,type:i.AnnotationEditorParamsType.INK_OPACITY,overwriteIfSameType:!0,keepUndo:!0})}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.canvas||(this.#k(),this.#F()),this.isAttachedToDOM||(this.parent.add(this),this.#_()),this.#E()))}remove(){this.canvas!==null&&(this.isEmpty()||this.commit(),this.canvas.width=this.canvas.height=0,this.canvas.remove(),this.canvas=null,this.#p.disconnect(),this.#p=null,super.remove())}setParent(t){!this.parent&&t?this._uiManager.removeShouldRescale(this):this.parent&&t===null&&this._uiManager.addShouldRescale(this),super.setParent(t)}onScaleChanging(){const[t,r]=this.parentDimensions,l=this.width*t,c=this.height*r;this.setDimensions(l,c)}enableEditMode(){this.#l||this.canvas===null||(super.enableEditMode(),this._isDraggable=!1,this.canvas.addEventListener("pointerdown",this.#a))}disableEditMode(){!this.isInEditMode()||this.canvas===null||(super.disableEditMode(),this._isDraggable=!this.isEmpty(),this.div.classList.remove("editing"),this.canvas.removeEventListener("pointerdown",this.#a))}onceAdded(){this._isDraggable=!this.isEmpty()}isEmpty(){return this.paths.length===0||this.paths.length===1&&this.paths[0].length===0}#d(){const{parentRotation:t,parentDimensions:[r,l]}=this;switch(t){case 90:return[0,l,l,r];case 180:return[r,l,r,l];case 270:return[r,0,l,r];default:return[0,0,r,l]}}#b(){const{ctx:t,color:r,opacity:l,thickness:c,parentScale:e,scaleFactor:h}=this;t.lineWidth=c*e/h,t.lineCap="round",t.lineJoin="round",t.miterLimit=10,t.strokeStyle=`${r}${(0,M.opacityToHex)(l)}`}#P(t,r){this.canvas.addEventListener("contextmenu",A.noContextMenu),this.canvas.addEventListener("pointerleave",this.#s),this.canvas.addEventListener("pointermove",this.#r),this.canvas.addEventListener("pointerup",this.#o),this.canvas.removeEventListener("pointerdown",this.#a),this.isEditing=!0,this.#i||(this.#i=!0,this.#_(),this.thickness||=w._defaultThickness,this.color||=w._defaultColor||d.AnnotationEditor._defaultLineColor,this.opacity??=w._defaultOpacity),this.currentPath.push([t,r]),this.#c=!1,this.#b(),this.#f=()=>{this.#I(),this.#f&&window.requestAnimationFrame(this.#f)},window.requestAnimationFrame(this.#f)}#S(t,r){const[l,c]=this.currentPath.at(-1);if(this.currentPath.length>1&&t===l&&r===c)return;const e=this.currentPath;let h=this.#n;if(e.push([t,r]),this.#c=!0,e.length<=2){h.moveTo(...e[0]),h.lineTo(t,r);return}e.length===3&&(this.#n=h=new Path2D,h.moveTo(...e[0])),this.#L(h,...e.at(-3),...e.at(-2),t,r)}#w(){if(this.currentPath.length===0)return;const t=this.currentPath.at(-1);this.#n.lineTo(...t)}#T(t,r){this.#f=null,t=Math.min(Math.max(t,0),this.canvas.width),r=Math.min(Math.max(r,0),this.canvas.height),this.#S(t,r),this.#w();let l;if(this.currentPath.length!==1)l=this.#O();else{const a=[t,r];l=[[a,a.slice(),a.slice(),a]]}const c=this.#n,e=this.currentPath;this.currentPath=[],this.#n=new Path2D;const h=()=>{this.allRawPaths.push(e),this.paths.push(l),this.bezierPath2D.push(c),this.rebuild()},f=()=>{this.allRawPaths.pop(),this.paths.pop(),this.bezierPath2D.pop(),this.paths.length===0?this.remove():(this.canvas||(this.#k(),this.#F()),this.#E())};this.addCommands({cmd:h,undo:f,mustExec:!0})}#I(){if(!this.#c)return;this.#c=!1;const t=Math.ceil(this.thickness*this.parentScale),r=this.currentPath.slice(-3),l=r.map(h=>h[0]),c=r.map(h=>h[1]);Math.min(...l)-t,Math.max(...l)+t,Math.min(...c)-t,Math.max(...c)+t;const{ctx:e}=this;e.save(),e.clearRect(0,0,this.canvas.width,this.canvas.height);for(const h of this.bezierPath2D)e.stroke(h);e.stroke(this.#n),e.restore()}#L(t,r,l,c,e,h,f){const a=(r+c)/2,v=(l+e)/2,R=(c+h)/2,k=(e+f)/2;t.bezierCurveTo(a+2*(c-a)/3,v+2*(e-v)/3,R+2*(c-R)/3,k+2*(e-k)/3,R,k)}#O(){const t=this.currentPath;if(t.length<=2)return[[t[0],t[0],t.at(-1),t.at(-1)]];const r=[];let l,[c,e]=t[0];for(l=1;l<t.length-2;l++){const[g,P]=t[l],[U,z]=t[l+1],N=(g+U)/2,j=(P+z)/2,W=[c+2*(g-c)/3,e+2*(P-e)/3],at=[N+2*(g-N)/3,j+2*(P-j)/3];r.push([[c,e],W,at,[N,j]]),[c,e]=[N,j]}const[h,f]=t[l],[a,v]=t[l+1],R=[c+2*(h-c)/3,e+2*(f-e)/3],k=[a+2*(h-a)/3,v+2*(f-v)/3];return r.push([[c,e],R,k,[a,v]]),r}#v(){if(this.isEmpty()){this.#C();return}this.#b();const{canvas:t,ctx:r}=this;r.setTransform(1,0,0,1,0,0),r.clearRect(0,0,t.width,t.height),this.#C();for(const l of this.bezierPath2D)r.stroke(l)}commit(){this.#l||(super.commit(),this.isEditing=!1,this.disableEditMode(),this.setInForeground(),this.#l=!0,this.div.classList.add("disabled"),this.#E(!0),this.makeResizable(),this.parent.addInkEditorIfNeeded(!0),this.moveInDOM(),this.div.focus({preventScroll:!0}))}focusin(t){this._focusEventsAllowed&&(super.focusin(t),this.enableEditMode())}canvasPointerdown(t){t.button!==0||!this.isInEditMode()||this.#l||(this.setInForeground(),t.preventDefault(),t.type!=="mouse"&&this.div.focus(),this.#P(t.offsetX,t.offsetY))}canvasPointermove(t){t.preventDefault(),this.#S(t.offsetX,t.offsetY)}canvasPointerup(t){t.preventDefault(),this.#D(t)}canvasPointerleave(t){this.#D(t)}#D(t){this.canvas.removeEventListener("pointerleave",this.#s),this.canvas.removeEventListener("pointermove",this.#r),this.canvas.removeEventListener("pointerup",this.#o),this.canvas.addEventListener("pointerdown",this.#a),setTimeout(()=>{this.canvas.removeEventListener("contextmenu",A.noContextMenu)},10),this.#T(t.offsetX,t.offsetY),this.addToAnnotationStorage(),this.setInBackground()}#k(){this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=0,this.canvas.className="inkEditorCanvas",d.AnnotationEditor._l10nPromise.get("editor_ink_canvas_aria_label").then(t=>this.canvas?.setAttribute("aria-label",t)),this.div.append(this.canvas),this.ctx=this.canvas.getContext("2d")}#F(){this.#p=new ResizeObserver(t=>{const r=t[0].contentRect;r.width&&r.height&&this.setDimensions(r.width,r.height)}),this.#p.observe(this.div)}get isResizable(){return!this.isEmpty()&&this.#l}render(){if(this.div)return this.div;let t,r;this.width&&(t=this.x,r=this.y),super.render(),d.AnnotationEditor._l10nPromise.get("editor_ink2_aria_label").then(f=>this.div?.setAttribute("aria-label",f));const[l,c,e,h]=this.#d();if(this.setAt(l,c,0,0),this.setDims(e,h),this.#k(),this.width){const[f,a]=this.parentDimensions;this.setAspectRatio(this.width*f,this.height*a),this.setAt(t*f,r*a,this.width*f,this.height*a),this.#i=!0,this.#_(),this.setDims(this.width*f,this.height*a),this.#v(),this.div.classList.add("disabled")}else this.div.classList.add("editing"),this.enableEditMode();return this.#F(),this.div}#_(){if(!this.#i)return;const[t,r]=this.parentDimensions;this.canvas.width=Math.ceil(this.width*t),this.canvas.height=Math.ceil(this.height*r),this.#C()}setDimensions(t,r){const l=Math.round(t),c=Math.round(r);if(this.#h===l&&this.#u===c)return;this.#h=l,this.#u=c,this.canvas.style.visibility="hidden";const[e,h]=this.parentDimensions;this.width=t/e,this.height=r/h,this.fixAndSetPosition(),this.#l&&this.#x(t,r),this.#_(),this.#v(),this.canvas.style.visibility="visible",this.fixDims()}#x(t,r){const l=this.#R(),c=(t-l)/this.#e,e=(r-l)/this.#t;this.scaleFactor=Math.min(c,e)}#C(){const t=this.#R()/2;this.ctx.setTransform(this.scaleFactor,0,0,this.scaleFactor,this.translationX*this.scaleFactor+t,this.translationY*this.scaleFactor+t)}static#N(t){const r=new Path2D;for(let l=0,c=t.length;l<c;l++){const[e,h,f,a]=t[l];l===0&&r.moveTo(...e),r.bezierCurveTo(h[0],h[1],f[0],f[1],a[0],a[1])}return r}static#$(t,r,l){const[c,e,h,f]=r;switch(l){case 0:for(let a=0,v=t.length;a<v;a+=2)t[a]+=c,t[a+1]=f-t[a+1];break;case 90:for(let a=0,v=t.length;a<v;a+=2){const R=t[a];t[a]=t[a+1]+c,t[a+1]=R+e}break;case 180:for(let a=0,v=t.length;a<v;a+=2)t[a]=h-t[a],t[a+1]+=e;break;case 270:for(let a=0,v=t.length;a<v;a+=2){const R=t[a];t[a]=h-t[a+1],t[a+1]=f-R}break;default:throw new Error("Invalid rotation")}return t}static#U(t,r,l){const[c,e,h,f]=r;switch(l){case 0:for(let a=0,v=t.length;a<v;a+=2)t[a]-=c,t[a+1]=f-t[a+1];break;case 90:for(let a=0,v=t.length;a<v;a+=2){const R=t[a];t[a]=t[a+1]-e,t[a+1]=R-c}break;case 180:for(let a=0,v=t.length;a<v;a+=2)t[a]=h-t[a],t[a+1]-=e;break;case 270:for(let a=0,v=t.length;a<v;a+=2){const R=t[a];t[a]=f-t[a+1],t[a+1]=h-R}break;default:throw new Error("Invalid rotation")}return t}#B(t,r,l,c){const e=[],h=this.thickness/2,f=t*r+h,a=t*l+h;for(const v of this.paths){const R=[],k=[];for(let g=0,P=v.length;g<P;g++){const[U,z,N,j]=v[g],W=t*U[0]+f,at=t*U[1]+a,tt=t*z[0]+f,it=t*z[1]+a,ut=t*N[0]+f,J=t*N[1]+a,L=t*j[0]+f,b=t*j[1]+a;g===0&&(R.push(W,at),k.push(W,at)),R.push(tt,it,ut,J,L,b),k.push(tt,it),g===P-1&&k.push(L,b)}e.push({bezier:w.#$(R,c,this.rotation),points:w.#$(k,c,this.rotation)})}return e}#M(){let t=1/0,r=-1/0,l=1/0,c=-1/0;for(const e of this.paths)for(const[h,f,a,v]of e){const R=i.Util.bezierBoundingBox(...h,...f,...a,...v);t=Math.min(t,R[0]),l=Math.min(l,R[1]),r=Math.max(r,R[2]),c=Math.max(c,R[3])}return[t,l,r,c]}#R(){return this.#l?Math.ceil(this.thickness*this.parentScale):0}#E(t=!1){if(this.isEmpty())return;if(!this.#l){this.#v();return}const r=this.#M(),l=this.#R();this.#e=Math.max(d.AnnotationEditor.MIN_SIZE,r[2]-r[0]),this.#t=Math.max(d.AnnotationEditor.MIN_SIZE,r[3]-r[1]);const c=Math.ceil(l+this.#e*this.scaleFactor),e=Math.ceil(l+this.#t*this.scaleFactor),[h,f]=this.parentDimensions;this.width=c/h,this.height=e/f,this.setAspectRatio(c,e);const a=this.translationX,v=this.translationY;this.translationX=-r[0],this.translationY=-r[1],this.#_(),this.#v(),this.#h=c,this.#u=e,this.setDims(c,e);const R=t?l/this.scaleFactor/2:0;this.translate(a-this.translationX-R,v-this.translationY-R)}static deserialize(t,r,l){if(t instanceof C.InkAnnotationElement)return null;const c=super.deserialize(t,r,l);c.thickness=t.thickness,c.color=i.Util.makeHexColor(...t.color),c.opacity=t.opacity;const[e,h]=c.pageDimensions,f=c.width*e,a=c.height*h,v=c.parentScale,R=t.thickness/2;c.#l=!0,c.#h=Math.round(f),c.#u=Math.round(a);const{paths:k,rect:g,rotation:P}=t;for(let{bezier:z}of k){z=w.#U(z,g,P);const N=[];c.paths.push(N);let j=v*(z[0]-R),W=v*(z[1]-R);for(let tt=2,it=z.length;tt<it;tt+=6){const ut=v*(z[tt]-R),J=v*(z[tt+1]-R),L=v*(z[tt+2]-R),b=v*(z[tt+3]-R),p=v*(z[tt+4]-R),u=v*(z[tt+5]-R);N.push([[j,W],[ut,J],[L,b],[p,u]]),j=p,W=u}const at=this.#N(N);c.bezierPath2D.push(at)}const U=c.#M();return c.#e=Math.max(d.AnnotationEditor.MIN_SIZE,U[2]-U[0]),c.#t=Math.max(d.AnnotationEditor.MIN_SIZE,U[3]-U[1]),c.#x(f,a),c}serialize(){if(this.isEmpty())return null;const t=this.getRect(0,0),r=d.AnnotationEditor._colorManager.convert(this.ctx.strokeStyle);return{annotationType:i.AnnotationEditorType.INK,color:r,thickness:this.thickness,opacity:this.opacity,paths:this.#B(this.scaleFactor/this.parentScale,this.translationX,this.translationY,t),pageIndex:this.pageIndex,rect:t,rotation:this.rotation,structTreeParentId:this._structTreeParentId}}}s.InkEditor=w},(E,s,y)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.StampEditor=void 0;var i=y(1),d=y(4),C=y(6),A=y(29);class M extends d.AnnotationEditor{#t=null;#e=null;#r=null;#s=null;#o=null;#a=null;#n=null;#l=null;#c=!1;#i=!1;static _type="stamp";constructor(n){super({...n,name:"stampEditor"}),this.#s=n.bitmapUrl,this.#o=n.bitmapFile}static initialize(n){d.AnnotationEditor.initialize(n)}static get supportedTypes(){const n=["apng","avif","bmp","gif","jpeg","png","svg+xml","webp","x-icon"];return(0,i.shadow)(this,"supportedTypes",n.map(t=>`image/${t}`))}static get supportedTypesStr(){return(0,i.shadow)(this,"supportedTypesStr",this.supportedTypes.join(","))}static isHandlingMimeForPasting(n){return this.supportedTypes.includes(n)}static paste(n,t){t.pasteEditor(i.AnnotationEditorType.STAMP,{bitmapFile:n.getAsFile()})}#p(n,t=!1){if(!n){this.remove();return}this.#t=n.bitmap,t||(this.#e=n.id,this.#c=n.isSvg),this.#f()}#h(){this.#r=null,this._uiManager.enableWaiting(!1),this.#a&&this.div.focus()}#u(){if(this.#e){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(this.#e).then(t=>this.#p(t,!0)).finally(()=>this.#h());return}if(this.#s){const t=this.#s;this.#s=null,this._uiManager.enableWaiting(!0),this.#r=this._uiManager.imageManager.getFromUrl(t).then(r=>this.#p(r)).finally(()=>this.#h());return}if(this.#o){const t=this.#o;this.#o=null,this._uiManager.enableWaiting(!0),this.#r=this._uiManager.imageManager.getFromFile(t).then(r=>this.#p(r)).finally(()=>this.#h());return}const n=document.createElement("input");n.type="file",n.accept=M.supportedTypesStr,this.#r=new Promise(t=>{n.addEventListener("change",async()=>{if(!n.files||n.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const r=await this._uiManager.imageManager.getFromFile(n.files[0]);this.#p(r)}t()}),n.addEventListener("cancel",()=>{this.remove(),t()})}).finally(()=>this.#h()),n.click()}remove(){this.#e&&(this.#t=null,this._uiManager.imageManager.deleteId(this.#e),this.#a?.remove(),this.#a=null,this.#n?.disconnect(),this.#n=null),super.remove()}rebuild(){if(!this.parent){this.#e&&this.#u();return}super.rebuild(),this.div!==null&&(this.#e&&this.#u(),this.isAttachedToDOM||this.parent.add(this))}onceAdded(){this._isDraggable=!0,this.div.focus()}isEmpty(){return!(this.#r||this.#t||this.#s||this.#o)}get isResizable(){return!0}render(){if(this.div)return this.div;let n,t;if(this.width&&(n=this.x,t=this.y),super.render(),this.div.hidden=!0,this.#t?this.#f():this.#u(),this.width){const[r,l]=this.parentDimensions;this.setAt(n*r,t*l,this.width*r,this.height*l)}return this.div}#f(){const{div:n}=this;let{width:t,height:r}=this.#t;const[l,c]=this.pageDimensions,e=.75;if(this.width)t=this.width*l,r=this.height*c;else if(t>e*l||r>e*c){const v=Math.min(e*l/t,e*c/r);t*=v,r*=v}const[h,f]=this.parentDimensions;this.setDims(t*h/l,r*f/c),this._uiManager.enableWaiting(!1);const a=this.#a=document.createElement("canvas");n.append(a),n.hidden=!1,this.#g(t,r),this.#b(),this.#i||(this.parent.addUndoableEditor(this),this.#i=!0),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",subtype:this.editorType,data:{action:"inserted_image"}}}),this.addAltTextButton()}#y(n,t){const[r,l]=this.parentDimensions;this.width=n/r,this.height=t/l,this.setDims(n,t),this._initialOptions?.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,this.#l!==null&&clearTimeout(this.#l);const c=200;this.#l=setTimeout(()=>{this.#l=null,this.#g(n,t)},c)}#m(n,t){const{width:r,height:l}=this.#t;let c=r,e=l,h=this.#t;for(;c>2*n||e>2*t;){const f=c,a=e;c>2*n&&(c=c>=16384?Math.floor(c/2)-1:Math.ceil(c/2)),e>2*t&&(e=e>=16384?Math.floor(e/2)-1:Math.ceil(e/2));const v=new OffscreenCanvas(c,e);v.getContext("2d").drawImage(h,0,0,f,a,0,0,c,e),h=v.transferToImageBitmap()}return h}#g(n,t){n=Math.ceil(n),t=Math.ceil(t);const r=this.#a;if(!r||r.width===n&&r.height===t)return;r.width=n,r.height=t;const l=this.#c?this.#t:this.#m(n,t),c=r.getContext("2d");c.filter=this._uiManager.hcmFilter,c.drawImage(l,0,0,l.width,l.height,0,0,n,t)}#d(n){if(n){if(this.#c){const l=this._uiManager.imageManager.getSvgUrl(this.#e);if(l)return l}const t=document.createElement("canvas");return{width:t.width,height:t.height}=this.#t,t.getContext("2d").drawImage(this.#t,0,0),t.toDataURL()}if(this.#c){const[t,r]=this.pageDimensions,l=Math.round(this.width*t*C.PixelsPerInch.PDF_TO_CSS_UNITS),c=Math.round(this.height*r*C.PixelsPerInch.PDF_TO_CSS_UNITS),e=new OffscreenCanvas(l,c);return e.getContext("2d").drawImage(this.#t,0,0,this.#t.width,this.#t.height,0,0,l,c),e.transferToImageBitmap()}return structuredClone(this.#t)}#b(){this.#n=new ResizeObserver(n=>{const t=n[0].contentRect;t.width&&t.height&&this.#y(t.width,t.height)}),this.#n.observe(this.div)}static deserialize(n,t,r){if(n instanceof A.StampAnnotationElement)return null;const l=super.deserialize(n,t,r),{rect:c,bitmapUrl:e,bitmapId:h,isSvg:f,accessibilityData:a}=n;h&&r.imageManager.isValidId(h)?l.#e=h:l.#s=e,l.#c=f;const[v,R]=l.pageDimensions;return l.width=(c[2]-c[0])/v,l.height=(c[3]-c[1])/R,a&&(l.altTextData=a),l}serialize(n=!1,t=null){if(this.isEmpty())return null;const r={annotationType:i.AnnotationEditorType.STAMP,bitmapId:this.#e,pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:this.#c,structTreeParentId:this._structTreeParentId};if(n)return r.bitmapUrl=this.#d(!0),r.accessibilityData=this.altTextData,r;const{decorative:l,altText:c}=this.altTextData;if(!l&&c&&(r.accessibilityData={type:"Figure",alt:c}),t===null)return r;t.stamps||=new Map;const e=this.#c?(r.rect[2]-r.rect[0])*(r.rect[3]-r.rect[1]):null;if(!t.stamps.has(this.#e))t.stamps.set(this.#e,{area:e,serialized:r}),r.bitmap=this.#d(!1);else if(this.#c){const h=t.stamps.get(this.#e);e>h.area&&(h.area=e,h.serialized.bitmap.close(),h.serialized.bitmap=this.#d(!1))}return r}}s.StampEditor=M}],__webpack_module_cache__={};function __w_pdfjs_require__(E){var s=__webpack_module_cache__[E];if(s!==void 0)return s.exports;var y=__webpack_module_cache__[E]={exports:{}};return __webpack_modules__[E](y,y.exports,__w_pdfjs_require__),y.exports}var __webpack_exports__={};return(()=>{var E=__webpack_exports__;Object.defineProperty(E,"__esModule",{value:!0}),Object.defineProperty(E,"AbortException",{enumerable:!0,get:function(){return s.AbortException}}),Object.defineProperty(E,"AnnotationEditorLayer",{enumerable:!0,get:function(){return C.AnnotationEditorLayer}}),Object.defineProperty(E,"AnnotationEditorParamsType",{enumerable:!0,get:function(){return s.AnnotationEditorParamsType}}),Object.defineProperty(E,"AnnotationEditorType",{enumerable:!0,get:function(){return s.AnnotationEditorType}}),Object.defineProperty(E,"AnnotationEditorUIManager",{enumerable:!0,get:function(){return A.AnnotationEditorUIManager}}),Object.defineProperty(E,"AnnotationLayer",{enumerable:!0,get:function(){return M.AnnotationLayer}}),Object.defineProperty(E,"AnnotationMode",{enumerable:!0,get:function(){return s.AnnotationMode}}),Object.defineProperty(E,"CMapCompressionType",{enumerable:!0,get:function(){return s.CMapCompressionType}}),Object.defineProperty(E,"DOMSVGFactory",{enumerable:!0,get:function(){return i.DOMSVGFactory}}),Object.defineProperty(E,"FeatureTest",{enumerable:!0,get:function(){return s.FeatureTest}}),Object.defineProperty(E,"GlobalWorkerOptions",{enumerable:!0,get:function(){return w.GlobalWorkerOptions}}),Object.defineProperty(E,"ImageKind",{enumerable:!0,get:function(){return s.ImageKind}}),Object.defineProperty(E,"InvalidPDFException",{enumerable:!0,get:function(){return s.InvalidPDFException}}),Object.defineProperty(E,"MissingPDFException",{enumerable:!0,get:function(){return s.MissingPDFException}}),Object.defineProperty(E,"OPS",{enumerable:!0,get:function(){return s.OPS}}),Object.defineProperty(E,"PDFDataRangeTransport",{enumerable:!0,get:function(){return y.PDFDataRangeTransport}}),Object.defineProperty(E,"PDFDateString",{enumerable:!0,get:function(){return i.PDFDateString}}),Object.defineProperty(E,"PDFWorker",{enumerable:!0,get:function(){return y.PDFWorker}}),Object.defineProperty(E,"PasswordResponses",{enumerable:!0,get:function(){return s.PasswordResponses}}),Object.defineProperty(E,"PermissionFlag",{enumerable:!0,get:function(){return s.PermissionFlag}}),Object.defineProperty(E,"PixelsPerInch",{enumerable:!0,get:function(){return i.PixelsPerInch}}),Object.defineProperty(E,"PromiseCapability",{enumerable:!0,get:function(){return s.PromiseCapability}}),Object.defineProperty(E,"RenderingCancelledException",{enumerable:!0,get:function(){return i.RenderingCancelledException}}),Object.defineProperty(E,"SVGGraphics",{enumerable:!0,get:function(){return y.SVGGraphics}}),Object.defineProperty(E,"UnexpectedResponseException",{enumerable:!0,get:function(){return s.UnexpectedResponseException}}),Object.defineProperty(E,"Util",{enumerable:!0,get:function(){return s.Util}}),Object.defineProperty(E,"VerbosityLevel",{enumerable:!0,get:function(){return s.VerbosityLevel}}),Object.defineProperty(E,"XfaLayer",{enumerable:!0,get:function(){return n.XfaLayer}}),Object.defineProperty(E,"build",{enumerable:!0,get:function(){return y.build}}),Object.defineProperty(E,"createValidAbsoluteUrl",{enumerable:!0,get:function(){return s.createValidAbsoluteUrl}}),Object.defineProperty(E,"getDocument",{enumerable:!0,get:function(){return y.getDocument}}),Object.defineProperty(E,"getFilenameFromUrl",{enumerable:!0,get:function(){return i.getFilenameFromUrl}}),Object.defineProperty(E,"getPdfFilenameFromUrl",{enumerable:!0,get:function(){return i.getPdfFilenameFromUrl}}),Object.defineProperty(E,"getXfaPageViewport",{enumerable:!0,get:function(){return i.getXfaPageViewport}}),Object.defineProperty(E,"isDataScheme",{enumerable:!0,get:function(){return i.isDataScheme}}),Object.defineProperty(E,"isPdfFile",{enumerable:!0,get:function(){return i.isPdfFile}}),Object.defineProperty(E,"loadScript",{enumerable:!0,get:function(){return i.loadScript}}),Object.defineProperty(E,"noContextMenu",{enumerable:!0,get:function(){return i.noContextMenu}}),Object.defineProperty(E,"normalizeUnicode",{enumerable:!0,get:function(){return s.normalizeUnicode}}),Object.defineProperty(E,"renderTextLayer",{enumerable:!0,get:function(){return d.renderTextLayer}}),Object.defineProperty(E,"setLayerDimensions",{enumerable:!0,get:function(){return i.setLayerDimensions}}),Object.defineProperty(E,"shadow",{enumerable:!0,get:function(){return s.shadow}}),Object.defineProperty(E,"updateTextLayer",{enumerable:!0,get:function(){return d.updateTextLayer}}),Object.defineProperty(E,"version",{enumerable:!0,get:function(){return y.version}});var s=__w_pdfjs_require__(1),y=__w_pdfjs_require__(2),i=__w_pdfjs_require__(6),d=__w_pdfjs_require__(26),C=__w_pdfjs_require__(27),A=__w_pdfjs_require__(5),M=__w_pdfjs_require__(29),w=__w_pdfjs_require__(14),n=__w_pdfjs_require__(32)})(),__webpack_exports__})())}(pdf)),pdf.exports}var pdfExports=requirePdf();pdfExports.GlobalWorkerOptions.workerSrc="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js";async function parsePDFFile(E,s,y){const i={...defaultPDFConfig,...s};try{const d=await extractTextFromPDF(E);if(console.log(d),!d||d.trim().length<10)throw new Error(`Could not extract text from PDF.

This PDF might be image-based.

Solution: Use "Paste Text" option instead:
1. Open the PDF in a viewer
2. Select and copy the product list
3. Paste it in the text input`);const C=parseProductLines(d,i),A=C.length,M=C.reduce((w,n)=>w+n.totalPrice,0);return console.log(C),{id:generateOfferId(),supplierName:y||"Unknown Supplier",sourceFile:E.name,sourceType:"pdf",uploadDate:Date.now(),products:C,currency:i.defaultCurrency||"USD",totalProducts:A,totalValue:M}}catch(d){const C=d instanceof Error?d.message:"Unknown error";throw new Error(C)}}function parseTextContent(E,s,y){const i={...defaultPDFConfig,...s},d=parseProductLines(E,i),C=d.length,A=d.reduce((M,w)=>M+w.totalPrice,0);return{id:generateOfferId(),supplierName:y||"Manual Entry",sourceFile:"text-input",sourceType:"pdf",uploadDate:Date.now(),products:d,currency:i.defaultCurrency||"USD",totalProducts:C,totalValue:A}}async function extractTextFromPDF(E){try{const s=await E.arrayBuffer(),y=new Uint8Array(s),d=await pdfExports.getDocument({data:y,useWorkerFetch:!1,isEvalSupported:!1,useSystemFonts:!0}).promise,C=d.numPages;console.log(`📄 PDF loaded: ${C} pages total`);const A=[];for(let w=1;w<=C;w++){console.log(`📖 Processing page ${w}/${C}...`);try{const t=await(await d.getPage(w)).getTextContent();if(console.log(`   Page ${w}: ${t.items?.length||0} text items`),!t.items||t.items.length===0){console.log(`   Page ${w}: No text items found`);continue}const r=[...t.items].sort((f,a)=>{const v=f.transform?f.transform[5]:0,R=a.transform?a.transform[5]:0,k=f.transform?f.transform[4]:0,g=a.transform?a.transform[4]:0;return Math.abs(v-R)>3?R-v:k-g}),l=[];let c=[],e=null;for(const f of r){const a=f;if(!a.str||!a.str.trim())continue;const v=a.transform?a.transform[5]:0;e!==null&&Math.abs(v-e)>3?(c.length>0&&l.push(c),c=[a.str]):c.push(a.str),e=v}c.length>0&&l.push(c);const h=l.map(f=>f.join(" ")).join(`
`);h.trim()&&(A.push(h),console.log(`   Page ${w}: Extracted ${l.length} lines, ${h.length} chars`))}catch(n){console.error(`   Page ${w}: ERROR -`,n)}}const M=A.join(`
`);return console.log(`✅ Total extracted: ${M.length} characters from ${A.length} pages`),M}catch(s){throw console.error("PDF extraction failed:",s),new Error('Failed to read PDF file. Please try "Paste Text" option instead.')}}function parseProductLines(E,s){const y=[],i=E.split(/[\n\r]+/).map(A=>A.trim()).filter(Boolean),d=parseB2BCatalogFormat(E);if(d.length>0)return d;const C=[/^(\d{10,14})\s+(.{5,80}?)\s+(\d+)\s+\$?\s*(\d+[.,]\d{2})\s+\$?\s*(\d+[.,]\d{2})\s*$/,/^(.{3,50}?)\s+(\d+(?:[.,]\d+)?)\s+([a-zA-Z]{1,10})?\s*\$?\s*(\d+[.,]\d{2})\s+\$?\s*(\d+[.,]\d{2})\s*$/,/^([A-Z0-9]{2,10})\s+(.{3,40}?)\s+(\d+(?:[.,]\d+)?)\s+([a-zA-Z]{1,10})?\s*\$?\s*(\d+[.,]\d{2})\s+\$?\s*(\d+[.,]\d{2})\s*$/,/^(.{3,50}?)\s+(\d+(?:[.,]\d+)?)\s+\$?\s*(\d+[.,]\d{2})\s*$/,/^(.{3,50}?)\s+\$\s*(\d+[.,]\d{2})\s*$/,/^(.{5,50}?)\s+(\d+[.,]\d{2})\s*$/];s.patterns?.productLine&&C.unshift(s.patterns.productLine);for(const A of i)if(!(A.length<5||/^(product|item|description|qty|quantity|price|total|unit|code|sku|upc|image|expiration|wholesale|b2b|case)s?\s*$/i.test(A)||/^[-=_\s]+$/.test(A)))for(const M of C){const w=A.match(M);if(w){const n=parseMatchToProduct(w,s);if(n){y.push(n);break}}}return y}function parseB2BCatalogFormat(E){const s=[];if(!/UPC|PRODUCT\s*DESCRIPTION|WHOLESALE|B2B.*PRICE|QTY\s*IN/i.test(E))return[];const i=E.split(/[\n\r]+/).map(A=>A.trim()).filter(Boolean),d=/^(\d{10,14})\s+(.+?)\s+(\d{1,2}[\/\-]\d{1,2}[\/\-]\d{2,4})?\s*(\d+)\s+\$?\s*(\d+[.,]\d{2})\s+\$?\s*(\d+[.,]\d{2})\s*$/,C=/^(\d{10,14})\s+(.+?)\s+(\d+)\s+\$?\s*(\d+[.,]\d{2})\s+\$?\s*(\d+[.,]\d{2})\s*$/;for(let A=0;A<i.length;A++){const M=i[A];if(/^(UPC|IMAGE|PRODUCT|DESCRIPTION|EXPIRATION|EXPERATION|QTY|WHOLESALE|B2B|CASE|PRICE)/i.test(M))continue;let w=M.match(d);if(w){const t=w[1],r=w[2].trim(),l=parseNumber(w[4]);parseNumber(w[5]);const c=parseNumber(w[6]);r.length>=3&&c>0&&s.push({id:generateProductId(),productCode:t,productName:r,unit:"case",quantity:l||1,unitPrice:c,totalPrice:c*(l||1),currency:"USD",normalizedName:normalizeProductName(r)});continue}if(w=M.match(C),w){const t=w[1],r=w[2].trim(),l=parseNumber(w[3]);parseNumber(w[4]);const c=parseNumber(w[5]);r.length>=3&&c>0&&s.push({id:generateProductId(),productCode:t,productName:r,unit:"case",quantity:l||1,unitPrice:c,totalPrice:c*(l||1),currency:"USD",normalizedName:normalizeProductName(r)});continue}const n=M.match(/^(\d{10,14})\s+(.*)$/);if(n){const t=n[1],r=n[2],l=r.match(/\d+[.,]\d{2}/g),c=r.match(/\s(\d{1,3})\s/);if(l&&l.length>=1){const e=parseNumber(l[l.length-1]);l.length>=2&&parseNumber(l[l.length-2]);const h=c?parseInt(c[1]):1,f=r.match(/^(.+?)(?:\s+\d{1,2}[\/\-]|\s+\d{1,3}\s+\$?[\d.,]+)/),a=f?f[1].trim():r.split(/\s+\d/)[0].trim();a.length>=3&&e>0&&s.push({id:generateProductId(),productCode:t,productName:a,unit:"case",quantity:h,unitPrice:e,totalPrice:e*h,currency:"USD",normalizedName:normalizeProductName(a)})}}}return s}function parseMatchToProduct(E,s){const y=E.slice(1);let i="",d,C=1,A=s.defaultUnit||"ea",M=0,w=0;try{return y.length===2?(i=y[0],M=parseNumber(y[1]),w=M):y.length===3?(i=y[0],C=parseNumber(y[1])||1,w=parseNumber(y[2]),M=w/C):y.length===4?/^[A-Z0-9]{2,10}$/.test(y[0])?(d=y[0],i=y[1],C=parseNumber(y[2])||1,w=parseNumber(y[3]),M=w/C):(i=y[0],C=parseNumber(y[1])||1,y[2]&&!/^\d/.test(y[2])&&(A=normalizeUnit(y[2])),w=parseNumber(y[3]),M=w/C):y.length===5?(i=y[0],C=parseNumber(y[1])||1,y[2]&&(A=normalizeUnit(y[2])),M=parseNumber(y[3]),w=parseNumber(y[4])):y.length===6&&(d=y[0],i=y[1],C=parseNumber(y[2])||1,y[3]&&(A=normalizeUnit(y[3])),M=parseNumber(y[4]),w=parseNumber(y[5])),!i||i.length<2||M===0?null:{id:generateProductId(),productName:i.trim(),productCode:d,unit:A,quantity:C,unitPrice:M,totalPrice:w||M*C,currency:s.defaultCurrency||"USD",normalizedName:normalizeProductName(i)}}catch{return null}}function parseNumber(E){if(typeof E=="number")return E;if(!E||typeof E!="string")return 0;let s=E.replace(/[$€£¥₹₽%\s]/g,"").trim();const y=s.lastIndexOf(","),i=s.lastIndexOf(".");y>i?s=s.replace(/\./g,"").replace(",","."):s=s.replace(/,/g,"");const d=parseFloat(s);return isNaN(d)?0:d}function levenshteinDistance(E,s){const y=E.length,i=s.length;if(y===0)return i;if(i===0)return y;const d=Array(y+1).fill(null).map(()=>Array(i+1).fill(0));for(let C=0;C<=y;C++)d[C][0]=C;for(let C=0;C<=i;C++)d[0][C]=C;for(let C=1;C<=y;C++)for(let A=1;A<=i;A++){const M=E[C-1]===s[A-1]?0:1;d[C][A]=Math.min(d[C-1][A]+1,d[C][A-1]+1,d[C-1][A-1]+M)}return d[y][i]}function stringSimilarity(E,s){if(!E||!s)return 0;if(E===s)return 100;const y=Math.max(E.length,s.length);if(y===0)return 100;const i=levenshteinDistance(E,s);return Math.round((y-i)/y*100)}function wordSimilarity(E,s){const y=new Set(E.toLowerCase().split(/\s+/).filter(A=>A.length>1)),i=new Set(s.toLowerCase().split(/\s+/).filter(A=>A.length>1));if(y.size===0&&i.size===0)return 100;if(y.size===0||i.size===0)return 0;const d=new Set([...y].filter(A=>i.has(A))),C=new Set([...y,...i]);return Math.round(d.size/C.size*100)}function normalizeUpc(E){if(!E)return"";const s=E.replace(/\D/g,"");return s.length===0?"":s}function upcMatch(E,s){const y=normalizeUpc(E),i=normalizeUpc(s);return!y||!i?!1:y===i?!0:y.length===12&&i.length===13?"0"+y===i:y.length===13&&i.length===12?y==="0"+i:!!(y.length>6&&i.length>6&&(y.includes(i)||i.includes(y)))}function extractIdentifiers(E){const s=[];return[/\b(\d{10,14})\b/g,/\b([A-Z]{2,}\d{3,})\b/gi,/\b(\d{3,}-\d{3,})\b/g,/#(\w+)\b/g].forEach(i=>{const d=E.match(i);d&&s.push(...d)}),s}function calculateSimilarity(E,s){const y=normalizeUpc(E.productCode||E.barcode),i=normalizeUpc(s.productCode||s.barcode),d=upcMatch(y,i);if(d)return{score:100,matchType:"upc_match",upcMatch:!0,upcMismatch:!1,nameScore:100,details:"UPC/Barcode match"};const A=y.length>=6&&i.length>=6&&!d,M=normalizeProductName(E.productName),w=normalizeProductName(s.productName);if(M===w&&!A)return{score:100,matchType:"exact",upcMatch:!1,upcMismatch:!1,nameScore:100,details:"Exact name match"};const n=stringSimilarity(M,w),t=wordSimilarity(M,w),r=extractIdentifiers(E.productName),l=extractIdentifiers(s.productName),c=r.some(v=>l.some(R=>v===R));let e;c?e=Math.max(n,t,85):e=Math.round(n*.4+t*.6),E.brand&&s.brand&&E.brand.toLowerCase()===s.brand.toLowerCase()&&(e=Math.min(100,e+10));let h=e,f=`Name similarity: ${e}%`;A&&(h=Math.round(e*.5),f+=` (UPC mismatch: ${y} vs ${i} - score reduced)`),c&&!A&&(f+=" (ID match found)");let a;return h>=90?a="high":h>=70?a="medium":h>=50?a="low":a="none",{score:h,matchType:a,upcMatch:!1,upcMismatch:A,nameScore:e,details:f}}function groupProductsBySimilarity(E,s=70){const y=[],i=new Set,d=[...E].sort((C,A)=>C.product.productName.localeCompare(A.product.productName));for(const C of d){if(i.has(C.product.id))continue;const A={id:`group_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,representativeName:C.product.productName,representativeUpc:C.product.productCode||C.product.barcode,products:[{...C,similarity:{score:100,matchType:"exact",upcMatch:!1,upcMismatch:!1,nameScore:100,details:"Reference product"}}],matchQuality:"exact",averageSimilarity:100};i.add(C.product.id);for(const M of d){if(i.has(M.product.id)||M.supplierId===C.supplierId)continue;const w=calculateSimilarity(C.product,M.product);w.score>=s&&(A.products.push({...M,similarity:w}),i.add(M.product.id),w.upcMatch&&!A.representativeUpc&&(A.representativeUpc=M.product.productCode||M.product.barcode))}if(A.products.length>1){const M=A.products.reduce((w,n)=>w+n.similarity.score,0);A.averageSimilarity=Math.round(M/A.products.length),A.averageSimilarity>=95?A.matchQuality="exact":A.averageSimilarity>=85?A.matchQuality="high":A.averageSimilarity>=70?A.matchQuality="medium":A.matchQuality="low"}y.push(A)}return y}function getMatchQualityDisplay(E){switch(E){case"exact":return{label:"Exact Match",color:"var(--success-color)",bgColor:"var(--success-light)"};case"high":return{label:"High Match",color:"var(--info-color)",bgColor:"var(--info-light)"};case"medium":return{label:"Similar",color:"var(--warning-color)",bgColor:"var(--warning-light)"};case"low":return{label:"Possible Match",color:"var(--text-muted)",bgColor:"var(--gray-100)"};default:return{label:"Unknown",color:"var(--text-muted)",bgColor:"var(--gray-50)"}}}function getScoreDisplay(E){return E>=95?{label:`${E}%`,color:"var(--success-color)",bgColor:"var(--success-light)"}:E>=85?{label:`${E}%`,color:"var(--info-color)",bgColor:"var(--info-light)"}:E>=70?{label:`${E}%`,color:"var(--warning-color)",bgColor:"var(--warning-light)"}:{label:`${E}%`,color:"var(--danger-color)",bgColor:"var(--danger-light)"}}function createOffersStore(){const[E,s]=createSignal([]),[y,i]=createSignal(70),d=l=>{s(c=>[...c,l])},C=l=>{s(c=>c.filter(e=>e.id!==l))},A=(l,c)=>{s(e=>e.map(h=>{if(h.id===l){const f={...h,...c};return c.products&&(f.totalProducts=f.products.length,f.totalValue=f.products.reduce((a,v)=>a+v.totalPrice,0)),f}return h}))},M=()=>{s([])},w=l=>E().find(c=>c.id===l),n=createMemo(()=>{const l=E();if(l.length===0)return[];const c=[];l.forEach(a=>{a.products.forEach(v=>{c.push({product:v,supplierId:a.id,supplierName:a.supplierName})})});const e=y();return groupProductsBySimilarity(c,e).map(a=>{const v=a.products.map(j=>j.product.unitPrice),R=Math.min(...v),k=Math.max(...v),g=v.reduce((j,W)=>j+W,0)/v.length,P=v.indexOf(R),U=a.products[P],z=a.products[0].product;return{productName:a.representativeName,normalizedName:normalizeProductName(a.representativeName),productCode:a.representativeUpc||z.productCode,category:z.category,matchQuality:a.matchQuality,averageSimilarity:a.averageSimilarity,offers:a.products.map(j=>{const W=j.product.unitPrice===R,at=W?0:j.product.unitPrice-R,tt=W?0:at/R*100;return{supplierId:j.supplierId,supplierName:j.supplierName,productOffer:j.product,isBestPrice:W,priceDifference:at>0?at:void 0,priceDifferencePercent:tt>0?tt:void 0,similarity:j.similarity}}),bestOffer:{supplierId:U.supplierId,supplierName:U.supplierName,price:R},averagePrice:g,priceRange:{min:R,max:k}}}).sort((a,v)=>a.productName.localeCompare(v.productName))}),t=l=>n().find(c=>c.normalizedName===l),r=createMemo(()=>{const l=E(),c=n(),e=c.reduce((a,v)=>{const R=v.priceRange.max-v.priceRange.min;return a+R},0),h=new Set(l.flatMap(a=>a.products.map(v=>normalizeProductName(v.productName)))),f=c.filter(a=>a.offers.length>1).length;return{id:generateComparisonId(),name:`Comparison ${new Date().toLocaleDateString()}`,createdAt:Date.now(),supplierOffers:l,comparisons:c,summary:{totalProducts:h.size,totalSuppliers:l.length,productsWithMultipleOffers:f,potentialSavings:e}}});return{offers:E,similarityThreshold:y,addSupplierOffer:d,removeSupplierOffer:C,updateSupplierOffer:A,clearAllOffers:M,getOfferById:w,setSimilarityThreshold:i,compareProducts:n,getBestOffersForProduct:t,getComparisonResult:r}}const offersStore=createOffersStore();async function analyzePdfWithAI(E,s,y){try{const d={query:"analyzePdfTefi",params:{pdfBase64:E,prompt:s,supplierName:y||"Unknown Supplier"}};console.log("📄 Calling analyzePdfTefi...");const C=await fetchGraphQLSS(d);return console.log("📄 AI Response:",C),parseAIResponse(C.data||C)}catch(i){return console.error("❌ analyzePdfTefi error:",i),{success:!1,products:[],error:i instanceof Error?i.message:"Failed to analyze PDF with AI"}}}async function analyzeCsvWithAI(E,s,y,i=!1){try{const d={prompt:s,supplierName:y||"Unknown Supplier"};i?d.csvBase64=E:d.csvContent=E;const C={query:"analyzeCsvTefi",params:d};console.log("📊 Calling analyzeCsvTefi...");const A=await fetchGraphQLSS(C);return console.log("📊 AI Response:",A),parseAIResponse(A.data||A)}catch(d){return console.error("❌ analyzeCsvTefi error:",d),{success:!1,products:[],error:d instanceof Error?d.message:"Failed to analyze CSV with AI"}}}async function fileToBase64(E){return new Promise((s,y)=>{const i=new FileReader;i.onload=()=>{const d=i.result,C=d.split(",")[1]||d;s(C)},i.onerror=y,i.readAsDataURL(E)})}function getDefaultB2BPrompt(){return`Analyze this B2B product catalog and extract ALL products.

Expected columns:
- UPC (barcode, 10-14 digits)
- IMAGE (skip)
- PRODUCT DESCRIPTION (product name)
- EXPERATION/EXPIRATION (date - optional)
- QTY IN A CASE (quantity per case)
- WHOLESALE PRICE BY CASE
- B2B CASE PRICE (use this as the final price)

Return a JSON array with this structure:
[
  {
    "productCode": "UPC number",
    "productName": "Product Description",
    "quantity": number,
    "unit": "case",
    "unitPrice": B2B_CASE_PRICE,
    "totalPrice": unitPrice * quantity,
    "currency": "USD"
  }
]

Extract ALL products. Return ONLY valid JSON, no explanations.`}function parseAIResponse(E){try{let s=E;if(typeof E=="string"){let i=E.trim();i=i.replace(/^```json\s*/i,""),i=i.replace(/^```\s*/i,""),i=i.replace(/\s*```$/i,"");const d=i.match(/\[[\s\S]*\]/);if(!d)return{success:!1,products:[],error:"No JSON array found in AI response",rawResponse:E};s=JSON.parse(d[0])}return s&&s.products&&Array.isArray(s.products)&&(s=s.products),Array.isArray(s)?{success:!0,products:s.filter(i=>i&&(i.productName||i.name||i.description)).map(i=>({id:generateProductId(),productCode:i.productCode||i.upc||i.sku||i.code||void 0,productName:String(i.productName||i.name||i.description||"").trim(),quantity:parseFloat(i.quantity)||1,unit:i.unit||"case",unitPrice:parseFloat(i.unitPrice)||parseFloat(i.price)||parseFloat(i.b2bPrice)||0,totalPrice:parseFloat(i.totalPrice)||(parseFloat(i.unitPrice)||parseFloat(i.price)||0)*(parseFloat(i.quantity)||1),currency:i.currency||"USD",normalizedName:normalizeProductName(i.productName||i.name||"")})),rawResponse:JSON.stringify(E)}:{success:!1,products:[],error:"AI response is not an array",rawResponse:JSON.stringify(E)}}catch(s){return{success:!1,products:[],error:s instanceof Error?s.message:"Failed to parse AI response",rawResponse:JSON.stringify(E)}}}function createOfferFromAIProducts(E,s,y,i){const d=E.length,C=E.reduce((A,M)=>A+M.totalPrice,0);return{id:generateOfferId(),supplierName:s,sourceFile:y,sourceType:i,uploadDate:Date.now(),products:E,currency:"USD",totalProducts:d,totalValue:C}}var _tmpl$=template("<div>"),_tmpl$2=template("<div>Selected: <!> (<!>)"),_tmpl$3=template("<div><label>Upload File (CSV or PDF) *</label><input type=file accept=.csv,.pdf>"),_tmpl$4=template(`<div><label>Paste Product List *</label><textarea placeholder="Paste product data here. Expected formats:

Product Name    $12.99
Product Name    10    $25.00
Product Name    10    kg    $2.50    $25.00

Tip: Copy text from PDF and paste here"></textarea><div>One product per line. Use spaces or tabs to separate columns.`),_tmpl$5=template("<div><h4>AI-Powered Analysis</h4><p>Use AI to analyze complex PDFs or CSVs that don't parse correctly. The file is sent directly to the AI backend for analysis.</p><div><label>Upload File (PDF or CSV)</label><input type=file accept=.csv,.pdf></div><div><label>Analysis Prompt</label><textarea></textarea><div><button type=button>Reset to Default"),_tmpl$6=template("<div><h5>Map JSON Fields (<!> items detected)</h5><p>Match your JSON fields to the product comparison columns.</p><div><div><label>Product Name *</label><select><option value>-- Select Field --</option></select></div><div><label>Unit Price *</label><select><option value>-- Select Field --</option></select></div><div><label>Product Code</label><select><option value>-- Not Mapped --</option></select></div><div><label>Quantity</label><select><option value>-- Not Mapped --</option></select></div><div><label>Unit</label><select><option value>-- Not Mapped --</option></select></div><div><label>Total Price</label><select><option value>-- Not Mapped --</option></select></div><div><label>Category</label><select><option value>-- Not Mapped --"),_tmpl$7=template("<div><h5>Preview (first 3 items):</h5><table><thead><tr><th>Name</th><th>Code</th><th>Price</th><th>Qty</th></tr></thead><tbody>"),_tmpl$8=template(`<div><h4>JSON Product List</h4><p>Paste a JSON array of products and map the fields to the comparison columns.</p><div><label>Paste JSON Array</label><textarea placeholder="Paste JSON array here, e.g.:
[
  {&quot;name&quot;: &quot;Product A&quot;, &quot;sku&quot;: &quot;123&quot;, &quot;price&quot;: 10.99, &quot;qty&quot;: 5},
  {&quot;name&quot;: &quot;Product B&quot;, &quot;sku&quot;: &quot;456&quot;, &quot;price&quot;: 15.99, &quot;qty&quot;: 3}
]">`),_tmpl$9=template("<div>Selected: "),_tmpl$0=template("<div>Extracting text from PDF..."),_tmpl$1=template("<div><h5>Map PDF Columns (<!> rows detected)</h5><div><label><input type=checkbox><span>First row contains headers</span></label></div><div><div><label>Product Name *</label><select><option value>-- Select Column --</option></select></div><div><label>Unit Price *</label><select><option value>-- Select Column --</option></select></div><div><label>UPC/Code</label><select><option value>-- Not Mapped --</option></select></div><div><label>Quantity</label><select><option value>-- Not Mapped --</option></select></div><div><label>Total Price</label><select><option value>-- Not Mapped --"),_tmpl$10=template("<div><h5>Preview (first 5 rows):</h5><table><thead><tr></tr></thead><tbody></tbody></table><div><span>Product Name</span><span>Price</span><span>Code"),_tmpl$11=template("<div><h4>PDF Field Mapping</h4><p>Upload a PDF, extract its table data, and map columns to product fields.</p><div><label>Upload PDF File</label><input type=file accept=.pdf>"),_tmpl$12=template("<div><div><label>Product Name Column</label><select></select></div><div><label>Unit Price Column</label><select></select></div><div><label>Quantity Column (optional)</label><select><option value=-1>-- Not mapped --</option></select></div><div><label>Product Code Column (optional)</label><select><option value=-1>-- Not mapped --"),_tmpl$13=template("<div><div><span>CSV Configuration</span><button> Column Mapping</button></div><div>Detected <!> columns: "),_tmpl$14=template('<div><h3>Add Supplier Offer</h3><div><label>Supplier Name *</label><input type=text placeholder="Enter supplier name"></div><div><label>Input Method</label><div><button type=button>Upload File</button><button type=button>Paste Text</button><button type=button>AI Analysis</button><button type=button>JSON List</button><button type=button>PDF Fields'),_tmpl$15=template("<div>No offers loaded yet. Upload CSV or PDF files to start comparing."),_tmpl$16=template("<div><h3>Loaded Offers (<!>)"),_tmpl$17=template("<div><div></div><div>Total Products"),_tmpl$18=template("<div><div></div><div>Suppliers"),_tmpl$19=template("<div><div></div><div>Products w/ Multiple Offers"),_tmpl$20=template("<div><div></div><div>Potential Savings"),_tmpl$21=template("<div><select><option value>All Categories"),_tmpl$22=template('<div><div><input type=text placeholder="Search products..."></div><div><label>Match Threshold:</label><input type=range min=50 max=100 step=5><span>%</span></div><div>Showing <!> of <!> products'),_tmpl$23=template("<div>No products to compare. Upload at least 2 supplier offers."),_tmpl$24=template("<div><table><thead><tr><th>Product </th><th>Match Score</th><th>Suppliers </th><th>Best Price </th><th>Price Range</th><th>Potential Savings </th><th>Best Supplier</th><th>Actions</th></tr></thead><tbody>"),_tmpl$25=template("<div><strong>UPC/Code:</strong> "),_tmpl$26=template("<div><div><h3></h3><button>×</button></div><div><div><div>Best Price</div><div></div></div><div><div>Average Price</div><div></div></div><div><div>Potential Savings</div><div></div></div><div><div>Match Quality</div></div></div><h4>All Offers</h4><table><thead><tr><th>Supplier</th><th>Product Name</th><th>Match</th><th>Price</th><th>Qty</th><th>Difference</th></tr></thead><tbody>"),_tmpl$27=template("<div><div><h1>Product Offers Comparison</h1><div></div></div><div><button>Upload Offers (<!>)</button><button>Compare Products"),_tmpl$28=template("<option>"),_tmpl$29=template("<tr><td></td><td></td><td></td><td>"),_tmpl$30=template("<option>: "),_tmpl$31=template("<th>"),_tmpl$32=template("<tr>"),_tmpl$33=template("<td>"),_tmpl$34=template("<div><div><div><div></div><div> products | <!> total</div><div>Source: <!> (<!>)</div></div><button>Remove</button></div><div><table><thead><tr><th>Product</th><th>Code</th><th>Qty</th><th>Price</th><th>Total</th></tr></thead><tbody>"),_tmpl$35=template("<tr><td></td><td></td><td> </td><td></td><td>"),_tmpl$36=template("<div>UPC: "),_tmpl$37=template("<div><span></span><span>%"),_tmpl$38=template("<span>--"),_tmpl$39=template("<tr><td><div></div></td><td><div><span></span><span></span></div></td><td><span></span></td><td></td><td> - </td><td></td><td><span></span></td><td><button>Details"),_tmpl$40=template("<div><span>%"),_tmpl$41=template("<span>UPC Match"),_tmpl$42=template("<span>UPC Diff"),_tmpl$43=template("<span>+<!> (<!>%)"),_tmpl$44=template("<span>Best Price"),_tmpl$45=template("<tr><td><span></span></td><td></td><td><div><span></span></div></td><td></td><td> </td><td>");const ProductOffersComparison=()=>{const[E,s]=createSignal("upload"),[y,i]=createSignal(!1),[d,C]=createSignal(null),[A,M]=createSignal(null),[w,n]=createSignal("file"),[t,r]=createSignal(null),[l,c]=createSignal(""),[e,h]=createSignal("csv"),[f,a]=createSignal(""),[v,R]=createSignal(defaultCSVConfig),[k,g]=createSignal(!1),[P,U]=createSignal([]),[z,N]=createSignal(null),[j,W]=createSignal(getDefaultB2BPrompt()),[at,tt]=createSignal("pdf"),[it,ut]=createSignal(!1),[J,L]=createSignal(""),[b,p]=createSignal([]),[u,_]=createSignal([]),[F,I]=createSignal({productName:"",productCode:"",quantity:"",unit:"",unitPrice:"",totalPrice:"",category:""}),[O,x]=createSignal([]),[o,m]=createSignal(null),[S,T]=createSignal([]),[D,$]=createSignal([]),[B,G]=createSignal({productName:"",productCode:"",quantity:"",unit:"",unitPrice:"",totalPrice:"",category:""}),[lt,V]=createSignal([]),[X,K]=createSignal(!0),[Y,et]=createSignal(!1),[gt,wt]=createSignal("savings"),[Tt,$t]=createSignal("desc"),[zt,Jt]=createSignal(""),[Se,Pe]=createSignal(""),[Ae,me]=createSignal(null),ye=()=>offersStore.offers(),Re=()=>offersStore.compareProducts(),Fe=()=>offersStore.getComparisonResult(),Oe=createMemo(()=>{const vt=new Set;return ye().forEach(he=>{he.products.forEach(ve=>{ve.category&&vt.add(ve.category)})}),Array.from(vt).sort()}),rt=createMemo(()=>{let vt=Re();if(Se()){const ue=Se().toLowerCase();vt=vt.filter(se=>se.productName.toLowerCase().includes(ue)||se.normalizedName.includes(ue)||se.productCode&&se.productCode.toLowerCase().includes(ue))}zt()&&(vt=vt.filter(ue=>ue.category===zt()));const he=gt(),ve=Tt();return vt=[...vt].sort((ue,se)=>{let de=0;switch(he){case"name":de=ue.productName.localeCompare(se.productName);break;case"bestPrice":de=(ue.bestOffer?.price||0)-(se.bestOffer?.price||0);break;case"savings":const pe=ue.priceRange.max-ue.priceRange.min,Ee=se.priceRange.max-se.priceRange.min;de=pe-Ee;break;case"suppliers":de=ue.offers.length-se.offers.length;break}return ve==="asc"?de:-de}),vt}),q=async vt=>{const ve=vt.target.files?.[0];if(!ve)return;if(r(ve),C(null),ve.name.split(".").pop()?.toLowerCase()==="pdf")h("pdf");else{h("csv");try{const se=await ve.text(),de=detectDelimiter(se),pe=se.split(`
`);if(pe.length>0){const Ee=pe[0].split(de).map(mt=>mt.trim().replace(/"/g,""));U(Ee);const ke=suggestColumnMapping(Ee);R(mt=>({...mt,delimiter:de,columnMapping:{...mt.columnMapping,...ke}}))}}catch(se){console.error("Error detecting CSV config:",se)}}if(!l()){const se=ve.name.replace(/\.(csv|pdf)$/i,"");c(se.replace(/[_-]/g," ").trim())}},H=async()=>{if(!l()){C("Please enter a supplier name");return}if(w()==="file"){if(!t()){C("Please select a file");return}}else if(!f().trim()){C("Please paste the product text");return}i(!0),C(null);try{let vt;if(w()==="text"?vt=parseTextContent(f(),{},l()):e()==="csv"?vt=await parseCSVFile(t(),v(),l()):vt=await parsePDFFile(t(),{},l()),vt.products.length===0)throw new Error(`No products found. Please check the format.

Expected format (one product per line):
• Product Name    $12.99
• Product Name    10    $25.00
• Product Name    10    kg    $2.50    $25.00`);offersStore.addSupplierOffer(vt),M(`Added ${vt.products.length} products from ${l()}`),setTimeout(()=>M(null),3e3),r(null),c(""),a(""),U([]),ye().length>=2&&s("compare")}catch(vt){console.error("Error parsing:",vt),C(vt instanceof Error?vt.message:"Error parsing input")}finally{i(!1)}},At=vt=>{offersStore.removeSupplierOffer(vt)},Vt=vt=>{gt()===vt?$t(he=>he==="asc"?"desc":"asc"):(wt(vt),$t("desc"))},Kt=(vt,he="USD")=>new Intl.NumberFormat("en-US",{style:"currency",currency:he}).format(vt),be=vt=>vt.priceRange.min===0?0:(vt.priceRange.max-vt.priceRange.min)/vt.priceRange.max*100,xe={padding:"1.5rem","margin-bottom":"1rem"},Te={width:"100%","border-collapse":"collapse","font-size":"0.9rem"},oe={padding:"0.75rem","text-align":"left","border-bottom":"2px solid var(--border-color)","font-weight":"600",background:"var(--gray-50)",cursor:"pointer"},Qt={padding:"0.75rem","border-bottom":"1px solid var(--border-color)"},Yt={width:"100%",padding:"0.75rem",border:"1px solid var(--border-color)","border-radius":"var(--border-radius-sm)","font-size":"1rem",background:"var(--surface-color)"},Xt={display:"block","margin-bottom":"0.5rem","font-weight":"500"},Me=vt=>({padding:"0.75rem 1.5rem",background:vt?"var(--primary-color)":"transparent",color:vt?"white":"var(--text-primary)",border:"1px solid var(--border-color)","border-bottom":vt?"none":"1px solid var(--border-color)","border-radius":"var(--border-radius-sm) var(--border-radius-sm) 0 0",cursor:"pointer","font-weight":vt?"600":"400"});return(()=>{var vt=_tmpl$27(),he=vt.firstChild,ve=he.firstChild,ue=ve.nextSibling,se=he.nextSibling,de=se.firstChild,pe=de.firstChild,Ee=pe.nextSibling;Ee.nextSibling;var ke=de.nextSibling;return vt.style.setProperty("padding","1rem"),vt.style.setProperty("max-width","1400px"),vt.style.setProperty("margin","0 auto"),he.style.setProperty("display","flex"),he.style.setProperty("justify-content","space-between"),he.style.setProperty("align-items","center"),he.style.setProperty("margin-bottom","1.5rem"),ve.style.setProperty("font-size","1.5rem"),ve.style.setProperty("font-weight","600"),ue.style.setProperty("display","flex"),ue.style.setProperty("gap","0.5rem"),insert(ue,createComponent(Show,{get when(){return ye().length>0},get children(){return createComponent(Button,{variant:"outline",onClick:()=>offersStore.clearAllOffers(),children:"Clear All"})}})),se.style.setProperty("display","flex"),se.style.setProperty("gap","0.25rem"),se.style.setProperty("margin-bottom","1rem"),de.$$click=()=>s("upload"),insert(de,()=>ye().length,Ee),ke.$$click=()=>s("compare"),insert(vt,createComponent(Show,{get when(){return d()},get children(){var mt=_tmpl$();return mt.style.setProperty("padding","1rem"),mt.style.setProperty("background","var(--danger-light)"),mt.style.setProperty("color","var(--danger-color)"),mt.style.setProperty("border-radius","var(--border-radius-sm)"),mt.style.setProperty("margin-bottom","1rem"),insert(mt,d),mt}}),null),insert(vt,createComponent(Show,{get when(){return A()},get children(){var mt=_tmpl$();return mt.style.setProperty("padding","1rem"),mt.style.setProperty("background","var(--success-light)"),mt.style.setProperty("color","var(--success-color)"),mt.style.setProperty("border-radius","var(--border-radius-sm)"),mt.style.setProperty("margin-bottom","1rem"),insert(mt,A),mt}}),null),insert(vt,createComponent(Show,{get when(){return E()==="upload"},get children(){var mt=_tmpl$();return mt.style.setProperty("display","grid"),mt.style.setProperty("grid-template-columns","1fr 1fr"),mt.style.setProperty("gap","1.5rem"),insert(mt,createComponent(Card,{get children(){var Dt=_tmpl$14(),Nt=Dt.firstChild,Zt=Nt.nextSibling,le=Zt.firstChild,Wt=le.nextSibling,ie=Zt.nextSibling,ce=ie.firstChild,fe=ce.nextSibling,re=fe.firstChild,te=re.nextSibling,ne=te.nextSibling,ae=ne.nextSibling,ct=ae.nextSibling;return Nt.style.setProperty("margin-bottom","1.5rem"),Nt.style.setProperty("font-weight","600"),Zt.style.setProperty("margin-bottom","1rem"),Wt.$$input=ot=>c(ot.currentTarget.value),ie.style.setProperty("margin-bottom","1rem"),fe.style.setProperty("display","flex"),fe.style.setProperty("gap","0.5rem"),re.$$click=()=>n("file"),re.style.setProperty("flex","1"),re.style.setProperty("padding","0.5rem 1rem"),re.style.setProperty("border","1px solid var(--border-color)"),re.style.setProperty("border-radius","var(--border-radius-sm)"),re.style.setProperty("cursor","pointer"),re.style.setProperty("font-size","0.875rem"),te.$$click=()=>n("text"),te.style.setProperty("flex","1"),te.style.setProperty("padding","0.5rem 1rem"),te.style.setProperty("border","1px solid var(--border-color)"),te.style.setProperty("border-radius","var(--border-radius-sm)"),te.style.setProperty("cursor","pointer"),te.style.setProperty("font-size","0.875rem"),ne.$$click=()=>n("ai"),ne.style.setProperty("flex","1"),ne.style.setProperty("padding","0.5rem 1rem"),ne.style.setProperty("border","1px solid var(--border-color)"),ne.style.setProperty("border-radius","var(--border-radius-sm)"),ne.style.setProperty("cursor","pointer"),ne.style.setProperty("font-size","0.875rem"),ae.$$click=()=>n("json"),ae.style.setProperty("flex","1"),ae.style.setProperty("padding","0.5rem 1rem"),ae.style.setProperty("border","1px solid var(--border-color)"),ae.style.setProperty("border-radius","var(--border-radius-sm)"),ae.style.setProperty("cursor","pointer"),ae.style.setProperty("font-size","0.875rem"),ct.$$click=()=>n("pdf-map"),ct.style.setProperty("flex","1"),ct.style.setProperty("padding","0.5rem 1rem"),ct.style.setProperty("border","1px solid var(--border-color)"),ct.style.setProperty("border-radius","var(--border-radius-sm)"),ct.style.setProperty("cursor","pointer"),ct.style.setProperty("font-size","0.875rem"),insert(Dt,createComponent(Show,{get when(){return w()==="file"},get children(){var ot=_tmpl$3(),Lt=ot.firstChild,qt=Lt.nextSibling;return ot.style.setProperty("margin-bottom","1rem"),qt.addEventListener("change",q),insert(ot,createComponent(Show,{get when(){return t()},get children(){var Ft=_tmpl$2(),Ht=Ft.firstChild,Bt=Ht.nextSibling,Z=Bt.nextSibling,yt=Z.nextSibling;return yt.nextSibling,Ft.style.setProperty("margin-top","0.5rem"),Ft.style.setProperty("font-size","0.875rem"),Ft.style.setProperty("color","var(--text-muted)"),insert(Ft,()=>t()?.name,Bt),insert(Ft,()=>e().toUpperCase(),yt),Ft}}),null),createRenderEffect(Ft=>{var Ht=Xt,Bt=Yt;return Ft.e=style(Lt,Ht,Ft.e),Ft.t=style(qt,Bt,Ft.t),Ft},{e:void 0,t:void 0}),ot}}),null),insert(Dt,createComponent(Show,{get when(){return w()==="text"},get children(){var ot=_tmpl$4(),Lt=ot.firstChild,qt=Lt.nextSibling,Ft=qt.nextSibling;return ot.style.setProperty("margin-bottom","1rem"),qt.$$input=Ht=>a(Ht.currentTarget.value),Ft.style.setProperty("margin-top","0.5rem"),Ft.style.setProperty("font-size","0.75rem"),Ft.style.setProperty("color","var(--text-muted)"),createRenderEffect(Ht=>{var Bt=Xt,Z={...Yt,"min-height":"150px","font-family":"monospace","font-size":"0.8rem",resize:"vertical"};return Ht.e=style(Lt,Bt,Ht.e),Ht.t=style(qt,Z,Ht.t),Ht},{e:void 0,t:void 0}),createRenderEffect(()=>qt.value=f()),ot}}),null),insert(Dt,createComponent(Show,{get when(){return w()==="ai"},get children(){var ot=_tmpl$5(),Lt=ot.firstChild,qt=Lt.nextSibling,Ft=qt.nextSibling,Ht=Ft.firstChild,Bt=Ht.nextSibling,Z=Ft.nextSibling,yt=Z.firstChild,nt=yt.nextSibling,Ut=nt.nextSibling,kt=Ut.firstChild;return ot.style.setProperty("padding","1rem"),ot.style.setProperty("background","var(--warning-light)"),ot.style.setProperty("border-radius","var(--border-radius-sm)"),ot.style.setProperty("margin-bottom","1rem"),Lt.style.setProperty("margin-bottom","0.75rem"),Lt.style.setProperty("color","var(--warning-color)"),qt.style.setProperty("font-size","0.875rem"),qt.style.setProperty("margin-bottom","1rem"),Ft.style.setProperty("margin-bottom","1rem"),Bt.addEventListener("change",st=>{const ft=st.currentTarget.files?.[0];if(!ft)return;const ht=ft.name.split(".").pop()?.toLowerCase();if(tt(ht==="pdf"?"pdf":"csv"),N(ft),!l()){const Q=ft.name.replace(/\.(csv|pdf)$/i,"");c(Q.replace(/[_-]/g," ").trim())}}),insert(Ft,createComponent(Show,{get when(){return z()},get children(){var st=_tmpl$2(),ft=st.firstChild,ht=ft.nextSibling,Q=ht.nextSibling,bt=Q.nextSibling;return bt.nextSibling,st.style.setProperty("margin-top","0.5rem"),st.style.setProperty("font-size","0.875rem"),st.style.setProperty("color","var(--text-muted)"),insert(st,()=>z()?.name,ht),insert(st,()=>at().toUpperCase(),bt),st}}),null),Z.style.setProperty("margin-bottom","1rem"),nt.$$input=st=>W(st.currentTarget.value),Ut.style.setProperty("display","flex"),Ut.style.setProperty("gap","0.5rem"),Ut.style.setProperty("margin-top","0.5rem"),kt.$$click=()=>W(getDefaultB2BPrompt()),kt.style.setProperty("padding","0.25rem 0.5rem"),kt.style.setProperty("border","1px solid var(--border-color)"),kt.style.setProperty("border-radius","var(--border-radius-sm)"),kt.style.setProperty("background","white"),kt.style.setProperty("cursor","pointer"),kt.style.setProperty("font-size","0.75rem"),insert(ot,createComponent(Button,{variant:"primary",get disabled(){return!z()||!l()||it()},onClick:async()=>{const st=z();if(st){ut(!0),C(null);try{console.log(`🤖 Starting AI analysis for ${st.name}...`);const ft=await fileToBase64(st);console.log(`📦 File converted to base64 (${ft.length} chars)`);let ht;if(at()==="pdf"?(console.log("📄 Calling analyzePdfWithAI..."),ht=await analyzePdfWithAI(ft,j(),l())):(console.log("📊 Calling analyzeCsvWithAI..."),ht=await analyzeCsvWithAI(ft,j(),l(),!0)),console.log("🤖 AI Result:",ht),ht.success&&ht.products.length>0){const Q=createOfferFromAIProducts(ht.products,l()||"AI Analyzed",st.name,at());offersStore.addSupplierOffer(Q),M(`Added ${ht.products.length} products from AI analysis`),setTimeout(()=>M(null),3e3),N(null),c(""),offersStore.offers().length>=2&&s("compare")}else C(ht.error||"AI analysis returned no products")}catch(ft){console.error("❌ AI Analysis error:",ft),C(ft instanceof Error?ft.message:"Failed to analyze with AI")}finally{ut(!1)}}},style:{width:"100%"},get children(){return it()?"Analyzing with AI...":"Analyze with AI"}}),null),createRenderEffect(st=>{var ft=Xt,ht=Yt,Q=Xt,bt={...Yt,"min-height":"100px","font-family":"monospace","font-size":"0.75rem",resize:"vertical"};return st.e=style(Ht,ft,st.e),st.t=style(Bt,ht,st.t),st.a=style(yt,Q,st.a),st.o=style(nt,bt,st.o),st},{e:void 0,t:void 0,a:void 0,o:void 0}),createRenderEffect(()=>nt.value=j()),ot}}),null),insert(Dt,createComponent(Show,{get when(){return w()==="json"},get children(){var ot=_tmpl$8(),Lt=ot.firstChild,qt=Lt.nextSibling,Ft=qt.nextSibling,Ht=Ft.firstChild,Bt=Ht.nextSibling;return ot.style.setProperty("padding","1rem"),ot.style.setProperty("background","var(--info-light)"),ot.style.setProperty("border-radius","var(--border-radius-sm)"),ot.style.setProperty("margin-bottom","1rem"),Lt.style.setProperty("margin-bottom","0.75rem"),Lt.style.setProperty("color","var(--info-color)"),qt.style.setProperty("font-size","0.875rem"),qt.style.setProperty("margin-bottom","1rem"),Ft.style.setProperty("margin-bottom","1rem"),Bt.$$input=Z=>{const yt=Z.currentTarget.value;L(yt),C(null);try{if(!yt.trim()){p([]),_([]),x([]);return}let nt=JSON.parse(yt);if(!Array.isArray(nt))if(nt.products&&Array.isArray(nt.products))nt=nt.products;else if(nt.data&&Array.isArray(nt.data))nt=nt.data;else if(nt.items&&Array.isArray(nt.items))nt=nt.items;else throw new Error("JSON must be an array or contain a products/data/items array");p(nt),x(nt.slice(0,3));const Ut=new Set;nt.slice(0,10).forEach(ft=>{ft&&typeof ft=="object"&&Object.keys(ft).forEach(ht=>Ut.add(ht))});const kt=Array.from(Ut).sort();_(kt);const st={productName:"",productCode:"",quantity:"",unit:"",unitPrice:"",totalPrice:"",category:""};kt.forEach(ft=>{const ht=ft.toLowerCase();!st.productName&&(ht.includes("name")||ht.includes("description")||ht.includes("product"))&&(st.productName=ft),!st.productCode&&(ht.includes("code")||ht.includes("sku")||ht.includes("upc")||ht.includes("barcode")||ht==="id")&&(st.productCode=ft),!st.quantity&&(ht.includes("qty")||ht.includes("quantity")||ht.includes("amount"))&&(st.quantity=ft),!st.unit&&(ht.includes("unit")||ht==="uom")&&(st.unit=ft),!st.unitPrice&&(ht.includes("price")||ht.includes("cost"))&&!ht.includes("total")&&(st.unitPrice=ft),!st.totalPrice&&(ht.includes("total")||ht.includes("subtotal"))&&(st.totalPrice=ft),!st.category&&(ht.includes("category")||ht.includes("type")||ht.includes("group"))&&(st.category=ft)}),I(st)}catch(nt){yt.trim()&&C(nt instanceof Error?nt.message:"Invalid JSON"),p([]),_([])}},insert(ot,createComponent(Show,{get when(){return u().length>0},get children(){return[(()=>{var Z=_tmpl$6(),yt=Z.firstChild,nt=yt.firstChild,Ut=nt.nextSibling;Ut.nextSibling;var kt=yt.nextSibling,st=kt.nextSibling,ft=st.firstChild,ht=ft.firstChild,Q=ht.nextSibling;Q.firstChild;var bt=ft.nextSibling,xt=bt.firstChild,St=xt.nextSibling;St.firstChild;var Ct=bt.nextSibling,dt=Ct.firstChild,Et=dt.nextSibling;Et.firstChild;var _t=Ct.nextSibling,Pt=_t.firstChild,Rt=Pt.nextSibling;Rt.firstChild;var ee=_t.nextSibling,we=ee.firstChild,_e=we.nextSibling;_e.firstChild;var Mt=ee.nextSibling,Ce=Mt.firstChild,ge=Ce.nextSibling;ge.firstChild;var It=Mt.nextSibling,Gt=It.firstChild,jt=Gt.nextSibling;return jt.firstChild,Z.style.setProperty("padding","1rem"),Z.style.setProperty("background","white"),Z.style.setProperty("border-radius","var(--border-radius-sm)"),Z.style.setProperty("margin-bottom","1rem"),yt.style.setProperty("margin-bottom","0.75rem"),yt.style.setProperty("font-weight","600"),insert(yt,()=>b().length,Ut),kt.style.setProperty("font-size","0.75rem"),kt.style.setProperty("color","var(--text-muted)"),kt.style.setProperty("margin-bottom","1rem"),st.style.setProperty("display","grid"),st.style.setProperty("grid-template-columns","repeat(auto-fit, minmax(180px, 1fr))"),st.style.setProperty("gap","0.75rem"),Q.addEventListener("change",pt=>I(Ot=>({...Ot,productName:pt.currentTarget.value}))),insert(Q,createComponent(For,{get each(){return u()},children:pt=>(()=>{var Ot=_tmpl$28();return Ot.value=pt,insert(Ot,pt),Ot})()}),null),St.addEventListener("change",pt=>I(Ot=>({...Ot,unitPrice:pt.currentTarget.value}))),insert(St,createComponent(For,{get each(){return u()},children:pt=>(()=>{var Ot=_tmpl$28();return Ot.value=pt,insert(Ot,pt),Ot})()}),null),Et.addEventListener("change",pt=>I(Ot=>({...Ot,productCode:pt.currentTarget.value}))),insert(Et,createComponent(For,{get each(){return u()},children:pt=>(()=>{var Ot=_tmpl$28();return Ot.value=pt,insert(Ot,pt),Ot})()}),null),Rt.addEventListener("change",pt=>I(Ot=>({...Ot,quantity:pt.currentTarget.value}))),insert(Rt,createComponent(For,{get each(){return u()},children:pt=>(()=>{var Ot=_tmpl$28();return Ot.value=pt,insert(Ot,pt),Ot})()}),null),_e.addEventListener("change",pt=>I(Ot=>({...Ot,unit:pt.currentTarget.value}))),insert(_e,createComponent(For,{get each(){return u()},children:pt=>(()=>{var Ot=_tmpl$28();return Ot.value=pt,insert(Ot,pt),Ot})()}),null),ge.addEventListener("change",pt=>I(Ot=>({...Ot,totalPrice:pt.currentTarget.value}))),insert(ge,createComponent(For,{get each(){return u()},children:pt=>(()=>{var Ot=_tmpl$28();return Ot.value=pt,insert(Ot,pt),Ot})()}),null),jt.addEventListener("change",pt=>I(Ot=>({...Ot,category:pt.currentTarget.value}))),insert(jt,createComponent(For,{get each(){return u()},children:pt=>(()=>{var Ot=_tmpl$28();return Ot.value=pt,insert(Ot,pt),Ot})()}),null),createRenderEffect(pt=>{var Ot={...Xt,"font-size":"0.8rem",color:"var(--danger-color)"},De={...Yt,"font-size":"0.85rem"},Ie={...Xt,"font-size":"0.8rem",color:"var(--danger-color)"},Le={...Yt,"font-size":"0.85rem"},Ne={...Xt,"font-size":"0.8rem"},$e={...Yt,"font-size":"0.85rem"},Ue={...Xt,"font-size":"0.8rem"},Be={...Yt,"font-size":"0.85rem"},ze={...Xt,"font-size":"0.8rem"},je={...Yt,"font-size":"0.85rem"},He={...Xt,"font-size":"0.8rem"},We={...Yt,"font-size":"0.85rem"},qe={...Xt,"font-size":"0.8rem"},Ge={...Yt,"font-size":"0.85rem"};return pt.e=style(ht,Ot,pt.e),pt.t=style(Q,De,pt.t),pt.a=style(xt,Ie,pt.a),pt.o=style(St,Le,pt.o),pt.i=style(dt,Ne,pt.i),pt.n=style(Et,$e,pt.n),pt.s=style(Pt,Ue,pt.s),pt.h=style(Rt,Be,pt.h),pt.r=style(we,ze,pt.r),pt.d=style(_e,je,pt.d),pt.l=style(Ce,He,pt.l),pt.u=style(ge,We,pt.u),pt.c=style(Gt,qe,pt.c),pt.w=style(jt,Ge,pt.w),pt},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0,r:void 0,d:void 0,l:void 0,u:void 0,c:void 0,w:void 0}),createRenderEffect(()=>Q.value=F().productName),createRenderEffect(()=>St.value=F().unitPrice),createRenderEffect(()=>Et.value=F().productCode),createRenderEffect(()=>Rt.value=F().quantity),createRenderEffect(()=>_e.value=F().unit),createRenderEffect(()=>ge.value=F().totalPrice),createRenderEffect(()=>jt.value=F().category),Z})(),createComponent(Show,{get when(){return memo(()=>O().length>0)()&&F().productName},get children(){var Z=_tmpl$7(),yt=Z.firstChild,nt=yt.nextSibling,Ut=nt.firstChild,kt=Ut.firstChild,st=kt.firstChild,ft=st.nextSibling,ht=ft.nextSibling,Q=ht.nextSibling,bt=Ut.nextSibling;return Z.style.setProperty("padding","0.75rem"),Z.style.setProperty("background","white"),Z.style.setProperty("border-radius","var(--border-radius-sm)"),Z.style.setProperty("margin-bottom","1rem"),Z.style.setProperty("max-height","150px"),Z.style.setProperty("overflow","auto"),yt.style.setProperty("margin-bottom","0.5rem"),yt.style.setProperty("font-size","0.8rem"),yt.style.setProperty("color","var(--text-muted)"),nt.style.setProperty("width","100%"),nt.style.setProperty("font-size","0.75rem"),nt.style.setProperty("border-collapse","collapse"),kt.style.setProperty("background","var(--gray-50)"),st.style.setProperty("padding","0.25rem 0.5rem"),st.style.setProperty("text-align","left"),st.style.setProperty("border-bottom","1px solid var(--border-color)"),ft.style.setProperty("padding","0.25rem 0.5rem"),ft.style.setProperty("text-align","left"),ft.style.setProperty("border-bottom","1px solid var(--border-color)"),ht.style.setProperty("padding","0.25rem 0.5rem"),ht.style.setProperty("text-align","right"),ht.style.setProperty("border-bottom","1px solid var(--border-color)"),Q.style.setProperty("padding","0.25rem 0.5rem"),Q.style.setProperty("text-align","right"),Q.style.setProperty("border-bottom","1px solid var(--border-color)"),insert(bt,createComponent(For,{get each(){return O()},children:xt=>(()=>{var St=_tmpl$29(),Ct=St.firstChild,dt=Ct.nextSibling,Et=dt.nextSibling,_t=Et.nextSibling;return Ct.style.setProperty("padding","0.25rem 0.5rem"),Ct.style.setProperty("border-bottom","1px solid var(--border-color)"),insert(Ct,(()=>{var Pt=memo(()=>!!F().productName);return()=>Pt()?String(xt[F().productName]||""):"--"})()),dt.style.setProperty("padding","0.25rem 0.5rem"),dt.style.setProperty("border-bottom","1px solid var(--border-color)"),insert(dt,(()=>{var Pt=memo(()=>!!F().productCode);return()=>Pt()?String(xt[F().productCode]||""):"--"})()),Et.style.setProperty("padding","0.25rem 0.5rem"),Et.style.setProperty("text-align","right"),Et.style.setProperty("border-bottom","1px solid var(--border-color)"),insert(Et,(()=>{var Pt=memo(()=>!!F().unitPrice);return()=>Pt()?`$${parseFloat(xt[F().unitPrice]||0).toFixed(2)}`:"--"})()),_t.style.setProperty("padding","0.25rem 0.5rem"),_t.style.setProperty("text-align","right"),_t.style.setProperty("border-bottom","1px solid var(--border-color)"),insert(_t,(()=>{var Pt=memo(()=>!!F().quantity);return()=>Pt()?String(xt[F().quantity]||1):"1"})()),St})()})),Z}}),createComponent(Button,{variant:"primary",get disabled(){return!l()||!F().productName||!F().unitPrice||b().length===0},onClick:()=>{const Z=F(),yt=b();if(!Z.productName||!Z.unitPrice){C("Product Name and Unit Price fields are required");return}try{const nt=yt.filter(st=>st&&st[Z.productName]).map(st=>{const ft=String(st[Z.productName]||"").trim(),ht=parseFloat(st[Z.unitPrice])||0,Q=Z.quantity&&parseFloat(st[Z.quantity])||1,bt=Z.totalPrice&&parseFloat(st[Z.totalPrice])||ht*Q;return{id:`json-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,productCode:Z.productCode?String(st[Z.productCode]||""):void 0,productName:ft,quantity:Q,unit:Z.unit?String(st[Z.unit]||"unit"):"unit",unitPrice:ht,totalPrice:bt,currency:"USD",category:Z.category?String(st[Z.category]||""):void 0,normalizedName:normalizeProductName(ft)}});if(nt.length===0){C("No valid products found in JSON");return}const Ut=nt.reduce((st,ft)=>st+ft.totalPrice,0),kt={id:`offer-${Date.now()}`,supplierName:l(),sourceFile:"json-import",sourceType:"csv",uploadDate:Date.now(),products:nt,currency:"USD",totalProducts:nt.length,totalValue:Ut};offersStore.addSupplierOffer(kt),M(`Added ${nt.length} products from JSON`),setTimeout(()=>M(null),3e3),L(""),p([]),_([]),x([]),c(""),offersStore.offers().length>=2&&s("compare")}catch(nt){C(nt instanceof Error?nt.message:"Failed to parse JSON")}},style:{width:"100%"},get children(){return["Add ",memo(()=>b().length)," Products from JSON"]}})]}}),null),createRenderEffect(Z=>{var yt=Xt,nt={...Yt,"min-height":"120px","font-family":"monospace","font-size":"0.75rem",resize:"vertical"};return Z.e=style(Ht,yt,Z.e),Z.t=style(Bt,nt,Z.t),Z},{e:void 0,t:void 0}),createRenderEffect(()=>Bt.value=J()),ot}}),null),insert(Dt,createComponent(Show,{get when(){return w()==="pdf-map"},get children(){var ot=_tmpl$11(),Lt=ot.firstChild,qt=Lt.nextSibling,Ft=qt.nextSibling,Ht=Ft.firstChild,Bt=Ht.nextSibling;return ot.style.setProperty("padding","1rem"),ot.style.setProperty("background","var(--success-light)"),ot.style.setProperty("border-radius","var(--border-radius-sm)"),ot.style.setProperty("margin-bottom","1rem"),Lt.style.setProperty("margin-bottom","0.75rem"),Lt.style.setProperty("color","var(--success-color)"),qt.style.setProperty("font-size","0.875rem"),qt.style.setProperty("margin-bottom","1rem"),Ft.style.setProperty("margin-bottom","1rem"),Bt.addEventListener("change",async Z=>{const yt=Z.currentTarget.files?.[0];if(yt){m(yt),et(!0),C(null);try{const nt=await extractTextFromPDF(yt);console.log("📄 Extracted PDF text:",nt.substring(0,500));const Ut=nt.split(`
`).filter(bt=>bt.trim()),kt=[];for(const bt of Ut){const xt=bt.split(/\t|  +/).map(St=>St.trim()).filter(St=>St);xt.length>=2&&kt.push(xt)}if(kt.length===0)throw new Error("No table data found in PDF. Try AI Analysis mode instead.");const st=Math.max(...kt.map(bt=>bt.length)),ft=kt.map(bt=>{for(;bt.length<st;)bt.push("");return bt.slice(0,st)});T(ft),V(ft.slice(0,5));const ht=ft[0].map((bt,xt)=>bt&&bt.length<30?bt:`Column ${xt+1}`);$(ht);const Q={productName:"",productCode:"",quantity:"",unit:"",unitPrice:"",totalPrice:"",category:""};if(ht.forEach((bt,xt)=>{const St=bt.toLowerCase(),Ct=`${xt}`;!Q.productName&&(St.includes("name")||St.includes("description")||St.includes("product"))&&(Q.productName=Ct),!Q.productCode&&(St.includes("upc")||St.includes("code")||St.includes("sku")||St.includes("barcode"))&&(Q.productCode=Ct),!Q.quantity&&(St.includes("qty")||St.includes("quantity")||St.includes("case"))&&(Q.quantity=Ct),!Q.unitPrice&&(St.includes("price")||St.includes("cost"))&&!St.includes("total")&&(Q.unitPrice=Ct),!Q.totalPrice&&(St.includes("total")||St.includes("amount"))&&(Q.totalPrice=Ct)}),G(Q),!l()){const bt=yt.name.replace(/\.pdf$/i,"");c(bt.replace(/[_-]/g," ").trim())}M(`Extracted ${ft.length} rows with ${st} columns from PDF`),setTimeout(()=>M(null),3e3)}catch(nt){console.error("PDF parsing error:",nt),C(nt instanceof Error?nt.message:"Failed to parse PDF")}finally{et(!1)}}}),insert(Ft,createComponent(Show,{get when(){return o()},get children(){var Z=_tmpl$9();return Z.firstChild,Z.style.setProperty("margin-top","0.5rem"),Z.style.setProperty("font-size","0.875rem"),Z.style.setProperty("color","var(--text-muted)"),insert(Z,()=>o()?.name,null),Z}}),null),insert(Ft,createComponent(Show,{get when(){return Y()},get children(){var Z=_tmpl$0();return Z.style.setProperty("margin-top","0.5rem"),Z.style.setProperty("font-size","0.875rem"),Z.style.setProperty("color","var(--warning-color)"),Z}}),null),insert(ot,createComponent(Show,{get when(){return D().length>0},get children(){return[(()=>{var Z=_tmpl$1(),yt=Z.firstChild,nt=yt.firstChild,Ut=nt.nextSibling;Ut.nextSibling;var kt=yt.nextSibling,st=kt.firstChild,ft=st.firstChild,ht=ft.nextSibling,Q=kt.nextSibling,bt=Q.firstChild,xt=bt.firstChild,St=xt.nextSibling;St.firstChild;var Ct=bt.nextSibling,dt=Ct.firstChild,Et=dt.nextSibling;Et.firstChild;var _t=Ct.nextSibling,Pt=_t.firstChild,Rt=Pt.nextSibling;Rt.firstChild;var ee=_t.nextSibling,we=ee.firstChild,_e=we.nextSibling;_e.firstChild;var Mt=ee.nextSibling,Ce=Mt.firstChild,ge=Ce.nextSibling;return ge.firstChild,Z.style.setProperty("padding","1rem"),Z.style.setProperty("background","white"),Z.style.setProperty("border-radius","var(--border-radius-sm)"),Z.style.setProperty("margin-bottom","1rem"),yt.style.setProperty("margin-bottom","0.75rem"),yt.style.setProperty("font-weight","600"),insert(yt,()=>S().length,Ut),kt.style.setProperty("margin-bottom","1rem"),st.style.setProperty("display","flex"),st.style.setProperty("align-items","center"),st.style.setProperty("gap","0.5rem"),st.style.setProperty("cursor","pointer"),ft.addEventListener("change",It=>K(It.currentTarget.checked)),ht.style.setProperty("font-size","0.875rem"),Q.style.setProperty("display","grid"),Q.style.setProperty("grid-template-columns","repeat(auto-fit, minmax(180px, 1fr))"),Q.style.setProperty("gap","0.75rem"),St.addEventListener("change",It=>G(Gt=>({...Gt,productName:It.currentTarget.value}))),insert(St,createComponent(For,{get each(){return D()},children:(It,Gt)=>(()=>{var jt=_tmpl$30(),pt=jt.firstChild;return insert(jt,Gt,pt),insert(jt,It,null),createRenderEffect(()=>jt.value=Gt()),jt})()}),null),Et.addEventListener("change",It=>G(Gt=>({...Gt,unitPrice:It.currentTarget.value}))),insert(Et,createComponent(For,{get each(){return D()},children:(It,Gt)=>(()=>{var jt=_tmpl$30(),pt=jt.firstChild;return insert(jt,Gt,pt),insert(jt,It,null),createRenderEffect(()=>jt.value=Gt()),jt})()}),null),Rt.addEventListener("change",It=>G(Gt=>({...Gt,productCode:It.currentTarget.value}))),insert(Rt,createComponent(For,{get each(){return D()},children:(It,Gt)=>(()=>{var jt=_tmpl$30(),pt=jt.firstChild;return insert(jt,Gt,pt),insert(jt,It,null),createRenderEffect(()=>jt.value=Gt()),jt})()}),null),_e.addEventListener("change",It=>G(Gt=>({...Gt,quantity:It.currentTarget.value}))),insert(_e,createComponent(For,{get each(){return D()},children:(It,Gt)=>(()=>{var jt=_tmpl$30(),pt=jt.firstChild;return insert(jt,Gt,pt),insert(jt,It,null),createRenderEffect(()=>jt.value=Gt()),jt})()}),null),ge.addEventListener("change",It=>G(Gt=>({...Gt,totalPrice:It.currentTarget.value}))),insert(ge,createComponent(For,{get each(){return D()},children:(It,Gt)=>(()=>{var jt=_tmpl$30(),pt=jt.firstChild;return insert(jt,Gt,pt),insert(jt,It,null),createRenderEffect(()=>jt.value=Gt()),jt})()}),null),createRenderEffect(It=>{var Gt={...Xt,"font-size":"0.8rem",color:"var(--danger-color)"},jt={...Yt,"font-size":"0.85rem"},pt={...Xt,"font-size":"0.8rem",color:"var(--danger-color)"},Ot={...Yt,"font-size":"0.85rem"},De={...Xt,"font-size":"0.8rem"},Ie={...Yt,"font-size":"0.85rem"},Le={...Xt,"font-size":"0.8rem"},Ne={...Yt,"font-size":"0.85rem"},$e={...Xt,"font-size":"0.8rem"},Ue={...Yt,"font-size":"0.85rem"};return It.e=style(xt,Gt,It.e),It.t=style(St,jt,It.t),It.a=style(dt,pt,It.a),It.o=style(Et,Ot,It.o),It.i=style(Pt,De,It.i),It.n=style(Rt,Ie,It.n),It.s=style(we,Le,It.s),It.h=style(_e,Ne,It.h),It.r=style(Ce,$e,It.r),It.d=style(ge,Ue,It.d),It},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0,r:void 0,d:void 0}),createRenderEffect(()=>ft.checked=X()),createRenderEffect(()=>St.value=B().productName),createRenderEffect(()=>Et.value=B().unitPrice),createRenderEffect(()=>Rt.value=B().productCode),createRenderEffect(()=>_e.value=B().quantity),createRenderEffect(()=>ge.value=B().totalPrice),Z})(),createComponent(Show,{get when(){return lt().length>0},get children(){var Z=_tmpl$10(),yt=Z.firstChild,nt=yt.nextSibling,Ut=nt.firstChild,kt=Ut.firstChild,st=Ut.nextSibling,ft=nt.nextSibling,ht=ft.firstChild,Q=ht.nextSibling,bt=Q.nextSibling;return Z.style.setProperty("padding","0.75rem"),Z.style.setProperty("background","white"),Z.style.setProperty("border-radius","var(--border-radius-sm)"),Z.style.setProperty("margin-bottom","1rem"),Z.style.setProperty("max-height","200px"),Z.style.setProperty("overflow","auto"),yt.style.setProperty("margin-bottom","0.5rem"),yt.style.setProperty("font-size","0.8rem"),yt.style.setProperty("color","var(--text-muted)"),nt.style.setProperty("width","100%"),nt.style.setProperty("font-size","0.7rem"),nt.style.setProperty("border-collapse","collapse"),kt.style.setProperty("background","var(--gray-50)"),insert(kt,createComponent(For,{get each(){return D()},children:(xt,St)=>(()=>{var Ct=_tmpl$31();return Ct.style.setProperty("padding","0.25rem 0.4rem"),Ct.style.setProperty("text-align","left"),Ct.style.setProperty("border-bottom","1px solid var(--border-color)"),Ct.style.setProperty("font-weight","600"),Ct.style.setProperty("white-space","nowrap"),insert(Ct,xt),createRenderEffect(dt=>(dt=B().productName===`${St()}`?"var(--success-light)":B().unitPrice===`${St()}`?"var(--warning-light)":B().productCode===`${St()}`?"var(--info-light)":"inherit")!=null?Ct.style.setProperty("background",dt):Ct.style.removeProperty("background")),Ct})()})),insert(st,createComponent(For,{get each(){return memo(()=>!!X())()?lt().slice(1):lt()},children:xt=>(()=>{var St=_tmpl$32();return insert(St,createComponent(For,{each:xt,children:(Ct,dt)=>(()=>{var Et=_tmpl$33();return Et.style.setProperty("padding","0.25rem 0.4rem"),Et.style.setProperty("border-bottom","1px solid var(--border-color)"),Et.style.setProperty("max-width","150px"),Et.style.setProperty("overflow","hidden"),Et.style.setProperty("text-overflow","ellipsis"),Et.style.setProperty("white-space","nowrap"),insert(Et,Ct),createRenderEffect(_t=>(_t=B().productName===`${dt()}`?"var(--success-light)":B().unitPrice===`${dt()}`?"var(--warning-light)":B().productCode===`${dt()}`?"var(--info-light)":"inherit")!=null?Et.style.setProperty("background",_t):Et.style.removeProperty("background")),Et})()})),St})()})),ft.style.setProperty("margin-top","0.5rem"),ft.style.setProperty("font-size","0.7rem"),ft.style.setProperty("color","var(--text-muted)"),ht.style.setProperty("background","var(--success-light)"),ht.style.setProperty("padding","0.1rem 0.3rem"),ht.style.setProperty("margin-right","0.5rem"),Q.style.setProperty("background","var(--warning-light)"),Q.style.setProperty("padding","0.1rem 0.3rem"),Q.style.setProperty("margin-right","0.5rem"),bt.style.setProperty("background","var(--info-light)"),bt.style.setProperty("padding","0.1rem 0.3rem"),Z}}),createComponent(Button,{variant:"primary",get disabled(){return!l()||!B().productName||!B().unitPrice||S().length===0},onClick:()=>{const Z=B(),yt=X()?S().slice(1):S();if(!Z.productName||!Z.unitPrice){C("Product Name and Unit Price columns are required");return}try{const nt=parseInt(Z.productName),Ut=parseInt(Z.unitPrice),kt=Z.productCode?parseInt(Z.productCode):-1,st=Z.quantity?parseInt(Z.quantity):-1,ft=Z.totalPrice?parseInt(Z.totalPrice):-1,ht=yt.filter(xt=>xt[nt]&&xt[nt].trim()).map(xt=>{const St=xt[nt]?.trim()||"",Ct=(xt[Ut]||"0").replace(/[$,€£]/g,"").trim(),dt=parseFloat(Ct)||0,Et=st>=0&&parseFloat(xt[st]?.replace(/[^0-9.]/g,"")||"1")||1,_t=ft>=0&&parseFloat(xt[ft]?.replace(/[$,€£]/g,"")||"0")||dt*Et;return{id:`pdf-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,productCode:kt>=0?xt[kt]?.trim():void 0,productName:St,quantity:Et,unit:"unit",unitPrice:dt,totalPrice:_t,currency:"USD",normalizedName:normalizeProductName(St)}}).filter(xt=>xt.unitPrice>0||xt.productName);if(ht.length===0){C("No valid products found. Check your column mappings.");return}const Q=ht.reduce((xt,St)=>xt+St.totalPrice,0),bt={id:`offer-${Date.now()}`,supplierName:l(),sourceFile:o()?.name||"pdf-import",sourceType:"pdf",uploadDate:Date.now(),products:ht,currency:"USD",totalProducts:ht.length,totalValue:Q};offersStore.addSupplierOffer(bt),M(`Added ${ht.length} products from PDF`),setTimeout(()=>M(null),3e3),m(null),T([]),$([]),V([]),c(""),offersStore.offers().length>=2&&s("compare")}catch(nt){C(nt instanceof Error?nt.message:"Failed to parse PDF data")}},style:{width:"100%"},get children(){return["Add ",memo(()=>memo(()=>!!X())()?S().length-1:S().length)," Products from PDF"]}})]}}),null),createRenderEffect(Z=>{var yt=Xt,nt=Yt,Ut=Y();return Z.e=style(Ht,yt,Z.e),Z.t=style(Bt,nt,Z.t),Ut!==Z.a&&(Bt.disabled=Z.a=Ut),Z},{e:void 0,t:void 0,a:void 0}),ot}}),null),insert(Dt,createComponent(Show,{get when(){return memo(()=>w()==="file"&&e()==="csv")()&&P().length>0},get children(){var ot=_tmpl$13(),Lt=ot.firstChild,qt=Lt.firstChild,Ft=qt.nextSibling,Ht=Ft.firstChild,Bt=Lt.nextSibling,Z=Bt.firstChild,yt=Z.nextSibling;return yt.nextSibling,ot.style.setProperty("padding","1rem"),ot.style.setProperty("background","var(--gray-50)"),ot.style.setProperty("border-radius","var(--border-radius-sm)"),ot.style.setProperty("margin-bottom","1rem"),Lt.style.setProperty("display","flex"),Lt.style.setProperty("justify-content","space-between"),Lt.style.setProperty("align-items","center"),Lt.style.setProperty("margin-bottom","0.75rem"),qt.style.setProperty("font-weight","500"),Ft.$$click=()=>g(!k()),Ft.style.setProperty("background","none"),Ft.style.setProperty("border","none"),Ft.style.setProperty("color","var(--primary-color)"),Ft.style.setProperty("cursor","pointer"),Ft.style.setProperty("font-size","0.875rem"),insert(Ft,()=>k()?"Hide":"Show",Ht),Bt.style.setProperty("font-size","0.875rem"),Bt.style.setProperty("color","var(--text-muted)"),Bt.style.setProperty("margin-bottom","0.5rem"),insert(Bt,()=>P().length,yt),insert(Bt,()=>P().slice(0,5).join(", "),null),insert(Bt,()=>P().length>5&&"...",null),insert(ot,createComponent(Show,{get when(){return k()},get children(){var nt=_tmpl$12(),Ut=nt.firstChild,kt=Ut.firstChild,st=kt.nextSibling,ft=Ut.nextSibling,ht=ft.firstChild,Q=ht.nextSibling,bt=ft.nextSibling,xt=bt.firstChild,St=xt.nextSibling;St.firstChild;var Ct=bt.nextSibling,dt=Ct.firstChild,Et=dt.nextSibling;return Et.firstChild,nt.style.setProperty("display","grid"),nt.style.setProperty("grid-template-columns","repeat(auto-fit, minmax(200px, 1fr))"),nt.style.setProperty("gap","0.75rem"),nt.style.setProperty("margin-top","1rem"),st.addEventListener("change",_t=>R(Pt=>({...Pt,columnMapping:{...Pt.columnMapping,productName:parseInt(_t.currentTarget.value)}}))),insert(st,createComponent(For,{get each(){return P()},children:(_t,Pt)=>(()=>{var Rt=_tmpl$30(),ee=Rt.firstChild;return insert(Rt,Pt,ee),insert(Rt,_t,null),createRenderEffect(()=>Rt.value=Pt()),Rt})()})),Q.addEventListener("change",_t=>R(Pt=>({...Pt,columnMapping:{...Pt.columnMapping,unitPrice:parseInt(_t.currentTarget.value)}}))),insert(Q,createComponent(For,{get each(){return P()},children:(_t,Pt)=>(()=>{var Rt=_tmpl$30(),ee=Rt.firstChild;return insert(Rt,Pt,ee),insert(Rt,_t,null),createRenderEffect(()=>Rt.value=Pt()),Rt})()})),St.addEventListener("change",_t=>{const Pt=parseInt(_t.currentTarget.value);R(Rt=>({...Rt,columnMapping:{...Rt.columnMapping,quantity:Pt>=0?Pt:void 0}}))}),insert(St,createComponent(For,{get each(){return P()},children:(_t,Pt)=>(()=>{var Rt=_tmpl$30(),ee=Rt.firstChild;return insert(Rt,Pt,ee),insert(Rt,_t,null),createRenderEffect(()=>Rt.value=Pt()),Rt})()}),null),Et.addEventListener("change",_t=>{const Pt=parseInt(_t.currentTarget.value);R(Rt=>({...Rt,columnMapping:{...Rt.columnMapping,productCode:Pt>=0?Pt:void 0}}))}),insert(Et,createComponent(For,{get each(){return P()},children:(_t,Pt)=>(()=>{var Rt=_tmpl$30(),ee=Rt.firstChild;return insert(Rt,Pt,ee),insert(Rt,_t,null),createRenderEffect(()=>Rt.value=Pt()),Rt})()}),null),createRenderEffect(_t=>{var Pt={...Xt,"font-size":"0.875rem"},Rt=Yt,ee={...Xt,"font-size":"0.875rem"},we=Yt,_e={...Xt,"font-size":"0.875rem"},Mt=Yt,Ce={...Xt,"font-size":"0.875rem"},ge=Yt;return _t.e=style(kt,Pt,_t.e),_t.t=style(st,Rt,_t.t),_t.a=style(ht,ee,_t.a),_t.o=style(Q,we,_t.o),_t.i=style(xt,_e,_t.i),_t.n=style(St,Mt,_t.n),_t.s=style(dt,Ce,_t.s),_t.h=style(Et,ge,_t.h),_t},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0}),createRenderEffect(()=>st.value=v().columnMapping.productName),createRenderEffect(()=>Q.value=v().columnMapping.unitPrice),createRenderEffect(()=>St.value=v().columnMapping.quantity??-1),createRenderEffect(()=>Et.value=v().columnMapping.productCode??-1),nt}}),null),ot}}),null),insert(Dt,createComponent(Show,{get when(){return memo(()=>w()!=="ai"&&w()!=="json")()&&w()!=="pdf-map"},get children(){return createComponent(Button,{variant:"primary",onClick:H,get disabled(){return y()||!l()||(w()==="file"?!t():!f().trim())},style:{width:"100%"},get children(){return y()?"Processing...":"Add Offer"}})}}),null),createRenderEffect(ot=>{var Lt=xe,qt=Xt,Ft=Yt,Ht=Xt,Bt=w()==="file"?"var(--primary-color)":"white",Z=w()==="file"?"white":"var(--text-primary)",yt=w()==="text"?"var(--primary-color)":"white",nt=w()==="text"?"white":"var(--text-primary)",Ut=w()==="ai"?"var(--warning-color)":"white",kt=w()==="ai"?"white":"var(--text-primary)",st=w()==="json"?"var(--info-color)":"white",ft=w()==="json"?"white":"var(--text-primary)",ht=w()==="pdf-map"?"var(--success-color)":"white",Q=w()==="pdf-map"?"white":"var(--text-primary)";return ot.e=style(Dt,Lt,ot.e),ot.t=style(le,qt,ot.t),ot.a=style(Wt,Ft,ot.a),ot.o=style(ce,Ht,ot.o),Bt!==ot.i&&((ot.i=Bt)!=null?re.style.setProperty("background",Bt):re.style.removeProperty("background")),Z!==ot.n&&((ot.n=Z)!=null?re.style.setProperty("color",Z):re.style.removeProperty("color")),yt!==ot.s&&((ot.s=yt)!=null?te.style.setProperty("background",yt):te.style.removeProperty("background")),nt!==ot.h&&((ot.h=nt)!=null?te.style.setProperty("color",nt):te.style.removeProperty("color")),Ut!==ot.r&&((ot.r=Ut)!=null?ne.style.setProperty("background",Ut):ne.style.removeProperty("background")),kt!==ot.d&&((ot.d=kt)!=null?ne.style.setProperty("color",kt):ne.style.removeProperty("color")),st!==ot.l&&((ot.l=st)!=null?ae.style.setProperty("background",st):ae.style.removeProperty("background")),ft!==ot.u&&((ot.u=ft)!=null?ae.style.setProperty("color",ft):ae.style.removeProperty("color")),ht!==ot.c&&((ot.c=ht)!=null?ct.style.setProperty("background",ht):ct.style.removeProperty("background")),Q!==ot.w&&((ot.w=Q)!=null?ct.style.setProperty("color",Q):ct.style.removeProperty("color")),ot},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0,r:void 0,d:void 0,l:void 0,u:void 0,c:void 0,w:void 0}),createRenderEffect(()=>Wt.value=l()),Dt}}),null),insert(mt,createComponent(Card,{get children(){var Dt=_tmpl$16(),Nt=Dt.firstChild,Zt=Nt.firstChild,le=Zt.nextSibling;return le.nextSibling,Nt.style.setProperty("margin-bottom","1.5rem"),Nt.style.setProperty("font-weight","600"),insert(Nt,()=>ye().length,le),insert(Dt,createComponent(Show,{get when(){return ye().length===0},get children(){var Wt=_tmpl$15();return Wt.style.setProperty("padding","2rem"),Wt.style.setProperty("text-align","center"),Wt.style.setProperty("color","var(--text-muted)"),Wt.style.setProperty("background","var(--gray-50)"),Wt.style.setProperty("border-radius","var(--border-radius-sm)"),Wt}}),null),insert(Dt,createComponent(For,{get each(){return ye()},children:Wt=>(()=>{var ie=_tmpl$34(),ce=ie.firstChild,fe=ce.firstChild,re=fe.firstChild,te=re.nextSibling,ne=te.firstChild,ae=ne.nextSibling;ae.nextSibling;var ct=te.nextSibling,ot=ct.firstChild,Lt=ot.nextSibling,qt=Lt.nextSibling,Ft=qt.nextSibling;Ft.nextSibling;var Ht=fe.nextSibling,Bt=ce.nextSibling,Z=Bt.firstChild,yt=Z.firstChild,nt=yt.firstChild,Ut=nt.firstChild,kt=Ut.nextSibling,st=kt.nextSibling,ft=st.nextSibling,ht=ft.nextSibling,Q=yt.nextSibling;return ie.style.setProperty("border","1px solid var(--border-color)"),ie.style.setProperty("border-radius","var(--border-radius-sm)"),ie.style.setProperty("margin-bottom","0.75rem"),ie.style.setProperty("overflow","hidden"),ce.style.setProperty("padding","1rem"),ce.style.setProperty("background","var(--gray-50)"),ce.style.setProperty("display","flex"),ce.style.setProperty("justify-content","space-between"),ce.style.setProperty("align-items","center"),re.style.setProperty("font-weight","600"),insert(re,()=>Wt.supplierName),te.style.setProperty("font-size","0.875rem"),te.style.setProperty("color","var(--text-muted)"),insert(te,()=>Wt.totalProducts,ne),insert(te,()=>Kt(Wt.totalValue,Wt.currency),ae),ct.style.setProperty("font-size","0.75rem"),ct.style.setProperty("color","var(--text-muted)"),insert(ct,()=>Wt.sourceFile,Lt),insert(ct,()=>Wt.sourceType.toUpperCase(),Ft),Ht.$$click=()=>At(Wt.id),Ht.style.setProperty("background","var(--danger-color)"),Ht.style.setProperty("color","white"),Ht.style.setProperty("border","none"),Ht.style.setProperty("padding","0.5rem 1rem"),Ht.style.setProperty("border-radius","var(--border-radius-sm)"),Ht.style.setProperty("cursor","pointer"),Bt.style.setProperty("max-height","200px"),Bt.style.setProperty("overflow","auto"),Bt.style.setProperty("font-size","0.8rem"),Z.style.setProperty("width","100%"),Z.style.setProperty("border-collapse","collapse"),nt.style.setProperty("background","var(--gray-100)"),nt.style.setProperty("position","sticky"),nt.style.setProperty("top","0"),Ut.style.setProperty("padding","0.4rem 0.6rem"),Ut.style.setProperty("text-align","left"),Ut.style.setProperty("font-weight","600"),kt.style.setProperty("padding","0.4rem 0.6rem"),kt.style.setProperty("text-align","left"),kt.style.setProperty("font-weight","600"),st.style.setProperty("padding","0.4rem 0.6rem"),st.style.setProperty("text-align","right"),st.style.setProperty("font-weight","600"),ft.style.setProperty("padding","0.4rem 0.6rem"),ft.style.setProperty("text-align","right"),ft.style.setProperty("font-weight","600"),ht.style.setProperty("padding","0.4rem 0.6rem"),ht.style.setProperty("text-align","right"),ht.style.setProperty("font-weight","600"),insert(Q,createComponent(For,{get each(){return Wt.products},children:(bt,xt)=>(()=>{var St=_tmpl$35(),Ct=St.firstChild,dt=Ct.nextSibling,Et=dt.nextSibling,_t=Et.firstChild,Pt=Et.nextSibling,Rt=Pt.nextSibling;return St.style.setProperty("border-bottom","1px solid var(--border-color)"),Ct.style.setProperty("padding","0.4rem 0.6rem"),Ct.style.setProperty("max-width","200px"),Ct.style.setProperty("overflow","hidden"),Ct.style.setProperty("text-overflow","ellipsis"),Ct.style.setProperty("white-space","nowrap"),insert(Ct,()=>bt.productName),dt.style.setProperty("padding","0.4rem 0.6rem"),dt.style.setProperty("color","var(--text-muted)"),dt.style.setProperty("font-family","monospace"),dt.style.setProperty("font-size","0.75rem"),insert(dt,()=>bt.productCode||"-"),Et.style.setProperty("padding","0.4rem 0.6rem"),Et.style.setProperty("text-align","right"),insert(Et,()=>bt.quantity,_t),insert(Et,()=>bt.unit,null),Pt.style.setProperty("padding","0.4rem 0.6rem"),Pt.style.setProperty("text-align","right"),Pt.style.setProperty("font-weight","500"),insert(Pt,()=>Kt(bt.unitPrice)),Rt.style.setProperty("padding","0.4rem 0.6rem"),Rt.style.setProperty("text-align","right"),insert(Rt,()=>Kt(bt.totalPrice)),createRenderEffect(ee=>(ee=xt()%2===0?"white":"var(--gray-50)")!=null?St.style.setProperty("background",ee):St.style.removeProperty("background")),St})()})),ie})()}),null),insert(Dt,createComponent(Show,{get when(){return ye().length>=2},get children(){return createComponent(Button,{variant:"primary",onClick:()=>s("compare"),style:{width:"100%","margin-top":"1rem"},children:"Compare Offers"})}}),null),createRenderEffect(Wt=>style(Dt,xe,Wt)),Dt}}),null),mt}}),null),insert(vt,createComponent(Show,{get when(){return E()==="compare"},get children(){return[createComponent(Show,{get when(){return Fe()},get children(){var mt=_tmpl$();return mt.style.setProperty("display","grid"),mt.style.setProperty("grid-template-columns","repeat(auto-fit, minmax(200px, 1fr))"),mt.style.setProperty("gap","1rem"),mt.style.setProperty("margin-bottom","1.5rem"),insert(mt,createComponent(Card,{get children(){var Dt=_tmpl$17(),Nt=Dt.firstChild,Zt=Nt.nextSibling;return Dt.style.setProperty("padding","1rem"),Dt.style.setProperty("text-align","center"),Nt.style.setProperty("font-size","2rem"),Nt.style.setProperty("font-weight","700"),Nt.style.setProperty("color","var(--primary-color)"),insert(Nt,()=>Fe().summary.totalProducts),Zt.style.setProperty("color","var(--text-muted)"),Dt}}),null),insert(mt,createComponent(Card,{get children(){var Dt=_tmpl$18(),Nt=Dt.firstChild,Zt=Nt.nextSibling;return Dt.style.setProperty("padding","1rem"),Dt.style.setProperty("text-align","center"),Nt.style.setProperty("font-size","2rem"),Nt.style.setProperty("font-weight","700"),Nt.style.setProperty("color","var(--info-color)"),insert(Nt,()=>Fe().summary.totalSuppliers),Zt.style.setProperty("color","var(--text-muted)"),Dt}}),null),insert(mt,createComponent(Card,{get children(){var Dt=_tmpl$19(),Nt=Dt.firstChild,Zt=Nt.nextSibling;return Dt.style.setProperty("padding","1rem"),Dt.style.setProperty("text-align","center"),Nt.style.setProperty("font-size","2rem"),Nt.style.setProperty("font-weight","700"),Nt.style.setProperty("color","var(--warning-color)"),insert(Nt,()=>Fe().summary.productsWithMultipleOffers),Zt.style.setProperty("color","var(--text-muted)"),Dt}}),null),insert(mt,createComponent(Card,{get children(){var Dt=_tmpl$20(),Nt=Dt.firstChild,Zt=Nt.nextSibling;return Dt.style.setProperty("padding","1rem"),Dt.style.setProperty("text-align","center"),Nt.style.setProperty("font-size","2rem"),Nt.style.setProperty("font-weight","700"),Nt.style.setProperty("color","var(--success-color)"),insert(Nt,()=>Kt(Fe().summary.potentialSavings)),Zt.style.setProperty("color","var(--text-muted)"),Dt}}),null),mt}}),createComponent(Card,{get children(){var mt=_tmpl$22(),Dt=mt.firstChild,Nt=Dt.firstChild,Zt=Dt.nextSibling,le=Zt.firstChild,Wt=le.nextSibling,ie=Wt.nextSibling,ce=ie.firstChild,fe=Zt.nextSibling,re=fe.firstChild,te=re.nextSibling,ne=te.nextSibling,ae=ne.nextSibling;return ae.nextSibling,mt.style.setProperty("padding","1rem"),mt.style.setProperty("display","flex"),mt.style.setProperty("gap","1rem"),mt.style.setProperty("flex-wrap","wrap"),mt.style.setProperty("align-items","center"),Dt.style.setProperty("flex","1"),Dt.style.setProperty("min-width","200px"),Nt.$$input=ct=>Pe(ct.currentTarget.value),insert(mt,createComponent(Show,{get when(){return Oe().length>0},get children(){var ct=_tmpl$21(),ot=ct.firstChild;return ot.firstChild,ot.addEventListener("change",Lt=>Jt(Lt.currentTarget.value)),insert(ot,createComponent(For,{get each(){return Oe()},children:Lt=>(()=>{var qt=_tmpl$28();return qt.value=Lt,insert(qt,Lt),qt})()}),null),createRenderEffect(Lt=>style(ot,Yt,Lt)),createRenderEffect(()=>ot.value=zt()),ct}}),Zt),Zt.style.setProperty("display","flex"),Zt.style.setProperty("align-items","center"),Zt.style.setProperty("gap","0.5rem"),le.style.setProperty("font-size","0.8rem"),le.style.setProperty("white-space","nowrap"),Wt.$$input=ct=>offersStore.setSimilarityThreshold(parseInt(ct.currentTarget.value)),Wt.style.setProperty("width","100px"),ie.style.setProperty("font-size","0.8rem"),ie.style.setProperty("font-weight","600"),ie.style.setProperty("min-width","35px"),insert(ie,()=>offersStore.similarityThreshold(),ce),fe.style.setProperty("font-size","0.875rem"),fe.style.setProperty("color","var(--text-muted)"),insert(fe,()=>rt().length,te),insert(fe,()=>Re().length,ae),createRenderEffect(ct=>{var ot=Yt,Lt=offersStore.similarityThreshold()>=90?"var(--success-color)":offersStore.similarityThreshold()>=70?"var(--warning-color)":"var(--danger-color)";return ct.e=style(Nt,ot,ct.e),Lt!==ct.t&&((ct.t=Lt)!=null?ie.style.setProperty("color",Lt):ie.style.removeProperty("color")),ct},{e:void 0,t:void 0}),createRenderEffect(()=>Nt.value=Se()),createRenderEffect(()=>Wt.value=offersStore.similarityThreshold()),mt}}),createComponent(Card,{get children(){var mt=_tmpl$24(),Dt=mt.firstChild,Nt=Dt.firstChild,Zt=Nt.firstChild,le=Zt.firstChild;le.firstChild;var Wt=le.nextSibling,ie=Wt.nextSibling;ie.firstChild;var ce=ie.nextSibling;ce.firstChild;var fe=ce.nextSibling,re=fe.nextSibling;re.firstChild;var te=re.nextSibling,ne=te.nextSibling,ae=Nt.nextSibling;return mt.style.setProperty("padding","1rem"),mt.style.setProperty("overflow-x","auto"),le.$$click=()=>Vt("name"),insert(le,(()=>{var ct=memo(()=>gt()==="name");return()=>ct()&&(Tt()==="asc"?"↑":"↓")})(),null),ie.$$click=()=>Vt("suppliers"),insert(ie,(()=>{var ct=memo(()=>gt()==="suppliers");return()=>ct()&&(Tt()==="asc"?"↑":"↓")})(),null),ce.$$click=()=>Vt("bestPrice"),insert(ce,(()=>{var ct=memo(()=>gt()==="bestPrice");return()=>ct()&&(Tt()==="asc"?"↑":"↓")})(),null),re.$$click=()=>Vt("savings"),insert(re,(()=>{var ct=memo(()=>gt()==="savings");return()=>ct()&&(Tt()==="asc"?"↑":"↓")})(),null),insert(ae,createComponent(For,{get each(){return rt()},children:ct=>{const ot=getMatchQualityDisplay(ct.matchQuality),Lt=getScoreDisplay(ct.averageSimilarity);return(()=>{var qt=_tmpl$39(),Ft=qt.firstChild,Ht=Ft.firstChild,Bt=Ft.nextSibling,Z=Bt.firstChild,yt=Z.firstChild,nt=yt.nextSibling,Ut=Bt.nextSibling,kt=Ut.firstChild,st=Ut.nextSibling,ft=st.nextSibling,ht=ft.firstChild,Q=ft.nextSibling,bt=Q.nextSibling,xt=bt.firstChild,St=bt.nextSibling,Ct=St.firstChild;return Ht.style.setProperty("font-weight","500"),insert(Ht,()=>ct.productName),insert(Ft,createComponent(Show,{get when(){return ct.productCode},get children(){var dt=_tmpl$36();return dt.firstChild,dt.style.setProperty("font-size","0.75rem"),dt.style.setProperty("color","var(--text-muted)"),insert(dt,()=>ct.productCode,null),dt}}),null),Z.style.setProperty("display","flex"),Z.style.setProperty("flex-direction","column"),Z.style.setProperty("gap","0.25rem"),yt.style.setProperty("padding","0.15rem 0.4rem"),yt.style.setProperty("border-radius","var(--border-radius-sm)"),yt.style.setProperty("font-size","0.7rem"),yt.style.setProperty("font-weight","600"),yt.style.setProperty("text-align","center"),insert(yt,()=>ot.label),nt.style.setProperty("padding","0.1rem 0.3rem"),nt.style.setProperty("border-radius","var(--border-radius-sm)"),nt.style.setProperty("font-size","0.7rem"),nt.style.setProperty("text-align","center"),insert(nt,()=>Lt.label),kt.style.setProperty("padding","0.25rem 0.5rem"),kt.style.setProperty("border-radius","var(--border-radius-sm)"),kt.style.setProperty("font-size","0.875rem"),insert(kt,()=>ct.offers.length),insert(st,()=>Kt(ct.bestOffer?.price||0)),insert(ft,()=>Kt(ct.priceRange.min),ht),insert(ft,()=>Kt(ct.priceRange.max),null),insert(Q,createComponent(Show,{get when(){return ct.offers.length>1},get children(){var dt=_tmpl$37(),Et=dt.firstChild,_t=Et.nextSibling,Pt=_t.firstChild;return dt.style.setProperty("display","flex"),dt.style.setProperty("align-items","center"),dt.style.setProperty("gap","0.5rem"),Et.style.setProperty("font-weight","600"),Et.style.setProperty("color","var(--success-color)"),insert(Et,()=>Kt(ct.priceRange.max-ct.priceRange.min)),_t.style.setProperty("font-size","0.75rem"),_t.style.setProperty("color","var(--success-color)"),_t.style.setProperty("background","var(--success-light)"),_t.style.setProperty("padding","0.125rem 0.375rem"),_t.style.setProperty("border-radius","var(--border-radius-sm)"),insert(_t,()=>be(ct).toFixed(1),Pt),dt}}),null),insert(Q,createComponent(Show,{get when(){return ct.offers.length<=1},get children(){var dt=_tmpl$38();return dt.style.setProperty("color","var(--text-muted)"),dt}}),null),xt.style.setProperty("color","var(--primary-color)"),xt.style.setProperty("font-weight","500"),insert(xt,()=>ct.bestOffer?.supplierName||"--"),Ct.$$click=()=>me(ct),Ct.style.setProperty("background","var(--primary-color)"),Ct.style.setProperty("color","white"),Ct.style.setProperty("border","none"),Ct.style.setProperty("padding","0.375rem 0.75rem"),Ct.style.setProperty("border-radius","var(--border-radius-sm)"),Ct.style.setProperty("cursor","pointer"),Ct.style.setProperty("font-size","0.875rem"),createRenderEffect(dt=>{var Et=Qt,_t=Qt,Pt=ot.bgColor,Rt=ot.color,ee=Lt.bgColor,we=Lt.color,_e=Qt,Mt=ct.offers.length>1?"var(--success-light)":"var(--gray-100)",Ce={...Qt,"font-weight":"600",color:"var(--success-color)"},ge=Qt,It=Qt,Gt=Qt,jt=Qt;return dt.e=style(Ft,Et,dt.e),dt.t=style(Bt,_t,dt.t),Pt!==dt.a&&((dt.a=Pt)!=null?yt.style.setProperty("background",Pt):yt.style.removeProperty("background")),Rt!==dt.o&&((dt.o=Rt)!=null?yt.style.setProperty("color",Rt):yt.style.removeProperty("color")),ee!==dt.i&&((dt.i=ee)!=null?nt.style.setProperty("background",ee):nt.style.removeProperty("background")),we!==dt.n&&((dt.n=we)!=null?nt.style.setProperty("color",we):nt.style.removeProperty("color")),dt.s=style(Ut,_e,dt.s),Mt!==dt.h&&((dt.h=Mt)!=null?kt.style.setProperty("background",Mt):kt.style.removeProperty("background")),dt.r=style(st,Ce,dt.r),dt.d=style(ft,ge,dt.d),dt.l=style(Q,It,dt.l),dt.u=style(bt,Gt,dt.u),dt.c=style(St,jt,dt.c),dt},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0,r:void 0,d:void 0,l:void 0,u:void 0,c:void 0}),qt})()}})),insert(mt,createComponent(Show,{get when(){return rt().length===0},get children(){var ct=_tmpl$23();return ct.style.setProperty("padding","2rem"),ct.style.setProperty("text-align","center"),ct.style.setProperty("color","var(--text-muted)"),ct}}),null),createRenderEffect(ct=>{var ot=Te,Lt=oe,qt=oe,Ft=oe,Ht=oe,Bt=oe,Z=oe,yt=oe,nt=oe;return ct.e=style(Dt,ot,ct.e),ct.t=style(le,Lt,ct.t),ct.a=style(Wt,qt,ct.a),ct.o=style(ie,Ft,ct.o),ct.i=style(ce,Ht,ct.i),ct.n=style(fe,Bt,ct.n),ct.s=style(re,Z,ct.s),ct.h=style(te,yt,ct.h),ct.r=style(ne,nt,ct.r),ct},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0,r:void 0}),mt}})]}}),null),insert(vt,createComponent(Show,{get when(){return Ae()},get children(){var mt=_tmpl$();return mt.$$click=()=>me(null),mt.style.setProperty("position","fixed"),mt.style.setProperty("top","0"),mt.style.setProperty("left","0"),mt.style.setProperty("right","0"),mt.style.setProperty("bottom","0"),mt.style.setProperty("background","rgba(0,0,0,0.5)"),mt.style.setProperty("display","flex"),mt.style.setProperty("justify-content","center"),mt.style.setProperty("align-items","center"),mt.style.setProperty("z-index","1000"),insert(mt,createComponent(Card,{style:{width:"90%","max-width":"700px","max-height":"80vh",overflow:"auto"},get children(){var Dt=_tmpl$26(),Nt=Dt.firstChild,Zt=Nt.firstChild,le=Zt.nextSibling,Wt=Nt.nextSibling,ie=Wt.firstChild,ce=ie.firstChild,fe=ce.nextSibling,re=ie.nextSibling,te=re.firstChild,ne=te.nextSibling,ae=re.nextSibling,ct=ae.firstChild,ot=ct.nextSibling,Lt=ae.nextSibling,qt=Lt.firstChild,Ft=Wt.nextSibling,Ht=Ft.nextSibling,Bt=Ht.firstChild,Z=Bt.firstChild,yt=Z.firstChild,nt=yt.nextSibling,Ut=nt.nextSibling,kt=Ut.nextSibling,st=kt.nextSibling,ft=st.nextSibling,ht=Bt.nextSibling;return Dt.$$click=Q=>Q.stopPropagation(),Nt.style.setProperty("display","flex"),Nt.style.setProperty("justify-content","space-between"),Nt.style.setProperty("align-items","center"),Nt.style.setProperty("margin-bottom","1.5rem"),Zt.style.setProperty("font-weight","600"),insert(Zt,()=>Ae()?.productName),le.$$click=()=>me(null),le.style.setProperty("background","none"),le.style.setProperty("border","none"),le.style.setProperty("font-size","1.5rem"),le.style.setProperty("cursor","pointer"),le.style.setProperty("color","var(--text-muted)"),Wt.style.setProperty("display","grid"),Wt.style.setProperty("grid-template-columns","repeat(4, 1fr)"),Wt.style.setProperty("gap","1rem"),Wt.style.setProperty("margin-bottom","1.5rem"),Wt.style.setProperty("padding","1rem"),Wt.style.setProperty("background","var(--gray-50)"),Wt.style.setProperty("border-radius","var(--border-radius-sm)"),ce.style.setProperty("font-size","0.875rem"),ce.style.setProperty("color","var(--text-muted)"),fe.style.setProperty("font-size","1.25rem"),fe.style.setProperty("font-weight","700"),fe.style.setProperty("color","var(--success-color)"),insert(fe,()=>Kt(Ae()?.bestOffer?.price||0)),te.style.setProperty("font-size","0.875rem"),te.style.setProperty("color","var(--text-muted)"),ne.style.setProperty("font-size","1.25rem"),ne.style.setProperty("font-weight","600"),insert(ne,()=>Kt(Ae()?.averagePrice||0)),ct.style.setProperty("font-size","0.875rem"),ct.style.setProperty("color","var(--text-muted)"),ot.style.setProperty("font-size","1.25rem"),ot.style.setProperty("font-weight","600"),ot.style.setProperty("color","var(--success-color)"),insert(ot,()=>Kt((Ae()?.priceRange.max||0)-(Ae()?.priceRange.min||0))),qt.style.setProperty("font-size","0.875rem"),qt.style.setProperty("color","var(--text-muted)"),insert(Lt,()=>{const Q=getMatchQualityDisplay(Ae()?.matchQuality||"exact");return(()=>{var bt=_tmpl$40(),xt=bt.firstChild,St=xt.firstChild;return bt.style.setProperty("font-size","1rem"),bt.style.setProperty("font-weight","600"),bt.style.setProperty("display","flex"),bt.style.setProperty("align-items","center"),bt.style.setProperty("gap","0.5rem"),insert(bt,()=>Q.label,xt),xt.style.setProperty("font-size","0.8rem"),xt.style.setProperty("padding","0.1rem 0.4rem"),xt.style.setProperty("border-radius","var(--border-radius-sm)"),insert(xt,()=>Ae()?.averageSimilarity||100,St),createRenderEffect(Ct=>{var dt=Q.color,Et=Q.bgColor;return dt!==Ct.e&&((Ct.e=dt)!=null?bt.style.setProperty("color",dt):bt.style.removeProperty("color")),Et!==Ct.t&&((Ct.t=Et)!=null?xt.style.setProperty("background",Et):xt.style.removeProperty("background")),Ct},{e:void 0,t:void 0}),bt})()},null),insert(Dt,createComponent(Show,{get when(){return Ae()?.productCode},get children(){var Q=_tmpl$25(),bt=Q.firstChild;return bt.nextSibling,Q.style.setProperty("padding","0.5rem 1rem"),Q.style.setProperty("background","var(--info-light)"),Q.style.setProperty("border-radius","var(--border-radius-sm)"),Q.style.setProperty("margin-bottom","1rem"),Q.style.setProperty("font-size","0.875rem"),insert(Q,()=>Ae()?.productCode,null),Q}}),Ft),Ft.style.setProperty("margin-bottom","1rem"),Ft.style.setProperty("font-weight","600"),insert(ht,createComponent(For,{get each(){return Ae()?.offers.sort((Q,bt)=>Q.productOffer.unitPrice-bt.productOffer.unitPrice)},children:Q=>{const bt=getScoreDisplay(Q.similarity?.score||100);return(()=>{var xt=_tmpl$45(),St=xt.firstChild,Ct=St.firstChild,dt=St.nextSibling,Et=dt.nextSibling,_t=Et.firstChild,Pt=_t.firstChild,Rt=Et.nextSibling,ee=Rt.nextSibling,we=ee.firstChild,_e=ee.nextSibling;return insert(Ct,()=>Q.supplierName,null),insert(Ct,()=>Q.isBestPrice&&" ⭐",null),insert(dt,()=>Q.productOffer.productName,null),insert(dt,createComponent(Show,{get when(){return Q.productOffer.productCode},get children(){var Mt=_tmpl$();return Mt.style.setProperty("font-size","0.7rem"),Mt.style.setProperty("color","var(--text-muted)"),insert(Mt,()=>Q.productOffer.productCode),Mt}}),null),_t.style.setProperty("display","flex"),_t.style.setProperty("flex-direction","column"),_t.style.setProperty("gap","0.15rem"),Pt.style.setProperty("padding","0.1rem 0.3rem"),Pt.style.setProperty("border-radius","var(--border-radius-sm)"),Pt.style.setProperty("font-size","0.7rem"),Pt.style.setProperty("text-align","center"),insert(Pt,()=>bt.label),insert(_t,createComponent(Show,{get when(){return Q.similarity?.upcMatch},get children(){var Mt=_tmpl$41();return Mt.style.setProperty("font-size","0.65rem"),Mt.style.setProperty("color","var(--success-color)"),Mt.style.setProperty("text-align","center"),Mt}}),null),insert(_t,createComponent(Show,{get when(){return Q.similarity?.upcMismatch},get children(){var Mt=_tmpl$42();return Mt.style.setProperty("font-size","0.65rem"),Mt.style.setProperty("color","var(--danger-color)"),Mt.style.setProperty("text-align","center"),Mt}}),null),insert(Rt,()=>Kt(Q.productOffer.unitPrice)),insert(ee,()=>Q.productOffer.quantity,we),insert(ee,()=>Q.productOffer.unit,null),insert(_e,createComponent(Show,{get when(){return!Q.isBestPrice&&Q.priceDifference},get children(){var Mt=_tmpl$43(),Ce=Mt.firstChild,ge=Ce.nextSibling,It=ge.nextSibling,Gt=It.nextSibling;return Gt.nextSibling,Mt.style.setProperty("color","var(--danger-color)"),insert(Mt,()=>Kt(Q.priceDifference),ge),insert(Mt,()=>Q.priceDifferencePercent?.toFixed(1),Gt),Mt}}),null),insert(_e,createComponent(Show,{get when(){return Q.isBestPrice},get children(){var Mt=_tmpl$44();return Mt.style.setProperty("color","var(--success-color)"),Mt}}),null),createRenderEffect(Mt=>{var Ce=Q.isBestPrice?"var(--success-light)":"transparent",ge=Qt,It=Q.isBestPrice?"600":"400",Gt={...Qt,"font-size":"0.8rem"},jt=Qt,pt=bt.bgColor,Ot=bt.color,De={...Qt,"font-weight":"600"},Ie=Qt,Le=Qt;return Ce!==Mt.e&&((Mt.e=Ce)!=null?xt.style.setProperty("background",Ce):xt.style.removeProperty("background")),Mt.t=style(St,ge,Mt.t),It!==Mt.a&&((Mt.a=It)!=null?Ct.style.setProperty("font-weight",It):Ct.style.removeProperty("font-weight")),Mt.o=style(dt,Gt,Mt.o),Mt.i=style(Et,jt,Mt.i),pt!==Mt.n&&((Mt.n=pt)!=null?Pt.style.setProperty("background",pt):Pt.style.removeProperty("background")),Ot!==Mt.s&&((Mt.s=Ot)!=null?Pt.style.setProperty("color",Ot):Pt.style.removeProperty("color")),Mt.h=style(Rt,De,Mt.h),Mt.r=style(ee,Ie,Mt.r),Mt.d=style(_e,Le,Mt.d),Mt},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0,r:void 0,d:void 0}),xt})()}})),createRenderEffect(Q=>{var bt=xe,xt=Te,St=oe,Ct=oe,dt=oe,Et=oe,_t=oe,Pt=oe;return Q.e=style(Dt,bt,Q.e),Q.t=style(Ht,xt,Q.t),Q.a=style(yt,St,Q.a),Q.o=style(nt,Ct,Q.o),Q.i=style(Ut,dt,Q.i),Q.n=style(kt,Et,Q.n),Q.s=style(st,_t,Q.s),Q.h=style(ft,Pt,Q.h),Q},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0}),Dt}})),mt}}),null),createRenderEffect(mt=>{var Dt=Me(E()==="upload"),Nt=Me(E()==="compare"),Zt=ye().length<2;return mt.e=style(de,Dt,mt.e),mt.t=style(ke,Nt,mt.t),Zt!==mt.a&&(ke.disabled=mt.a=Zt),mt},{e:void 0,t:void 0,a:void 0}),vt})()};delegateEvents(["click","input"]);export{ProductOffersComparison as default};
