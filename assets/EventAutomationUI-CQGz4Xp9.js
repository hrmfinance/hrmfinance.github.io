import{H as et,J as tt,K as rt,g as Ie,N as kt,O as Pt,P as Yt,Q as Lt,c as ye,f as it,t as x,i as e,a as c,h as m,b as A,S as I,F as ue,d as at,A as Gt,R as Zt,T as Ze,u as It,v as Ae,r as Qt,U as Xt,V as Kt,W as er,o as tr,X as rr,Y as nr}from"./index-wZtwUe5-.js";const Ve={async getAll(r,t){let i={businessId:Ie.getBusinessId()};return t?.search,r&&r.trim()&&r.split(" ").map((b,w)=>{b&&(i[":search"+w]=b.trim())}),(await Pt({query:"getAutomaticRules",queryString:r?"!* contain :search0 AND !* contain :search1 AND !* contain :search2 AND !* contain :search3 AND !* contain :search4 AND createdTimeStamp > :date1 AND createdTimeStamp < :date2 AND account contain :account AND subAccount contain :subAccount AND status = :status":"",params:i})).data||[]},async getById(r){return et(async()=>{const t=await rt({query:"getEventRules",queryString:"businessId = :businessId AND id = :ruleId",params:{":businessId":Ie.getBusinessId(),":ruleId":r}});return kt(t)[0]||null},()=>tt.eventRules.getById(r))},async getByEventType(r){return et(async()=>{const t=await rt({query:"getEventRules",queryString:"businessId = :businessId AND eventType = :eventType AND isActive = true",params:{":businessId":Ie.getBusinessId(),":eventType":r}});return kt(t)},()=>tt.eventRules.getByEventType(r))},async create(r){const t={...r,id:`rule_${Yt()}`,businessId:Ie.getBusinessId(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};let g={query:"addAutomaticRule",params:{businessId:Ie.getBusinessId()},form:t};return await Pt(g)},async update(r,t){const i={...t,updatedAt:new Date().toISOString()};let C={query:"updateAutomaticRule",params:{businessId:Ie.getBusinessId(),id:r},form:i};const b=await Pt(C);return console.log(JSON.stringify(C,null,4)),b},async delete(r){return et(async()=>{if((await rt({query:"deleteEventRules",params:{id:r,businessId:Ie.getBusinessId()}}))?.deleteEventRules)return{success:!0,message:"Event rule deleted successfully"};throw new Error("Failed to delete event rule")},()=>tt.eventRules.delete(r))},async toggleActive(r,t){return this.update(r,{isActive:t})},async testRule(r,t){let g={query:"executeRuleFromConnector",params:{businessId:Ie.getBusinessId()},...t};return await Pt(g)},async getExecutionHistory(r,t=100){return et(async()=>{const i=r?"businessId = :businessId AND ruleId = :ruleId":"businessId = :businessId",g={":businessId":Ie.getBusinessId()};r&&(g[":ruleId"]=r);const C=await rt({query:"getEventRuleHistory",queryString:i,params:g,form:{limit:t}});return kt(C)},()=>tt.eventRules.getExecutionHistory(r,t))},async bulkToggle(r,t){return et(async()=>(await rt({query:"bulkUpdateEventRules",form:{ruleIds:r,updates:{isActive:t,updatedAt:new Date().toISOString()},businessId:Ie.getBusinessId()}}))?.bulkUpdateEventRules||{success:!1,updated:0,failed:r},()=>tt.eventRules.bulkToggle(r,t))},async exportRules(){return(await this.getAll()).map(t=>({...t,id:void 0,businessId:void 0}))},async importRules(r){return et(async()=>(await rt({query:"importEventRules",form:{rules:r.map(i=>({...i,businessId:Ie.getBusinessId()})),businessId:Ie.getBusinessId()}}))?.importEventRules||{success:!1,imported:0,failed:r.length,errors:["Import failed"]},()=>tt.eventRules.importRules(r))}};class sr{listeners=new Map;eventHistory=[];maxHistorySize=1e3;on(t,i,g){const C={id:g.id,eventTypes:Array.isArray(t)?t:[t],handler:i,priority:g.priority||100,isActive:g.isActive!==!1};return C.eventTypes.forEach(b=>{this.listeners.has(b)||this.listeners.set(b,[]);const k=this.listeners.get(b).filter(Y=>Y.id!==C.id);k.push(C),k.sort((Y,B)=>B.priority-Y.priority),this.listeners.set(b,k)}),C.id}off(t){this.listeners.forEach((i,g)=>{const C=i.filter(b=>b.id!==t);this.listeners.set(g,C)})}async emit(t){this.eventHistory.unshift(t),this.eventHistory.length>this.maxHistorySize&&(this.eventHistory=this.eventHistory.slice(0,this.maxHistorySize));const g=(this.listeners.get(t.type)||[]).filter(C=>C.isActive);for(const C of g)try{await C.handler(t)}catch(b){console.error(`Event listener ${C.id} failed for event ${t.type}:`,b)}}getHistory(t=100){return this.eventHistory.slice(0,t)}getListeners(t){if(t)return this.listeners.get(t)||[];const i=[];return this.listeners.forEach(g=>{g.forEach(C=>{i.find(b=>b.id===C.id)||i.push(C)})}),i}toggleListener(t,i){this.listeners.forEach(g=>{const C=g.find(b=>b.id===t);C&&(C.isActive=i)})}clearHistory(){this.eventHistory=[]}getStats(){const t={};let i=0;this.listeners.forEach((b,w)=>{t[w]=b.length,i+=b.length});const g=new Date(Date.now()-24*60*60*1e3),C=this.eventHistory.filter(b=>b.timestamp>g).reduce((b,w)=>{const k=b.find(Y=>Y.type===w.type);return k?k.count++:b.push({type:w.type,count:1}),b},[]);return{totalListeners:i,listenersByType:t,totalEvents:this.eventHistory.length,recentEvents:C}}}const Ht=new sr;class or{rules=new Map;auditLog=[];constructor(){Ht.on(["invoice_completed","invoice_created","invoice_updated","invoice_cancelled","payment_received","payment_refunded","inventory_received","inventory_sold","inventory_adjusted","expense_created","expense_approved","expense_paid","service_rendered","freight_processed","customs_cleared","bank_transaction_imported"],this.handleEvent.bind(this),{id:"automation_service",priority:50}),this.loadRulesFromApi()}addRule(t){const i={...t,id:`rule_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,createdAt:new Date,updatedAt:new Date};return this.rules.set(i.id,i),i.id}updateRule(t,i){const g=this.rules.get(t);if(!g)return!1;const C={...g,...i,id:t,updatedAt:new Date};return this.rules.set(t,C),!0}removeRule(t){return this.rules.delete(t)}getRules(){return Array.from(this.rules.values())}getRulesForEvent(t){return this.getRules().filter(i=>i.eventType===t&&i.isActive).sort((i,g)=>g.priority-i.priority)}async handleEvent(t){const i=this.getRulesForEvent(t.type);if(i.length===0)return;const g=[],C=[];let b=!0,w;try{for(const k of i)try{if(this.evaluateConditions(k.conditions,t)){const B=await this.createJournalEntry(k,t);g.push(k.name),C.push(B)}}catch(Y){console.error(`Error executing rule ${k.name}:`,Y),w=Y instanceof Error?Y.message:"Unknown error",b=!1}}catch(k){console.error("Error processing event automation:",k),w=k instanceof Error?k.message:"Unknown error",b=!1}this.auditLog.unshift({timestamp:new Date,eventId:t.id,eventType:t.type,rulesTriggered:g,entriesCreated:C,success:b,error:w}),this.auditLog.length>1e3&&(this.auditLog=this.auditLog.slice(0,1e3))}evaluateConditions(t,i){return t.length===0?!0:t.every(g=>{const C=this.getNestedValue(i,g.field);return this.evaluateCondition(C,g)})}evaluateCondition(t,i){const{operator:g,value:C,dataType:b}=i,w=this.convertValue(t,b),k=this.convertValue(C,b);switch(g){case"equals":return w===k;case"notEquals":return w!==k;case"greaterThan":return w>k;case"lessThan":return w<k;case"greaterThanOrEqual":return w>=k;case"lessThanOrEqual":return w<=k;case"contains":return String(w).toLowerCase().includes(String(k).toLowerCase());case"notContains":return!String(w).toLowerCase().includes(String(k).toLowerCase());case"in":return Array.isArray(k)&&k.includes(w);case"notIn":return Array.isArray(k)&&!k.includes(w);case"exists":return t!=null;case"notExists":return t==null;default:return!1}}convertValue(t,i){if(t==null)return t;switch(i){case"number":return Number(t);case"string":return String(t);case"boolean":return!!t;case"date":return new Date(t);case"array":return Array.isArray(t)?t:[t];default:return t}}async createJournalEntry(t,i){const{journalEntryTemplate:g}=t,C=this.processTemplate(g.description,i),b=this.processTemplate(g.reference,i),w=[];for(const S of g.lines){if(S.conditions&&S.conditions.length>0&&!this.evaluateConditions(S.conditions,i))continue;const G=this.evaluateAmountExpression(S.amountExpression,i);if(G===0)continue;const pe=this.processTemplate(S.accountExpression,i),oe=S.subAccountExpression?this.processTemplate(S.subAccountExpression,i):void 0,Pe=this.processTemplate(S.descriptionTemplate,i),xe={id:`line_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,accountId:pe,accountName:this.getAccountName(pe),subAccountId:oe,subAccountName:oe?this.getAccountName(oe):void 0,description:Pe,debitAmount:S.isDebit?G:0,creditAmount:S.isDebit?0:G,reference:b};w.push(xe)}if(w.length===0)throw new Error("No valid journal entry lines generated");const k=w.reduce((S,G)=>S+G.debitAmount,0),Y=w.reduce((S,G)=>S+G.creditAmount,0);if(Math.abs(k-Y)>.01)throw new Error(`Journal entry not balanced. Debits: ${k}, Credits: ${Y}`);const B={entryNumber:Lt.getNextEntryNumber(),date:new Date().toISOString().split("T")[0],description:C,reference:b,status:"draft",createdBy:"automation",createdAt:new Date().toISOString(),totalDebit:k,totalCredit:Y,lines:w};return await Lt.addJournalEntry(B)}processTemplate(t,i){return t.replace(/\{([^}]+)\}/g,(g,C)=>{const b=this.getNestedValue(i,C);return String(b||g)})}evaluateAmountExpression(t,i){try{if(!isNaN(Number(t)))return Number(t);const g=this.getNestedValue(i,t);return Number(g)||0}catch(g){return console.error(`Error evaluating amount expression: ${t}`,g),0}}getNestedValue(t,i){return i.split(".").reduce((g,C)=>g?.[C],t)}getAccountName(t){return{1001:"Cash - Operating Account",1002:"Cash - Zelle Account",1003:"Cash - Credit Card Processing",1101:"Accounts Receivable - Customers",1102:"Accounts Receivable - Freight Charges",1201:"Inventory - Products",1202:"Inventory - Packaging Materials",1301:"Prepaid Expenses",1401:"Customs Fees Receivable",1402:"Transit Insurance Receivable",2001:"Accounts Payable",2002:"Freight Payable",2101:"Accrued Salaries",2102:"Accrued Rent",2301:"Sales Tax Payable",2302:"Customs Fees Payable",2303:"Transit Insurance Payable",3001:"Owner's Equity",3101:"Retained Earnings",4001:"Sales Revenue - Products",4101:"Service Revenue - General",4201:"Transport Service Revenue",4202:"Freight Revenue - Air",4203:"Freight Revenue - Sea",4301:"Processing Revenue - Packaging",4302:"Processing Revenue - Storage",5001:"Cost of Goods Sold - Products",5002:"Cost of Goods Sold - Packaging",5101:"Freight Expense - Air",5102:"Freight Expense - Sea",5103:"Local Transport Expense",5201:"Salaries and Wages",5202:"Rent Expense - Office",5203:"Rent Expense - Warehouse",5301:"Utilities Expense",5302:"Insurance Expense",5303:"Office Supplies",5401:"Professional Fees",5402:"Bank Fees",5403:"Credit Card Processing Fees",5501:"Vehicle Expenses",5502:"Equipment Maintenance",5601:"Depreciation Expense"}[t]||`Account ${t}`}getAuditLog(t=100){return this.auditLog.slice(0,t)}clearAuditLog(){this.auditLog=[]}exportRules(){return this.getRules()}importRules(t){this.rules.clear(),t.forEach(i=>{this.rules.set(i.id,i)})}syncRules(t){this.rules.clear(),t.forEach(i=>{this.rules.set(i.id,i)})}async loadRulesFromApi(){try{const t=await Ve.getAll();this.syncRules(t)}catch(t){console.error("Failed to load event rules from API:",t)}}testRule(t,i){const g=t.conditions.map(w=>({condition:w,result:this.evaluateCondition(this.getNestedValue(i,w.field),w)})),C=g.every(w=>w.result),b={wouldTrigger:C,conditionResults:g};if(C)try{const w=this.processTemplate(t.journalEntryTemplate.description,i),k=this.processTemplate(t.journalEntryTemplate.reference,i),Y=t.journalEntryTemplate.lines.map(B=>{const ve=this.evaluateAmountExpression(B.amountExpression,i),S=this.processTemplate(B.accountExpression,i),G=this.processTemplate(B.descriptionTemplate,i);return{accountId:S,accountName:this.getAccountName(S),description:G,debitAmount:B.isDebit?ve:0,creditAmount:B.isDebit?0:ve}});b.estimatedJournalEntry={description:w,reference:k,lines:Y}}catch(w){b.errors=[w instanceof Error?w.message:"Unknown error"]}return b}}const xt=new or,o=(r,t,i=!1,g)=>({type:r,description:t,required:i,...g}),Jt={eventType:"invoice_completed",displayName:"Invoice Completed",description:"Triggered when an invoice is marked as completed",category:"financial",dataStructure:{"data.invoice":o("string","Invoice number",!0,{example:"B47G1D-YY_8635-20250810"}),"data.description":o("string","Invoice description",!1,{example:"Customer order description"}),"data.store":o("string","Store code",!0,{example:"YY_8665"}),"data.guide":o("string","Guide number",!0,{example:"2521"}),"data.createDate":o("date","Invoice creation date",!0,{example:"2025-08-13"}),"data.type":o("string","Invoice type",!0,{example:"SALES"}),"data.isCompleted":o("boolean","Invoice completion status",!0,{example:!0}),"data.shipper_consignee.name":o("string","Full name",!0,{example:"SUCEL NUNEZ JORGE"}),"data.shipper_consignee.firstName":o("string","First name",!1,{example:"YASEL"}),"data.shipper_consignee.middleName":o("string","Middle name",!1,{example:""}),"data.shipper_consignee.lastName":o("string","Last name",!1,{example:"VASQUES JORGE"}),"data.shipper_consignee.lastName2":o("string","Second last name",!1,{example:""}),"data.shipper_consignee.phoneNumber":o("string","Primary phone number",!1,{example:"531101638"}),"data.shipper_consignee.phoneNumberS":o("string","Secondary phone number",!1,{example:""}),"data.shipper_consignee.cid":o("string","Customer ID number",!1,{example:"82072829422"}),"data.shipper_consignee.passport":o("string","Passport number",!1,{example:""}),"data.shipper_consignee.address":o("string","Full address",!1,{example:"Calle undefined"}),"data.products[0].id":o("string","Product line item ID",!1,{example:"1755310725671"}),"data.products[0].product.id":o("string","Product ID",!1,{example:"AjlXorLU63dtPDrm"}),"data.products[0].product.code":o("string","Product code",!1,{example:"K89G06815"}),"data.products[0].product.label":o("string","Product label/name",!1,{example:"SAZON COMPLETO BADIA 7 OZ"}),"data.products[0].product.price":o("number","Product base price",!1,{format:"currency",example:0}),"data.products[0].qty":o("number","Product quantity",!1,{example:4}),"data.products[0].salePrice":o("number","Product sale price",!1,{format:"currency",example:8}),"data.products[0].total":o("number","Product line total",!1,{format:"currency",example:32}),"data.reservas[0].id":o("string","Reserva line item ID",!1,{example:"1755276669614"}),"data.reservas[0].type":o("string","Reserva type",!1,{example:"Ropa"}),"data.reservas[0].qty":o("number","Reserva quantity in lbs",!1,{example:120}),"data.reservas[0].price":o("number","Reserva price per lb",!1,{format:"currency",example:4}),"data.reservas[0].arancel":o("number","Reserva customs fee",!1,{format:"currency",example:0}),"data.reservas[0].total":o("number","Reserva line total",!1,{format:"currency",example:480}),"data.services[0].id":o("string","Service line item ID",!1,{example:"1755395460664"}),"data.services[0].type":o("string","Service type",!1,{example:"ğŸš› TransportaciÃ³n"}),"data.services[0].qty":o("number","Service quantity",!1,{example:3}),"data.services[0].price":o("number","Service base price",!1,{format:"currency",example:0}),"data.services[0].arancel":o("number","Service fee per unit",!1,{format:"currency",example:20}),"data.services[0].total":o("number","Service line total",!1,{format:"currency",example:60}),"data.packagesOrder":o("boolean","Is packages order",!1,{example:!1}),"data.shippingMethod":o("string","Shipping method",!0,{example:"AEREO",options:[{value:"AEREO",label:"Air"},{value:"MARITIMO",label:"Maritime"}]}),"data.paymentMethods.taxOnTotal":o("boolean","Tax applied on total",!1,{example:!1}),"data.paymentMethods.taxPercent":o("number","Tax percentage",!1,{example:7}),"data.paymentMethods.exemptTaxOnCash":o("boolean","Cash payment tax exempt",!1,{example:!0}),"data.paymentMethods.cash":o("number","Cash payment amount",!1,{format:"currency",example:300}),"data.paymentMethods.zelle":o("number","Zelle payment amount",!1,{format:"currency",example:292}),"data.paymentMethods.creditCard":o("number","Credit card payment amount",!1,{format:"currency",example:0}),"data.businessId":o("string","Business ID",!0,{example:"YB100423253156428"}),"data.ssg_inventory_key":o("string","Inventory system key",!1,{example:"INVOICE-1755395719878"}),"data.ssg_sorder_key":o("string","Sales order key",!1,{example:"SO-1755395719878"}),"data.referenceHId":o("string","Reference hash ID",!1,{example:"xxhdlfvvmgvsn87q_1755395721386"}),"data.productSubtotal":o("number","Products subtotal",!0,{format:"currency",example:32}),"data.reservaSubtotal":o("number","Reservas subtotal",!0,{format:"currency",example:480}),"data.serviceSubtotal":o("number","Services subtotal",!0,{format:"currency",example:60}),"data.transportTotal":o("number","Transporte subtotal",!0,{format:"currency",example:20}),"data.subtotalBeforeTax":o("number","Subtotal before tax",!0,{format:"currency",example:572}),"data.taxAmount":o("number","Total tax amount",!0,{format:"currency",example:19.75}),"data.taxSavings":o("number","Tax savings amount",!1,{format:"currency",example:20.29}),"data.total":o("number","Final total amount",!0,{format:"currency",example:591.75}),"data.taxCalculationMethod":o("string","Tax calculation method",!1,{example:"subtotal"}),"data.cashPaymentRatio":o("number","Cash payment ratio",!1,{example:.51})},examples:[{name:"Cash Sale Invoice",description:"Invoice paid entirely in cash",sampleData:{invoice:"INV-2024-001",customerId:"CUST-001",customerName:"ABC Corporation",totalAmount:1500,subtotalAmount:1300,taxAmount:200,paymentMethods:{cash:1500,zelle:0,creditCard:0,check:0,bankTransfer:0},currency:"USD",status:"completed"}},{name:"Mixed Payment Invoice",description:"Invoice with cash and Zelle payments",sampleData:{invoice:"INV-2024-002",customerId:"CUST-002",customerName:"XYZ Inc",totalAmount:2e3,subtotalAmount:1800,taxAmount:200,paymentMethods:{cash:1200,zelle:800,creditCard:0,check:0,bankTransfer:0},currency:"USD",status:"completed"}}]},lr={eventType:"payment_received",displayName:"Payment Received",description:"Triggered when a payment is received from a customer",category:"financial",dataStructure:{"data.paymentId":o("string","Payment ID",!0,{example:"PAY-2024-001"}),"data.invoiceId":o("string","Related invoice ID",!1,{example:"INV-2024-001"}),"data.customerId":o("string","Customer ID",!0),"data.customerName":o("string","Customer name",!0,{example:"ABC Corporation"}),"data.amount":o("number","Payment amount",!0,{format:"currency",example:1500}),"data.paymentMethod":o("string","Payment method",!0,{options:[{value:"cash",label:"Cash"},{value:"zelle",label:"Zelle"},{value:"creditCard",label:"Credit Card"},{value:"check",label:"Check"},{value:"bankTransfer",label:"Bank Transfer"}],example:"cash"}),"data.currency":o("string","Currency code",!0,{example:"USD"}),"data.exchangeRate":o("number","Exchange rate",!1,{example:1}),"data.reference":o("string","Payment reference",!0,{example:"REF-001"}),"data.bankAccount":o("string","Bank account used",!1,{example:"BOA-Checking-001"}),"data.depositDate":o("date","Date payment was deposited",!1,{format:"date",example:"2024-01-15"})},examples:[{name:"Cash Payment",description:"Cash payment for an invoice",sampleData:{paymentId:"PAY-2024-001",invoiceId:"INV-2024-001",customerId:"CUST-001",customerName:"ABC Corporation",amount:1500,paymentMethod:"cash",currency:"USD",reference:"CASH-001"}}]},Ot={eventType:"inventory_received",displayName:"Inventory Received",description:"Triggered when inventory is received from suppliers",category:"inventory",dataStructure:{"data.movementId":o("string","Movement ID",!0,{example:"MOV-2024-001"}),"data.productId":o("string","Product ID",!0,{example:"PROD-001"}),"data.productName":o("string","Product name",!0,{example:"Widget A"}),"data.sku":o("string","Product SKU",!0,{example:"WID-A-001"}),"data.category":o("string","Product category",!0,{example:"Electronics"}),"data.quantity":o("number","Quantity received",!0,{example:100}),"data.unitCost":o("number","Cost per unit",!0,{format:"currency",example:25}),"data.totalCost":o("number","Total cost",!0,{format:"currency",example:2500}),"data.supplierId":o("string","Supplier ID",!1,{example:"SUPP-001"}),"data.supplierName":o("string","Supplier name",!1,{example:"Acme Supplies"}),"data.purchaseOrderId":o("string","Purchase order ID",!1,{example:"PO-2024-001"}),"data.warehouseLocation":o("string","Warehouse location",!0,{example:"WH-A-001"}),"data.movementType":o("string","Type of movement",!0,{options:[{value:"purchase",label:"Purchase"},{value:"sale",label:"Sale"},{value:"adjustment",label:"Adjustment"},{value:"transfer",label:"Transfer"}],example:"purchase"})},examples:[{name:"Product Purchase",description:"Products received from supplier",sampleData:{movementId:"MOV-2024-001",productId:"PROD-001",productName:"Widget A",sku:"WID-A-001",category:"Electronics",quantity:100,unitCost:25,totalCost:2500,supplierId:"SUPP-001",supplierName:"Acme Supplies",movementType:"purchase"}}]},Mt={eventType:"expense_created",displayName:"Expense Created",description:"Triggered when a new expense is created",category:"financial",dataStructure:{"data.expenseId":o("string","Expense ID",!0,{example:"EXP-2024-001"}),"data.category":o("string","Expense category",!0,{options:[{value:"office_supplies",label:"Office Supplies"},{value:"travel",label:"Travel"},{value:"utilities",label:"Utilities"},{value:"rent",label:"Rent"},{value:"equipment",label:"Equipment"},{value:"marketing",label:"Marketing"},{value:"professional_services",label:"Professional Services"}],example:"office_supplies"}),"data.subcategory":o("string","Expense subcategory",!1,{example:"Stationery"}),"data.description":o("string","Expense description",!0,{example:"Office supplies from Staples"}),"data.amount":o("number","Expense amount",!0,{format:"currency",example:250}),"data.currency":o("string","Currency code",!0,{example:"USD"}),"data.vendorId":o("string","Vendor ID",!1,{example:"VEND-001"}),"data.vendorName":o("string","Vendor name",!1,{example:"Staples Inc"}),"data.employeeId":o("string","Employee ID",!1,{example:"EMP-001"}),"data.employeeName":o("string","Employee name",!1,{example:"John Doe"}),"data.departmentId":o("string","Department ID",!1,{example:"DEPT-001"}),"data.departmentName":o("string","Department name",!1,{example:"Administration"}),"data.paymentMethod":o("string","Payment method",!0,{options:[{value:"cash",label:"Cash"},{value:"check",label:"Check"},{value:"creditCard",label:"Credit Card"},{value:"bankTransfer",label:"Bank Transfer"}],example:"creditCard"}),"data.reference":o("string","Reference number",!0,{example:"REF-001"}),"data.receiptAttached":o("boolean","Receipt attached",!1,{example:!0})},examples:[{name:"Office Supplies Expense",description:"Office supplies purchased with credit card",sampleData:{expenseId:"EXP-2024-001",category:"office_supplies",description:"Office supplies from Staples",amount:250,currency:"USD",vendorName:"Staples Inc",paymentMethod:"creditCard",reference:"CC-001",receiptAttached:!0}}]},ir={eventType:"service_rendered",displayName:"Service Rendered",description:"Triggered when a service is completed for a customer",category:"operational",dataStructure:{"data.serviceId":o("string","Service ID",!0,{example:"SRV-2024-001"}),"data.serviceType":o("string","Type of service",!0,{options:[{value:"transport",label:"Transportation"},{value:"packaging",label:"Packaging"},{value:"storage",label:"Storage"},{value:"customs",label:"Customs Clearance"},{value:"processing",label:"Processing"},{value:"other",label:"Other"}],example:"transport"}),"data.description":o("string","Service description",!0,{example:"Transportation from Miami to NYC"}),"data.customerId":o("string","Customer ID",!0,{example:"CUST-001"}),"data.customerName":o("string","Customer name",!0,{example:"ABC Corporation"}),"data.amount":o("number","Service amount",!0,{format:"currency",example:500}),"data.currency":o("string","Currency code",!0,{example:"USD"}),"data.quantity":o("number","Service quantity",!1,{example:1}),"data.unitPrice":o("number","Price per unit",!1,{format:"currency",example:500}),"data.invoiceId":o("string","Related invoice ID",!1,{example:"INV-2024-001"}),"data.reference":o("string","Service reference",!0,{example:"TRANS-001"}),"data.serviceDate":o("date","Date service was performed",!0,{format:"date",example:"2024-01-15"}),"data.location":o("string","Service location",!1,{example:"Miami, FL"}),"data.weight":o("number","Weight (if applicable)",!1,{example:150.5}),"data.trackingNumber":o("string","Tracking number",!1,{example:"TRK-123456"})},examples:[{name:"Transportation Service",description:"Freight transportation service",sampleData:{serviceId:"SRV-2024-001",serviceType:"transport",description:"Transportation from Miami to NYC",customerId:"CUST-001",customerName:"ABC Corporation",amount:500,currency:"USD",reference:"TRANS-001",serviceDate:"2024-01-15",weight:150.5}}]},ar={...Jt,eventType:"invoice_created",displayName:"Invoice Created",description:"Triggered when a new invoice is created"},dr={invoice_completed:Jt,invoice_created:ar,payment_received:lr,inventory_received:Ot,inventory_sold:Ot,expense_created:Mt,expense_approved:Mt,service_rendered:ir},Ft=r=>dr[r]||null,cr=r=>{const t=Ft(r);return t?Object.entries(t.dataStructure).map(([i,g])=>({path:i,definition:g})):[]};var ur=x("<span>e.g., "),pr=x("<p>"),mr=x("<div><div><code></code><span>"),yr=x("<span>"),gr=x("<span>Click to insert"),vr=x('<div><input type=text placeholder="Search fields...">'),fr=x("<div><p>Click to insert common expressions"),br=x("<div><p>Click to insert function templates"),hr=x("<div><div><button>ğŸ“‹ Fields</button><button>ğŸ§® Expressions</button><button>ğŸ”§ Functions</button></div><div>"),Pr=x("<div><p>ğŸ“‹ No fields available</p><p>Select an event type to see available data fields"),xr=x("<div><div></div><code></code><p>"),$r=x("<div><h4>"),_r=x("<div><code></code><span>- ");const Cr=r=>{const[t,i]=ye(new Set(["data","custom","data.shipper_consignee","data.products[0]","data.products[0].product","data.reservas[0]","data.services[0]","data.paymentMethods"])),[g,C]=ye(""),[b,w]=ye("fields"),k=it(()=>{if(!r.eventType)return[];const a=Ft(r.eventType);if(!a)return[];const R=(n=>{const s={};Object.entries(n).forEach(([O,W])=>{const u=O.split(".");let y=s;for(let p=0;p<u.length;p++){const E=u[p];p===u.length-1?y[E]={_definition:W,_path:O}:(!y[E]||y[E]._definition)&&(y[E]={}),y=y[E]}});const j=(O,W="")=>{const u=[];return Object.entries(O).forEach(([y,p])=>{if(p._definition){const E={path:p._path,name:y.replace(/\[\d+\]/,"[0]"),type:p._definition.type,description:p._definition.description||"",example:p._definition.example};u.push(E)}else if(typeof p=="object"&&p!==null){const E=j(p,W?`${W}.${y}`:y);if(E.length>0){const h={path:W?`${W}.${y}`:y,name:y.replace(/\[\d+\]/,"[0]"),type:"object",description:`${y.charAt(0).toUpperCase()+y.slice(1)} fields`,children:E};u.push(h)}}}),u.sort((y,p)=>y.children&&!p.children?-1:!y.children&&p.children?1:y.name.localeCompare(p.name))};return j(s)})(a.dataStructure);if(R.length===0)return[{path:"data",name:"data",type:"object",description:"Event data fields",children:Object.entries(a.dataStructure).map(([j,O])=>({path:j,name:j.replace("data.",""),type:O.type,description:O.description||"",example:O.example}))}];const D=R.find(n=>n.name==="data"),_=[];D&&_.push(D);const F=(r.customFields||[]).map(n=>({path:`custom.${n.name}`,name:n.name,type:"expression",description:n.description||`Custom field: ${n.expression}`,example:n.expression}));if(F.length>0){const n={path:"custom",name:"custom",type:"object",description:"Custom fields defined for this rule",children:F};_.push(n)}return _}),Y=it(()=>{const a=g().toLowerCase();if(!a)return k();const $=R=>R.reduce((D,_)=>{if(_.path.toLowerCase().includes(a)||_.name.toLowerCase().includes(a)||_.description.toLowerCase().includes(a))D.push(_);else if(_.children){const n=$(_.children);n.length>0&&D.push({..._,children:n})}return D},[]);return $(k())}),B=it(()=>{const a=[{name:"Conditional Amount",expression:"data.amount > 1000 ? data.amount * 0.95 : data.amount",description:"Apply 5% discount if amount > 1000"},{name:"Formatted Reference",expression:'"REF-" + data.invoice + "-" + new Date().getFullYear()',description:"Create formatted reference with year"},{name:"Percentage Calculation",expression:"data.totalAmount * 0.18",description:"Calculate 18% of total amount"}];return r.eventType==="invoice_completed"&&a.push({name:"Total Payments",expression:"data.paymentMethods.cash + data.paymentMethods.zelle + data.paymentMethods.creditCard",description:"Sum all payment methods"},{name:"Net Amount",expression:"data.totalAmount - data.taxAmount",description:"Total minus tax"}),a}),ve=[{name:"Math Functions",items:[{name:"Math.round()",description:"Round to nearest integer"},{name:"Math.floor()",description:"Round down"},{name:"Math.ceil()",description:"Round up"},{name:"Math.abs()",description:"Absolute value"},{name:"Math.min(a, b)",description:"Minimum of two values"},{name:"Math.max(a, b)",description:"Maximum of two values"}]},{name:"String Functions",items:[{name:".toUpperCase()",description:"Convert to uppercase"},{name:".toLowerCase()",description:"Convert to lowercase"},{name:".substring(0, 10)",description:"Extract substring"},{name:'.replace("old", "new")',description:"Replace text"},{name:".trim()",description:"Remove whitespace"}]},{name:"Date Functions",items:[{name:"new Date()",description:"Current date"},{name:"new Date().getFullYear()",description:"Current year"},{name:"new Date().getMonth() + 1",description:"Current month"},{name:"new Date().getDate()",description:"Current day"}]}],S=a=>{i($=>{const R=new Set($);return R.has(a)?R.delete(a):R.add(a),R})},G=a=>{r.onFieldSelect(a.path,a.type)},pe=a=>{r.onExpressionInsert(a)},oe={"background-color":"white",border:"1px solid #d1d5db","border-radius":"0.5rem","box-shadow":"0 10px 15px -3px rgba(0, 0, 0, 0.1)","max-height":"500px",display:"flex","flex-direction":"column"},Pe=a=>({padding:"0.75rem 1rem","background-color":a?"white":"#f9fafb",border:"none","border-bottom":a?"2px solid #3b82f6":"2px solid transparent",cursor:"pointer","font-weight":a?"600":"500",color:a?"#1f2937":"#6b7280","font-size":"0.875rem",flex:"1"}),xe={padding:"0.75rem","border-bottom":"1px solid #e5e7eb"},de={flex:"1","overflow-y":"auto",padding:"0.75rem"},me={"margin-bottom":"0.25rem"},Le={display:"flex","align-items":"center",padding:"0.5rem",cursor:"pointer","border-radius":"0.375rem","font-size":"0.875rem"},Fe=a=>({"font-size":"0.7rem",padding:"0.125rem 0.375rem","border-radius":"0.25rem","margin-left":"0.5rem","font-weight":"500","background-color":a==="number"?"#dbeafe":a==="string"?"#d1fae5":a==="boolean"?"#fef3c7":a==="object"?"#e0e7ff":"#f3f4f6",color:a==="number"?"#1e40af":a==="string"?"#065f46":a==="boolean"?"#92400e":a==="object"?"#4338ca":"#374151"}),Ce=a=>{const $=a.node.children&&a.node.children.length>0,R=t().has(a.node.path);return(()=>{var D=mr(),_=D.firstChild,F=_.firstChild,n=F.nextSibling;return m(D,me),_.addEventListener("mouseleave",s=>s.currentTarget.style.backgroundColor="transparent"),_.addEventListener("mouseenter",s=>s.currentTarget.style.backgroundColor="#f3f4f6"),_.$$click=()=>$?S(a.node.path):G(a.node),e(_,$&&(()=>{var s=yr();return s.style.setProperty("margin-right","0.5rem"),s.style.setProperty("font-size","0.75rem"),e(s,R?"â–¼":"â–¶"),s})(),F),F.style.setProperty("font-family","monospace"),F.style.setProperty("color","#059669"),F.style.setProperty("font-weight","600"),e(F,()=>a.node.name),e(n,()=>a.node.type),e(_,c(I,{get when(){return a.node.example!==void 0},get children(){var s=ur();return s.firstChild,s.style.setProperty("font-size","0.7rem"),s.style.setProperty("color","#6b7280"),s.style.setProperty("margin-left","0.5rem"),s.style.setProperty("font-style","italic"),e(s,()=>JSON.stringify(a.node.example),null),s}}),null),e(_,!$&&(()=>{var s=gr();return s.style.setProperty("margin-left","auto"),s.style.setProperty("font-size","0.7rem"),s.style.setProperty("color","#9ca3af"),s})(),null),e(D,c(I,{get when(){return a.node.description},get children(){var s=pr();return s.style.setProperty("font-size","0.75rem"),s.style.setProperty("color","#6b7280"),s.style.setProperty("margin-top","0.125rem"),s.style.setProperty("margin-bottom","0.5rem"),e(s,()=>a.node.description),A(j=>(j=`${a.level*1.5+2}rem`)!=null?s.style.setProperty("margin-left",j):s.style.removeProperty("margin-left")),s}}),null),e(D,c(I,{when:$&&R,get children(){return c(ue,{get each(){return a.node.children},children:s=>c(Ce,{node:s,get level(){return a.level+1}})})}}),null),A(s=>{var j={...Le,"padding-left":`${a.level*1.5+.5}rem`},O=Fe(a.node.type);return s.e=m(_,j,s.e),s.t=m(n,O,s.t),s},{e:void 0,t:void 0}),D})()};return(()=>{var a=hr(),$=a.firstChild,R=$.firstChild,D=R.nextSibling,_=D.nextSibling,F=$.nextSibling;return $.style.setProperty("display","flex"),$.style.setProperty("border-bottom","1px solid #e5e7eb"),R.$$click=()=>w("fields"),D.$$click=()=>w("expressions"),_.$$click=()=>w("functions"),e(a,c(I,{get when(){return b()==="fields"},get children(){var n=vr(),s=n.firstChild;return m(n,xe),s.$$input=j=>C(j.currentTarget.value),s.style.setProperty("width","100%"),s.style.setProperty("padding","0.5rem"),s.style.setProperty("border","1px solid #d1d5db"),s.style.setProperty("border-radius","0.375rem"),s.style.setProperty("font-size","0.875rem"),A(()=>s.value=g()),n}}),F),e(F,c(I,{get when(){return b()==="fields"},get children(){return c(I,{get when(){return Y().length>0},get fallback(){return(()=>{var n=Pr(),s=n.firstChild,j=s.nextSibling;return n.style.setProperty("padding","2rem"),n.style.setProperty("text-align","center"),n.style.setProperty("color","#6b7280"),s.style.setProperty("margin-bottom","0.5rem"),j.style.setProperty("font-size","0.75rem"),n})()},get children(){return c(ue,{get each(){return Y()},children:n=>c(Ce,{node:n,level:0})})}})}}),null),e(F,c(I,{get when(){return b()==="expressions"},get children(){var n=fr(),s=n.firstChild;return s.style.setProperty("font-size","0.875rem"),s.style.setProperty("color","#6b7280"),s.style.setProperty("margin-bottom","1rem"),e(n,c(ue,{get each(){return B()},children:j=>(()=>{var O=xr(),W=O.firstChild,u=W.nextSibling,y=u.nextSibling;return O.addEventListener("mouseleave",p=>p.currentTarget.style.backgroundColor="#f9fafb"),O.addEventListener("mouseenter",p=>p.currentTarget.style.backgroundColor="#f3f4f6"),O.$$click=()=>pe(j.expression),O.style.setProperty("padding","0.75rem"),O.style.setProperty("background-color","#f9fafb"),O.style.setProperty("border-radius","0.375rem"),O.style.setProperty("margin-bottom","0.5rem"),O.style.setProperty("cursor","pointer"),W.style.setProperty("font-weight","600"),W.style.setProperty("margin-bottom","0.25rem"),e(W,()=>j.name),u.style.setProperty("font-family","monospace"),u.style.setProperty("font-size","0.875rem"),u.style.setProperty("color","#059669"),u.style.setProperty("display","block"),u.style.setProperty("margin-bottom","0.25rem"),e(u,()=>j.expression),y.style.setProperty("font-size","0.75rem"),y.style.setProperty("color","#6b7280"),y.style.setProperty("margin","0"),e(y,()=>j.description),O})()}),null),n}}),null),e(F,c(I,{get when(){return b()==="functions"},get children(){var n=br(),s=n.firstChild;return s.style.setProperty("font-size","0.875rem"),s.style.setProperty("color","#6b7280"),s.style.setProperty("margin-bottom","1rem"),e(n,c(ue,{each:ve,children:j=>(()=>{var O=$r(),W=O.firstChild;return O.style.setProperty("margin-bottom","1.5rem"),W.style.setProperty("font-weight","600"),W.style.setProperty("margin-bottom","0.5rem"),W.style.setProperty("color","#1f2937"),e(W,()=>j.name),e(O,c(ue,{get each(){return j.items},children:u=>(()=>{var y=_r(),p=y.firstChild,E=p.nextSibling;return E.firstChild,y.addEventListener("mouseleave",h=>h.currentTarget.style.backgroundColor="transparent"),y.addEventListener("mouseenter",h=>h.currentTarget.style.backgroundColor="#f3f4f6"),y.$$click=()=>pe(u.name),y.style.setProperty("padding","0.5rem"),y.style.setProperty("cursor","pointer"),y.style.setProperty("border-radius","0.375rem"),p.style.setProperty("font-family","monospace"),p.style.setProperty("color","#6366f1"),p.style.setProperty("font-weight","600"),e(p,()=>u.name),E.style.setProperty("font-size","0.75rem"),E.style.setProperty("color","#6b7280"),E.style.setProperty("margin-left","0.5rem"),e(E,()=>u.description,null),y})()}),null),O})()}),null),n}}),null),A(n=>{var s=oe,j=Pe(b()==="fields"),O=Pe(b()==="expressions"),W=Pe(b()==="functions"),u=de;return n.e=m(a,s,n.e),n.t=m(R,j,n.t),n.a=m(D,O,n.a),n.o=m(_,W,n.o),n.i=m(F,u,n.i),n},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),a})()};at(["click","input"]);var Sr=x("<span>*"),Tr=x("<button type=button><span>+"),wr=x("<button type=button><span>âˆ’"),Ar=x("<button type=button><span>Ã—"),Er=x("<button type=button><span>Ã·"),kr=x("<button type=button><span>( )"),Ir=x("<button type=button><span>ğŸ‘ï¸</span><span>Preview"),Fr=x("<p>ğŸ’¡ "),Dr=x("<div><p>Preview:</p><p>"),qt=x("<div>"),Rr=x("<div><label></label><div><textarea></textarea><div><button type=button><span>ğŸ“‹</span><span>Insert Field");const je=r=>{const[t,i]=ye(!1),[g,C]=ye(0),[b,w]=ye(null),[k,Y]=ye(!1);Gt(()=>{const a=b();if(a){const $=()=>{C(a.selectionStart||0)};return a.addEventListener("click",$),a.addEventListener("keyup",$),()=>{a.removeEventListener("click",$),a.removeEventListener("keyup",$)}}});const B=(a,$)=>{S(a),i(!1)},ve=a=>{S(a),i(!1)},S=a=>{const $=r.value,R=g(),D=$.substring(0,R),_=$.substring(R);let F=a;r.type==="template"&&a.startsWith("data.")&&!a.includes("{")&&(F=`{${a}}`);const n=D+F+_;r.onChange(n);const s=R+F.length;C(s);const j=b();j&&(j.focus(),setTimeout(()=>{j.setSelectionRange(s,s)},0))},G=()=>{if(r.type!=="template")return"";let a=r.value;const $=/\{([^}]+)\}/g;return a=a.replace($,(R,D)=>D.includes("amount")||D.includes("total")?"$1,234.56":D.includes("customer")?"John Doe":D.includes("invoice")?"INV-2024-001":D.includes("date")?"2024-01-15":"<value>"),a},pe={width:"100%",position:"relative"},oe={display:"block","font-weight":"500","margin-bottom":"0.5rem","font-size":"0.875rem"},Pe={position:"relative"},xe={width:"100%",padding:"0.75rem",border:"1px solid #d1d5db","border-radius":"0.375rem","font-size":"0.875rem","font-family":"inherit",resize:"vertical","min-height":r.type==="expression"?"80px":"60px"},de={display:"flex",gap:"0.5rem","margin-top":"0.5rem","flex-wrap":"wrap"},me={padding:"0.375rem 0.75rem","background-color":"#f3f4f6",color:"#374151",border:"1px solid #d1d5db","border-radius":"0.375rem",cursor:"pointer","font-size":"0.75rem","font-weight":"500",display:"flex","align-items":"center",gap:"0.25rem"},Le={"margin-top":"0.5rem",padding:"0.75rem","background-color":"#f0fdf4",border:"1px solid #bbf7d0","border-radius":"0.375rem"},Fe={"font-size":"0.75rem",color:"#6b7280","margin-top":"0.25rem"},Ce={position:"absolute",top:"100%",left:"0",right:"0","margin-top":"0.5rem","z-index":"50"};return(()=>{var a=Rr(),$=a.firstChild,R=$.nextSibling,D=R.firstChild,_=D.nextSibling,F=_.firstChild;return m($,oe),e($,()=>r.label,null),e($,c(I,{get when(){return r.required},get children(){var n=Sr();return n.style.setProperty("color","#ef4444"),n.style.setProperty("margin-left","0.25rem"),n}}),null),D.addEventListener("change",n=>r.onChange(n.currentTarget.value)),Zt(w,D),F.addEventListener("mouseleave",n=>n.currentTarget.style.backgroundColor="#f3f4f6"),F.addEventListener("mouseenter",n=>n.currentTarget.style.backgroundColor="#e5e7eb"),F.$$click=()=>i(!t()),e(_,c(I,{get when(){return r.type==="expression"},get children(){return[(()=>{var n=Tr();return n.addEventListener("mouseleave",s=>s.currentTarget.style.backgroundColor="#f3f4f6"),n.addEventListener("mouseenter",s=>s.currentTarget.style.backgroundColor="#e5e7eb"),n.$$click=()=>S(" + "),A(s=>m(n,me,s)),n})(),(()=>{var n=wr();return n.addEventListener("mouseleave",s=>s.currentTarget.style.backgroundColor="#f3f4f6"),n.addEventListener("mouseenter",s=>s.currentTarget.style.backgroundColor="#e5e7eb"),n.$$click=()=>S(" - "),A(s=>m(n,me,s)),n})(),(()=>{var n=Ar();return n.addEventListener("mouseleave",s=>s.currentTarget.style.backgroundColor="#f3f4f6"),n.addEventListener("mouseenter",s=>s.currentTarget.style.backgroundColor="#e5e7eb"),n.$$click=()=>S(" * "),A(s=>m(n,me,s)),n})(),(()=>{var n=Er();return n.addEventListener("mouseleave",s=>s.currentTarget.style.backgroundColor="#f3f4f6"),n.addEventListener("mouseenter",s=>s.currentTarget.style.backgroundColor="#e5e7eb"),n.$$click=()=>S(" / "),A(s=>m(n,me,s)),n})(),(()=>{var n=kr();return n.addEventListener("mouseleave",s=>s.currentTarget.style.backgroundColor="#f3f4f6"),n.addEventListener("mouseenter",s=>s.currentTarget.style.backgroundColor="#e5e7eb"),n.$$click=()=>S("()"),A(s=>m(n,me,s)),n})()]}}),null),e(_,c(I,{get when(){return r.type==="template"&&r.value},get children(){var n=Ir();return n.addEventListener("mouseleave",s=>s.currentTarget.style.backgroundColor="#f3f4f6"),n.addEventListener("mouseenter",s=>s.currentTarget.style.backgroundColor="#e5e7eb"),n.$$click=()=>Y(!k()),A(s=>m(n,me,s)),n}}),null),e(R,c(I,{get when(){return r.helpText},get children(){var n=Fr();return n.firstChild,m(n,Fe),e(n,()=>r.helpText,null),n}}),null),e(R,c(I,{get when(){return k()&&r.type==="template"},get children(){var n=Dr(),s=n.firstChild,j=s.nextSibling;return m(n,Le),s.style.setProperty("font-size","0.75rem"),s.style.setProperty("font-weight","600"),s.style.setProperty("margin-bottom","0.25rem"),j.style.setProperty("font-size","0.875rem"),j.style.setProperty("color","#065f46"),e(j,()=>G()||"No preview available"),n}}),null),e(R,c(I,{get when(){return t()},get children(){var n=qt();return e(n,c(Cr,{get eventType(){return r.eventType},onFieldSelect:B,onExpressionInsert:ve,get currentValue(){return r.value},get cursorPosition(){return g()},get customFields(){return r.customFields}})),A(s=>m(n,Ce,s)),n}}),null),e(R,c(I,{get when(){return t()},get children(){var n=qt();return n.$$click=()=>i(!1),n.style.setProperty("position","fixed"),n.style.setProperty("top","0"),n.style.setProperty("left","0"),n.style.setProperty("right","0"),n.style.setProperty("bottom","0"),n.style.setProperty("z-index","40"),n}}),null),A(n=>{var s=pe,j=Pe,O=r.placeholder,W=xe,u=r.type==="expression"?3:2,y=de,p=me;return n.e=m(a,s,n.e),n.t=m(R,j,n.t),O!==n.a&&Ze(D,"placeholder",n.a=O),n.o=m(D,W,n.o),u!==n.i&&Ze(D,"rows",n.i=u),n.n=m(_,y,n.n),n.s=m(F,p,n.s),n},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0}),A(()=>D.value=r.value),a})()};at(["click"]);var Nr=x('<div><span>ğŸ’¡</span><p><strong>Note:</strong> Remember to click the "Save" or "Update" button at the bottom of the form to persist all custom field changes.'),zr=x("<div><h4>Create New Custom Field</h4><div><div></div><div><div><p>ğŸ’¡ Quick templates:</p><div></div></div></div><div></div><div><button>Cancel</button><button>Create Field"),jr=x("<div><p>No custom fields created yet</p><p>Create custom fields to combine multiple interface fields into reusable expressions"),Lr=x("<div><div><div><h3>ğŸ› ï¸ Custom Fields</h3><p>Create custom expressions by combining interface fields</p></div><button>+ Add Custom Field</button></div><div>"),Or=x("<button type=button>"),Mr=x("<div><h4>Edit Custom Field</h4><div><div></div><div></div><div></div></div><div><button>Cancel</button><button>Update Field"),qr=x("<div>"),Br=x("<p>"),Ur=x("<div><div><div><h4></h4><span>custom field</span></div><div><code></code></div></div><div><button>Edit</button><button>Remove");const Vr=r=>{It();const[t,i]=ye(!1),[g,C]=ye(null),[b,w]=ye(null),[k,Y]=ye({name:"",expression:"",description:""}),B=()=>{const _=k();_.name.trim()&&_.expression.trim()&&(r.onAdd(_),Y({name:"",expression:"",description:""}),i(!1))},ve=_=>{Y(F=>({...F,expression:_}))},S=_=>{Y(F=>({...F,name:_}))},G=_=>{Y(F=>({...F,description:_}))},pe=_=>{C(_.id),w({..._})},oe=()=>{C(null),w(null)},Pe=()=>{const _=b(),F=g();_&&F&&(r.onUpdate(F,{name:_.name,expression:_.expression,description:_.description}),C(null),w(null))},xe=(_,F)=>{w(n=>n?{...n,[_]:F}:null)},de=_=>{Y(F=>({...F,expression:_}))},me=[{label:"Total with Tax",expression:"data.subtotalAmount + data.taxAmount",description:"Subtotal plus tax amount"},{label:"Total Payments",expression:"data.paymentMethods.cash + data.paymentMethods.zelle + data.paymentMethods.creditCard",description:"Sum of all payment methods"},{label:"Customer Info",expression:'data.customerName + " (" + data.customerId + ")"',description:"Customer name with ID"},{label:"Invoice Reference",expression:'"Invoice " + data.invoice + " - " + data.customerName',description:"Complete invoice reference"}],Le={border:"1px solid #d1d5db","border-radius":"0.5rem","background-color":"#f9fafb",padding:"1.5rem"},Fe={display:"flex","justify-content":"space-between","align-items":"center","margin-bottom":"1.5rem"},Ce={padding:"0.5rem 1rem","background-color":"#3b82f6",color:"white",border:"none","border-radius":"0.375rem",cursor:"pointer","font-weight":"500","font-size":"0.875rem"},a={...Ce,"background-color":"#6b7280"},$={...Ce,"background-color":"#ef4444"},R={"background-color":"white",border:"1px solid #e5e7eb","border-radius":"0.375rem",padding:"1rem","margin-bottom":"1rem"},D={"background-color":"white",border:"1px solid #d1d5db","border-radius":"0.375rem",padding:"1.5rem","margin-bottom":"1.5rem"};return(()=>{var _=Lr(),F=_.firstChild,n=F.firstChild,s=n.firstChild,j=s.nextSibling,O=n.nextSibling,W=F.nextSibling;return m(_,Le),m(F,Fe),s.style.setProperty("font-size","1.125rem"),s.style.setProperty("font-weight","600"),s.style.setProperty("margin","0 0 0.25rem 0"),j.style.setProperty("font-size","0.875rem"),j.style.setProperty("color","#6b7280"),j.style.setProperty("margin","0"),O.$$click=()=>i(!t()),e(_,c(I,{get when(){return r.customFields.length>0},get children(){var u=Nr(),y=u.firstChild,p=y.nextSibling;return u.style.setProperty("background-color","#fef3c7"),u.style.setProperty("border","1px solid #f59e0b"),u.style.setProperty("border-radius","0.375rem"),u.style.setProperty("padding","0.75rem"),u.style.setProperty("margin-bottom","1rem"),u.style.setProperty("display","flex"),u.style.setProperty("align-items","center"),u.style.setProperty("gap","0.5rem"),y.style.setProperty("font-size","1.25rem"),p.style.setProperty("font-size","0.875rem"),p.style.setProperty("color","#92400e"),p.style.setProperty("margin","0"),u}}),W),e(_,c(I,{get when(){return t()},get children(){var u=zr(),y=u.firstChild,p=y.nextSibling,E=p.firstChild,h=E.nextSibling,N=h.firstChild,M=N.firstChild,V=M.nextSibling,d=h.nextSibling,v=d.nextSibling,P=v.firstChild,f=P.nextSibling;return m(u,D),y.style.setProperty("font-size","1rem"),y.style.setProperty("font-weight","600"),y.style.setProperty("margin-bottom","1rem"),p.style.setProperty("display","grid"),p.style.setProperty("gap","1rem"),e(E,c(I,{get when(){return r.eventType},get children(){return c(je,{label:"Field Name *",get value(){return k().name},onChange:S,get eventType(){return r.eventType},placeholder:"e.g., totalWithTax, customerInfo",type:"text",helpText:"Name for your custom field (camelCase recommended)",required:!0,get customFields(){return r.customFields}})}})),e(h,c(I,{get when(){return r.eventType},get children(){return c(je,{label:"Expression *",get value(){return k().expression},onChange:ve,get eventType(){return r.eventType},placeholder:"e.g., data.subtotal + data.tax",type:"expression",helpText:"JavaScript expression using event data fields and functions",required:!0,get customFields(){return r.customFields}})}}),N),N.style.setProperty("margin-top","0.75rem"),M.style.setProperty("font-size","0.75rem"),M.style.setProperty("color","#6b7280"),M.style.setProperty("margin-bottom","0.5rem"),V.style.setProperty("display","flex"),V.style.setProperty("flex-wrap","wrap"),V.style.setProperty("gap","0.5rem"),e(V,c(ue,{each:me,children:T=>(()=>{var z=Or();return z.$$click=()=>de(T.expression),z.style.setProperty("padding","0.25rem 0.5rem"),z.style.setProperty("background-color","#f3f4f6"),z.style.setProperty("color","#374151"),z.style.setProperty("border","1px solid #d1d5db"),z.style.setProperty("border-radius","0.25rem"),z.style.setProperty("cursor","pointer"),z.style.setProperty("font-size","0.75rem"),e(z,()=>T.label),A(()=>Ze(z,"title",T.description)),z})()})),e(d,c(I,{get when(){return r.eventType},get children(){return c(je,{label:"Description",get value(){return k().description},onChange:G,get eventType(){return r.eventType},placeholder:"Describe what this field represents",type:"text",helpText:"Brief description of what this custom field calculates",get customFields(){return r.customFields}})}})),v.style.setProperty("display","flex"),v.style.setProperty("gap","0.5rem"),v.style.setProperty("justify-content","flex-end"),P.$$click=()=>i(!1),f.$$click=B,A(T=>{var z=a,se=Ce;return T.e=m(P,z,T.e),T.t=m(f,se,T.t),T},{e:void 0,t:void 0}),u}}),W),e(W,c(I,{get when(){return r.customFields.length===0},get children(){var u=jr(),y=u.firstChild,p=y.nextSibling;return u.style.setProperty("padding","3rem"),u.style.setProperty("text-align","center"),u.style.setProperty("color","#6b7280"),u.style.setProperty("background-color","white"),u.style.setProperty("border-radius","0.375rem"),u.style.setProperty("border","1px solid #e5e7eb"),y.style.setProperty("font-size","1rem"),y.style.setProperty("margin-bottom","0.5rem"),p.style.setProperty("font-size","0.875rem"),u}}),null),e(W,c(ue,{get each(){return r.customFields},children:u=>(()=>{var y=qr();return m(y,R),e(y,c(I,{get when(){return g()===u.id},get fallback(){return(()=>{var p=Ur(),E=p.firstChild,h=E.firstChild,N=h.firstChild,M=N.nextSibling,V=h.nextSibling,d=V.firstChild,v=E.nextSibling,P=v.firstChild,f=P.nextSibling;return p.style.setProperty("display","flex"),p.style.setProperty("justify-content","space-between"),p.style.setProperty("align-items","start"),E.style.setProperty("flex-grow","1"),h.style.setProperty("display","flex"),h.style.setProperty("align-items","center"),h.style.setProperty("gap","0.75rem"),h.style.setProperty("margin-bottom","0.5rem"),N.style.setProperty("font-size","1rem"),N.style.setProperty("font-weight","600"),N.style.setProperty("margin","0"),N.style.setProperty("color","#1f2937"),e(N,()=>u.name),M.style.setProperty("font-size","0.7rem"),M.style.setProperty("padding","0.125rem 0.5rem"),M.style.setProperty("background-color","#dbeafe"),M.style.setProperty("color","#1e40af"),M.style.setProperty("border-radius","0.25rem"),M.style.setProperty("font-weight","500"),V.style.setProperty("margin-bottom","0.5rem"),d.style.setProperty("font-size","0.875rem"),d.style.setProperty("color","#4b5563"),d.style.setProperty("font-family","monospace"),d.style.setProperty("background-color","#f3f4f6"),d.style.setProperty("padding","0.5rem"),d.style.setProperty("border-radius","0.25rem"),d.style.setProperty("display","block"),e(d,()=>u.expression),e(E,c(I,{get when(){return u.description},get children(){var T=Br();return T.style.setProperty("font-size","0.875rem"),T.style.setProperty("color","#6b7280"),T.style.setProperty("margin","0"),e(T,()=>u.description),T}}),null),v.style.setProperty("display","flex"),v.style.setProperty("gap","0.5rem"),P.$$click=()=>pe(u),f.$$click=()=>r.onRemove(u.id),A(T=>{var z={...a,padding:"0.5rem","font-size":"0.75rem"},se={...$,padding:"0.5rem","font-size":"0.75rem"};return T.e=m(P,z,T.e),T.t=m(f,se,T.t),T},{e:void 0,t:void 0}),p})()},get children(){var p=Mr(),E=p.firstChild,h=E.nextSibling,N=h.firstChild,M=N.nextSibling,V=M.nextSibling,d=h.nextSibling,v=d.firstChild,P=v.nextSibling;return E.style.setProperty("font-size","1rem"),E.style.setProperty("font-weight","600"),E.style.setProperty("margin-bottom","1rem"),h.style.setProperty("display","grid"),h.style.setProperty("gap","1rem"),h.style.setProperty("margin-bottom","1rem"),e(N,c(I,{get when(){return r.eventType},get children(){return c(je,{label:"Field Name *",get value(){return b()?.name||""},onChange:f=>xe("name",f),get eventType(){return r.eventType},placeholder:"e.g., totalWithTax, customerInfo",type:"text",helpText:"Name for your custom field (camelCase recommended)",required:!0,get customFields(){return r.customFields}})}})),e(M,c(I,{get when(){return r.eventType},get children(){return c(je,{label:"Expression *",get value(){return b()?.expression||""},onChange:f=>xe("expression",f),get eventType(){return r.eventType},placeholder:"e.g., data.subtotal + data.tax",type:"expression",helpText:"JavaScript expression using event data fields and functions",required:!0,get customFields(){return r.customFields}})}})),e(V,c(I,{get when(){return r.eventType},get children(){return c(je,{label:"Description",get value(){return b()?.description||""},onChange:f=>xe("description",f),get eventType(){return r.eventType},placeholder:"Describe what this field represents",type:"text",helpText:"Brief description of what this custom field calculates",get customFields(){return r.customFields}})}})),d.style.setProperty("display","flex"),d.style.setProperty("gap","0.5rem"),d.style.setProperty("justify-content","flex-end"),v.$$click=oe,P.$$click=Pe,A(f=>{var T=a,z=Ce;return f.e=m(v,T,f.e),f.t=m(P,z,f.t),f},{e:void 0,t:void 0}),p}})),y})()}),null),A(u=>m(O,Ce,u)),_})()};at(["click"]);var Hr=x("<div><p><strong>:</strong> </p><button type=button>"),$t=x("<div>"),Jr=x("<div><h5></h5><p></p><div></div><div><p>ğŸ’¡ <strong>Consejo de Uso:</strong> Copia rutas de campos como <code>data.totalAmount</code> o <code>data.customerName</code> para usar en condiciones y plantillas de asientos contables."),Wr=x("<div><h3>ğŸ“‹ Interfaz de Datos y Ejemplos</h3><div><div><h4>ğŸ“Š Campos Disponibles</h4><div></div></div><div><h4>ğŸ’¡ Ejemplos de Datos de Muestra"),Yr=x("<p> <!> events"),Gr=x("<p>"),Zr=x("<p>âš ï¸ Recuerda guardar la regla para persistir todos los cambios incluyendo campos personalizados"),Qr=x("<div><div><h2></h2><div><h3></h3><div><div><label> *</label><input type=text></div><div><label></label><input type=number min=1 max=1000></div></div><div><label> *</label><textarea></textarea></div><div><div><label> *</label><select></select></div><div><label><input type=checkbox></label></div></div></div><div><div><h3></h3><button>+ </button></div></div><div><div><h3></h3><div><button type=button></button><button></button></div></div><div><h4></h4><button>+ </button></div></div><div><div></div><div><button></button><button>"),_t=x("<option>"),Xr=x("<p>Example: <code>"),Kr=x("<div><div><code></code><span></span></div><p>"),en=x("<button type=button>"),tn=x("<div><div><div><label></label><select><option value></option></select></div><div><label></label><select></select></div><div><label></label></div><div><button>"),rn=x("<option> (<!>)"),Bt=x("<input type=text value=N/A disabled>"),nn=x("<p>ğŸ’¡ Sin condiciones = lÃ­nea siempre incluida. Agrega condiciones para insertar lÃ­nea solo cuando se cumplan criterios (ej. cantidad > 0)."),sn=x("<div><div><h5>LÃ­nea de Asiento </h5><button></button></div><div><div><label></label></div><div><label></label><select><option value=debit></option><option value=credit></option></select></div></div><div><div><h6>ğŸ”„ Condiciones de LÃ­nea (Opcional)</h6><button type=button>+ Agregar CondiciÃ³n"),on=x("<input>"),ln=x("<div><div><div><label>Campo</label><select><option value>Seleccionar campo</option></select></div><div><label>Operador</label><select></select></div><div><label>Valor</label></div><div><button type=button>âœ•");const an=r=>{const{t}=It(),i=()=>r.rule&&r.rule.id,[g,C]=ye(!1),[b,w]=ye(0),[k,Y]=ye(!1),[B,ve]=ye(r.rule?.customFields||[]),[S,G]=ye({name:r.rule?.name||"",description:r.rule?.description||"",eventType:r.rule?.eventType||"invoice_completed",isActive:r.rule?.isActive??!0,priority:r.rule?.priority||100,conditions:r.rule?.conditions||[],customFields:r.rule?.customFields||[],journalEntryTemplate:r.rule?.journalEntryTemplate||{description:"",reference:"",lines:[]},createdBy:r.rule?.createdBy||"user"}),pe=it(()=>{const d=S().eventType;if(!d)return[];const v=cr(d),P=B().map(f=>({path:`custom.${f.name}`,definition:{type:"expression",description:f.description||`Custom field: ${f.expression}`,example:f.expression}}));return[...v,...P]}),oe=it(()=>{const d=S().eventType;return d?Ft(d):null}),Pe=[{value:"equals",label:t("eventAutomation.operators.equals")},{value:"notEquals",label:t("eventAutomation.operators.notEquals")},{value:"greaterThan",label:t("eventAutomation.operators.greaterThan")},{value:"lessThan",label:t("eventAutomation.operators.lessThan")},{value:"greaterThanOrEqual",label:t("eventAutomation.operators.greaterThanOrEqual")},{value:"lessThanOrEqual",label:t("eventAutomation.operators.lessThanOrEqual")},{value:"contains",label:t("eventAutomation.operators.contains")},{value:"notContains",label:t("eventAutomation.operators.notContains")},{value:"exists",label:t("eventAutomation.operators.exists")},{value:"notExists",label:t("eventAutomation.operators.notExists")}],xe=[{value:"invoice_completed",label:t("eventAutomation.eventTypes.invoice_completed")},{value:"invoice_created",label:t("eventAutomation.eventTypes.invoice_created")},{value:"payment_received",label:t("eventAutomation.eventTypes.payment_received")},{value:"inventory_received",label:t("eventAutomation.eventTypes.inventory_received")},{value:"inventory_sold",label:t("eventAutomation.eventTypes.inventory_sold")},{value:"expense_created",label:t("eventAutomation.eventTypes.expense_created")},{value:"expense_approved",label:t("eventAutomation.eventTypes.expense_approved")},{value:"service_rendered",label:t("eventAutomation.eventTypes.service_rendered")}],de=(d,v)=>{G(P=>({...P,[d]:v}))},me=(d,v)=>{G(P=>({...P,journalEntryTemplate:{...P.journalEntryTemplate,[d]:v}}))},Le=()=>{const d={field:pe()[0]?.path||"",operator:"equals",value:"",dataType:"string"};G(v=>({...v,conditions:[...v.conditions||[],d]}))},Fe=(d,v,P)=>{const f=[...S().conditions||[]];if(f[d]={...f[d],[v]:P},v==="field"){const T=pe().find(z=>z.path===P);T&&(f[d].dataType=T.definition.type)}G(T=>({...T,conditions:f}))},Ce=d=>{G(v=>({...v,conditions:v.conditions?.filter((P,f)=>f!==d)||[]}))},a=()=>{const d={accountExpression:"1001",descriptionTemplate:"",amountExpression:"",isDebit:!0,conditions:[]};G(v=>({...v,journalEntryTemplate:{...v.journalEntryTemplate,lines:[...v.journalEntryTemplate?.lines||[],d]}}))},$=(d,v,P)=>{const f=[...S().journalEntryTemplate?.lines||[]];f[d]={...f[d],[v]:P},G(T=>({...T,journalEntryTemplate:{...T.journalEntryTemplate,lines:f}}))},R=d=>{const v={field:pe()[0]?.path||"",operator:"greaterThan",value:"0",dataType:"number"},P=[...S().journalEntryTemplate?.lines||[]];P[d]={...P[d],conditions:[...P[d].conditions||[],v]},G(f=>({...f,journalEntryTemplate:{...f.journalEntryTemplate,lines:P}}))},D=(d,v,P,f)=>{const T=[...S().journalEntryTemplate?.lines||[]],z=[...T[d].conditions||[]];if(z[v]={...z[v],[P]:f},P==="field"){const se=pe().find(fe=>fe.path===f);se&&(z[v].dataType=se.definition.type)}T[d]={...T[d],conditions:z},G(se=>({...se,journalEntryTemplate:{...se.journalEntryTemplate,lines:T}}))},_=(d,v)=>{const P=[...S().journalEntryTemplate?.lines||[]];P[d]={...P[d],conditions:P[d].conditions?.filter((f,T)=>T!==v)||[]},G(f=>({...f,journalEntryTemplate:{...f.journalEntryTemplate,lines:P}}))},F=d=>{const v={...d,id:`custom_${Date.now()}_${Math.random().toString(36).substr(2,9)}`};ve(P=>[...P,v])},n=(d,v)=>{ve(P=>P.map(f=>f.id===d?{...f,...v}:f))},s=d=>{ve(v=>v.filter(P=>P.id!==d))},j=d=>{G(v=>({...v,journalEntryTemplate:{...v.journalEntryTemplate,lines:v.journalEntryTemplate?.lines.filter((P,f)=>f!==d)||[]}}))},O=()=>{const d=S();if(!d.name||!d.description||!d.eventType){alert("Por favor complete todos los campos requeridos");return}if(!d.journalEntryTemplate?.lines.length){alert("Por favor agregue al menos una lÃ­nea de asiento contable");return}if(d.journalEntryTemplate.lines.filter(T=>!T.accountExpression||!T.amountExpression||!T.descriptionTemplate).length>0){alert("Por favor complete todos los campos de las lÃ­neas de asiento contable");return}if(d.journalEntryTemplate.lines.filter(T=>T.conditions?.some(z=>!z.field||!z.operator||z.operator!=="exists"&&z.operator!=="notExists"&&!z.value)).length>0){alert("Por favor complete todos los campos de condiciones de lÃ­nea o elimine las condiciones incompletas");return}const f={...d,customFields:B()};r.onSave(f)},W={position:"fixed",top:"0",left:"0",right:"0",bottom:"0","background-color":"rgba(0, 0, 0, 0.5)",display:"flex","align-items":"center","justify-content":"center","z-index":"1000",overflow:"auto",padding:"2rem"},u={"background-color":"white","border-radius":"0.5rem",padding:"2rem","max-width":"900px","max-height":"90vh","overflow-y":"auto",width:"100%"},y={width:"100%",padding:"0.5rem",border:"1px solid #d1d5db","border-radius":"0.375rem","font-size":"0.875rem"},p={...y,"background-color":"white"},E={padding:"0.5rem 1rem","border-radius":"0.375rem",cursor:"pointer","font-weight":"500",border:"1px solid #d1d5db"},h={...E,"background-color":"#3b82f6",color:"white",border:"none"},N={...E,"background-color":"white",color:"#374151"},M={...E,"background-color":"#ef4444",color:"white",border:"none"},V={"margin-bottom":"2rem","border-bottom":"1px solid #e5e7eb","padding-bottom":"2rem"};return console.log(r.rule),(()=>{var d=Qr(),v=d.firstChild,P=v.firstChild,f=P.nextSibling,T=f.firstChild,z=T.nextSibling,se=z.firstChild,fe=se.firstChild,$e=fe.firstChild,Ee=fe.nextSibling,Je=se.nextSibling,Oe=Je.firstChild,ke=Oe.nextSibling,le=z.nextSibling,_e=le.firstChild,De=_e.firstChild,Se=_e.nextSibling,Re=le.nextSibling,Qe=Re.firstChild,Z=Qe.firstChild,Me=Z.firstChild,he=Z.nextSibling,qe=Qe.nextSibling,Ne=qe.firstChild,dt=Ne.firstChild,He=f.nextSibling,nt=He.firstChild,ct=nt.firstChild,ut=ct.nextSibling;ut.firstChild;var We=He.nextSibling,Xe=We.firstChild,pt=Xe.firstChild,Ct=pt.nextSibling,mt=Ct.firstChild,St=mt.nextSibling,Ke=Xe.nextSibling,yt=Ke.firstChild,gt=yt.nextSibling;gt.firstChild;var Ye=We.nextSibling,Dt=Ye.firstChild,Tt=Dt.nextSibling,vt=Tt.firstChild,wt=vt.nextSibling;return m(v,u),P.style.setProperty("font-size","1.5rem"),P.style.setProperty("font-weight","700"),P.style.setProperty("margin-bottom","1.5rem"),e(P,(()=>{var l=Ae(()=>!!i());return()=>l()?t("eventAutomation.builder.editTitle"):t("eventAutomation.builder.createTitle")})()),T.style.setProperty("font-size","1.125rem"),T.style.setProperty("font-weight","600"),T.style.setProperty("margin-bottom","1rem"),e(T,()=>t("eventAutomation.builder.basicInfo")),z.style.setProperty("display","grid"),z.style.setProperty("grid-template-columns","1fr 1fr"),z.style.setProperty("gap","1rem"),z.style.setProperty("margin-bottom","1rem"),fe.style.setProperty("display","block"),fe.style.setProperty("font-weight","500"),fe.style.setProperty("margin-bottom","0.5rem"),e(fe,()=>t("eventAutomation.builder.ruleName"),$e),Ee.$$input=l=>de("name",l.currentTarget.value),Oe.style.setProperty("display","block"),Oe.style.setProperty("font-weight","500"),Oe.style.setProperty("margin-bottom","0.5rem"),e(Oe,()=>t("eventAutomation.builder.priority")),ke.$$input=l=>de("priority",parseInt(l.currentTarget.value)||100),le.style.setProperty("margin-bottom","1rem"),_e.style.setProperty("display","block"),_e.style.setProperty("font-weight","500"),_e.style.setProperty("margin-bottom","0.5rem"),e(_e,()=>t("eventAutomation.builder.description"),De),Se.$$input=l=>de("description",l.currentTarget.value),Re.style.setProperty("display","grid"),Re.style.setProperty("grid-template-columns","1fr auto"),Re.style.setProperty("gap","1rem"),Re.style.setProperty("align-items","end"),Z.style.setProperty("display","block"),Z.style.setProperty("font-weight","500"),Z.style.setProperty("margin-bottom","0.5rem"),e(Z,()=>t("eventAutomation.builder.eventType"),Me),he.addEventListener("change",l=>de("eventType",l.currentTarget.value)),e(he,c(ue,{each:xe,children:l=>(()=>{var L=_t();return e(L,()=>l.label),A(()=>L.value=l.value),L})()})),Ne.style.setProperty("display","flex"),Ne.style.setProperty("align-items","center"),Ne.style.setProperty("gap","0.5rem"),dt.addEventListener("change",l=>de("isActive",l.currentTarget.checked)),e(Ne,()=>t("eventAutomation.builder.active"),null),e(f,c(I,{get when(){return oe()},get children(){var l=Hr(),L=l.firstChild,Q=L.firstChild,ge=Q.firstChild;Q.nextSibling;var ie=L.nextSibling;return l.style.setProperty("margin-top","1rem"),l.style.setProperty("padding","1rem"),l.style.setProperty("background-color","#f3f4f6"),l.style.setProperty("border-radius","0.375rem"),L.style.setProperty("font-size","0.875rem"),L.style.setProperty("color","#4b5563"),L.style.setProperty("margin-bottom","0.5rem"),e(Q,()=>t("eventAutomation.builder.eventDescription"),ge),e(L,()=>oe()?.description,null),ie.$$click=()=>C(!g()),e(ie,()=>g()?"ğŸ”½ Ocultar Interfaz de Datos":"ğŸ”¼ Mostrar Interfaz de Datos y Ejemplos"),A(ce=>m(ie,{...N,"font-size":"0.75rem",padding:"0.25rem 0.5rem"},ce)),l}}),null),e(v,c(I,{get when(){return Ae(()=>!!g())()&&oe()},get children(){var l=Wr(),L=l.firstChild,Q=L.nextSibling,ge=Q.firstChild,ie=ge.firstChild,ce=ie.nextSibling,be=ge.nextSibling,Te=be.firstChild;return L.style.setProperty("font-size","1.125rem"),L.style.setProperty("font-weight","600"),L.style.setProperty("margin-bottom","1rem"),Q.style.setProperty("display","grid"),Q.style.setProperty("grid-template-columns","1fr 1fr"),Q.style.setProperty("gap","2rem"),ie.style.setProperty("font-size","1rem"),ie.style.setProperty("font-weight","600"),ie.style.setProperty("margin-bottom","0.75rem"),ie.style.setProperty("color","#1f2937"),ce.style.setProperty("max-height","300px"),ce.style.setProperty("overflow-y","auto"),ce.style.setProperty("border","1px solid #d1d5db"),ce.style.setProperty("border-radius","0.375rem"),ce.style.setProperty("padding","0.75rem"),ce.style.setProperty("background-color","#f9fafb"),e(ce,c(ue,{get each(){return pe()},children:H=>(()=>{var re=Kr(),X=re.firstChild,J=X.firstChild,ee=J.nextSibling,we=X.nextSibling;return re.style.setProperty("margin-bottom","0.5rem"),re.style.setProperty("padding","0.5rem"),re.style.setProperty("background-color","white"),re.style.setProperty("border-radius","0.25rem"),re.style.setProperty("border","1px solid #e5e7eb"),X.style.setProperty("display","flex"),X.style.setProperty("justify-content","space-between"),X.style.setProperty("align-items","center"),J.style.setProperty("font-family","monospace"),J.style.setProperty("font-size","0.8rem"),J.style.setProperty("color","#059669"),J.style.setProperty("font-weight","600"),e(J,()=>H.path),ee.style.setProperty("font-size","0.7rem"),ee.style.setProperty("padding","0.125rem 0.375rem"),ee.style.setProperty("border-radius","0.25rem"),ee.style.setProperty("font-weight","500"),e(ee,()=>H.definition.type),we.style.setProperty("font-size","0.75rem"),we.style.setProperty("color","#6b7280"),we.style.setProperty("margin","0.25rem 0 0 0"),e(we,()=>H.definition.description),e(re,c(I,{get when(){return H.definition.example},get children(){var ne=Xr(),U=ne.firstChild,K=U.nextSibling;return ne.style.setProperty("font-size","0.7rem"),ne.style.setProperty("color","#374151"),ne.style.setProperty("margin","0.25rem 0 0 0"),ne.style.setProperty("font-style","italic"),K.style.setProperty("background-color","#f3f4f6"),K.style.setProperty("padding","0.125rem 0.25rem"),K.style.setProperty("border-radius","0.125rem"),e(K,(()=>{var Be=Ae(()=>typeof H.definition.example=="object");return()=>Be()?JSON.stringify(H.definition.example):H.definition.example})()),ne}}),null),A(ne=>{var U=H.definition.type==="number"?"#dbeafe":H.definition.type==="string"?"#fef3c7":H.definition.type==="boolean"?"#dcfce7":"#f3e8ff",K=H.definition.type==="number"?"#1e40af":H.definition.type==="string"?"#92400e":H.definition.type==="boolean"?"#166534":"#7c3aed";return U!==ne.e&&((ne.e=U)!=null?ee.style.setProperty("background-color",U):ee.style.removeProperty("background-color")),K!==ne.t&&((ne.t=K)!=null?ee.style.setProperty("color",K):ee.style.removeProperty("color")),ne},{e:void 0,t:void 0}),re})()})),Te.style.setProperty("font-size","1rem"),Te.style.setProperty("font-weight","600"),Te.style.setProperty("margin-bottom","0.75rem"),Te.style.setProperty("color","#1f2937"),e(be,c(I,{get when(){return Ae(()=>!!oe()?.examples)()&&oe().examples.length>0},get children(){return[(()=>{var H=$t();return H.style.setProperty("margin-bottom","0.75rem"),e(H,c(ue,{get each(){return oe().examples},children:(re,X)=>(()=>{var J=en();return J.$$click=()=>w(X()),e(J,()=>re.name),A(ee=>m(J,{...N,"margin-right":"0.5rem","margin-bottom":"0.5rem","font-size":"0.75rem",padding:"0.375rem 0.75rem","background-color":b()===X()?"#3b82f6":"white",color:b()===X()?"white":"#374151",border:b()===X()?"none":"1px solid #d1d5db"},ee)),J})()})),H})(),c(I,{get when(){return oe()?.examples[b()]},get children(){var H=Jr(),re=H.firstChild,X=re.nextSibling,J=X.nextSibling,ee=J.nextSibling,we=ee.firstChild;return H.style.setProperty("border","1px solid #d1d5db"),H.style.setProperty("border-radius","0.375rem"),H.style.setProperty("padding","0.75rem"),H.style.setProperty("background-color","#f9fafb"),re.style.setProperty("font-size","0.875rem"),re.style.setProperty("font-weight","600"),re.style.setProperty("margin-bottom","0.5rem"),e(re,()=>oe().examples[b()].name),X.style.setProperty("font-size","0.75rem"),X.style.setProperty("color","#6b7280"),X.style.setProperty("margin-bottom","0.75rem"),e(X,()=>oe().examples[b()].description),J.style.setProperty("background-color","#1f2937"),J.style.setProperty("color","#f9fafb"),J.style.setProperty("padding","0.75rem"),J.style.setProperty("border-radius","0.25rem"),J.style.setProperty("font-family","monospace"),J.style.setProperty("font-size","0.75rem"),J.style.setProperty("overflow-x","auto"),J.style.setProperty("white-space","pre"),e(J,()=>JSON.stringify({data:oe().examples[b()].sampleData},null,2)),ee.style.setProperty("margin-top","0.5rem"),ee.style.setProperty("padding","0.5rem"),ee.style.setProperty("background-color","#fef3c7"),ee.style.setProperty("border-radius","0.25rem"),we.style.setProperty("font-size","0.7rem"),we.style.setProperty("color","#92400e"),H}})]}}),null),A(H=>m(l,V,H)),l}}),He),nt.style.setProperty("display","flex"),nt.style.setProperty("justify-content","space-between"),nt.style.setProperty("align-items","center"),nt.style.setProperty("margin-bottom","1rem"),ct.style.setProperty("font-size","1.125rem"),ct.style.setProperty("font-weight","600"),e(ct,()=>t("eventAutomation.builder.conditions.title")),ut.$$click=Le,e(ut,()=>t("eventAutomation.builder.conditions.add"),null),e(He,c(I,{get when(){return(S().conditions?.length||0)===0},get children(){var l=Yr(),L=l.firstChild,Q=L.nextSibling;return Q.nextSibling,l.style.setProperty("color","#6b7280"),l.style.setProperty("font-style","italic"),e(l,()=>t("eventAutomation.builder.conditions.noConditions"),L),e(l,()=>S().eventType,Q),l}}),null),e(He,c(ue,{get each(){return S().conditions||[]},children:(l,L)=>(()=>{var Q=tn(),ge=Q.firstChild,ie=ge.firstChild,ce=ie.firstChild,be=ce.nextSibling,Te=be.firstChild,H=ie.nextSibling,re=H.firstChild,X=re.nextSibling,J=H.nextSibling,ee=J.firstChild,we=J.nextSibling,ne=we.firstChild;return Q.style.setProperty("border","1px solid #d1d5db"),Q.style.setProperty("border-radius","0.375rem"),Q.style.setProperty("padding","1rem"),Q.style.setProperty("margin-bottom","1rem"),ge.style.setProperty("display","grid"),ge.style.setProperty("grid-template-columns","2fr 1fr 1fr auto"),ge.style.setProperty("gap","1rem"),ge.style.setProperty("align-items","end"),ce.style.setProperty("display","block"),ce.style.setProperty("font-weight","500"),ce.style.setProperty("margin-bottom","0.5rem"),e(ce,()=>t("eventAutomation.builder.conditions.field")),be.addEventListener("change",U=>Fe(L(),"field",U.currentTarget.value)),e(Te,()=>t("eventAutomation.builder.conditions.selectField")),e(be,c(ue,{get each(){return pe()},children:U=>(()=>{var K=rn(),Be=K.firstChild,q=Be.nextSibling;return q.nextSibling,e(K,()=>U.path,Be),e(K,()=>U.definition.description,q),A(()=>K.value=U.path),K})()}),null),re.style.setProperty("display","block"),re.style.setProperty("font-weight","500"),re.style.setProperty("margin-bottom","0.5rem"),e(re,()=>t("eventAutomation.builder.conditions.operator")),X.addEventListener("change",U=>Fe(L(),"operator",U.currentTarget.value)),e(X,c(ue,{each:Pe,children:U=>(()=>{var K=_t();return e(K,()=>U.label),A(()=>K.value=U.value),K})()})),ee.style.setProperty("display","block"),ee.style.setProperty("font-weight","500"),ee.style.setProperty("margin-bottom","0.5rem"),e(ee,()=>t("eventAutomation.builder.conditions.value")),e(J,c(I,{get when(){return l.operator!=="exists"&&l.operator!=="notExists"},get fallback(){return(()=>{var U=Bt();return A(K=>m(U,y,K)),U})()},get children(){return c(Qt,{get type(){return l.dataType==="number"?"number":"text"},style:y,get value(){return l.value},onChange:U=>Fe(L(),"value",l.dataType==="number"?parseFloat(U)||0:U),get placeholder(){return Ae(()=>l.dataType==="number")()?"0":t("eventAutomation.builder.conditions.enterValue")}})}}),null),ne.$$click=()=>Ce(L()),e(ne,()=>t("eventAutomation.builder.conditions.remove")),A(U=>{var K=p,Be=p,q=M;return U.e=m(be,K,U.e),U.t=m(X,Be,U.t),U.a=m(ne,q,U.a),U},{e:void 0,t:void 0,a:void 0}),A(()=>be.value=l.field),A(()=>X.value=l.operator),Q})()}),null),e(v,c(I,{get when(){return k()},get children(){var l=$t();return l.style.setProperty("margin-bottom","2rem"),e(l,c(Vr,{get customFields(){return B()},get availableFields(){return pe()},get eventType(){return S().eventType},onAdd:F,onUpdate:n,onRemove:s})),l}}),We),We.style.setProperty("margin-bottom","2rem"),Xe.style.setProperty("display","flex"),Xe.style.setProperty("justify-content","space-between"),Xe.style.setProperty("align-items","center"),Xe.style.setProperty("margin-bottom","1rem"),pt.style.setProperty("font-size","1.125rem"),pt.style.setProperty("font-weight","600"),e(pt,()=>t("eventAutomation.builder.journalTemplate.title")),Ct.style.setProperty("display","flex"),Ct.style.setProperty("gap","0.5rem"),mt.$$click=()=>Y(!k()),e(mt,()=>k()?"ğŸ”½ Ocultar Campos Personalizados":"ğŸ› ï¸ Gestionar Campos Personalizados"),St.$$click=()=>C(!g()),e(St,()=>g()?"ğŸ”½ Ocultar Interfaz de Datos":"ğŸ“Š Mostrar Interfaz de Datos"),e(We,c(I,{get when(){return S().eventType},get children(){var l=$t();return l.style.setProperty("display","grid"),l.style.setProperty("grid-template-columns","1fr 1fr"),l.style.setProperty("gap","1rem"),l.style.setProperty("margin-bottom","1rem"),e(l,c(je,{get label(){return`${t("eventAutomation.builder.journalTemplate.description")} *`},get value(){return S().journalEntryTemplate?.description||""},onChange:L=>me("description",L),get eventType(){return S().eventType},get placeholder(){return t("eventAutomation.builder.journalTemplate.descriptionPlaceholder")},type:"template",helpText:"Usa {data.field} para insertar datos del evento en descripciones",required:!0,get customFields(){return B()}}),null),e(l,c(je,{get label(){return`${t("eventAutomation.builder.journalTemplate.reference")} *`},get value(){return S().journalEntryTemplate?.reference||""},onChange:L=>me("reference",L),get eventType(){return S().eventType},get placeholder(){return t("eventAutomation.builder.journalTemplate.referencePlaceholder")},type:"template",helpText:"Plantilla para referencia del asiento contable",required:!0,get customFields(){return B()}}),null),l}}),Ke),Ke.style.setProperty("display","flex"),Ke.style.setProperty("justify-content","space-between"),Ke.style.setProperty("align-items","center"),Ke.style.setProperty("margin-bottom","1rem"),yt.style.setProperty("font-size","1rem"),yt.style.setProperty("font-weight","600"),e(yt,()=>t("eventAutomation.builder.journalTemplate.lines")),gt.$$click=a,e(gt,()=>t("eventAutomation.builder.journalTemplate.addLine"),null),e(We,c(I,{get when(){return(S().journalEntryTemplate?.lines.length||0)===0},get children(){var l=Gr();return l.style.setProperty("color","#6b7280"),l.style.setProperty("font-style","italic"),l.style.setProperty("margin-bottom","1rem"),e(l,()=>t("eventAutomation.builder.journalTemplate.noLines")),l}}),null),e(We,c(ue,{get each(){return S().journalEntryTemplate?.lines||[]},children:(l,L)=>(()=>{var Q=sn(),ge=Q.firstChild,ie=ge.firstChild;ie.firstChild;var ce=ie.nextSibling,be=ge.nextSibling,Te=be.firstChild,H=Te.firstChild,re=Te.nextSibling,X=re.firstChild,J=X.nextSibling,ee=J.firstChild,we=ee.nextSibling,ne=be.nextSibling,U=ne.firstChild,K=U.firstChild,Be=K.nextSibling;return Q.style.setProperty("border","1px solid #d1d5db"),Q.style.setProperty("border-radius","0.375rem"),Q.style.setProperty("padding","1rem"),Q.style.setProperty("margin-bottom","1rem"),Q.style.setProperty("background-color","#fafafa"),ge.style.setProperty("display","flex"),ge.style.setProperty("justify-content","space-between"),ge.style.setProperty("align-items","center"),ge.style.setProperty("margin-bottom","1rem"),ie.style.setProperty("font-size","0.875rem"),ie.style.setProperty("font-weight","600"),ie.style.setProperty("margin","0"),e(ie,()=>L()+1,null),ce.$$click=()=>j(L()),e(ce,()=>t("eventAutomation.builder.conditions.remove")),be.style.setProperty("display","grid"),be.style.setProperty("grid-template-columns","1fr 1fr"),be.style.setProperty("gap","1rem"),be.style.setProperty("margin-bottom","1rem"),H.style.setProperty("display","block"),H.style.setProperty("font-weight","500"),H.style.setProperty("margin-bottom","0.5rem"),e(H,()=>t("eventAutomation.builder.journalTemplate.account")),e(Te,c(Xt,{get selectedAccountId(){return l.accountId},onSelect:q=>{$(L(),"accountExpression",q?.accountNumber),$(L(),"accountId",q?.id)},get placeholder(){return t("eventAutomation.builder.journalTemplate.selectAccount")}}),null),X.style.setProperty("display","block"),X.style.setProperty("font-weight","500"),X.style.setProperty("margin-bottom","0.5rem"),e(X,()=>t("eventAutomation.builder.journalTemplate.type")),J.addEventListener("change",q=>$(L(),"isDebit",q.currentTarget.value==="debit")),e(ee,()=>t("eventAutomation.builder.journalTemplate.debit")),e(we,()=>t("eventAutomation.builder.journalTemplate.credit")),e(Q,c(I,{get when(){return S().eventType},get children(){var q=$t();return q.style.setProperty("display","grid"),q.style.setProperty("grid-template-columns","2fr 1fr"),q.style.setProperty("gap","1rem"),e(q,c(je,{get label(){return t("eventAutomation.builder.journalTemplate.descriptionTemplate")},get value(){return l.descriptionTemplate},onChange:ze=>$(L(),"descriptionTemplate",ze),get eventType(){return S().eventType},get placeholder(){return t("eventAutomation.builder.journalTemplate.descriptionTemplatePlaceholder")},type:"template",helpText:"Usa {data.field} para insertar datos del evento",get customFields(){return B()}}),null),e(q,c(je,{get label(){return t("eventAutomation.builder.journalTemplate.amountExpression")},get value(){return l.amountExpression},onChange:ze=>$(L(),"amountExpression",ze),get eventType(){return S().eventType},get placeholder(){return t("eventAutomation.builder.journalTemplate.amountExpressionPlaceholder")},type:"expression",helpText:"Ruta del campo o expresiÃ³n para cÃ¡lculo de cantidad",get customFields(){return B()}}),null),q}}),ne),ne.style.setProperty("margin-top","1rem"),ne.style.setProperty("padding-top","1rem"),ne.style.setProperty("border-top","1px solid #e5e7eb"),U.style.setProperty("display","flex"),U.style.setProperty("justify-content","space-between"),U.style.setProperty("align-items","center"),U.style.setProperty("margin-bottom","0.75rem"),K.style.setProperty("font-size","0.875rem"),K.style.setProperty("font-weight","600"),K.style.setProperty("margin","0"),K.style.setProperty("color","#374151"),Be.$$click=()=>R(L()),e(ne,c(I,{get when(){return(l.conditions?.length||0)===0},get children(){var q=nn();return q.style.setProperty("font-size","0.75rem"),q.style.setProperty("color","#6b7280"),q.style.setProperty("font-style","italic"),q.style.setProperty("margin","0.5rem 0"),q}}),null),e(ne,c(ue,{get each(){return l.conditions||[]},children:(q,ze)=>(()=>{var Ue=ln(),Ge=Ue.firstChild,Rt=Ge.firstChild,st=Rt.firstChild,ot=st.nextSibling;ot.firstChild;var Nt=Rt.nextSibling,lt=Nt.firstChild,ft=lt.nextSibling,At=Nt.nextSibling,bt=At.firstChild,Wt=At.nextSibling,zt=Wt.firstChild;return Ue.style.setProperty("border","1px solid #e5e7eb"),Ue.style.setProperty("border-radius","0.375rem"),Ue.style.setProperty("padding","0.75rem"),Ue.style.setProperty("margin-bottom","0.5rem"),Ue.style.setProperty("background-color","#f9fafb"),Ge.style.setProperty("display","grid"),Ge.style.setProperty("grid-template-columns","2fr 1fr 1fr auto"),Ge.style.setProperty("gap","0.75rem"),Ge.style.setProperty("align-items","end"),st.style.setProperty("display","block"),st.style.setProperty("font-weight","500"),st.style.setProperty("margin-bottom","0.25rem"),st.style.setProperty("font-size","0.75rem"),ot.addEventListener("change",te=>D(L(),ze(),"field",te.currentTarget.value)),e(ot,c(ue,{get each(){return pe()},children:te=>(()=>{var ae=_t();return e(ae,()=>te.path),A(()=>ae.value=te.path),ae})()}),null),lt.style.setProperty("display","block"),lt.style.setProperty("font-weight","500"),lt.style.setProperty("margin-bottom","0.25rem"),lt.style.setProperty("font-size","0.75rem"),ft.addEventListener("change",te=>D(L(),ze(),"operator",te.currentTarget.value)),e(ft,c(ue,{each:Pe,children:te=>(()=>{var ae=_t();return e(ae,()=>te.label),A(()=>ae.value=te.value),ae})()})),bt.style.setProperty("display","block"),bt.style.setProperty("font-weight","500"),bt.style.setProperty("margin-bottom","0.25rem"),bt.style.setProperty("font-size","0.75rem"),e(At,c(I,{get when(){return q.operator!=="exists"&&q.operator!=="notExists"},get fallback(){return(()=>{var te=Bt();return A(ae=>m(te,{...y,"font-size":"0.75rem"},ae)),te})()},get children(){var te=on();return te.$$input=ae=>D(L(),ze(),"value",q.dataType==="number"?parseFloat(ae.currentTarget.value)||0:ae.currentTarget.value),A(ae=>{var ht=q.dataType==="number"?"number":"text",Et={...y,"font-size":"0.75rem"},jt=q.dataType==="number"?"0":"Ingresa valor";return ht!==ae.e&&Ze(te,"type",ae.e=ht),ae.t=m(te,Et,ae.t),jt!==ae.a&&Ze(te,"placeholder",ae.a=jt),ae},{e:void 0,t:void 0,a:void 0}),A(()=>te.value=q.value),te}}),null),zt.$$click=()=>_(L(),ze()),A(te=>{var ae={...p,"font-size":"0.75rem"},ht={...p,"font-size":"0.75rem"},Et={...M,"font-size":"0.7rem",padding:"0.375rem"};return te.e=m(ot,ae,te.e),te.t=m(ft,ht,te.t),te.a=m(zt,Et,te.a),te},{e:void 0,t:void 0,a:void 0}),A(()=>ot.value=q.field),A(()=>ft.value=q.operator),Ue})()}),null),A(q=>{var ze=M,Ue=p,Ge={...N,"font-size":"0.75rem",padding:"0.375rem 0.75rem"};return q.e=m(ce,ze,q.e),q.t=m(J,Ue,q.t),q.a=m(Be,Ge,q.a),q},{e:void 0,t:void 0,a:void 0}),A(()=>J.value=l.isDebit?"debit":"credit"),Q})()}),null),Ye.style.setProperty("display","flex"),Ye.style.setProperty("justify-content","space-between"),Ye.style.setProperty("align-items","center"),Ye.style.setProperty("border-top","1px solid #e5e7eb"),Ye.style.setProperty("padding-top","1.5rem"),Ye.style.setProperty("margin-top","2rem"),e(Dt,c(I,{get when(){return B().length>0||S().journalEntryTemplate?.lines.length>0},get children(){var l=Zr();return l.style.setProperty("font-size","0.875rem"),l.style.setProperty("color","#6b7280"),l}})),Tt.style.setProperty("display","flex"),Tt.style.setProperty("gap","1rem"),Kt(vt,"click",r.onCancel,!0),e(vt,()=>t("eventAutomation.builder.cancel")),wt.$$click=O,e(wt,(()=>{var l=Ae(()=>!!i());return()=>l()?t("eventAutomation.builder.update"):t("eventAutomation.builder.save")})()),A(l=>{var L=W,Q=V,ge=y,ie=t("eventAutomation.builder.ruleNamePlaceholder"),ce=y,be={...y,height:"4rem",resize:"vertical"},Te=t("eventAutomation.builder.descriptionPlaceholder"),H=p,re=V,X=N,J={...N,"font-size":"0.875rem"},ee={...N,"font-size":"0.875rem"},we=N,ne=N,U=h;return l.e=m(d,L,l.e),l.t=m(f,Q,l.t),l.a=m(Ee,ge,l.a),ie!==l.o&&Ze(Ee,"placeholder",l.o=ie),l.i=m(ke,ce,l.i),l.n=m(Se,be,l.n),Te!==l.s&&Ze(Se,"placeholder",l.s=Te),l.h=m(he,H,l.h),l.r=m(He,re,l.r),l.d=m(ut,X,l.d),l.l=m(mt,J,l.l),l.u=m(St,ee,l.u),l.c=m(gt,we,l.c),l.w=m(vt,ne,l.w),l.m=m(wt,U,l.m),l},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0,r:void 0,d:void 0,l:void 0,u:void 0,c:void 0,w:void 0,m:void 0}),A(()=>Ee.value=S().name||""),A(()=>ke.value=S().priority||100),A(()=>Se.value=S().description||""),A(()=>he.value=S().eventType||""),A(()=>dt.checked=S().isActive??!0),d})()};at(["input","click"]);var dn=x("<div><p>Loading rules..."),cn=x("<div><p>Failed to load rules. Please refresh the page."),un=x("<div><p></p><button>"),pn=x("<div><div><h2></h2><button>+ "),Ut=x("<div>"),Vt=x("<div><h2>"),mn=x("<div><div><h1></h1><p></p></div><div><button> (<!>)</button><button></button><button>"),yn=x("<div><div><div><div><h3></h3><span></span><span></span></div><p></p><div><div><strong>:</strong></div><div><strong>:</strong><div> <!> - </div></div></div></div><div><button></button><button></button><button>"),gn=x("<div> <!> "),vn=x("<span>"),fn=x("<div><div><h3></h3><span></span></div><div><div><strong>:</strong> </div><div><strong>:</strong> </div><details><summary></summary><pre>"),bn=x("<div><strong>:</strong> "),hn=x("<div><div><div><h3></h3><span></span></div><span></span></div><div><div><strong>:</strong> </div><div><strong>:</strong> </div><div><strong>:</strong> <!> ");const xn=()=>{const{t:r}=It(),[t,i]=ye("rules"),[g,C]=ye(null),[b,w]=ye(!1),[k,Y]=ye(""),[B,{refetch:ve}]=er(()=>Ve.getAll(),{initialValue:[]}),S=()=>Ht.getHistory(50),G=()=>xt.getAuditLog(50);r("eventAutomation.eventTypes.invoice_completed"),r("eventAutomation.categories.financial"),r("eventAutomation.eventTypes.invoice_created"),r("eventAutomation.categories.financial"),r("eventAutomation.eventTypes.invoice_updated"),r("eventAutomation.categories.financial"),r("eventAutomation.eventTypes.payment_received"),r("eventAutomation.categories.financial"),r("eventAutomation.eventTypes.inventory_received"),r("eventAutomation.categories.inventory"),r("eventAutomation.eventTypes.inventory_sold"),r("eventAutomation.categories.inventory"),r("eventAutomation.eventTypes.inventory_adjusted"),r("eventAutomation.categories.inventory"),r("eventAutomation.eventTypes.expense_created"),r("eventAutomation.categories.financial"),r("eventAutomation.eventTypes.expense_approved"),r("eventAutomation.categories.financial"),r("eventAutomation.eventTypes.expense_paid"),r("eventAutomation.categories.financial"),r("eventAutomation.eventTypes.service_rendered"),r("eventAutomation.categories.operational"),r("eventAutomation.eventTypes.freight_processed"),r("eventAutomation.categories.operational"),r("eventAutomation.eventTypes.customs_cleared"),r("eventAutomation.categories.operational");const pe=async $=>{try{console.log($,g()),g()?await Ve.update(g().id,$):await Ve.create($),await ve();const R=await Ve.getAll();console.log(R),xt.syncRules(R),C(null),w(!1)}catch(R){console.error("Failed to save rule:",R),alert("Failed to save rule. Please try again.")}},oe=async $=>{if(confirm(r("common.confirmDelete")))try{await Ve.delete($),await ve();const R=await Ve.getAll();xt.syncRules(R)}catch(R){console.error("Failed to delete rule:",R),alert("Failed to delete rule. Please try again.")}},Pe=$=>new Date($).toLocaleString(),xe=$=>({padding:"0.75rem 1.5rem","background-color":$?"#3b82f6":"transparent",color:$?"white":"#6b7280",border:"none","border-radius":"0.5rem",cursor:"pointer","font-weight":"500",transition:"all 0.2s"}),de={"background-color":"white","border-radius":"0.5rem",padding:"1.5rem","box-shadow":"0 1px 3px 0 rgba(0, 0, 0, 0.1)","margin-bottom":"1rem"},me={padding:"0.5rem 1rem","background-color":"#3b82f6",color:"white",border:"none","border-radius":"0.375rem",cursor:"pointer","font-weight":"500"},Le={...me,"background-color":"#6b7280"},Fe={...me,"background-color":"#ef4444"},Ce=async()=>{let $=await rr.getAlls("");nr.updAccount(Object.values($))};tr(()=>{Ce()});const a=async($,R)=>{try{await Ve.toggleActive($,R),await ve();const D=await Ve.getAll();xt.syncRules(D)}catch(D){console.error("Failed to toggle rule:",D),alert("Failed to update rule status. Please try again.")}};return(()=>{var $=mn(),R=$.firstChild,D=R.firstChild,_=D.nextSibling,F=R.nextSibling,n=F.firstChild,s=n.firstChild,j=s.nextSibling;j.nextSibling;var O=n.nextSibling,W=O.nextSibling;return $.style.setProperty("max-width","1200px"),$.style.setProperty("margin","0 auto"),$.style.setProperty("padding","2rem"),R.style.setProperty("margin-bottom","2rem"),D.style.setProperty("font-size","2rem"),D.style.setProperty("font-weight","700"),D.style.setProperty("margin-bottom","0.5rem"),e(D,()=>r("eventAutomation.title")),_.style.setProperty("color","#6b7280"),e(_,()=>r("eventAutomation.subtitle")),F.style.setProperty("display","flex"),F.style.setProperty("gap","0.5rem"),F.style.setProperty("margin-bottom","2rem"),n.$$click=()=>i("rules"),e(n,()=>r("eventAutomation.tabs.rules"),s),e(n,(()=>{var u=Ae(()=>!B.loading&&!B.error);return()=>u()?B().length:0})(),j),O.$$click=()=>i("events"),e(O,()=>r("eventAutomation.tabs.events")),W.$$click=()=>i("audit"),e(W,()=>r("eventAutomation.tabs.audit")),e($,c(I,{get when(){return t()==="rules"},get children(){var u=pn(),y=u.firstChild,p=y.firstChild,E=p.nextSibling;return E.firstChild,y.style.setProperty("display","flex"),y.style.setProperty("justify-content","space-between"),y.style.setProperty("margin-bottom","1.5rem"),p.style.setProperty("font-size","1.25rem"),p.style.setProperty("font-weight","600"),e(p,()=>r("eventAutomation.rules.title")),E.$$click=()=>w(!0),e(E,()=>r("eventAutomation.rules.createNew"),null),e(u,c(I,{get when(){return B.loading},get children(){var h=dn(),N=h.firstChild;return N.style.setProperty("text-align","center"),N.style.setProperty("color","#6b7280"),A(M=>m(h,de,M)),h}}),null),e(u,c(I,{get when(){return B.error},get children(){var h=cn(),N=h.firstChild;return N.style.setProperty("text-align","center"),N.style.setProperty("color","#ef4444"),A(M=>m(h,de,M)),h}}),null),e(u,c(I,{get when(){return Ae(()=>!B.loading&&!B.error)()&&B().length===0},get children(){var h=un(),N=h.firstChild,M=N.nextSibling;return N.style.setProperty("margin-bottom","1rem"),e(N,()=>r("eventAutomation.rules.noRules")),M.$$click=()=>w(!0),e(M,()=>r("eventAutomation.rules.createFirst")),A(V=>{var d={...de,"text-align":"center",padding:"3rem",color:"#6b7280"},v=me;return V.e=m(h,d,V.e),V.t=m(M,v,V.t),V},{e:void 0,t:void 0}),h}}),null),e(u,c(ue,{get each(){return Ae(()=>!B.loading&&!B.error)()?B():[]},children:h=>(()=>{var N=yn(),M=N.firstChild,V=M.firstChild,d=V.firstChild,v=d.firstChild,P=v.nextSibling,f=P.nextSibling,T=d.nextSibling,z=T.nextSibling,se=z.firstChild,fe=se.firstChild,$e=fe.firstChild,Ee=se.nextSibling,Je=Ee.firstChild,Oe=Je.firstChild,ke=Je.nextSibling,le=ke.firstChild,_e=le.nextSibling;_e.nextSibling;var De=V.nextSibling,Se=De.firstChild,Re=Se.nextSibling,Qe=Re.nextSibling;return M.style.setProperty("display","flex"),M.style.setProperty("justify-content","space-between"),M.style.setProperty("align-items","start"),V.style.setProperty("flex","1"),d.style.setProperty("display","flex"),d.style.setProperty("align-items","center"),d.style.setProperty("gap","1rem"),d.style.setProperty("margin-bottom","0.5rem"),v.style.setProperty("font-size","1.125rem"),v.style.setProperty("font-weight","600"),e(v,()=>h.name),P.style.setProperty("padding","0.25rem 0.75rem"),P.style.setProperty("border-radius","0.375rem"),P.style.setProperty("font-size","0.875rem"),P.style.setProperty("font-weight","500"),e(P,(()=>{var Z=Ae(()=>!!h.isActive);return()=>Z()?r("common.active"):r("common.inactive")})()),f.style.setProperty("padding","0.25rem 0.75rem"),f.style.setProperty("background-color","#e5e7eb"),f.style.setProperty("color","#374151"),f.style.setProperty("border-radius","0.375rem"),f.style.setProperty("font-size","0.875rem"),e(f,()=>h.eventType),T.style.setProperty("color","#6b7280"),T.style.setProperty("margin-bottom","1rem"),e(T,()=>h.description),z.style.setProperty("font-size","0.875rem"),z.style.setProperty("color","#4b5563"),se.style.setProperty("margin-bottom","0.5rem"),e(fe,()=>r("eventAutomation.rules.conditions"),$e),e(se,c(ue,{get each(){return h.conditions},children:(Z,Me)=>(()=>{var he=gn(),qe=he.firstChild,Ne=qe.nextSibling;return Ne.nextSibling,he.style.setProperty("margin-left","1rem"),e(he,()=>Me()>0&&"AND ",qe),e(he,()=>Z.field,qe),e(he,()=>Z.operator,Ne),e(he,()=>Z.value,null),he})()}),null),e(se,(()=>{var Z=Ae(()=>h.conditions.length===0);return()=>Z()&&(()=>{var Me=vn();return Me.style.setProperty("margin-left","1rem"),e(Me,()=>r("eventAutomation.rules.alwaysTriggers")),Me})()})(),null),e(Je,()=>r("eventAutomation.rules.journalEntry"),Oe),ke.style.setProperty("margin-left","1rem"),e(ke,()=>h.journalEntryTemplate.lines.length,le),e(ke,()=>r("eventAutomation.rules.lines"),_e),e(ke,()=>h.journalEntryTemplate.description,null),De.style.setProperty("display","flex"),De.style.setProperty("gap","0.5rem"),Se.$$click=()=>a(h.id,!h.isActive),e(Se,(()=>{var Z=Ae(()=>!!h.isActive);return()=>Z()?r("eventAutomation.rules.disable"):r("eventAutomation.rules.enable")})()),Re.$$click=()=>C(h),e(Re,()=>r("common.edit")),Qe.$$click=()=>oe(h.id),e(Qe,()=>r("common.delete")),A(Z=>{var Me=de,he=h.isActive?"#d1fae5":"#fee2e2",qe=h.isActive?"#065f46":"#991b1b",Ne=Le,dt=me,He=Fe;return Z.e=m(N,Me,Z.e),he!==Z.t&&((Z.t=he)!=null?P.style.setProperty("background-color",he):P.style.removeProperty("background-color")),qe!==Z.a&&((Z.a=qe)!=null?P.style.setProperty("color",qe):P.style.removeProperty("color")),Z.o=m(Se,Ne,Z.o),Z.i=m(Re,dt,Z.i),Z.n=m(Qe,He,Z.n),Z},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0}),N})()}),null),A(h=>m(E,me,h)),u}}),null),e($,c(I,{get when(){return t()==="events"},get children(){var u=Vt(),y=u.firstChild;return y.style.setProperty("font-size","1.25rem"),y.style.setProperty("font-weight","600"),y.style.setProperty("margin-bottom","1.5rem"),e(y,()=>r("eventAutomation.events.title")),e(u,c(I,{get when(){return S().length===0},get children(){var p=Ut();return e(p,()=>r("eventAutomation.events.noEvents")),A(E=>m(p,{...de,"text-align":"center",color:"#6b7280"},E)),p}}),null),e(u,c(ue,{get each(){return S()},children:p=>(()=>{var E=fn(),h=E.firstChild,N=h.firstChild,M=N.nextSibling,V=h.nextSibling,d=V.firstChild,v=d.firstChild,P=v.firstChild;v.nextSibling;var f=d.nextSibling,T=f.firstChild,z=T.firstChild;T.nextSibling;var se=f.nextSibling,fe=se.firstChild,$e=fe.nextSibling;return h.style.setProperty("display","flex"),h.style.setProperty("justify-content","space-between"),h.style.setProperty("margin-bottom","0.5rem"),N.style.setProperty("font-size","1rem"),N.style.setProperty("font-weight","600"),e(N,()=>p.type),M.style.setProperty("font-size","0.875rem"),M.style.setProperty("color","#6b7280"),e(M,()=>Pe(p.timestamp)),V.style.setProperty("font-size","0.875rem"),V.style.setProperty("color","#4b5563"),e(v,()=>r("eventAutomation.events.source"),P),e(d,()=>p.source,null),e(T,()=>r("eventAutomation.events.eventId"),z),e(f,()=>p.id,null),se.style.setProperty("margin-top","0.5rem"),fe.style.setProperty("cursor","pointer"),e(fe,()=>r("eventAutomation.events.viewData")),$e.style.setProperty("margin-top","0.5rem"),$e.style.setProperty("padding","0.5rem"),$e.style.setProperty("background-color","#f3f4f6"),$e.style.setProperty("border-radius","0.25rem"),$e.style.setProperty("overflow","auto"),$e.style.setProperty("font-size","0.75rem"),e($e,()=>JSON.stringify(p.data,null,2)),A(Ee=>m(E,de,Ee)),E})()}),null),u}}),null),e($,c(I,{get when(){return t()==="audit"},get children(){var u=Vt(),y=u.firstChild;return y.style.setProperty("font-size","1.25rem"),y.style.setProperty("font-weight","600"),y.style.setProperty("margin-bottom","1.5rem"),e(y,()=>r("eventAutomation.audit.title")),e(u,c(I,{get when(){return G().length===0},get children(){var p=Ut();return e(p,()=>r("eventAutomation.audit.noActivity")),A(E=>m(p,{...de,"text-align":"center",color:"#6b7280"},E)),p}}),null),e(u,c(ue,{get each(){return G()},children:p=>(()=>{var E=hn(),h=E.firstChild,N=h.firstChild,M=N.firstChild,V=M.nextSibling,d=N.nextSibling,v=h.nextSibling,P=v.firstChild,f=P.firstChild,T=f.firstChild;f.nextSibling;var z=P.nextSibling,se=z.firstChild,fe=se.firstChild;se.nextSibling;var $e=z.nextSibling,Ee=$e.firstChild,Je=Ee.firstChild,Oe=Ee.nextSibling,ke=Oe.nextSibling;return ke.nextSibling,h.style.setProperty("display","flex"),h.style.setProperty("justify-content","space-between"),h.style.setProperty("margin-bottom","0.5rem"),N.style.setProperty("display","flex"),N.style.setProperty("align-items","center"),N.style.setProperty("gap","1rem"),M.style.setProperty("font-size","1rem"),M.style.setProperty("font-weight","600"),e(M,()=>p.eventType),V.style.setProperty("padding","0.25rem 0.75rem"),V.style.setProperty("border-radius","0.375rem"),V.style.setProperty("font-size","0.875rem"),V.style.setProperty("font-weight","500"),e(V,(()=>{var le=Ae(()=>!!p.success);return()=>le()?r("eventAutomation.audit.success"):r("eventAutomation.audit.failed")})()),d.style.setProperty("font-size","0.875rem"),d.style.setProperty("color","#6b7280"),e(d,()=>Pe(p.timestamp)),v.style.setProperty("font-size","0.875rem"),v.style.setProperty("color","#4b5563"),e(f,()=>r("eventAutomation.audit.eventId"),T),e(P,()=>p.eventId,null),e(se,()=>r("eventAutomation.audit.rulesTriggered"),fe),e(z,()=>p.rulesTriggered.join(", ")||r("common.none"),null),e(Ee,()=>r("eventAutomation.audit.entriesCreated"),Je),e($e,()=>p.entriesCreated.length,ke),e($e,()=>r("eventAutomation.audit.journalEntries"),null),e(v,c(I,{get when(){return p.error},get children(){var le=bn(),_e=le.firstChild,De=_e.firstChild;return _e.nextSibling,le.style.setProperty("color","#dc2626"),le.style.setProperty("margin-top","0.5rem"),e(_e,()=>r("eventAutomation.audit.error"),De),e(le,()=>p.error,null),le}}),null),A(le=>{var _e=de,De=p.success?"#d1fae5":"#fee2e2",Se=p.success?"#065f46":"#991b1b";return le.e=m(E,_e,le.e),De!==le.t&&((le.t=De)!=null?V.style.setProperty("background-color",De):V.style.removeProperty("background-color")),Se!==le.a&&((le.a=Se)!=null?V.style.setProperty("color",Se):V.style.removeProperty("color")),le},{e:void 0,t:void 0,a:void 0}),E})()}),null),u}}),null),e($,c(I,{get when(){return b()||g()},get children(){return c(an,{get rule(){return g()},onSave:pe,onCancel:()=>{w(!1),C(null)}})}}),null),A(u=>{var y=xe(t()==="rules"),p=xe(t()==="events"),E=xe(t()==="audit");return u.e=m(n,y,u.e),u.t=m(O,p,u.t),u.a=m(W,E,u.a),u},{e:void 0,t:void 0,a:void 0}),$})()};at(["click"]);export{xn as default};
