import{P as i,h as u,c as d,g as y}from"./index-BpnK5xI2.js";async function j(){try{const e=await i({query:"getSupervisionAdapters",params:{businessId:u.getBusinessId()},businessId:u.getBusinessId()});return e?.data||e||[]}catch(e){return console.error("Error getting supervision adapters:",e),[]}}async function Q(e){try{const r=await i({query:"getSupervisionAdapterById",params:{businessId:u.getBusinessId(),adapterId:e},businessId:u.getBusinessId()});return r?.data||r||null}catch(r){return console.error("Error getting supervision adapter by ID:",r),null}}async function D(e,r,s,t){try{const a=await i({query:"lockSupervisionAdapter",params:{businessId:u.getBusinessId()},form:{adapterId:e,lockStatus:r,userId:s,reason:t}});return a?.data||a||{success:!1,error:"Unknown error"}}catch(a){return console.error("Error locking/unlocking supervision adapter:",a),{success:!1,error:a.message}}}async function z(e,r){try{const s=await i({query:"testSupervisionAdapter",params:{businessId:u.getBusinessId()},form:{adapterId:e,samplePayload:r}});return s?.data||s||{success:!1,error:"Unknown error"}}catch(s){return console.error("Error testing supervision adapter:",s),{success:!1,error:s.message}}}async function H(e,r,s,t){try{const a=await i({query:"rollbackSupervisionAdapter",params:{businessId:u.getBusinessId()},form:{adapterId:e,targetVersion:r,userId:s,reason:t}});return a?.data||a||{success:!1,error:"Unknown error"}}catch(a){return console.error("Error rolling back supervision adapter:",a),{success:!1,error:a.message}}}async function J(e){try{const r=await i({query:"getSupervisionFieldMappings",params:{businessId:u.getBusinessId(),adapterId:e}});return r?.data||r||[]}catch(r){return console.error("Error getting supervision field mappings:",r),[]}}async function W(e,r,s,t,a){try{const c=await i({query:"updateSupervisionFieldMapping",params:{businessId:u.getBusinessId()},form:{adapterId:e,mappingId:r,updates:s,userId:t,reason:a}});return c?.data||c||{success:!1,error:"Unknown error"}}catch(c){return console.error("Error updating supervision field mapping:",c),{success:!1,error:c.message}}}async function _(e,r,s,t,a){try{const c=await i({query:"lockSupervisionFieldMapping",params:{businessId:u.getBusinessId()},form:{adapterId:e,mappingId:r,lockStatus:s,userId:t,reason:a}});return c?.data||c||{success:!1,error:"Unknown error"}}catch(c){return console.error("Error locking/unlocking supervision field mapping:",c),{success:!1,error:c.message}}}async function X(e,r,s,t,a){try{const c=await i({query:"rollbackSupervisionFieldMapping",params:{businessId:u.getBusinessId()},form:{adapterId:e,mappingId:r,targetVersion:s,userId:t,reason:a}});return c?.data||c||{success:!1,error:"Unknown error"}}catch(c){return console.error("Error rolling back supervision field mapping:",c),{success:!1,error:c.message}}}async function Y(){try{const e=await i({query:"getSupervisionAccountMappings",params:{businessId:u.getBusinessId()}});return e?.data||e||[]}catch(e){return console.error("Error getting supervision account mappings:",e),[]}}async function Z(e,r,s,t){try{const a=await i({query:"setSupervisionManualAccount",params:{businessId:u.getBusinessId()},form:{mappingId:e,accountField:r,account:s,userId:t}});return a?.data||a||{success:!1,error:"Unknown error"}}catch(a){return console.error("Error setting supervision manual account:",a),{success:!1,error:a.message}}}async function ee(){try{const e=await i({query:"getSupervisionPendingSuggestions",params:{businessId:u.getBusinessId()}});return e?.data||e||[]}catch(e){return console.error("Error getting supervision pending suggestions:",e),[]}}async function q(e,r,s,t){try{const a=await i({query:"reviewSupervisionSuggestion",params:{businessId:u.getBusinessId()},form:{suggestionId:e,approved:r,userId:s,notes:t}});return a?.data||a||{success:!1,error:"Unknown error"}}catch(a){return console.error("Error reviewing supervision suggestion:",a),{success:!1,error:a.message}}}async function re(){try{const e=await i({query:"getSupervisionDashboard",params:{businessId:u.getBusinessId()}});return e?.data||e||null}catch(e){return console.error("Error getting supervision dashboard:",e),null}}async function se(){try{const e=await i({query:"getSupervisionLearnedRules",params:{businessId:u.getBusinessId()}});return e?.data||e||[]}catch(e){return console.error("Error getting supervision learned rules:",e),[]}}async function T(e,r,s,t){try{const a=await i({query:"lockSupervisionLearnedRule",params:{businessId:u.getBusinessId()},form:{ruleId:e,lockStatus:r,userId:s,reason:t}});return a?.data||a||{success:!1,error:"Unknown error"}}catch(a){return console.error("Error locking/unlocking learned rule:",a),{success:!1,error:a.message}}}async function te(e,r,s){try{const t=await i({query:"updateSupervisionLearnedRule",params:{businessId:u.getBusinessId()},form:{ruleId:e,updates:r,userId:s}});return t?.data||t||{success:!1,error:"Unknown error"}}catch(t){return console.error("Error updating learned rule:",t),{success:!1,error:t.message}}}async function ae(e,r){try{const s=await i({query:"testSupervisionLearnedRule",params:{businessId:u.getBusinessId()},form:{ruleId:e,testData:r}});return s?.data||s||{success:!1,error:"Unknown error"}}catch(s){return console.error("Error testing learned rule:",s),{success:!1,error:s.message}}}async function ne(e,r,s){try{const t=await i({query:"rollbackSupervisionLearnedRule",params:{businessId:u.getBusinessId()},form:{ruleId:e,targetVersion:r,userId:s}});return t?.data||t||{success:!1,error:"Unknown error"}}catch(t){return console.error("Error rolling back learned rule:",t),{success:!1,error:t.message}}}async function oe(e){try{const r=await i({query:"getLayeredRulesForSupervision",params:{businessId:u.getBusinessId(),...e},limit:500,businessId:u.getBusinessId()}),s=r?.data;return s?.data?.rules?s.data.rules:s?.rules?s.rules:Array.isArray(s)?s:Array.isArray(r)?r:[]}catch(r){return console.error("Error getting layered rules for supervision:",r),[]}}async function ce(e,r,s,t){try{return await i({query:"setLayeredRuleLockStatus",params:{businessId:u.getBusinessId()},form:{ruleId:e,lockStatus:r,userId:s,reason:t}})||{success:!1,error:"Unknown error"}}catch(a){return console.error("Error setting rule lock status:",a),{success:!1,error:a.message}}}async function ue(e,r,s,t){try{const a=await i({query:"updateLayeredRuleFromSupervision",params:{businessId:u.getBusinessId()},form:{ruleId:e,updates:r,userId:s,reason:t}});return a?.data||a||{success:!1,error:"Unknown error"}}catch(a){return console.error("Error updating layered rule from supervision:",a),{success:!1,error:a.message}}}async function ie(e,r,s,t){try{const a=await i({query:"bulkUpdateLayeredRuleLocks",params:{businessId:u.getBusinessId()},form:{ruleIds:e,lockStatus:r,userId:s,reason:t}});return a?.data||a||{success:!1,error:"Unknown error"}}catch(a){return console.error("Error bulk updating layered rule locks:",a),{success:!1,error:a.message}}}async function le(e){try{return await i({query:"matchAccountsForTransaction",params:{businessId:u.getBusinessId()},form:{context:e}})||{success:!1,error:"Unknown error"}}catch(r){return console.error("Error matching accounts for transaction:",r),{success:!1,error:r.message}}}async function N(e,r,s,t){return ce(e,r?"user_locked":"unlocked",s,t)}async function de(e){return le(e)}async function ye(){try{const e=await i({query:"findDuplicateLayeredRules",params:{businessId:u.getBusinessId()}});return e?.data||e||{success:!1,error:"Unknown error"}}catch(e){return console.error("Error finding duplicate layered rules:",e),{success:!1,error:e.message}}}async function fe(e){try{const r=await i({query:"deduplicateAllLayeredRules",params:{businessId:u.getBusinessId()},form:{userId:e}});return r?.data||r||{success:!1,mergedCount:0,deletedCount:0,error:"Unknown error"}}catch(r){return console.error("Error deduplicating layered rules:",r),{success:!1,mergedCount:0,deletedCount:0,error:r.message}}}async function pe(e){try{const r=await i({query:"migrateAccountMappingsToLayered",params:{businessId:u.getBusinessId()},form:{userId:e}});return r?.data||r||{success:!1,migratedCount:0,skippedCount:0,error:"Unknown error"}}catch(r){return console.error("Error migrating account mappings to layered:",r),{success:!1,migratedCount:0,skippedCount:0,error:r.message}}}async function ge(){try{const e=await i({query:"getLayeredRulesSummaryConnector",params:{businessId:u.getBusinessId()}});return e?.data||e||null}catch(e){return console.error("Error getting layered rules summary:",e),null}}const[b,k]=d([]),[C,A]=d(null),[F,p]=d([]),[h,w]=d(null),[ke,U]=d([]),[B,m]=d([]),[E,L]=d(null),[R,g]=d([]),[S,v]=d(null),[me,O]=d(null),[K,I]=d([]),[Ae,P]=d(null),[he,we]=d([]),[Ee,o]=d(!1),[Le,n]=d(null),Re=y(()=>b().filter(e=>e.isLocked).length),Se=y(()=>b().filter(e=>!e.isLocked).length),ve=y(()=>F().filter(e=>e.confidence<.7)),Ie=y(()=>F().filter(e=>e.confidence>=.8)),be=y(()=>K().length),Ce=y(()=>B().filter(e=>e.isLocked).length),Fe=y(()=>B().filter(e=>e.confidence<.7)),Ue=y(()=>{const e=R()||[];return Array.isArray(e)?{revenue:e.filter(r=>r.layer==="revenue").length,payment:e.filter(r=>r.layer==="payment").length,tax:e.filter(r=>r.layer==="tax").length,cogs:e.filter(r=>r.layer==="cogs").length,inventory:e.filter(r=>r.layer==="inventory").length,discount:e.filter(r=>r.layer==="discount").length,fee:e.filter(r=>r.layer==="fee").length,receivable:e.filter(r=>r.layer==="receivable").length,payable:e.filter(r=>r.layer==="payable").length}:{revenue:0,payment:0,tax:0,cogs:0,inventory:0,discount:0,fee:0,receivable:0,payable:0}}),Be=y(()=>{const e=R()||[];return Array.isArray(e)?e.filter(r=>r.isLocked||r.lockStatus!=="unlocked").length:0}),Me=y(()=>{const e=R()||[];return Array.isArray(e)?e.filter(r=>(r.stats?.confidence??r.confidence??1)<.7):[]});function G(e,r){const s=e.lock||{},t=s.status==="locked"||s.status==="user_locked";return{id:e.id,adapterId:r,sourceField:e.sourcePath||e.sourceField,targetField:e.targetPath||e.targetField,transform:{type:e.transform||"none",params:e.transformParams||{}},isLocked:t,lockInfo:t?{status:"USER_LOCKED",lockedBy:s.lockedBy,lockedAt:s.lockedAt,reason:s.reason}:{status:"UNLOCKED"},source:e.source==="ai_generated"?"AI_GENERATED":e.source==="user_modified"?"USER_MODIFIED":e.source==="user_created"?"USER_CREATED":"AI_GENERATED",confidence:e.confidence||0,successCount:e.successCount||0,failureCount:e.failureCount||0,testCases:e.testCases||[],version:e.version||1,createdAt:e.createdAt,updatedAt:e.updatedAt}}function De(e){const r=e.lock||{},s=r.status==="locked"||r.status==="user_locked"||r.status==="ai_locked",t=e.criteria||{},a=e.accounts||{},c=a.debitAccount||{},l=a.creditAccount||{},f=t.itemCategory?`${t.transactionType} (${t.itemCategory})`:t.transactionType||"Unknown";return{id:e.id,businessId:e.businessId,name:`${f} â†’ ${l.name||"N/A"}`,transactionType:f,accountCode:c.code||"",accountName:c.name||"",debitAccount:{id:c.code,code:c.code,name:c.name,type:c.type,parentId:null},creditAccount:{id:l.code,code:l.code,name:l.name,type:l.type,parentId:null},criteria:[t],isLocked:s,lock:r,lockInfo:{status:s?r.status==="ai_locked"?"AI_LOCKED":"USER_LOCKED":"UNLOCKED",lockedBy:r.lockedBy,lockedAt:r.lockedAt,reason:r.reason},source:e.source==="ai_generated"?"AI_GENERATED":e.source==="user_created"?"USER_CREATED":"AI_GENERATED",createdBy:e.createdBy,confidence:e.confidence||0,priority:t.priority,usageCount:e.usageCount||0,successCount:e.successCount||0,failureCount:e.failureCount||0,successRate:e.successRate||0,version:e.version||1,pendingSuggestions:e.pendingSuggestions||[],createdAt:e.createdAt,updatedAt:e.updatedAt,lastUsedAt:e.lastUsedAt}}const _e=async()=>{o(!0),n(null);try{const e=await j(),r=Array.isArray(e)?e:e?.data||e?.items||[];if(!Array.isArray(r)){k([]);return}k(r.map(s=>{const t=s.globalLock||{},a=t.status==="locked"||t.status==="user_locked";return{id:s.id,name:s.name,displayName:s.displayName||s.name,description:s.description,sourceType:s.sourceSystem||s.sourceType,isLocked:a,lockInfo:{status:a?"USER_LOCKED":"UNLOCKED",lockedBy:t.lockedBy,lockedAt:t.lockedAt,reason:t.reason},confidence:s.confidence||s.detectionConfidence||0,successCount:s.successCount||0,failureCount:s.failureCount||0,processedCount:s.processedCount||0,successRate:s.successRate||0,lastProcessedAt:s.lastUsedAt||s.updatedAt,version:s.version||1,createdAt:s.createdAt,updatedAt:s.updatedAt,fieldMappings:s.fieldMappings||[],detectionRules:s.detectionRules||[],arrayMappings:s.arrayMappings||[],defaultValues:s.defaultValues||[],pendingSuggestions:s.pendingSuggestions||[]}}))}catch(e){throw n(e instanceof Error?e.message:"Failed to load adapters"),e}finally{o(!1)}},x=async e=>{o(!0),n(null);try{const r=await Q(e);if(r){const s=r.globalLock||{},t=s.status==="locked"||s.status==="user_locked";A({id:r.id,name:r.name,displayName:r.displayName||r.name,description:r.description,sourceType:r.sourceSystem||r.sourceType,isLocked:t,lockInfo:{status:t?"USER_LOCKED":"UNLOCKED",lockedBy:s.lockedBy,lockedAt:s.lockedAt,reason:s.reason},confidence:r.confidence||r.detectionConfidence||0,successCount:r.successCount||0,failureCount:r.failureCount||0,processedCount:r.processedCount||0,successRate:r.successRate||0,lastProcessedAt:r.lastUsedAt||r.updatedAt,version:r.version||1,createdAt:r.createdAt,updatedAt:r.updatedAt,fieldMappings:r.fieldMappings||[],detectionRules:r.detectionRules||[],arrayMappings:r.arrayMappings||[],defaultValues:r.defaultValues||[],pendingSuggestions:r.pendingSuggestions||[]}),r.fieldMappings&&r.fieldMappings.length>0&&p(r.fieldMappings.map(a=>G(a,e)))}}catch(r){throw n(r instanceof Error?r.message:"Failed to load adapter"),r}finally{o(!1)}},V=async e=>{o(!0),n(null);try{const r=await J(e),s=Array.isArray(r)?r:r?.data||r?.items||[];p(Array.isArray(s)?s.map(t=>G(t,e)):[])}catch(r){throw n(r instanceof Error?r.message:"Failed to load field mappings"),r}finally{o(!1)}},qe=async()=>{o(!0),n(null);try{const e=await Y(),r=Array.isArray(e)?e:e?.data||e?.items||[];U(Array.isArray(r)?r.map(s=>De(s)):[])}catch(e){throw n(e instanceof Error?e.message:"Failed to load account mappings"),e}finally{o(!1)}},Te=async()=>{o(!0),n(null);try{const e=await ee(),r=Array.isArray(e)?e:e?.data||e?.items||[];I(Array.isArray(r)?r:[])}catch(e){throw n(e instanceof Error?e.message:"Failed to load suggestions"),e}finally{o(!1)}},Ne=async()=>{o(!0),n(null);try{const e=await re();P(e)}catch(e){throw n(e instanceof Error?e.message:"Failed to load dashboard"),e}finally{o(!1)}},Oe=async(e,r)=>{o(!0),n(null);try{const s=u.currentUser?.uid||"system";await D(e,!0,s,r),k(a=>a.map(c=>c.id===e?{...c,isLocked:!0,lockInfo:{status:"USER_LOCKED",reason:r}}:c));const t=C();t?.id===e&&A({...t,isLocked:!0,lockInfo:{status:"USER_LOCKED",reason:r}})}catch(s){throw n(s instanceof Error?s.message:"Failed to lock adapter"),s}finally{o(!1)}},Ke=async e=>{o(!0),n(null);try{const r=u.currentUser?.uid||"system";await D(e,!1,r),k(t=>t.map(a=>a.id===e?{...a,isLocked:!1,lockInfo:{status:"UNLOCKED"}}:a));const s=C();s?.id===e&&A({...s,isLocked:!1,lockInfo:{status:"UNLOCKED"}})}catch(r){throw n(r instanceof Error?r.message:"Failed to unlock adapter"),r}finally{o(!1)}},Pe=async(e,r,s)=>{o(!0),n(null);try{const t=u.currentUser?.uid||"system";await _(e,r,!0,t,s),p(c=>c.map(l=>l.id===r?{...l,isLocked:!0,lockInfo:{status:"USER_LOCKED",reason:s}}:l));const a=h();a?.id===r&&w({...a,isLocked:!0,lockInfo:{status:"USER_LOCKED",reason:s}})}catch(t){throw n(t instanceof Error?t.message:"Failed to lock field mapping"),t}finally{o(!1)}},Ge=async(e,r)=>{o(!0),n(null);try{const s=u.currentUser?.uid||"system";await _(e,r,!1,s),p(a=>a.map(c=>c.id===r?{...c,isLocked:!1,lockInfo:{status:"UNLOCKED"}}:c));const t=h();t?.id===r&&w({...t,isLocked:!1,lockInfo:{status:"UNLOCKED"}})}catch(s){throw n(s instanceof Error?s.message:"Failed to unlock field mapping"),s}finally{o(!1)}},xe=async(e,r,s)=>{o(!0),n(null);try{const t=u.currentUser?.uid||"system",a={sourceField:s.sourceField,targetField:s.targetField,transformationType:s.transform?.type,transformationRule:s.transform?.params?.rule};await W(e,r,a,t),p(l=>l.map(f=>f.id===r?{...f,...s}:f));const c=h();c?.id===r&&w({...c,...s})}catch(t){throw n(t instanceof Error?t.message:"Failed to update field mapping"),t}finally{o(!1)}},Ve=async(e,r)=>{o(!0),n(null);try{const s=u.currentUser?.uid||"system";await q(e,!0,s,r),I(t=>t.filter(a=>a.id!==e))}catch(s){throw n(s instanceof Error?s.message:"Failed to approve suggestion"),s}finally{o(!1)}},$e=async(e,r)=>{o(!0),n(null);try{const s=u.currentUser?.uid||"system";await q(e,!1,s,r),I(t=>t.filter(a=>a.id!==e))}catch(s){throw n(s instanceof Error?s.message:"Failed to reject suggestion"),s}finally{o(!1)}},je=async(e,r,s)=>{o(!0),n(null);try{const t=u.currentUser?.uid||"system";await Z(e,r,s,t),U(a=>a.map(c=>c.id===e?{...c,accountCode:s,isLocked:!0,source:"USER_CREATED"}:c))}catch(t){throw n(t instanceof Error?t.message:"Failed to set manual account"),t}finally{o(!1)}},Qe=async(e,r)=>{o(!0),n(null);try{return await z(e,r)}catch(s){throw n(s instanceof Error?s.message:"Failed to test adapter"),s}finally{o(!1)}},ze=async(e,r)=>{o(!0),n(null);try{const s=u.currentUser?.uid||"system";await H(e,r,s),await x(e)}catch(s){throw n(s instanceof Error?s.message:"Failed to rollback adapter"),s}finally{o(!1)}},He=async(e,r,s)=>{o(!0),n(null);try{const t=u.currentUser?.uid||"system";await X(e,r,s,t),await V(e)}catch(t){throw n(t instanceof Error?t.message:"Failed to rollback field mapping"),t}finally{o(!1)}},Je=()=>{n(null)},$=async()=>{o(!0),n(null);try{const e=await se(),r=Array.isArray(e)?e:e?.data||e?.items||[];m(Array.isArray(r)?r:[])}catch(e){throw n(e instanceof Error?e.message:"Failed to load learned rules"),e}finally{o(!1)}},We=async(e,r)=>{o(!0),n(null);try{const s=u.currentUser?.uid||"system";await T(e,!0,s,r),m(a=>a.map(c=>c.id===e?{...c,isLocked:!0,lockedBy:s,lockReason:r}:c));const t=E();t?.id===e&&L({...t,isLocked:!0,lockedBy:s,lockReason:r})}catch(s){throw n(s instanceof Error?s.message:"Failed to lock learned rule"),s}finally{o(!1)}},Xe=async e=>{o(!0),n(null);try{const r=u.currentUser?.uid||"system";await T(e,!1,r),m(t=>t.map(a=>a.id===e?{...a,isLocked:!1,lockedBy:void 0,lockReason:void 0}:a));const s=E();s?.id===e&&L({...s,isLocked:!1,lockedBy:void 0,lockReason:void 0})}catch(r){throw n(r instanceof Error?r.message:"Failed to unlock learned rule"),r}finally{o(!1)}},Ye=async(e,r)=>{o(!0),n(null);try{const s=u.currentUser?.uid||"system";await te(e,r,s),m(a=>a.map(c=>c.id===e?{...c,...r}:c));const t=E();t?.id===e&&L({...t,...r})}catch(s){throw n(s instanceof Error?s.message:"Failed to update learned rule"),s}finally{o(!1)}},Ze=async(e,r)=>{o(!0),n(null);try{return await ae(e,r)}catch(s){throw n(s instanceof Error?s.message:"Failed to test learned rule"),s}finally{o(!1)}},er=async(e,r)=>{o(!0),n(null);try{const s=u.currentUser?.uid||"system";await ne(e,r,s),await $()}catch(s){throw n(s instanceof Error?s.message:"Failed to rollback learned rule"),s}finally{o(!1)}},M=async()=>{o(!0),n(null);try{const e=await oe(),r=Array.isArray(e)?e:e?.data||e?.items||[];g(Array.isArray(r)?r:[])}catch(e){throw n(e instanceof Error?e.message:"Failed to load layered rules"),e}finally{o(!1)}},rr=async()=>{o(!0),n(null);try{const e=await ge();O(e)}catch(e){throw n(e instanceof Error?e.message:"Failed to load layered rules summary"),e}finally{o(!1)}},sr=async(e,r)=>{o(!0),n(null);try{const s=u.currentUser?.uid||"system";await N(e,!0,s,r),g(a=>a.map(c=>c.id===e?{...c,lock:{...c.lock,status:"user_locked",lockedBy:s,reason:r}}:c));const t=S();t?.id===e&&v({...t,lock:{...t.lock,status:"user_locked",lockedBy:s,reason:r}})}catch(s){throw n(s instanceof Error?s.message:"Failed to lock layered rule"),s}finally{o(!1)}},tr=async e=>{o(!0),n(null);try{const r=u.currentUser?.uid||"system";await N(e,!1,r),g(t=>t.map(a=>a.id===e?{...a,lock:{...a.lock,status:"unlocked"}}:a));const s=S();s?.id===e&&v({...s,lock:{...s.lock,status:"unlocked"}})}catch(r){throw n(r instanceof Error?r.message:"Failed to unlock layered rule"),r}finally{o(!1)}},ar=async(e,r,s)=>{o(!0),n(null);try{const t=u.currentUser?.uid||"system";await ue(e,r,t,s),g(c=>c.map(l=>l.id===e?{...l,...r}:l));const a=S();a?.id===e&&v({...a,...r})}catch(t){throw n(t instanceof Error?t.message:"Failed to update layered rule"),t}finally{o(!1)}},nr=async e=>{o(!0),n(null);try{return await de(e)}catch(r){throw n(r instanceof Error?r.message:"Failed to test layered rules"),r}finally{o(!1)}},or=async(e,r,s)=>{o(!0),n(null);try{const t=u.currentUser?.uid||"system";await ie(e,r,t,s);const a=r?"user_locked":"unlocked";g(c=>c.map(l=>e.includes(l.id)?{...l,lock:{...l.lock,status:a,lockedBy:r?t:void 0,reason:s}}:l))}catch(t){throw n(t instanceof Error?t.message:"Failed to bulk lock/unlock layered rules"),t}finally{o(!1)}},cr=async()=>{o(!0),n(null);try{return await ye()}catch(e){throw n(e instanceof Error?e.message:"Failed to find duplicate rules"),e}finally{o(!1)}},ur=async()=>{o(!0),n(null);try{const e=u.currentUser?.uid||"system",r=await fe(e);return await M(),r}catch(e){throw n(e instanceof Error?e.message:"Failed to deduplicate rules"),e}finally{o(!1)}},ir=async()=>{o(!0),n(null);try{const e=u.currentUser?.uid||"system",r=await pe(e);return await M(),r}catch(e){throw n(e instanceof Error?e.message:"Failed to migrate to layered rules"),e}finally{o(!1)}},dr={adapters:b,selectedAdapter:C,fieldMappings:F,selectedFieldMapping:h,accountMappings:ke,learnedRules:B,selectedLearnedRule:E,layeredRules:R,selectedLayeredRule:S,layeredRulesSummary:me,pendingSuggestions:K,dashboardData:Ae,auditLog:he,isLoading:Ee,error:Le,setAdapters:k,setSelectedAdapter:A,setFieldMappings:p,setSelectedFieldMapping:w,setAccountMappings:U,setLearnedRules:m,setSelectedLearnedRule:L,setLayeredRules:g,setSelectedLayeredRule:v,setLayeredRulesSummary:O,setPendingSuggestions:I,setDashboardData:P,setAuditLog:we,lockedAdaptersCount:Re,unlockedAdaptersCount:Se,lowConfidenceMappings:ve,highConfidenceMappings:Ie,pendingSuggestionsCount:be,lockedLearnedRulesCount:Ce,lowConfidenceLearnedRules:Fe,layeredRulesByLayer:Ue,lockedLayeredRulesCount:Be,lowConfidenceLayeredRules:Me,loadAdapters:_e,loadAdapterById:x,loadFieldMappings:V,loadAccountMappings:qe,loadLearnedRules:$,loadPendingSuggestions:Te,loadDashboard:Ne,lockAdapter:Oe,unlockAdapter:Ke,lockFieldMapping:Pe,unlockFieldMapping:Ge,updateFieldMapping:xe,lockLearnedRule:We,unlockLearnedRule:Xe,updateLearnedRule:Ye,testLearnedRule:Ze,rollbackLearnedRule:er,approveSuggestion:Ve,rejectSuggestion:$e,setManualAccount:je,testAdapter:Qe,rollbackAdapter:ze,rollbackFieldMapping:He,clearError:Je,loadLayeredRules:M,loadLayeredRulesSummary:rr,lockLayeredRule:sr,unlockLayeredRule:tr,updateLayeredRule:ar,testLayeredRules:nr,bulkLockLayeredRules:or,findDuplicates:cr,deduplicateRules:ur,migrateToLayeredRules:ir};export{dr as s};
